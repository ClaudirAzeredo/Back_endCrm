[{"filePath":"C:\\Projetos\\Back_endCrm\\kanbanproject1\\app\\api\\funnels\\[id]\\columns\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projetos\\Back_endCrm\\kanbanproject1\\app\\api\\funnels\\[id]\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projetos\\Back_endCrm\\kanbanproject1\\app\\api\\funnels\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projetos\\Back_endCrm\\kanbanproject1\\app\\api\\mass-actions\\[id]\\items\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projetos\\Back_endCrm\\kanbanproject1\\app\\api\\mass-actions\\[id]\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projetos\\Back_endCrm\\kanbanproject1\\app\\api\\mass-actions\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projetos\\Back_endCrm\\kanbanproject1\\app\\api\\message-templates\\[id]\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projetos\\Back_endCrm\\kanbanproject1\\app\\api\\message-templates\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projetos\\Back_endCrm\\kanbanproject1\\app\\api\\setup-funnels\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projetos\\Back_endCrm\\kanbanproject1\\app\\api\\setup-tags\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projetos\\Back_endCrm\\kanbanproject1\\app\\api\\tags\\[id]\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projetos\\Back_endCrm\\kanbanproject1\\app\\api\\tags\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projetos\\Back_endCrm\\kanbanproject1\\app\\layout.tsx","messages":[{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":9,"column":14,"nodeType":"Identifier","messageId":"namedExport","endLine":9,"endColumn":32}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import type React from \"react\"\r\nimport type { Metadata } from \"next\"\r\nimport { Inter } from \"next/font/google\"\r\nimport \"./globals.css\"\r\nimport { Toaster } from \"@/components/ui/toaster\"\r\n\r\nconst inter = Inter({ subsets: [\"latin\"] })\r\n\r\nexport const metadata: Metadata = {\r\n  title: \"UniCRM - Plataforma de Gestão e Comunicação\",\r\n  description: \"Plataforma completa de CRM com integração WhatsApp, gestão de leads e dashboard inteligente\",\r\n  generator: \"v0.app\",\r\n  icons: {\r\n    icon: \"/unicrm-logo.png\",\r\n  },\r\n}\r\n\r\nexport default function RootLayout({\r\n  children,\r\n}: {\r\n  children: React.ReactNode\r\n}) {\r\n  return (\r\n    <html lang=\"pt-BR\">\r\n      <body className={inter.className}>\r\n        {children}\r\n        <Toaster />\r\n      </body>\r\n    </html>\r\n  )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Projetos\\Back_endCrm\\kanbanproject1\\app\\login\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projetos\\Back_endCrm\\kanbanproject1\\app\\lp\\[id]\\layout.tsx","messages":[{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":4,"column":14,"nodeType":"Identifier","messageId":"namedExport","endLine":4,"endColumn":32}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import type React from \"react\"\r\nimport type { Metadata } from \"next\"\r\n\r\nexport const metadata: Metadata = {\r\n  title: \"Landing Page - UniCRM\",\r\n  description: \"Página de captação de leads\",\r\n}\r\n\r\nexport default function LandingPageLayout({\r\n  children,\r\n}: {\r\n  children: React.ReactNode\r\n}) {\r\n  return children\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Projetos\\Back_endCrm\\kanbanproject1\\app\\lp\\[id]\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projetos\\Back_endCrm\\kanbanproject1\\app\\page.tsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'Image' is defined but never used.","line":14,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":14,"endColumn":13,"suggestions":[{"messageId":"removeVar","data":{"varName":"Image"},"fix":{"range":[626,637],"text":""},"desc":"Remove unused variable 'Image'."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Image' is defined but never used.","line":14,"column":8,"nodeType":null,"messageId":"unusedVar","endLine":14,"endColumn":13}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\"\r\n\r\nimport { useState, useEffect } from \"react\"\r\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\"\r\nimport { Button } from \"@/components/ui/button\"\r\nimport { LogOut, User } from \"lucide-react\"\r\nimport LeadKanban from \"@/components/project-kanban\"\r\nimport ConversationPanel from \"@/components/conversation-panel\"\r\nimport TaskCenter from \"@/components/task-center\"\r\nimport Dashboard from \"@/components/dashboard\"\r\nimport AdminPanel from \"@/components/admin-panel\"\r\nimport LoginForm from \"@/components/auth/login-form\"\r\nimport RegisterForm from \"@/components/auth/register-form\"\r\nimport Image from \"next/image\"\r\nimport { useApiAuth } from \"@/hooks/use-api-auth\"\r\nimport { hasPermission } from \"@/lib/permissions\"\r\nimport { hasChatAccess } from \"@/lib/auth\"\r\n\r\nexport default function Home() {\r\n  const [dashboardPeriod, setDashboardPeriod] = useState<\"7d\" | \"30d\" | \"90d\" | \"1y\">(\"30d\")\r\n  const [showAdminPanel, setShowAdminPanel] = useState(false)\r\n  const [authView, setAuthView] = useState<\"login\" | \"register\">(\"login\")\r\n\r\n  const { user, isAuthenticated, logout, isLoading, login, register, error } = useApiAuth()\r\n\r\n  const isSuperAdmin = user?.role === \"superadmin\"\r\n\r\n  const canAccessDashboard = hasPermission(\"dashboard\", user)\r\n  const canAccessPipeline = hasPermission(\"pipeline\", user)\r\n  const canAccessTasks = hasPermission(\"tarefas\", user)\r\n  const canAccessUniChat = hasPermission(\"unichat\", user) && hasChatAccess()\r\n\r\n  const getDefaultTab = () => {\r\n    if (canAccessDashboard) return \"dashboard\"\r\n    if (canAccessPipeline) return \"leads\"\r\n    if (canAccessTasks) return \"tasks\"\r\n    if (canAccessUniChat) return \"conversations\"\r\n    return \"dashboard\"\r\n  }\r\n\r\n  useEffect(() => {\r\n    const handler = (ev: ErrorEvent) => {\r\n      const msg = ev.message || \"\"\r\n      if (msg.includes(\"removeChild\")) {\r\n        try {\r\n          console.error(\"[DOM-ERROR]\", msg, ev.error && ev.error.stack ? ev.error.stack : null)\r\n        } catch {}\r\n      }\r\n    }\r\n    window.addEventListener(\"error\", handler)\r\n    return () => {\r\n      window.removeEventListener(\"error\", handler)\r\n    }\r\n  }, [])\r\n  \r\n  const handleLogout = async () => {\r\n    await logout()\r\n    setShowAdminPanel(false)\r\n    setAuthView(\"login\")\r\n  }\r\n\r\n  if (isLoading) {\r\n    return (\r\n      <div className=\"min-h-screen flex items-center justify-center\">\r\n        <div className=\"text-center\">\r\n          <p className=\"text-gray-600\">Carregando...</p>\r\n        </div>\r\n      </div>\r\n    )\r\n  }\r\n\r\n  if (!isAuthenticated) {\r\n    if (authView === \"login\") {\r\n      return <LoginForm onLoginSuccess={() => setAuthView(\"login\")} login={login} isLoading={isLoading} error={error} />\r\n    } else {\r\n      return <RegisterForm onRegisterSuccess={() => setAuthView(\"login\")} register={register} isLoading={isLoading} error={error} />\r\n    }\r\n  }\r\n\r\n  if (showAdminPanel && isSuperAdmin) {\r\n    return (\r\n      <div className=\"container mx-auto p-4\">\r\n        <AdminPanel onBack={() => setShowAdminPanel(false)} />\r\n      </div>\r\n    )\r\n  }\r\n\r\n  return (\r\n    <div className=\"container mx-auto p-2 md:p-4\">\r\n      <div className=\"flex flex-col sm:flex-row items-center justify-between mb-4 md:mb-6 gap-3\">\r\n        <div className=\"flex items-center gap-3\">\r\n          <img\r\n            src=\"/unicrm-logo.png\"\r\n            alt=\"UniCRM Logo\"\r\n            width={200}\r\n            height={60}\r\n            className=\"h-10 md:h-12 w-auto object-contain\"\r\n          />\r\n        </div>\r\n\r\n        <div className=\"flex items-center gap-2 md:gap-3\">\r\n          {isSuperAdmin && (\r\n            <Button\r\n              variant=\"outline\"\r\n              size=\"sm\"\r\n              onClick={() => setShowAdminPanel(true)}\r\n              className=\"flex items-center gap-2\"\r\n            >\r\n              <User className=\"w-4 h-4\" />\r\n              <span className=\"hidden sm:inline\">Admin</span>\r\n            </Button>\r\n          )}\r\n          <div className=\"flex items-center gap-2 text-xs md:text-sm text-gray-600\">\r\n            <User className=\"w-3 h-3 md:w-4 md:h-4\" />\r\n            <span className=\"truncate max-w-[150px] md:max-w-none\">{user?.email}</span>\r\n          </div>\r\n          <Button\r\n            variant=\"outline\"\r\n            size=\"sm\"\r\n            onClick={handleLogout}\r\n            className=\"flex items-center gap-1 md:gap-2 hover:bg-red-50 hover:text-red-600 hover:border-red-200 bg-transparent text-xs md:text-sm\"\r\n          >\r\n            <LogOut className=\"w-3 h-3 md:w-4 md:h-4\" />\r\n            <span className=\"hidden sm:inline\">Sair</span>\r\n          </Button>\r\n        </div>\r\n      </div>\r\n\r\n      <Tabs defaultValue={getDefaultTab()} className=\"w-full\">\r\n        <TabsList className=\"grid w-full grid-cols-4 h-auto\">\r\n          {canAccessDashboard && (\r\n            <TabsTrigger value=\"dashboard\" className=\"text-xs md:text-sm px-2 md:px-4\">\r\n              Dashboard\r\n            </TabsTrigger>\r\n          )}\r\n          {canAccessPipeline && (\r\n            <TabsTrigger value=\"leads\" className=\"text-xs md:text-sm px-2 md:px-4\">\r\n              <span className=\"hidden sm:inline\">Pipeline de Leads</span>\r\n              <span className=\"sm:hidden\">Pipeline</span>\r\n            </TabsTrigger>\r\n          )}\r\n          {canAccessTasks && (\r\n            <TabsTrigger value=\"tasks\" className=\"text-xs md:text-sm px-2 md:px-4\">\r\n              Tarefas\r\n            </TabsTrigger>\r\n          )}\r\n          {canAccessUniChat && (\r\n            <TabsTrigger value=\"conversations\" className=\"text-xs md:text-sm px-2 md:px-4\">\r\n              WhatsApp - UniCRM\r\n            </TabsTrigger>\r\n          )}\r\n        </TabsList>\r\n\r\n        {canAccessDashboard && (\r\n          <TabsContent value=\"dashboard\" className=\"mt-2 md:mt-4\">\r\n            <Dashboard\r\n              leads={[]}\r\n              projects={[]}\r\n              tasks={[]}\r\n              funnels={[]}\r\n              period={dashboardPeriod}\r\n              onPeriodChange={setDashboardPeriod}\r\n            />\r\n          </TabsContent>\r\n        )}\r\n\r\n        {canAccessPipeline && (\r\n          <TabsContent value=\"leads\" className=\"mt-2 md:mt-4\">\r\n            <LeadKanban />\r\n          </TabsContent>\r\n        )}\r\n\r\n        {canAccessTasks && (\r\n          <TabsContent value=\"tasks\" className=\"mt-2 md:mt-4\">\r\n            <TaskCenter\r\n              tasks={[]}\r\n              projects={[]}\r\n              onUpdateTask={() => {}}\r\n              onCreateTask={() => {}}\r\n              onDeleteTask={() => {}}\r\n            />\r\n          </TabsContent>\r\n        )}\r\n\r\n        {canAccessUniChat && (\r\n          <TabsContent value=\"conversations\" className=\"mt-2 md:mt-4\">\r\n            <ConversationPanel />\r\n          </TabsContent>\r\n        )}\r\n      </Tabs>\r\n    </div>\r\n  )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Projetos\\Back_endCrm\\kanbanproject1\\app\\payment\\loading.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projetos\\Back_endCrm\\kanbanproject1\\app\\payment\\page.tsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'err' is defined but never used.","line":130,"column":14,"nodeType":"Identifier","messageId":"unusedVar","endLine":130,"endColumn":17},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'err' is defined but never used.","line":130,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":130,"endColumn":17}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\"\r\n\r\nimport type React from \"react\"\r\n\r\nimport { useState, useEffect } from \"react\"\r\nimport { useRouter, useSearchParams } from \"next/navigation\"\r\nimport Link from \"next/link\"\r\nimport { Button } from \"@/components/ui/button\"\r\nimport { Input } from \"@/components/ui/input\"\r\nimport { Label } from \"@/components/ui/label\"\r\nimport { Card, CardContent, CardDescription, CardFooter, CardHeader, CardTitle } from \"@/components/ui/card\"\r\nimport { Alert, AlertDescription } from \"@/components/ui/alert\"\r\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\"\r\nimport { Separator } from \"@/components/ui/separator\"\r\nimport { AlertCircle, Loader2, ArrowLeft, CreditCard, Building, CheckCircle2, Calendar, Lock } from \"lucide-react\"\r\n\r\n// Tipos\r\ntype PlanType = {\r\n  id: string\r\n  name: string\r\n  price: number\r\n  description: string\r\n  features: string[]\r\n  recommended?: boolean\r\n}\r\n\r\n// Dados dos planos\r\nconst plans: PlanType[] = [\r\n  {\r\n    id: \"basic\",\r\n    name: \"Básico\",\r\n    price: 99,\r\n    description: \"Para pequenas equipes e projetos simples\",\r\n    features: [\"Até 5 projetos ativos\", \"Até 3 usuários\", \"Kanban básico\", \"Suporte por email\"],\r\n  },\r\n  {\r\n    id: \"pro\",\r\n    name: \"Profissional\",\r\n    price: 199,\r\n    description: \"Para equipes em crescimento\",\r\n    features: [\r\n      \"Projetos ilimitados\",\r\n      \"Até 10 usuários\",\r\n      \"Kanban avançado\",\r\n      \"Integração com WhatsApp\",\r\n      \"Suporte prioritário\",\r\n    ],\r\n    recommended: true,\r\n  },\r\n  {\r\n    id: \"enterprise\",\r\n    name: \"Empresarial\",\r\n    price: 399,\r\n    description: \"Para grandes organizações\",\r\n    features: [\r\n      \"Projetos ilimitados\",\r\n      \"Usuários ilimitados\",\r\n      \"Kanban avançado\",\r\n      \"Integração com WhatsApp\",\r\n      \"API personalizada\",\r\n      \"Suporte 24/7\",\r\n      \"Gerente de conta dedicado\",\r\n    ],\r\n  },\r\n]\r\n\r\nexport default function PaymentPage() {\r\n  const router = useRouter()\r\n  const searchParams = useSearchParams()\r\n  const [isLoading, setIsLoading] = useState(false)\r\n  const [isSuccess, setIsSuccess] = useState(false)\r\n  const [error, setError] = useState<string | null>(null)\r\n  const [planId, setPlanId] = useState<string>(\"pro\")\r\n  const [selectedPlan, setSelectedPlan] = useState<PlanType | null>(null)\r\n\r\n  // Estado para formulário de pagamento\r\n  const [paymentForm, setPaymentForm] = useState({\r\n    cardName: \"\",\r\n    cardNumber: \"\",\r\n    cardExpiry: \"\",\r\n    cardCvc: \"\",\r\n    billingName: \"\",\r\n    billingAddress: \"\",\r\n    billingCity: \"\",\r\n    billingState: \"\",\r\n    billingZip: \"\",\r\n    billingCountry: \"Brasil\",\r\n  })\r\n\r\n  // Obter o plano da URL\r\n  useEffect(() => {\r\n    const planParam = searchParams.get(\"plan\")\r\n    if (planParam) {\r\n      setPlanId(planParam)\r\n    }\r\n  }, [searchParams])\r\n\r\n  // Atualizar o plano selecionado quando o ID mudar\r\n  useEffect(() => {\r\n    const plan = plans.find((p) => p.id === planId)\r\n    if (plan) {\r\n      setSelectedPlan(plan)\r\n    }\r\n  }, [planId])\r\n\r\n  // Manipulador para processar pagamento\r\n  const handlePayment = async (e: React.FormEvent) => {\r\n    e.preventDefault()\r\n    setError(null)\r\n\r\n    // Validação básica\r\n    if (!paymentForm.cardName || !paymentForm.cardNumber || !paymentForm.cardExpiry || !paymentForm.cardCvc) {\r\n      setError(\"Por favor, preencha todos os campos do cartão\")\r\n      return\r\n    }\r\n\r\n    try {\r\n      setIsLoading(true)\r\n\r\n      // Simulação de processamento de pagamento - aqui você implementaria a lógica real\r\n      await new Promise((resolve) => setTimeout(resolve, 2000))\r\n\r\n      // Simular sucesso\r\n      setIsSuccess(true)\r\n\r\n      // Redirecionar após alguns segundos\r\n      setTimeout(() => {\r\n        router.push(\"/\")\r\n      }, 3000)\r\n    } catch (err) {\r\n      setError(\"Não foi possível processar o pagamento. Verifique os dados do cartão.\")\r\n    } finally {\r\n      setIsLoading(false)\r\n    }\r\n  }\r\n\r\n  // Formatar número do cartão\r\n  const formatCardNumber = (value: string) => {\r\n    const v = value.replace(/\\s+/g, \"\").replace(/[^0-9]/gi, \"\")\r\n    const matches = v.match(/\\d{4,16}/g)\r\n    const match = (matches && matches[0]) || \"\"\r\n    const parts = []\r\n\r\n    for (let i = 0; i < match.length; i += 4) {\r\n      parts.push(match.substring(i, i + 4))\r\n    }\r\n\r\n    if (parts.length) {\r\n      return parts.join(\" \")\r\n    } else {\r\n      return value\r\n    }\r\n  }\r\n\r\n  // Formatar data de expiração\r\n  const formatExpiry = (value: string) => {\r\n    const v = value.replace(/\\s+/g, \"\").replace(/[^0-9]/gi, \"\")\r\n\r\n    if (v.length >= 2) {\r\n      return `${v.substring(0, 2)}/${v.substring(2, 4)}`\r\n    }\r\n\r\n    return value\r\n  }\r\n\r\n  // Se o pagamento foi bem-sucedido, mostrar tela de confirmação\r\n  if (isSuccess) {\r\n    return (\r\n      <div className=\"min-h-screen flex items-center justify-center bg-slate-50 p-4\">\r\n        <Card className=\"w-full max-w-md\">\r\n          <CardHeader className=\"text-center\">\r\n            <div className=\"mx-auto bg-green-100 p-3 rounded-full w-16 h-16 flex items-center justify-center mb-4\">\r\n              <CheckCircle2 className=\"h-8 w-8 text-green-600\" />\r\n            </div>\r\n            <CardTitle className=\"text-2xl\">Pagamento Confirmado!</CardTitle>\r\n            <CardDescription>Seu plano foi ativado com sucesso</CardDescription>\r\n          </CardHeader>\r\n          <CardContent className=\"text-center\">\r\n            <p className=\"mb-4\">\r\n              Obrigado por escolher nosso sistema. Você agora tem acesso ao plano{\" \"}\r\n              <span className=\"font-bold\">{selectedPlan?.name}</span>.\r\n            </p>\r\n            <p className=\"text-muted-foreground\">Você será redirecionado para o dashboard em alguns segundos...</p>\r\n          </CardContent>\r\n          <CardFooter>\r\n            <Button className=\"w-full\" onClick={() => router.push(\"/\")}>\r\n              Ir para o Dashboard\r\n            </Button>\r\n          </CardFooter>\r\n        </Card>\r\n      </div>\r\n    )\r\n  }\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-slate-50 py-8\">\r\n      <div className=\"container mx-auto px-4\">\r\n        <Link\r\n          href=\"/login\"\r\n          className=\"inline-flex items-center text-sm text-muted-foreground hover:text-foreground mb-6\"\r\n        >\r\n          <ArrowLeft className=\"mr-2 h-4 w-4\" />\r\n          Voltar para login\r\n        </Link>\r\n\r\n        <div className=\"grid md:grid-cols-3 gap-8 max-w-6xl mx-auto\">\r\n          {/* Coluna de Pagamento */}\r\n          <div className=\"md:col-span-2\">\r\n            <Card>\r\n              <CardHeader>\r\n                <CardTitle>Informações de Pagamento</CardTitle>\r\n                <CardDescription>Preencha os dados para finalizar sua assinatura</CardDescription>\r\n              </CardHeader>\r\n\r\n              <Tabs defaultValue=\"card\" className=\"w-full\">\r\n                <TabsList className=\"grid w-full grid-cols-2 px-6\">\r\n                  <TabsTrigger value=\"card\" className=\"flex items-center\">\r\n                    <CreditCard className=\"h-4 w-4 mr-2\" />\r\n                    Cartão de Crédito\r\n                  </TabsTrigger>\r\n                  <TabsTrigger value=\"invoice\" className=\"flex items-center\">\r\n                    <Building className=\"h-4 w-4 mr-2\" />\r\n                    Boleto Bancário\r\n                  </TabsTrigger>\r\n                </TabsList>\r\n\r\n                <TabsContent value=\"card\">\r\n                  <form onSubmit={handlePayment}>\r\n                    <CardContent className=\"space-y-6\">\r\n                      {error && (\r\n                        <Alert variant=\"destructive\">\r\n                          <AlertCircle className=\"h-4 w-4\" />\r\n                          <AlertDescription>{error}</AlertDescription>\r\n                        </Alert>\r\n                      )}\r\n\r\n                      <div className=\"space-y-4\">\r\n                        <h3 className=\"text-lg font-medium\">Dados do Cartão</h3>\r\n\r\n                        <div className=\"space-y-2\">\r\n                          <Label htmlFor=\"cardName\">Nome no Cartão</Label>\r\n                          <Input\r\n                            id=\"cardName\"\r\n                            placeholder=\"Nome como aparece no cartão\"\r\n                            value={paymentForm.cardName}\r\n                            onChange={(e) => setPaymentForm({ ...paymentForm, cardName: e.target.value })}\r\n                            disabled={isLoading}\r\n                          />\r\n                        </div>\r\n\r\n                        <div className=\"space-y-2\">\r\n                          <Label htmlFor=\"cardNumber\">Número do Cartão</Label>\r\n                          <div className=\"relative\">\r\n                            <Input\r\n                              id=\"cardNumber\"\r\n                              placeholder=\"1234 5678 9012 3456\"\r\n                              value={paymentForm.cardNumber}\r\n                              onChange={(e) =>\r\n                                setPaymentForm({\r\n                                  ...paymentForm,\r\n                                  cardNumber: formatCardNumber(e.target.value),\r\n                                })\r\n                              }\r\n                              maxLength={19}\r\n                              disabled={isLoading}\r\n                            />\r\n                            <Lock className=\"absolute right-3 top-2.5 h-4 w-4 text-muted-foreground\" />\r\n                          </div>\r\n                        </div>\r\n\r\n                        <div className=\"grid grid-cols-2 gap-4\">\r\n                          <div className=\"space-y-2\">\r\n                            <Label htmlFor=\"cardExpiry\">Validade</Label>\r\n                            <div className=\"relative\">\r\n                              <Input\r\n                                id=\"cardExpiry\"\r\n                                placeholder=\"MM/AA\"\r\n                                value={paymentForm.cardExpiry}\r\n                                onChange={(e) =>\r\n                                  setPaymentForm({\r\n                                    ...paymentForm,\r\n                                    cardExpiry: formatExpiry(e.target.value),\r\n                                  })\r\n                                }\r\n                                maxLength={5}\r\n                                disabled={isLoading}\r\n                              />\r\n                              <Calendar className=\"absolute right-3 top-2.5 h-4 w-4 text-muted-foreground\" />\r\n                            </div>\r\n                          </div>\r\n                          <div className=\"space-y-2\">\r\n                            <Label htmlFor=\"cardCvc\">CVC</Label>\r\n                            <Input\r\n                              id=\"cardCvc\"\r\n                              placeholder=\"123\"\r\n                              value={paymentForm.cardCvc}\r\n                              onChange={(e) =>\r\n                                setPaymentForm({\r\n                                  ...paymentForm,\r\n                                  cardCvc: e.target.value.replace(/\\D/g, \"\").substring(0, 3),\r\n                                })\r\n                              }\r\n                              maxLength={3}\r\n                              disabled={isLoading}\r\n                            />\r\n                          </div>\r\n                        </div>\r\n                      </div>\r\n\r\n                      <Separator />\r\n\r\n                      <div className=\"space-y-4\">\r\n                        <h3 className=\"text-lg font-medium\">Endereço de Cobrança</h3>\r\n\r\n                        <div className=\"space-y-2\">\r\n                          <Label htmlFor=\"billingName\">Nome Completo</Label>\r\n                          <Input\r\n                            id=\"billingName\"\r\n                            placeholder=\"Nome completo\"\r\n                            value={paymentForm.billingName}\r\n                            onChange={(e) => setPaymentForm({ ...paymentForm, billingName: e.target.value })}\r\n                            disabled={isLoading}\r\n                          />\r\n                        </div>\r\n\r\n                        <div className=\"space-y-2\">\r\n                          <Label htmlFor=\"billingAddress\">Endereço</Label>\r\n                          <Input\r\n                            id=\"billingAddress\"\r\n                            placeholder=\"Rua, número, complemento\"\r\n                            value={paymentForm.billingAddress}\r\n                            onChange={(e) => setPaymentForm({ ...paymentForm, billingAddress: e.target.value })}\r\n                            disabled={isLoading}\r\n                          />\r\n                        </div>\r\n\r\n                        <div className=\"grid grid-cols-2 gap-4\">\r\n                          <div className=\"space-y-2\">\r\n                            <Label htmlFor=\"billingCity\">Cidade</Label>\r\n                            <Input\r\n                              id=\"billingCity\"\r\n                              placeholder=\"Cidade\"\r\n                              value={paymentForm.billingCity}\r\n                              onChange={(e) => setPaymentForm({ ...paymentForm, billingCity: e.target.value })}\r\n                              disabled={isLoading}\r\n                            />\r\n                          </div>\r\n                          <div className=\"space-y-2\">\r\n                            <Label htmlFor=\"billingState\">Estado</Label>\r\n                            <Input\r\n                              id=\"billingState\"\r\n                              placeholder=\"Estado\"\r\n                              value={paymentForm.billingState}\r\n                              onChange={(e) => setPaymentForm({ ...paymentForm, billingState: e.target.value })}\r\n                              disabled={isLoading}\r\n                            />\r\n                          </div>\r\n                        </div>\r\n\r\n                        <div className=\"grid grid-cols-2 gap-4\">\r\n                          <div className=\"space-y-2\">\r\n                            <Label htmlFor=\"billingZip\">CEP</Label>\r\n                            <Input\r\n                              id=\"billingZip\"\r\n                              placeholder=\"00000-000\"\r\n                              value={paymentForm.billingZip}\r\n                              onChange={(e) => setPaymentForm({ ...paymentForm, billingZip: e.target.value })}\r\n                              disabled={isLoading}\r\n                            />\r\n                          </div>\r\n                          <div className=\"space-y-2\">\r\n                            <Label htmlFor=\"billingCountry\">País</Label>\r\n                            <Input\r\n                              id=\"billingCountry\"\r\n                              value={paymentForm.billingCountry}\r\n                              onChange={(e) => setPaymentForm({ ...paymentForm, billingCountry: e.target.value })}\r\n                              disabled={isLoading}\r\n                            />\r\n                          </div>\r\n                        </div>\r\n                      </div>\r\n                    </CardContent>\r\n\r\n                    <CardFooter>\r\n                      <Button type=\"submit\" className=\"w-full\" disabled={isLoading}>\r\n                        {isLoading ? (\r\n                          <>\r\n                            <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />\r\n                            Processando...\r\n                          </>\r\n                        ) : (\r\n                          <>\r\n                            <Lock className=\"mr-2 h-4 w-4\" />\r\n                            Pagar R${selectedPlan?.price},00\r\n                          </>\r\n                        )}\r\n                      </Button>\r\n                    </CardFooter>\r\n                  </form>\r\n                </TabsContent>\r\n\r\n                <TabsContent value=\"invoice\">\r\n                  <CardContent className=\"space-y-4 py-6\">\r\n                    <div className=\"text-center p-6\">\r\n                      <Building className=\"h-12 w-12 mx-auto text-muted-foreground mb-4\" />\r\n                      <h3 className=\"text-lg font-medium mb-2\">Pagamento por Boleto</h3>\r\n                      <p className=\"text-muted-foreground mb-4\">\r\n                        Ao clicar em \"Gerar Boleto\", você receberá um boleto bancário para pagamento em até 3 dias\r\n                        úteis.\r\n                      </p>\r\n                      <Alert className=\"bg-amber-50 text-amber-800 border-amber-200\">\r\n                        <AlertCircle className=\"h-4 w-4\" />\r\n                        <AlertDescription>\r\n                          Seu acesso será liberado somente após a confirmação do pagamento.\r\n                        </AlertDescription>\r\n                      </Alert>\r\n                    </div>\r\n                  </CardContent>\r\n\r\n                  <CardFooter>\r\n                    <Button className=\"w-full\" variant=\"outline\">\r\n                      Gerar Boleto\r\n                    </Button>\r\n                  </CardFooter>\r\n                </TabsContent>\r\n              </Tabs>\r\n            </Card>\r\n          </div>\r\n\r\n          {/* Coluna de Resumo */}\r\n          <div>\r\n            <Card>\r\n              <CardHeader>\r\n                <CardTitle>Resumo do Pedido</CardTitle>\r\n              </CardHeader>\r\n              <CardContent className=\"space-y-4\">\r\n                {selectedPlan && (\r\n                  <>\r\n                    <div className=\"bg-muted p-4 rounded-lg\">\r\n                      <div className=\"flex justify-between items-center mb-2\">\r\n                        <h3 className=\"font-medium\">Plano {selectedPlan.name}</h3>\r\n                        <span className=\"font-bold\">R${selectedPlan.price},00</span>\r\n                      </div>\r\n                      <p className=\"text-sm text-muted-foreground mb-3\">{selectedPlan.description}</p>\r\n                      <div className=\"space-y-1\">\r\n                        {selectedPlan.features.slice(0, 3).map((feature, index) => (\r\n                          <div key={index} className=\"flex items-start text-sm\">\r\n                            <CheckCircle2 className=\"h-4 w-4 text-green-500 mr-2 shrink-0 mt-0.5\" />\r\n                            <span>{feature}</span>\r\n                          </div>\r\n                        ))}\r\n                        {selectedPlan.features.length > 3 && (\r\n                          <p className=\"text-sm text-muted-foreground\">\r\n                            + {selectedPlan.features.length - 3} outros recursos\r\n                          </p>\r\n                        )}\r\n                      </div>\r\n                    </div>\r\n\r\n                    <Separator />\r\n\r\n                    <div className=\"space-y-2\">\r\n                      <div className=\"flex justify-between\">\r\n                        <span className=\"text-muted-foreground\">Subtotal</span>\r\n                        <span>R${selectedPlan.price},00</span>\r\n                      </div>\r\n                      <div className=\"flex justify-between\">\r\n                        <span className=\"text-muted-foreground\">Impostos</span>\r\n                        <span>R$0,00</span>\r\n                      </div>\r\n                      <Separator className=\"my-2\" />\r\n                      <div className=\"flex justify-between font-bold\">\r\n                        <span>Total</span>\r\n                        <span>R${selectedPlan.price},00</span>\r\n                      </div>\r\n                      <div className=\"text-sm text-muted-foreground\">Cobrança mensal, cancele a qualquer momento</div>\r\n                    </div>\r\n\r\n                    <div className=\"bg-muted p-3 rounded-lg text-sm\">\r\n                      <p className=\"flex items-center\">\r\n                        <Lock className=\"h-4 w-4 mr-2 text-muted-foreground\" />\r\n                        Pagamento seguro via criptografia SSL\r\n                      </p>\r\n                    </div>\r\n                  </>\r\n                )}\r\n              </CardContent>\r\n            </Card>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Projetos\\Back_endCrm\\kanbanproject1\\app\\verify-code\\page.tsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'err' is defined but never used.","line":100,"column":14,"nodeType":"Identifier","messageId":"unusedVar","endLine":100,"endColumn":17},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'err' is defined but never used.","line":100,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":100,"endColumn":17},{"ruleId":"no-unused-vars","severity":1,"message":"'err' is defined but never used.","line":132,"column":14,"nodeType":"Identifier","messageId":"unusedVar","endLine":132,"endColumn":17},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'err' is defined but never used.","line":132,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":132,"endColumn":17}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\"\r\n\r\nimport type React from \"react\"\r\n\r\nimport { useState, useRef, useEffect } from \"react\"\r\nimport { useRouter } from \"next/navigation\"\r\nimport Link from \"next/link\"\r\nimport { Button } from \"@/components/ui/button\"\r\nimport { Input } from \"@/components/ui/input\"\r\nimport { Card, CardContent, CardDescription, CardFooter, CardHeader, CardTitle } from \"@/components/ui/card\"\r\nimport { Alert, AlertDescription } from \"@/components/ui/alert\"\r\nimport { AlertCircle, ArrowLeft, Loader2 } from \"lucide-react\"\r\n\r\nexport default function VerifyCodePage() {\r\n  const router = useRouter()\r\n  const [isLoading, setIsLoading] = useState(false)\r\n  const [error, setError] = useState<string | null>(null)\r\n  const [countdown, setCountdown] = useState(30)\r\n  const [canResend, setCanResend] = useState(false)\r\n\r\n  // Estado para os dígitos do código OTP\r\n  const [code, setCode] = useState([\"\", \"\", \"\", \"\", \"\", \"\"])\r\n  const inputRefs = useRef<(HTMLInputElement | null)[]>([])\r\n\r\n  // Iniciar contagem regressiva para reenvio\r\n  useEffect(() => {\r\n    const timer = setInterval(() => {\r\n      setCountdown((prev) => {\r\n        if (prev <= 1) {\r\n          clearInterval(timer)\r\n          setCanResend(true)\r\n          return 0\r\n        }\r\n        return prev - 1\r\n      })\r\n    }, 1000)\r\n\r\n    return () => clearInterval(timer)\r\n  }, [])\r\n\r\n  // Manipulador para entrada de código\r\n  const handleCodeChange = (index: number, value: string) => {\r\n    // Permitir apenas dígitos\r\n    if (!/^\\d*$/.test(value)) return\r\n\r\n    // Atualizar o código\r\n    const newCode = [...code]\r\n    newCode[index] = value\r\n    setCode(newCode)\r\n\r\n    // Mover para o próximo input se o valor for preenchido\r\n    if (value && index < 5) {\r\n      inputRefs.current[index + 1]?.focus()\r\n    }\r\n  }\r\n\r\n  // Manipulador para tecla de backspace\r\n  const handleKeyDown = (index: number, e: React.KeyboardEvent<HTMLInputElement>) => {\r\n    if (e.key === \"Backspace\" && !code[index] && index > 0) {\r\n      inputRefs.current[index - 1]?.focus()\r\n    }\r\n  }\r\n\r\n  // Manipulador para colar código\r\n  const handlePaste = (e: React.ClipboardEvent<HTMLInputElement>) => {\r\n    e.preventDefault()\r\n    const pastedData = e.clipboardData.getData(\"text/plain\").trim()\r\n\r\n    // Verificar se o texto colado contém apenas dígitos e tem o comprimento correto\r\n    if (/^\\d{6}$/.test(pastedData)) {\r\n      const digits = pastedData.split(\"\")\r\n      setCode(digits)\r\n\r\n      // Focar no último input\r\n      inputRefs.current[5]?.focus()\r\n    }\r\n  }\r\n\r\n  // Manipulador para verificar código\r\n  const handleVerifyCode = async (e: React.FormEvent) => {\r\n    e.preventDefault()\r\n    setError(null)\r\n\r\n    const fullCode = code.join(\"\")\r\n\r\n    // Validação básica\r\n    if (fullCode.length !== 6) {\r\n      setError(\"Por favor, insira o código completo de 6 dígitos\")\r\n      return\r\n    }\r\n\r\n    try {\r\n      setIsLoading(true)\r\n\r\n      // Simulação de verificação - aqui você implementaria a lógica real\r\n      await new Promise((resolve) => setTimeout(resolve, 1500))\r\n\r\n      // Redirecionar para a página principal após verificação bem-sucedida\r\n      router.push(\"/\")\r\n    } catch (err) {\r\n      setError(\"Código inválido. Por favor, tente novamente.\")\r\n    } finally {\r\n      setIsLoading(false)\r\n    }\r\n  }\r\n\r\n  // Manipulador para reenviar código\r\n  const handleResendCode = async () => {\r\n    if (!canResend) return\r\n\r\n    try {\r\n      setIsLoading(true)\r\n\r\n      // Simulação de reenvio - aqui você implementaria a lógica real\r\n      await new Promise((resolve) => setTimeout(resolve, 1000))\r\n\r\n      // Reiniciar contagem regressiva\r\n      setCountdown(30)\r\n      setCanResend(false)\r\n\r\n      // Iniciar novo timer\r\n      const timer = setInterval(() => {\r\n        setCountdown((prev) => {\r\n          if (prev <= 1) {\r\n            clearInterval(timer)\r\n            setCanResend(true)\r\n            return 0\r\n          }\r\n          return prev - 1\r\n        })\r\n      }, 1000)\r\n    } catch (err) {\r\n      setError(\"Não foi possível reenviar o código. Tente novamente.\")\r\n    } finally {\r\n      setIsLoading(false)\r\n    }\r\n  }\r\n\r\n  return (\r\n    <div className=\"min-h-screen flex items-center justify-center bg-slate-50 p-4\">\r\n      <div className=\"w-full max-w-md\">\r\n        <Link\r\n          href=\"/login\"\r\n          className=\"inline-flex items-center text-sm text-muted-foreground hover:text-foreground mb-6\"\r\n        >\r\n          <ArrowLeft className=\"mr-2 h-4 w-4\" />\r\n          Voltar para login\r\n        </Link>\r\n\r\n        <Card>\r\n          <CardHeader>\r\n            <CardTitle>Verificação de Código</CardTitle>\r\n            <CardDescription>Insira o código de 6 dígitos enviado para seu telefone</CardDescription>\r\n          </CardHeader>\r\n\r\n          <form onSubmit={handleVerifyCode}>\r\n            <CardContent className=\"space-y-4\">\r\n              {error && (\r\n                <Alert variant=\"destructive\">\r\n                  <AlertCircle className=\"h-4 w-4\" />\r\n                  <AlertDescription>{error}</AlertDescription>\r\n                </Alert>\r\n              )}\r\n\r\n              <div className=\"flex justify-between gap-2\">\r\n                {code.map((digit, index) => (\r\n                  <Input\r\n                    key={index}\r\n                    ref={(el) => (inputRefs.current[index] = el)}\r\n                    type=\"text\"\r\n                    inputMode=\"numeric\"\r\n                    maxLength={1}\r\n                    className=\"w-12 h-12 text-center text-lg\"\r\n                    value={digit}\r\n                    onChange={(e) => handleCodeChange(index, e.target.value)}\r\n                    onKeyDown={(e) => handleKeyDown(index, e)}\r\n                    onPaste={index === 0 ? handlePaste : undefined}\r\n                    disabled={isLoading}\r\n                    autoFocus={index === 0}\r\n                  />\r\n                ))}\r\n              </div>\r\n\r\n              <div className=\"text-center\">\r\n                <p className=\"text-sm text-muted-foreground\">\r\n                  Não recebeu o código?{\" \"}\r\n                  <Button\r\n                    variant=\"link\"\r\n                    className=\"p-0 h-auto\"\r\n                    onClick={handleResendCode}\r\n                    disabled={!canResend || isLoading}\r\n                  >\r\n                    {canResend ? \"Reenviar código\" : <>Reenviar em {countdown}s</>}\r\n                  </Button>\r\n                </p>\r\n              </div>\r\n            </CardContent>\r\n\r\n            <CardFooter>\r\n              <Button type=\"submit\" className=\"w-full\" disabled={isLoading}>\r\n                {isLoading ? (\r\n                  <>\r\n                    <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />\r\n                    Verificando...\r\n                  </>\r\n                ) : (\r\n                  \"Verificar Código\"\r\n                )}\r\n              </Button>\r\n            </CardFooter>\r\n          </form>\r\n        </Card>\r\n      </div>\r\n    </div>\r\n  )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Projetos\\Back_endCrm\\kanbanproject1\\components\\App.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'Header' is defined but never used.","line":4,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":4,"endColumn":14,"suggestions":[{"messageId":"removeVar","data":{"varName":"Header"},"fix":{"range":[57,69],"text":""},"desc":"Remove unused variable 'Header'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'Navigation' is defined but never used.","line":5,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":5,"endColumn":18,"suggestions":[{"messageId":"removeVar","data":{"varName":"Navigation"},"fix":{"range":[88,104],"text":""},"desc":"Remove unused variable 'Navigation'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'Dashboard' is defined but never used.","line":6,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":6,"endColumn":17,"suggestions":[{"messageId":"removeVar","data":{"varName":"Dashboard"},"fix":{"range":[127,142],"text":""},"desc":"Remove unused variable 'Dashboard'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'KanbanBoard' is defined but never used.","line":7,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":7,"endColumn":19,"suggestions":[{"messageId":"removeVar","data":{"varName":"KanbanBoard"},"fix":{"range":[164,181],"text":""},"desc":"Remove unused variable 'KanbanBoard'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'TaskCenter' is defined but never used.","line":8,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":8,"endColumn":18,"suggestions":[{"messageId":"removeVar","data":{"varName":"TaskCenter"},"fix":{"range":[205,221],"text":""},"desc":"Remove unused variable 'TaskCenter'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'ConversationPanel' is defined but never used.","line":9,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":9,"endColumn":25,"suggestions":[{"messageId":"removeVar","data":{"varName":"ConversationPanel"},"fix":{"range":[244,267],"text":""},"desc":"Remove unused variable 'ConversationPanel'."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":6,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\"\r\n\r\nimport { useState } from \"react\"\r\nimport Header from \"./Header\"\r\nimport Navigation from \"./Navigation\"\r\nimport Dashboard from \"./Dashboard\"\r\nimport KanbanBoard from \"./KanbanBoard\"\r\nimport TaskCenter from \"./TaskCenter\"\r\nimport ConversationPanel from \"./ConversationPanel\"\r\nimport \"../styles/globals.css\"\r\nimport \"../styles/components.css\"\r\n\r\n// Dados de exemplo para funis\r\nconst sampleFunnels = [\r\n  {\r\n    id: \"funnel1\",\r\n    name: \"Vendas B2B\",\r\n    description: \"Funil para vendas corporativas\",\r\n    columns: [\r\n      { id: \"novo\", name: \"Novos Leads\", color: \"#64748b\", order: 0 },\r\n      { id: \"qualificado\", name: \"Qualificados\", color: \"#3b82f6\", order: 1 },\r\n      { id: \"proposta\", name: \"Proposta\", color: \"#f59e0b\", order: 2 },\r\n      { id: \"negociacao\", name: \"Negociação\", color: \"#8b5cf6\", order: 3 },\r\n      { id: \"ganho\", name: \"Ganhos\", color: \"#10b981\", order: 4 },\r\n      { id: \"perdido\", name: \"Perdidos\", color: \"#ef4444\", order: 5 },\r\n    ],\r\n    isActive: true,\r\n    createdAt: \"2024-01-01T00:00:00Z\",\r\n  },\r\n  {\r\n    id: \"funnel2\",\r\n    name: \"Vendas B2C\",\r\n    description: \"Funil para vendas diretas ao consumidor\",\r\n    columns: [\r\n      { id: \"interesse\", name: \"Interesse\", color: \"#64748b\", order: 0 },\r\n      { id: \"contato\", name: \"Primeiro Contato\", color: \"#3b82f6\", order: 1 },\r\n      { id: \"demonstracao\", name: \"Demonstração\", color: \"#f59e0b\", order: 2 },\r\n      { id: \"fechamento\", name: \"Fechamento\", color: \"#10b981\", order: 3 },\r\n      { id: \"perdido\", name: \"Perdidos\", color: \"#ef4444\", order: 4 },\r\n    ],\r\n    isActive: true,\r\n    createdAt: \"2024-01-02T00:00:00Z\",\r\n  },\r\n]\r\n\r\n// Dados de exemplo para leads\r\nconst sampleLeads = [\r\n  {\r\n    id: \"l1\",\r\n    name: \"João Silva\",\r\n    company: \"Tech Corp\",\r\n    status: \"qualificado\",\r\n    priority: \"high\",\r\n    source: \"website\",\r\n    estimatedValue: 50000,\r\n    expectedCloseDate: \"2024-02-15\",\r\n    createdAt: \"2024-01-10T10:00:00Z\",\r\n    funnelId: \"funnel1\",\r\n  },\r\n  {\r\n    id: \"l2\",\r\n    name: \"Maria Santos\",\r\n    company: \"Digital Solutions\",\r\n    status: \"proposta\",\r\n    priority: \"medium\",\r\n    source: \"google_ads\",\r\n    estimatedValue: 75000,\r\n    expectedCloseDate: \"2024-02-20\",\r\n    createdAt: \"2024-01-12T14:30:00Z\",\r\n    funnelId: \"funnel1\",\r\n  },\r\n  {\r\n    id: \"l3\",\r\n    name: \"Pedro Costa\",\r\n    company: \"Innovation Labs\",\r\n    status: \"ganho\",\r\n    priority: \"urgent\",\r\n    source: \"referral\",\r\n    estimatedValue: 120000,\r\n    expectedCloseDate: \"2024-01-30\",\r\n    createdAt: \"2024-01-05T09:15:00Z\",\r\n    funnelId: \"funnel1\",\r\n  },\r\n  {\r\n    id: \"l4\",\r\n    name: \"Ana Oliveira\",\r\n    company: \"StartupXYZ\",\r\n    status: \"interesse\",\r\n    priority: \"medium\",\r\n    source: \"linkedin\",\r\n    estimatedValue: 35000,\r\n    expectedCloseDate: \"2024-03-01\",\r\n    createdAt: \"2024-01-15T16:20:00Z\",\r\n    funnelId: \"funnel2\",\r\n  },\r\n]\r\n\r\nconst sampleTasks = [\r\n  {\r\n    id: \"t1\",\r\n    title: \"Ligar para João Silva\",\r\n    status: \"completed\",\r\n    priority: \"high\",\r\n    dueDate: \"2024-01-20\",\r\n    createdAt: \"2024-01-15T10:00:00Z\",\r\n    leadId: \"l1\",\r\n    funnelId: \"funnel1\",\r\n  },\r\n  {\r\n    id: \"t2\",\r\n    title: \"Enviar proposta para Maria Santos\",\r\n    status: \"in_progress\",\r\n    priority: \"medium\",\r\n    dueDate: \"2024-01-25\",\r\n    createdAt: \"2024-01-16T14:00:00Z\",\r\n    leadId: \"l2\",\r\n    funnelId: \"funnel1\",\r\n  },\r\n]\r\n\r\nfunction App() {\r\n  const [activeTab, setActiveTab] = useState(\"dashboard\")\r\n  const [dashboardPeriod, setDashboardPeriod] = useState(\"30d\")\r\n\r\n  const handleTabChange = (tab) => {\r\n    setActiveTab(tab)\r\n  }\r\n\r\n  const renderContent = () => {\r\n    switch (activeTab) {\r\n      case \"dashboard\":\r\n        return (\r\n          <Dashboard\r\n            leads={sampleLeads}\r\n            tasks={sampleTasks}\r\n            funnels={sampleFunnels}\r\n            period={dashboardPeriod}\r\n            onPeriodChange={setDashboardPeriod}\r\n          />\r\n        )\r\n      case \"leads\":\r\n        return <KanbanBoard />\r\n      case \"tasks\":\r\n        return (\r\n          <TaskCenter\r\n            tasks={sampleTasks}\r\n            projects={sampleLeads.map((lead) => ({\r\n              id: lead.id,\r\n              title: `Lead: ${lead.name}`,\r\n              client: lead.company,\r\n              status: lead.status,\r\n            }))}\r\n            onUpdateTask={(taskId, updates) => {\r\n              console.log(\"Update task:\", taskId, updates)\r\n            }}\r\n            onCreateTask={(task) => {\r\n              console.log(\"Create task:\", task)\r\n            }}\r\n            onDeleteTask={(taskId) => {\r\n              console.log(\"Delete task:\", taskId)\r\n            }}\r\n          />\r\n        )\r\n      case \"conversations\":\r\n        return <ConversationPanel />\r\n      default:\r\n        return <Dashboard />\r\n    }\r\n  }\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-gray-50\">\r\n      <Header />\r\n      <div className=\"container mx-auto p-4\">\r\n        <Navigation activeTab={activeTab} onTabChange={handleTabChange} />\r\n        <div className=\"mt-4\">{renderContent()}</div>\r\n      </div>\r\n    </div>\r\n  )\r\n}\r\n\r\nexport default App\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Projetos\\Back_endCrm\\kanbanproject1\\components\\ChartCard.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projetos\\Back_endCrm\\kanbanproject1\\components\\ConversationPanel.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'ContactItem' is defined but never used.","line":255,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":255,"endColumn":21,"suggestions":[{"messageId":"removeVar","data":{"varName":"ContactItem"},"fix":{"range":[8148,9386],"text":""},"desc":"Remove unused variable 'ContactItem'."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\"\r\n\r\nimport { useState } from \"react\"\r\n\r\n// Dados de exemplo\r\nconst contacts = [\r\n  {\r\n    id: \"c1\",\r\n    name: \"João Silva\",\r\n    avatar: \"/placeholder.svg?height=40&width=40\",\r\n    project: \"Implementação ERP\",\r\n    lastMessage: \"Quando podemos agendar o treinamento?\",\r\n    time: \"10:30\",\r\n    unread: 2,\r\n    online: true,\r\n    isWhatsapp: true,\r\n  },\r\n  {\r\n    id: \"c2\",\r\n    name: \"Maria Oliveira\",\r\n    avatar: \"/placeholder.svg?height=40&width=40\",\r\n    project: \"Migração de Dados\",\r\n    lastMessage: \"Os dados foram migrados com sucesso\",\r\n    time: \"09:15\",\r\n    unread: 0,\r\n    online: false,\r\n    isWhatsapp: true,\r\n  },\r\n  {\r\n    id: \"c3\",\r\n    name: \"Pedro Santos\",\r\n    avatar: \"/placeholder.svg?height=40&width=40\",\r\n    project: \"Treinamento\",\r\n    lastMessage: \"Precisamos remarcar para amanhã\",\r\n    time: \"Ontem\",\r\n    unread: 1,\r\n    online: true,\r\n    isWhatsapp: false,\r\n  },\r\n]\r\n\r\nconst conversations = {\r\n  c1: [\r\n    {\r\n      id: \"m1\",\r\n      sender: \"João Silva\",\r\n      content: \"Olá, gostaria de saber quando podemos agendar o treinamento para a equipe.\",\r\n      time: \"10:15\",\r\n      isMe: false,\r\n    },\r\n    {\r\n      id: \"m2\",\r\n      sender: \"Você\",\r\n      content: \"Olá João! Podemos agendar para a próxima semana. Quais dias seriam melhores para vocês?\",\r\n      time: \"10:20\",\r\n      isMe: true,\r\n    },\r\n    {\r\n      id: \"m3\",\r\n      sender: \"João Silva\",\r\n      content: \"Terça ou quinta-feira seria ideal para nós.\",\r\n      time: \"10:25\",\r\n      isMe: false,\r\n    },\r\n    {\r\n      id: \"m4\",\r\n      sender: \"João Silva\",\r\n      content: \"Quando podemos agendar o treinamento?\",\r\n      time: \"10:30\",\r\n      isMe: false,\r\n    },\r\n  ],\r\n  c2: [\r\n    {\r\n      id: \"m1\",\r\n      sender: \"Maria Oliveira\",\r\n      content: \"Bom dia! Estamos com uma dúvida sobre a migração dos dados financeiros.\",\r\n      time: \"09:00\",\r\n      isMe: false,\r\n    },\r\n    {\r\n      id: \"m2\",\r\n      sender: \"Você\",\r\n      content: \"Bom dia Maria! Qual é a dúvida específica?\",\r\n      time: \"09:05\",\r\n      isMe: true,\r\n    },\r\n    {\r\n      id: \"m3\",\r\n      sender: \"Maria Oliveira\",\r\n      content: \"Os dados foram migrados com sucesso\",\r\n      time: \"09:15\",\r\n      isMe: false,\r\n    },\r\n  ],\r\n}\r\n\r\nfunction ConversationPanel() {\r\n  const [activeContact, setActiveContact] = useState(null)\r\n  const [messageInput, setMessageInput] = useState(\"\")\r\n  const [searchTerm, setSearchTerm] = useState(\"\")\r\n  const [activeTab, setActiveTab] = useState(\"all\")\r\n\r\n  // Filtrar contatos com base na pesquisa\r\n  const filteredContacts = contacts.filter(\r\n    (contact) =>\r\n      contact.name.toLowerCase().includes(searchTerm.toLowerCase()) ||\r\n      contact.project.toLowerCase().includes(searchTerm.toLowerCase()),\r\n  )\r\n\r\n  // Filtrar por tipo\r\n  const getFilteredContacts = () => {\r\n    if (activeTab === \"whatsapp\") {\r\n      return filteredContacts.filter((contact) => contact.isWhatsapp)\r\n    }\r\n    if (activeTab === \"internal\") {\r\n      return filteredContacts.filter((contact) => !contact.isWhatsapp)\r\n    }\r\n    return filteredContacts\r\n  }\r\n\r\n  // Enviar mensagem\r\n  const sendMessage = (e) => {\r\n    e.preventDefault()\r\n    if (!messageInput.trim() || !activeContact) return\r\n\r\n    // Aqui você implementaria a lógica real de envio de mensagem\r\n    setMessageInput(\"\")\r\n  }\r\n\r\n  return (\r\n    <div className=\"conversation-panel\">\r\n      {/* Painel de contatos */}\r\n      <div className=\"contacts-sidebar\">\r\n        <div className=\"contacts-header\">\r\n          <div className=\"contacts-search\">\r\n            <span className=\"contacts-search-icon\">🔍</span>\r\n            <input\r\n              type=\"text\"\r\n              className=\"form-input\"\r\n              placeholder=\"Buscar conversas...\"\r\n              value={searchTerm}\r\n              onChange={(e) => setSearchTerm(e.target.value)}\r\n            />\r\n          </div>\r\n        </div>\r\n\r\n        <div className=\"contacts-tabs\">\r\n          <div className=\"contacts-tabs-list\">\r\n            <button\r\n              className={`contacts-tabs-trigger ${activeTab === \"all\" ? \"active\" : \"\"}`}\r\n              onClick={() => setActiveTab(\"all\")}\r\n            >\r\n              Todos\r\n            </button>\r\n            <button\r\n              className={`contacts-tabs-trigger ${activeTab === \"whatsapp\" ? \"active\" : \"\"}`}\r\n              onClick={() => setActiveTab(\"whatsapp\")}\r\n            >\r\n              📱 WhatsApp\r\n            </button>\r\n            <button\r\n              className={`contacts-tabs-trigger ${activeTab === \"internal\" ? \"active\" : \"\"}`}\r\n              onClick={() => setActiveTab(\"internal\")}\r\n            >\r\n              Interno\r\n            </button>\r\n          </div>\r\n        </div>\r\n\r\n        <div className=\"contacts-list\">\r\n          {getFilteredContacts().map((contact) => (\r\n            <ContactItem\r\n              key={contact.id}\r\n              contact={contact}\r\n              isActive={activeContact?.id === contact.id}\r\n              onClick={() => setActiveContact(contact)}\r\n            />\r\n          ))}\r\n        </div>\r\n\r\n        <div className=\"contacts-footer\">\r\n          <button className=\"new-conversation-btn\">➕ Nova Conversa</button>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Painel de conversação */}\r\n      {activeContact ? (\r\n        <div className=\"conversation-main\">\r\n          <div className=\"conversation-header\">\r\n            <div className=\"conversation-contact-info\">\r\n              <div className=\"conversation-avatar\">\r\n                <img src={activeContact.avatar || \"/placeholder.svg\"} alt={activeContact.name} />\r\n              </div>\r\n              <div className=\"conversation-details\">\r\n                <h3>{activeContact.name}</h3>\r\n                <div className=\"conversation-status\">\r\n                  <span className=\"conversation-project-badge\">{activeContact.project}</span>\r\n                  <span className={`conversation-online-status ${activeContact.online ? \"online\" : \"offline\"}`}>\r\n                    <span className={`conversation-online-dot ${activeContact.online ? \"online\" : \"\"}`}></span>\r\n                    {activeContact.online ? \"Online\" : \"Offline\"}\r\n                  </span>\r\n                </div>\r\n              </div>\r\n            </div>\r\n            <div className=\"conversation-actions\">\r\n              <button className=\"conversation-action-btn\">📞</button>\r\n              <button className=\"conversation-action-btn\">📹</button>\r\n              <button className=\"conversation-action-btn\">⋮</button>\r\n            </div>\r\n          </div>\r\n\r\n          <div className=\"conversation-messages\">\r\n            <div className=\"messages-container\">\r\n              {conversations[activeContact.id]?.map((message) => (\r\n                <div key={message.id} className={`message ${message.isMe ? \"sent\" : \"received\"}`}>\r\n                  <div className={`message-bubble ${message.isMe ? \"sent\" : \"received\"}`}>\r\n                    <div className=\"message-content\">{message.content}</div>\r\n                    <div className={`message-time ${message.isMe ? \"sent\" : \"received\"}`}>{message.time}</div>\r\n                  </div>\r\n                </div>\r\n              ))}\r\n            </div>\r\n          </div>\r\n\r\n          <div className=\"conversation-input\">\r\n            <form onSubmit={sendMessage} className=\"conversation-input-form\">\r\n              <button type=\"button\" className=\"conversation-input-attachment\">\r\n                📎\r\n              </button>\r\n              <input\r\n                type=\"text\"\r\n                className=\"conversation-input-field form-input\"\r\n                placeholder=\"Digite sua mensagem...\"\r\n                value={messageInput}\r\n                onChange={(e) => setMessageInput(e.target.value)}\r\n              />\r\n              <button type=\"submit\" className=\"conversation-input-send\">\r\n                ➤\r\n              </button>\r\n            </form>\r\n          </div>\r\n        </div>\r\n      ) : (\r\n        <div className=\"conversation-empty\">\r\n          <h3>Selecione uma conversa</h3>\r\n          <p>Escolha um contato para iniciar ou continuar uma conversa</p>\r\n        </div>\r\n      )}\r\n    </div>\r\n  )\r\n}\r\n\r\n// Componente de item de contato\r\nfunction ContactItem({ contact, isActive, onClick }) {\r\n  return (\r\n    <div className={`contact-item ${isActive ? \"active\" : \"\"}`} onClick={onClick}>\r\n      <div className=\"contact-item-content\">\r\n        <div className=\"contact-avatar-container\">\r\n          <div className=\"contact-avatar\">\r\n            <img src={contact.avatar || \"/placeholder.svg\"} alt={contact.name} />\r\n          </div>\r\n          {contact.online && <span className=\"contact-online-indicator\"></span>}\r\n        </div>\r\n        <div className=\"contact-info\">\r\n          <div className=\"contact-header\">\r\n            <h4 className=\"contact-name\">{contact.name}</h4>\r\n            <span className=\"contact-time\">{contact.time}</span>\r\n          </div>\r\n          <div className=\"contact-message-row\">\r\n            <p className=\"contact-last-message\">{contact.lastMessage}</p>\r\n            {contact.unread > 0 && <span className=\"contact-unread-badge\">{contact.unread}</span>}\r\n          </div>\r\n          <div className=\"contact-meta\">\r\n            <span className=\"contact-project-badge\">{contact.project}</span>\r\n            {contact.isWhatsapp && <span className=\"contact-whatsapp-icon\">📱</span>}\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  )\r\n}\r\n\r\nexport default ConversationPanel\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Projetos\\Back_endCrm\\kanbanproject1\\components\\Dashboard.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'MetricCard' is defined but never used.","line":4,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":4,"endColumn":18,"suggestions":[{"messageId":"removeVar","data":{"varName":"MetricCard"},"fix":{"range":[66,82],"text":""},"desc":"Remove unused variable 'MetricCard'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'ChartCard' is defined but never used.","line":5,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":5,"endColumn":17,"suggestions":[{"messageId":"removeVar","data":{"varName":"ChartCard"},"fix":{"range":[105,120],"text":""},"desc":"Remove unused variable 'ChartCard'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'PieChart' is defined but never used.","line":6,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":6,"endColumn":16,"suggestions":[{"messageId":"removeVar","data":{"varName":"PieChart"},"fix":{"range":[142,156],"text":""},"desc":"Remove unused variable 'PieChart'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'DonutChart' is defined but never used.","line":7,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":7,"endColumn":18,"suggestions":[{"messageId":"removeVar","data":{"varName":"DonutChart"},"fix":{"range":[177,193],"text":""},"desc":"Remove unused variable 'DonutChart'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'viewMode' is assigned a value but never used.","line":11,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":11,"endColumn":18,"suggestions":[{"messageId":"removeVar","data":{"varName":"viewMode"},"fix":{"range":[351,359],"text":""},"desc":"Remove unused variable 'viewMode'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'setViewMode' is assigned a value but never used.","line":11,"column":20,"nodeType":"Identifier","messageId":"unusedVar","endLine":11,"endColumn":31,"suggestions":[{"messageId":"removeVar","data":{"varName":"setViewMode"},"fix":{"range":[359,372],"text":""},"desc":"Remove unused variable 'setViewMode'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'index' is defined but never used.","line":294,"column":54,"nodeType":"Identifier","messageId":"unusedVar","endLine":294,"endColumn":59,"suggestions":[{"messageId":"removeVar","data":{"varName":"index"},"fix":{"range":[11000,11007],"text":""},"desc":"Remove unused variable 'index'."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":7,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\"\r\n\r\nimport { useState, useMemo } from \"react\"\r\nimport MetricCard from \"./MetricCard\"\r\nimport ChartCard from \"./ChartCard\"\r\nimport PieChart from \"./PieChart\"\r\nimport DonutChart from \"./DonutChart\"\r\n\r\nfunction Dashboard({ leads, tasks, funnels, period, onPeriodChange }) {\r\n  const [activeTab, setActiveTab] = useState(\"overview\")\r\n  const [viewMode, setViewMode] = useState(\"standard\")\r\n  const [selectedFunnelId, setSelectedFunnelId] = useState(\"all\")\r\n\r\n  // Filtrar dados por funil selecionado\r\n  const filteredData = useMemo(() => {\r\n    if (selectedFunnelId === \"all\") {\r\n      return {\r\n        leads: leads,\r\n        tasks: tasks,\r\n        selectedFunnel: null,\r\n      }\r\n    }\r\n\r\n    const selectedFunnel = funnels.find((f) => f.id === selectedFunnelId)\r\n    const funnelLeads = leads.filter((lead) => lead.funnelId === selectedFunnelId)\r\n    const funnelTasks = tasks.filter((task) => task.funnelId === selectedFunnelId)\r\n\r\n    return {\r\n      leads: funnelLeads,\r\n      tasks: funnelTasks,\r\n      selectedFunnel,\r\n    }\r\n  }, [leads, tasks, funnels, selectedFunnelId])\r\n\r\n  // Cálculos de estatísticas\r\n  const stats = useMemo(() => {\r\n    const { leads: filteredLeads, tasks: filteredTasks } = filteredData\r\n    const now = new Date()\r\n    const periodDays = period === \"7d\" ? 7 : period === \"30d\" ? 30 : period === \"90d\" ? 90 : 365\r\n    const periodStart = new Date(now.getTime() - periodDays * 24 * 60 * 60 * 1000)\r\n\r\n    // Leads\r\n    const totalLeads = filteredLeads.length\r\n    const newLeads = filteredLeads.filter((lead) => new Date(lead.createdAt) >= periodStart).length\r\n    const convertedLeads = filteredLeads.filter((lead) => lead.status === \"ganho\" || lead.status === \"won\").length\r\n    const conversionRate = totalLeads > 0 ? (convertedLeads / totalLeads) * 100 : 0\r\n    const totalLeadValue = filteredLeads.reduce((sum, lead) => sum + lead.estimatedValue, 0)\r\n    const avgLeadValue = totalLeads > 0 ? totalLeadValue / totalLeads : 0\r\n\r\n    // Tarefas\r\n    const totalTasks = filteredTasks.length\r\n    const completedTasks = filteredTasks.filter((task) => task.status === \"completed\").length\r\n    const pendingTasks = filteredTasks.filter((task) => task.status === \"pending\").length\r\n    const overdueTasks = filteredTasks.filter(\r\n      (task) => task.dueDate && new Date(task.dueDate) < now && task.status !== \"completed\",\r\n    ).length\r\n\r\n    return {\r\n      leads: {\r\n        total: totalLeads,\r\n        new: newLeads,\r\n        converted: convertedLeads,\r\n        conversionRate,\r\n        totalValue: totalLeadValue,\r\n        avgValue: avgLeadValue,\r\n      },\r\n      tasks: {\r\n        total: totalTasks,\r\n        completed: completedTasks,\r\n        pending: pendingTasks,\r\n        overdue: overdueTasks,\r\n        completionRate: totalTasks > 0 ? (completedTasks / totalTasks) * 100 : 0,\r\n      },\r\n    }\r\n  }, [filteredData, period])\r\n\r\n  // Dados para gráficos\r\n  const chartData = useMemo(() => {\r\n    const { leads: filteredLeads } = filteredData\r\n\r\n    // Leads por status\r\n    const leadsByStatus = filteredLeads.reduce((acc, lead) => {\r\n      acc[lead.status] = (acc[lead.status] || 0) + 1\r\n      return acc\r\n    }, {})\r\n\r\n    const leadStatusData = Object.entries(leadsByStatus).map(([status, count]) => ({\r\n      name:\r\n        status === \"novo\"\r\n          ? \"Novos\"\r\n          : status === \"qualificado\"\r\n            ? \"Qualificados\"\r\n            : status === \"proposta\"\r\n              ? \"Proposta\"\r\n              : status === \"negociacao\"\r\n                ? \"Negociação\"\r\n                : status === \"ganho\"\r\n                  ? \"Ganhos\"\r\n                  : status === \"perdido\"\r\n                    ? \"Perdidos\"\r\n                    : status,\r\n      value: count,\r\n      percentage: filteredLeads.length > 0 ? ((count / filteredLeads.length) * 100).toFixed(1) : \"0\",\r\n    }))\r\n\r\n    // Leads por origem\r\n    const leadsBySource = filteredLeads.reduce((acc, lead) => {\r\n      acc[lead.source] = (acc[lead.source] || 0) + 1\r\n      return acc\r\n    }, {})\r\n\r\n    const leadSourceData = Object.entries(leadsBySource).map(([source, count]) => ({\r\n      name:\r\n        source === \"website\"\r\n          ? \"Website\"\r\n          : source === \"google_ads\"\r\n            ? \"Google Ads\"\r\n            : source === \"referral\"\r\n              ? \"Indicação\"\r\n              : source === \"linkedin\"\r\n                ? \"LinkedIn\"\r\n                : source === \"phone\"\r\n                  ? \"Telefone\"\r\n                  : source,\r\n      value: count,\r\n      percentage: filteredLeads.length > 0 ? ((count / filteredLeads.length) * 100).toFixed(1) : \"0\",\r\n    }))\r\n\r\n    return {\r\n      leadStatus: leadStatusData,\r\n      leadSource: leadSourceData,\r\n    }\r\n  }, [filteredData])\r\n\r\n  return (\r\n    <div className=\"dashboard\">\r\n      <div className=\"dashboard-header\">\r\n        <div>\r\n          <h1 className=\"dashboard-title\">Dashboard CRM</h1>\r\n          <p className=\"dashboard-subtitle\">\r\n            Visão geral do seu pipeline de vendas\r\n            {filteredData.selectedFunnel && (\r\n              <span className=\"ml-2 text-blue-600\">• {filteredData.selectedFunnel.name}</span>\r\n            )}\r\n          </p>\r\n        </div>\r\n        <div className=\"dashboard-controls\">\r\n          <select\r\n            className=\"form-select\"\r\n            value={selectedFunnelId}\r\n            onChange={(e) => setSelectedFunnelId(e.target.value)}\r\n          >\r\n            <option value=\"all\">Todos os Funis</option>\r\n            {funnels.map((funnel) => (\r\n              <option key={funnel.id} value={funnel.id}>\r\n                {funnel.name}\r\n              </option>\r\n            ))}\r\n          </select>\r\n          <select className=\"form-select\" value={period} onChange={(e) => onPeriodChange(e.target.value)}>\r\n            <option value=\"7d\">7 dias</option>\r\n            <option value=\"30d\">30 dias</option>\r\n            <option value=\"90d\">90 dias</option>\r\n            <option value=\"1y\">1 ano</option>\r\n          </select>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Indicador de funil selecionado */}\r\n      {filteredData.selectedFunnel && (\r\n        <div className=\"card mb-6\" style={{ borderColor: \"#3b82f6\", backgroundColor: \"#eff6ff\" }}>\r\n          <div className=\"card-content\">\r\n            <div className=\"flex items-center justify-between\">\r\n              <div className=\"flex items-center gap-3\">\r\n                <div className=\"w-4 h-4 rounded-full bg-blue-500\"></div>\r\n                <div>\r\n                  <h3 className=\"font-medium text-blue-900\">{filteredData.selectedFunnel.name}</h3>\r\n                  <p className=\"text-sm text-blue-700\">{filteredData.selectedFunnel.description}</p>\r\n                </div>\r\n              </div>\r\n              <div className=\"text-sm text-blue-600\">\r\n                {filteredData.leads.length} leads • {filteredData.tasks.length} tarefas\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      <div className=\"tabs\">\r\n        <div className=\"tabs-list\">\r\n          <button\r\n            className={`tabs-trigger ${activeTab === \"overview\" ? \"active\" : \"\"}`}\r\n            onClick={() => setActiveTab(\"overview\")}\r\n          >\r\n            Visão Geral\r\n          </button>\r\n          <button\r\n            className={`tabs-trigger ${activeTab === \"leads\" ? \"active\" : \"\"}`}\r\n            onClick={() => setActiveTab(\"leads\")}\r\n          >\r\n            Análise de Leads\r\n          </button>\r\n          <button\r\n            className={`tabs-trigger ${activeTab === \"tasks\" ? \"active\" : \"\"}`}\r\n            onClick={() => setActiveTab(\"tasks\")}\r\n          >\r\n            Gestão de Tarefas\r\n          </button>\r\n        </div>\r\n\r\n        <div className=\"tabs-content\">\r\n          {activeTab === \"overview\" && (\r\n            <div className=\"space-y-6\">\r\n              {/* Cards de estatísticas principais */}\r\n              <div className=\"metrics-grid\">\r\n                <MetricCard\r\n                  title=\"Total de Leads\"\r\n                  value={stats.leads.total}\r\n                  change={`+${stats.leads.new} novos no período`}\r\n                  changeType=\"positive\"\r\n                  icon=\"👥\"\r\n                />\r\n                <MetricCard\r\n                  title=\"Taxa de Conversão\"\r\n                  value={`${stats.leads.conversionRate.toFixed(1)}%`}\r\n                  change={`${stats.leads.converted} leads convertidos`}\r\n                  changeType=\"neutral\"\r\n                  icon=\"🎯\"\r\n                />\r\n                <MetricCard\r\n                  title=\"Valor Total Pipeline\"\r\n                  value={`R$ ${stats.leads.totalValue.toLocaleString(\"pt-BR\")}`}\r\n                  change={`Média: R$ ${stats.leads.avgValue.toLocaleString(\"pt-BR\")}`}\r\n                  changeType=\"neutral\"\r\n                  icon=\"💰\"\r\n                />\r\n                <MetricCard\r\n                  title=\"Tarefas Concluídas\"\r\n                  value={stats.tasks.completed}\r\n                  change={`${stats.tasks.completionRate.toFixed(1)}% de conclusão`}\r\n                  changeType=\"positive\"\r\n                  icon=\"✅\"\r\n                />\r\n              </div>\r\n\r\n              {/* Gráficos principais */}\r\n              <div className=\"charts-grid\">\r\n                <ChartCard title=\"Distribuição de Leads por Status\">\r\n                  <PieChart data={chartData.leadStatus} />\r\n                </ChartCard>\r\n                <ChartCard title=\"Leads por Origem\">\r\n                  <DonutChart data={chartData.leadSource} />\r\n                </ChartCard>\r\n              </div>\r\n            </div>\r\n          )}\r\n\r\n          {activeTab === \"leads\" && (\r\n            <div className=\"space-y-6\">\r\n              <div className=\"metrics-grid\">\r\n                <MetricCard\r\n                  title=\"Total de Leads\"\r\n                  value={stats.leads.total}\r\n                  change=\"Todos os leads cadastrados\"\r\n                  changeType=\"neutral\"\r\n                  icon=\"👥\"\r\n                />\r\n                <MetricCard\r\n                  title=\"Novos Leads\"\r\n                  value={stats.leads.new}\r\n                  change=\"No período selecionado\"\r\n                  changeType=\"positive\"\r\n                  icon=\"📈\"\r\n                />\r\n                <MetricCard\r\n                  title=\"Taxa de Conversão\"\r\n                  value={`${stats.leads.conversionRate.toFixed(1)}%`}\r\n                  change={`${stats.leads.converted} convertidos`}\r\n                  changeType=\"positive\"\r\n                  icon=\"🎯\"\r\n                />\r\n                <MetricCard\r\n                  title=\"Valor Médio\"\r\n                  value={`R$ ${stats.leads.avgValue.toLocaleString(\"pt-BR\")}`}\r\n                  change=\"Por lead\"\r\n                  changeType=\"neutral\"\r\n                  icon=\"💰\"\r\n                />\r\n              </div>\r\n\r\n              <div className=\"charts-grid\">\r\n                <ChartCard title=\"Análise por Origem\">\r\n                  <div className=\"space-y-4\">\r\n                    {chartData.leadSource.map((item, index) => (\r\n                      <div key={item.name} className=\"space-y-2\">\r\n                        <div className=\"flex items-center justify-between\">\r\n                          <span className=\"text-sm font-medium\">{item.name}</span>\r\n                          <span className=\"text-sm text-gray-500\">\r\n                            {item.value} leads ({item.percentage}%)\r\n                          </span>\r\n                        </div>\r\n                        <div className=\"progress\">\r\n                          <div className=\"progress-bar\" style={{ width: `${item.percentage}%` }}></div>\r\n                        </div>\r\n                      </div>\r\n                    ))}\r\n                  </div>\r\n                </ChartCard>\r\n                <ChartCard title=\"Distribuição por Status\">\r\n                  <PieChart data={chartData.leadStatus} />\r\n                </ChartCard>\r\n              </div>\r\n            </div>\r\n          )}\r\n\r\n          {activeTab === \"tasks\" && (\r\n            <div className=\"space-y-6\">\r\n              <div className=\"metrics-grid\">\r\n                <MetricCard\r\n                  title=\"Total de Tarefas\"\r\n                  value={stats.tasks.total}\r\n                  change=\"Todas as tarefas\"\r\n                  changeType=\"neutral\"\r\n                  icon=\"📋\"\r\n                />\r\n                <MetricCard\r\n                  title=\"Concluídas\"\r\n                  value={stats.tasks.completed}\r\n                  change={`${stats.tasks.completionRate.toFixed(1)}% de conclusão`}\r\n                  changeType=\"positive\"\r\n                  icon=\"✅\"\r\n                />\r\n                <MetricCard\r\n                  title=\"Pendentes\"\r\n                  value={stats.tasks.pending}\r\n                  change=\"Aguardando execução\"\r\n                  changeType=\"neutral\"\r\n                  icon=\"⏳\"\r\n                />\r\n                <MetricCard\r\n                  title=\"Atrasadas\"\r\n                  value={stats.tasks.overdue}\r\n                  change=\"Requerem atenção imediata\"\r\n                  changeType=\"negative\"\r\n                  icon=\"⚠️\"\r\n                />\r\n              </div>\r\n\r\n              <div className=\"charts-grid\">\r\n                <ChartCard title=\"Performance de Tarefas\">\r\n                  <div className=\"space-y-4\">\r\n                    <div className=\"flex items-center justify-between\">\r\n                      <span className=\"text-sm font-medium\">Taxa de Conclusão</span>\r\n                      <span className=\"text-sm text-gray-500\">{stats.tasks.completionRate.toFixed(1)}%</span>\r\n                    </div>\r\n                    <div className=\"progress\">\r\n                      <div className=\"progress-bar\" style={{ width: `${stats.tasks.completionRate}%` }}></div>\r\n                    </div>\r\n\r\n                    <div className=\"grid grid-cols-2 gap-4 mt-6\">\r\n                      <div className=\"text-center p-4 bg-green-50 rounded-lg\">\r\n                        <div className=\"text-2xl font-bold text-green-600\">{stats.tasks.completed}</div>\r\n                        <div className=\"text-sm text-gray-500\">Concluídas</div>\r\n                      </div>\r\n                      <div className=\"text-center p-4 bg-red-50 rounded-lg\">\r\n                        <div className=\"text-2xl font-bold text-red-600\">{stats.tasks.overdue}</div>\r\n                        <div className=\"text-sm text-gray-500\">Atrasadas</div>\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n                </ChartCard>\r\n              </div>\r\n            </div>\r\n          )}\r\n        </div>\r\n      </div>\r\n    </div>\r\n  )\r\n}\r\n\r\nexport default Dashboard\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Projetos\\Back_endCrm\\kanbanproject1\\components\\DonutChart.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'index' is defined but never used.","line":98,"column":29,"nodeType":"Identifier","messageId":"unusedVar","endLine":98,"endColumn":34,"suggestions":[{"messageId":"removeVar","data":{"varName":"index"},"fix":{"range":[2877,2884],"text":""},"desc":"Remove unused variable 'index'."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\"\r\n\r\nimport { useMemo } from \"react\"\r\n\r\nconst COLORS = [\"#0088FE\", \"#00C49F\", \"#FFBB28\", \"#FF8042\", \"#8884D8\", \"#FF6B6B\"]\r\n\r\nfunction DonutChart({ data, width = 400, height = 300, showLabels = true, showLegend = true, innerRadius = 0.4 }) {\r\n  const { slices, total } = useMemo(() => {\r\n    const total = data.reduce((sum, item) => sum + item.value, 0)\r\n    let currentAngle = 0\r\n\r\n    const slices = data.map((item, index) => {\r\n      const percentage = total > 0 ? (item.value / total) * 100 : 0\r\n      const angle = (percentage / 100) * 360\r\n      const startAngle = currentAngle\r\n      const endAngle = currentAngle + angle\r\n\r\n      currentAngle += angle\r\n\r\n      return {\r\n        ...item,\r\n        percentage,\r\n        angle,\r\n        startAngle,\r\n        endAngle,\r\n        color: COLORS[index % COLORS.length],\r\n      }\r\n    })\r\n\r\n    return { slices, total }\r\n  }, [data])\r\n\r\n  const outerRadius = Math.min(width, height) / 2 - 40\r\n  const innerRadiusValue = outerRadius * innerRadius\r\n  const centerX = width / 2\r\n  const centerY = height / 2\r\n\r\n  const createPath = (startAngle, endAngle, outerRadius, innerRadius) => {\r\n    const outerStart = polarToCartesian(centerX, centerY, outerRadius, endAngle)\r\n    const outerEnd = polarToCartesian(centerX, centerY, outerRadius, startAngle)\r\n    const innerStart = polarToCartesian(centerX, centerY, innerRadius, endAngle)\r\n    const innerEnd = polarToCartesian(centerX, centerY, innerRadius, startAngle)\r\n\r\n    const largeArcFlag = endAngle - startAngle <= 180 ? \"0\" : \"1\"\r\n\r\n    return [\r\n      \"M\",\r\n      outerStart.x,\r\n      outerStart.y,\r\n      \"A\",\r\n      outerRadius,\r\n      outerRadius,\r\n      0,\r\n      largeArcFlag,\r\n      0,\r\n      outerEnd.x,\r\n      outerEnd.y,\r\n      \"L\",\r\n      innerEnd.x,\r\n      innerEnd.y,\r\n      \"A\",\r\n      innerRadius,\r\n      innerRadius,\r\n      0,\r\n      largeArcFlag,\r\n      1,\r\n      innerStart.x,\r\n      innerStart.y,\r\n      \"Z\",\r\n    ].join(\" \")\r\n  }\r\n\r\n  const polarToCartesian = (centerX, centerY, radius, angleInDegrees) => {\r\n    const angleInRadians = ((angleInDegrees - 90) * Math.PI) / 180.0\r\n    return {\r\n      x: centerX + radius * Math.cos(angleInRadians),\r\n      y: centerY + radius * Math.sin(angleInRadians),\r\n    }\r\n  }\r\n\r\n  const getLabelPosition = (startAngle, endAngle, radius) => {\r\n    const midAngle = (startAngle + endAngle) / 2\r\n    const labelRadius = (radius + innerRadiusValue) / 2\r\n    return polarToCartesian(centerX, centerY, labelRadius, midAngle)\r\n  }\r\n\r\n  if (total === 0) {\r\n    return (\r\n      <div className=\"flex items-center justify-center\" style={{ width, height }}>\r\n        <p className=\"text-gray-500\">Nenhum dado disponível</p>\r\n      </div>\r\n    )\r\n  }\r\n\r\n  return (\r\n    <div className=\"flex flex-col items-center space-y-4\">\r\n      <svg width={width} height={height} className=\"overflow-visible\">\r\n        {slices.map((slice, index) => (\r\n          <g key={slice.name}>\r\n            <path\r\n              d={createPath(slice.startAngle, slice.endAngle, outerRadius, innerRadiusValue)}\r\n              fill={slice.color}\r\n              stroke=\"white\"\r\n              strokeWidth=\"2\"\r\n              className=\"hover:opacity-80 transition-opacity cursor-pointer\"\r\n            />\r\n            {showLabels && slice.percentage > 5 && (\r\n              <text\r\n                x={getLabelPosition(slice.startAngle, slice.endAngle, outerRadius).x}\r\n                y={getLabelPosition(slice.startAngle, slice.endAngle, outerRadius).y}\r\n                textAnchor=\"middle\"\r\n                dominantBaseline=\"middle\"\r\n                className=\"fill-white text-xs font-medium\"\r\n                style={{ textShadow: \"1px 1px 2px rgba(0,0,0,0.7)\" }}\r\n              >\r\n                {slice.percentage.toFixed(1)}%\r\n              </text>\r\n            )}\r\n          </g>\r\n        ))}\r\n\r\n        {/* Centro do donut com informações */}\r\n        <g>\r\n          <text\r\n            x={centerX}\r\n            y={centerY - 10}\r\n            textAnchor=\"middle\"\r\n            dominantBaseline=\"middle\"\r\n            className=\"fill-gray-900 text-2xl font-bold\"\r\n          >\r\n            {total}\r\n          </text>\r\n          <text\r\n            x={centerX}\r\n            y={centerY + 10}\r\n            textAnchor=\"middle\"\r\n            dominantBaseline=\"middle\"\r\n            className=\"fill-gray-600 text-sm\"\r\n          >\r\n            Total\r\n          </text>\r\n        </g>\r\n      </svg>\r\n\r\n      {showLegend && (\r\n        <div className=\"chart-legend\">\r\n          {slices.map((slice) => (\r\n            <div key={slice.name} className=\"legend-item\">\r\n              <div className=\"legend-color\" style={{ backgroundColor: slice.color }}></div>\r\n              <span className=\"truncate\">{slice.name}</span>\r\n              <span className=\"text-xs text-gray-500\">({slice.value})</span>\r\n            </div>\r\n          ))}\r\n        </div>\r\n      )}\r\n    </div>\r\n  )\r\n}\r\n\r\nexport default DonutChart\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Projetos\\Back_endCrm\\kanbanproject1\\components\\Header.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projetos\\Back_endCrm\\kanbanproject1\\components\\KanbanBoard.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'AlertDialog' is defined but never used.","line":5,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":5,"endColumn":14,"suggestions":[{"messageId":"removeVar","data":{"varName":"AlertDialog"},"fix":{"range":[62,74],"text":""},"desc":"Remove unused variable 'AlertDialog'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'AlertDialogContent' is defined but never used.","line":6,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":6,"endColumn":21,"suggestions":[{"messageId":"removeVar","data":{"varName":"AlertDialogContent"},"fix":{"range":[73,96],"text":""},"desc":"Remove unused variable 'AlertDialogContent'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'AlertDialogHeader' is defined but never used.","line":7,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":7,"endColumn":20,"suggestions":[{"messageId":"removeVar","data":{"varName":"AlertDialogHeader"},"fix":{"range":[96,118],"text":""},"desc":"Remove unused variable 'AlertDialogHeader'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'AlertDialogTitle' is defined but never used.","line":8,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":8,"endColumn":19,"suggestions":[{"messageId":"removeVar","data":{"varName":"AlertDialogTitle"},"fix":{"range":[118,139],"text":""},"desc":"Remove unused variable 'AlertDialogTitle'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'AlertDialogDescription' is defined but never used.","line":9,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":9,"endColumn":25,"suggestions":[{"messageId":"removeVar","data":{"varName":"AlertDialogDescription"},"fix":{"range":[139,166],"text":""},"desc":"Remove unused variable 'AlertDialogDescription'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'AlertDialogFooter' is defined but never used.","line":10,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":10,"endColumn":20,"suggestions":[{"messageId":"removeVar","data":{"varName":"AlertDialogFooter"},"fix":{"range":[166,188],"text":""},"desc":"Remove unused variable 'AlertDialogFooter'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'AlertDialogCancel' is defined but never used.","line":11,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":11,"endColumn":20,"suggestions":[{"messageId":"removeVar","data":{"varName":"AlertDialogCancel"},"fix":{"range":[188,210],"text":""},"desc":"Remove unused variable 'AlertDialogCancel'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'AlertDialogAction' is defined but never used.","line":12,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":12,"endColumn":20,"suggestions":[{"messageId":"removeVar","data":{"varName":"AlertDialogAction"},"fix":{"range":[210,232],"text":""},"desc":"Remove unused variable 'AlertDialogAction'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'KanbanColumn' is defined but never used.","line":14,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":14,"endColumn":20,"suggestions":[{"messageId":"removeVar","data":{"varName":"KanbanColumn"},"fix":{"range":[270,288],"text":""},"desc":"Remove unused variable 'KanbanColumn'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'Modal' is defined but never used.","line":15,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":15,"endColumn":13,"suggestions":[{"messageId":"removeVar","data":{"varName":"Modal"},"fix":{"range":[313,324],"text":""},"desc":"Remove unused variable 'Modal'."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":10,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\"\r\n\r\nimport { useState } from \"react\"\r\nimport {\r\n  AlertDialog,\r\n  AlertDialogContent,\r\n  AlertDialogHeader,\r\n  AlertDialogTitle,\r\n  AlertDialogDescription,\r\n  AlertDialogFooter,\r\n  AlertDialogCancel,\r\n  AlertDialogAction,\r\n} from \"./ui/alert-dialog\"\r\nimport KanbanColumn from \"./KanbanColumn\"\r\nimport Modal from \"./Modal\"\r\n\r\n// Dados de exemplo\r\nconst initialColumns = [\r\n  { id: \"novo\", name: \"Novos Leads\", color: \"#64748b\", order: 0 },\r\n  { id: \"qualificado\", name: \"Qualificados\", color: \"#3b82f6\", order: 1 },\r\n  { id: \"proposta\", name: \"Proposta\", color: \"#f59e0b\", order: 2 },\r\n  { id: \"negociacao\", name: \"Negociação\", color: \"#8b5cf6\", order: 3 },\r\n  { id: \"ganho\", name: \"Ganhos\", color: \"#10b981\", order: 4 },\r\n  { id: \"perdido\", name: \"Perdidos\", color: \"#ef4444\", order: 5 },\r\n]\r\n\r\nconst initialLeads = [\r\n  {\r\n    id: \"lead1\",\r\n    title: \"Interesse em Sistema ERP\",\r\n    client: \"Empresa Nova Ltda\",\r\n    clientEmail: \"contato@empresanova.com\",\r\n    clientPhone: \"+55 11 98888-1111\",\r\n    source: \"website\",\r\n    status: \"novo\",\r\n    priority: \"high\",\r\n    estimatedValue: 150000,\r\n    expectedCloseDate: \"2024-01-15\",\r\n    notes: \"Cliente demonstrou muito interesse no módulo financeiro\",\r\n    createdAt: \"2023-11-01T10:00:00Z\",\r\n  },\r\n  {\r\n    id: \"lead2\",\r\n    title: \"Migração de Sistema Legado\",\r\n    client: \"Tech Solutions\",\r\n    clientEmail: \"ti@techsolutions.com\",\r\n    clientPhone: \"+55 11 97777-2222\",\r\n    source: \"referral\",\r\n    status: \"qualificado\",\r\n    priority: \"medium\",\r\n    estimatedValue: 80000,\r\n    expectedCloseDate: \"2024-02-01\",\r\n    notes: \"Necessita migração urgente do sistema atual\",\r\n    createdAt: \"2023-11-02T14:00:00Z\",\r\n  },\r\n]\r\n\r\nfunction KanbanBoard() {\r\n  const [leads, setLeads] = useState(initialLeads)\r\n  const [columns] = useState(initialColumns)\r\n  const [showCreateLead, setShowCreateLead] = useState(false)\r\n  const [selectedLead, setSelectedLead] = useState(null)\r\n  const [showLeadDetails, setShowLeadDetails] = useState(false)\r\n  const [confirmDeleteOpen, setConfirmDeleteOpen] = useState(false)\r\n  const [pendingDeleteId, setPendingDeleteId] = useState(null)\r\n\r\n  const handleCreateLead = () => {\r\n    setShowCreateLead(true)\r\n  }\r\n\r\n  const handleLeadClick = (lead) => {\r\n    setSelectedLead(lead)\r\n    setShowLeadDetails(true)\r\n  }\r\n\r\n  const handleDeleteLead = (leadId) => {\r\n    setPendingDeleteId(leadId)\r\n    setConfirmDeleteOpen(true)\r\n  }\r\n\r\n  const getLeadsForColumn = (columnId) => {\r\n    return leads.filter((lead) => lead.status === columnId)\r\n  }\r\n\r\n  const getTotalValueForColumn = (columnId) => {\r\n    return getLeadsForColumn(columnId).reduce((sum, lead) => sum + (lead.estimatedValue || 0), 0)\r\n  }\r\n\r\n  return (\r\n    <div className=\"kanban-board\">\r\n      <div className=\"kanban-header\">\r\n        <div className=\"kanban-title-section\">\r\n          <h1>Pipeline de Leads</h1>\r\n          <p>Gerencie seus leads do primeiro contato até o fechamento</p>\r\n        </div>\r\n        <div className=\"kanban-actions\">\r\n          <button className=\"btn btn-primary\" onClick={handleCreateLead}>\r\n            ➕ Novo Lead\r\n          </button>\r\n          <button className=\"btn btn-outline\">✅ Central de Tarefas</button>\r\n          <button className=\"btn btn-outline\">⚙️ Configurações</button>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Estatísticas rápidas */}\r\n      <div className=\"stats-grid\">\r\n        {columns.map((column) => {\r\n          const count = getLeadsForColumn(column.id).length\r\n          const totalValue = getTotalValueForColumn(column.id)\r\n\r\n          return (\r\n            <div key={column.id} className=\"stat-card\">\r\n              <div className=\"stat-indicator\" style={{ backgroundColor: column.color }}></div>\r\n              <p className=\"stat-name\">{column.name}</p>\r\n              <p className=\"stat-count\">{count}</p>\r\n              <p className=\"stat-value\">R$ {totalValue.toLocaleString(\"pt-BR\")}</p>\r\n            </div>\r\n          )\r\n        })}\r\n      </div>\r\n\r\n      {/* Colunas do Kanban */}\r\n      <div className=\"kanban-columns\">\r\n        {columns\r\n          .sort((a, b) => a.order - b.order)\r\n          .map((column) => (\r\n            <KanbanColumn\r\n              key={column.id}\r\n              column={column}\r\n              leads={getLeadsForColumn(column.id)}\r\n              onLeadClick={handleLeadClick}\r\n              onDeleteLead={handleDeleteLead}\r\n              onAddLead={handleCreateLead}\r\n            />\r\n          ))}\r\n      </div>\r\n\r\n      {/* Diálogo de confirmação de exclusão */}\r\n      <AlertDialog open={confirmDeleteOpen} onOpenChange={setConfirmDeleteOpen}>\r\n        <AlertDialogContent>\r\n          <AlertDialogHeader>\r\n            <AlertDialogTitle>Excluir lead</AlertDialogTitle>\r\n            <AlertDialogDescription>\r\n              Tem certeza que deseja excluir este lead? Esta ação não pode ser desfeita.\r\n            </AlertDialogDescription>\r\n          </AlertDialogHeader>\r\n          <AlertDialogFooter>\r\n            <AlertDialogCancel onClick={() => setConfirmDeleteOpen(false)}>Cancelar</AlertDialogCancel>\r\n            <AlertDialogAction\r\n              onClick={() => {\r\n                if (pendingDeleteId) {\r\n                  setLeads((prev) => prev.filter((l) => l.id !== pendingDeleteId))\r\n                }\r\n                setConfirmDeleteOpen(false)\r\n                setPendingDeleteId(null)\r\n              }}\r\n            >\r\n              Excluir\r\n            </AlertDialogAction>\r\n          </AlertDialogFooter>\r\n        </AlertDialogContent>\r\n      </AlertDialog>\r\n\r\n      {/* Modal de criação de lead */}\r\n      {showCreateLead && (\r\n        <Modal title=\"Novo Lead\" onClose={() => setShowCreateLead(false)}>\r\n          <div className=\"space-y-4\">\r\n            <div className=\"form-group\">\r\n              <label className=\"form-label required\">Título do Lead</label>\r\n              <input type=\"text\" className=\"form-input\" placeholder=\"Ex: Interesse em Sistema ERP\" />\r\n            </div>\r\n            <div className=\"form-group\">\r\n              <label className=\"form-label required\">Cliente</label>\r\n              <input type=\"text\" className=\"form-input\" placeholder=\"Nome da empresa\" />\r\n            </div>\r\n            <div className=\"form-grid form-grid-2\">\r\n              <div className=\"form-group\">\r\n                <label className=\"form-label\">Email</label>\r\n                <input type=\"email\" className=\"form-input\" placeholder=\"contato@empresa.com\" />\r\n              </div>\r\n              <div className=\"form-group\">\r\n                <label className=\"form-label required\">Telefone</label>\r\n                <input type=\"tel\" className=\"form-input\" placeholder=\"(11) 99999-9999\" />\r\n              </div>\r\n            </div>\r\n            <div className=\"form-group\">\r\n              <label className=\"form-label\">Observações</label>\r\n              <textarea\r\n                className=\"form-textarea\"\r\n                rows=\"3\"\r\n                placeholder=\"Adicione observações sobre este lead...\"\r\n              ></textarea>\r\n            </div>\r\n            <div className=\"flex justify-end gap-2\">\r\n              <button className=\"btn btn-outline\" onClick={() => setShowCreateLead(false)}>\r\n                Cancelar\r\n              </button>\r\n              <button className=\"btn btn-primary\">Criar Lead</button>\r\n            </div>\r\n          </div>\r\n        </Modal>\r\n      )}\r\n\r\n      {/* Modal de detalhes do lead */}\r\n      {showLeadDetails && selectedLead && (\r\n        <Modal\r\n          title={selectedLead.title}\r\n          onClose={() => {\r\n            setShowLeadDetails(false)\r\n            setSelectedLead(null)\r\n          }}\r\n        >\r\n          <div className=\"space-y-4\">\r\n            <div>\r\n              <h4 className=\"font-medium mb-2\">Informações do Cliente</h4>\r\n              <p>\r\n                <strong>Cliente:</strong> {selectedLead.client}\r\n              </p>\r\n              <p>\r\n                <strong>Email:</strong> {selectedLead.clientEmail}\r\n              </p>\r\n              <p>\r\n                <strong>Telefone:</strong> {selectedLead.clientPhone}\r\n              </p>\r\n            </div>\r\n            <div>\r\n              <h4 className=\"font-medium mb-2\">Detalhes do Lead</h4>\r\n              <p>\r\n                <strong>Valor Estimado:</strong> R$ {selectedLead.estimatedValue?.toLocaleString(\"pt-BR\")}\r\n              </p>\r\n              <p>\r\n                <strong>Prioridade:</strong> {selectedLead.priority}\r\n              </p>\r\n              <p>\r\n                <strong>Origem:</strong> {selectedLead.source}\r\n              </p>\r\n            </div>\r\n            {selectedLead.notes && (\r\n              <div>\r\n                <h4 className=\"font-medium mb-2\">Observações</h4>\r\n                <p>{selectedLead.notes}</p>\r\n              </div>\r\n            )}\r\n            <div className=\"flex justify-end gap-2\">\r\n              <button className=\"btn btn-outline\">✏️ Editar</button>\r\n              <button className=\"btn btn-outline\" style={{ color: \"#dc2626\" }}>\r\n                🗑️ Excluir\r\n              </button>\r\n            </div>\r\n          </div>\r\n        </Modal>\r\n      )}\r\n    </div>\r\n  )\r\n}\r\n\r\nexport default KanbanBoard\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Projetos\\Back_endCrm\\kanbanproject1\\components\\KanbanColumn.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'LeadCard' is defined but never used.","line":2,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":2,"endColumn":16,"suggestions":[{"messageId":"removeVar","data":{"varName":"LeadCard"},"fix":{"range":[21,35],"text":""},"desc":"Remove unused variable 'LeadCard'."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\"\r\nimport LeadCard from \"./LeadCard\"\r\n\r\nfunction KanbanColumn({ column, leads, onLeadClick, onDeleteLead, onAddLead }) {\r\n  return (\r\n    <div className=\"kanban-column\">\r\n      <div\r\n        className=\"column-header\"\r\n        style={{\r\n          borderTopColor: column.color,\r\n          backgroundColor: `${column.color}20`,\r\n        }}\r\n      >\r\n        <div className=\"column-header-content\">\r\n          <div>\r\n            <h3 className=\"column-title\" style={{ color: column.color }}>\r\n              {column.name}\r\n            </h3>\r\n            <span className=\"column-count\">{leads.length} leads</span>\r\n          </div>\r\n          <button className=\"column-add-btn\" onClick={onAddLead}>\r\n            ➕\r\n          </button>\r\n        </div>\r\n      </div>\r\n      <div className=\"column-content\">\r\n        {leads.map((lead) => (\r\n          <LeadCard\r\n            key={lead.id}\r\n            lead={lead}\r\n            onClick={() => onLeadClick(lead)}\r\n            onDelete={() => onDeleteLead(lead.id)}\r\n          />\r\n        ))}\r\n      </div>\r\n    </div>\r\n  )\r\n}\r\n\r\nexport default KanbanColumn\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Projetos\\Back_endCrm\\kanbanproject1\\components\\LeadCard.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projetos\\Back_endCrm\\kanbanproject1\\components\\MetricCard.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projetos\\Back_endCrm\\kanbanproject1\\components\\Modal.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projetos\\Back_endCrm\\kanbanproject1\\components\\Navigation.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projetos\\Back_endCrm\\kanbanproject1\\components\\PieChart.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'index' is defined but never used.","line":85,"column":29,"nodeType":"Identifier","messageId":"unusedVar","endLine":85,"endColumn":34,"suggestions":[{"messageId":"removeVar","data":{"varName":"index"},"fix":{"range":[2366,2373],"text":""},"desc":"Remove unused variable 'index'."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\"\r\n\r\nimport { useMemo } from \"react\"\r\n\r\nconst COLORS = [\"#0088FE\", \"#00C49F\", \"#FFBB28\", \"#FF8042\", \"#8884D8\", \"#FF6B6B\"]\r\n\r\nfunction PieChart({ data, width = 400, height = 300, showLabels = true, showLegend = true }) {\r\n  const { slices, total } = useMemo(() => {\r\n    const total = data.reduce((sum, item) => sum + item.value, 0)\r\n    let currentAngle = 0\r\n\r\n    const slices = data.map((item, index) => {\r\n      const percentage = total > 0 ? (item.value / total) * 100 : 0\r\n      const angle = (percentage / 100) * 360\r\n      const startAngle = currentAngle\r\n      const endAngle = currentAngle + angle\r\n\r\n      currentAngle += angle\r\n\r\n      return {\r\n        ...item,\r\n        percentage,\r\n        angle,\r\n        startAngle,\r\n        endAngle,\r\n        color: COLORS[index % COLORS.length],\r\n      }\r\n    })\r\n\r\n    return { slices, total }\r\n  }, [data])\r\n\r\n  const radius = Math.min(width, height) / 2 - 40\r\n  const centerX = width / 2\r\n  const centerY = height / 2\r\n\r\n  const createPath = (startAngle, endAngle, radius) => {\r\n    const start = polarToCartesian(centerX, centerY, radius, endAngle)\r\n    const end = polarToCartesian(centerX, centerY, radius, startAngle)\r\n    const largeArcFlag = endAngle - startAngle <= 180 ? \"0\" : \"1\"\r\n\r\n    return [\r\n      \"M\",\r\n      centerX,\r\n      centerY,\r\n      \"L\",\r\n      start.x,\r\n      start.y,\r\n      \"A\",\r\n      radius,\r\n      radius,\r\n      0,\r\n      largeArcFlag,\r\n      0,\r\n      end.x,\r\n      end.y,\r\n      \"Z\",\r\n    ].join(\" \")\r\n  }\r\n\r\n  const polarToCartesian = (centerX, centerY, radius, angleInDegrees) => {\r\n    const angleInRadians = ((angleInDegrees - 90) * Math.PI) / 180.0\r\n    return {\r\n      x: centerX + radius * Math.cos(angleInRadians),\r\n      y: centerY + radius * Math.sin(angleInRadians),\r\n    }\r\n  }\r\n\r\n  const getLabelPosition = (startAngle, endAngle, radius) => {\r\n    const midAngle = (startAngle + endAngle) / 2\r\n    return polarToCartesian(centerX, centerY, radius * 0.7, midAngle)\r\n  }\r\n\r\n  if (total === 0) {\r\n    return (\r\n      <div className=\"flex items-center justify-center\" style={{ width, height }}>\r\n        <p className=\"text-gray-500\">Nenhum dado disponível</p>\r\n      </div>\r\n    )\r\n  }\r\n\r\n  return (\r\n    <div className=\"flex flex-col items-center space-y-4\">\r\n      <svg width={width} height={height} className=\"overflow-visible\">\r\n        {slices.map((slice, index) => (\r\n          <g key={slice.name}>\r\n            <path\r\n              d={createPath(slice.startAngle, slice.endAngle, radius)}\r\n              fill={slice.color}\r\n              stroke=\"white\"\r\n              strokeWidth=\"2\"\r\n              className=\"hover:opacity-80 transition-opacity cursor-pointer\"\r\n            />\r\n            {showLabels && slice.percentage > 5 && (\r\n              <text\r\n                x={getLabelPosition(slice.startAngle, slice.endAngle, radius).x}\r\n                y={getLabelPosition(slice.startAngle, slice.endAngle, radius).y}\r\n                textAnchor=\"middle\"\r\n                dominantBaseline=\"middle\"\r\n                className=\"fill-white text-xs font-medium\"\r\n                style={{ textShadow: \"1px 1px 2px rgba(0,0,0,0.7)\" }}\r\n              >\r\n                {slice.percentage.toFixed(1)}%\r\n              </text>\r\n            )}\r\n          </g>\r\n        ))}\r\n      </svg>\r\n\r\n      {showLegend && (\r\n        <div className=\"chart-legend\">\r\n          {slices.map((slice) => (\r\n            <div key={slice.name} className=\"legend-item\">\r\n              <div className=\"legend-color\" style={{ backgroundColor: slice.color }}></div>\r\n              <span className=\"truncate\">{slice.name}</span>\r\n              <span className=\"text-xs text-gray-500\">({slice.value})</span>\r\n            </div>\r\n          ))}\r\n        </div>\r\n      )}\r\n    </div>\r\n  )\r\n}\r\n\r\nexport default PieChart\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Projetos\\Back_endCrm\\kanbanproject1\\components\\TaskCenter.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'onCreateTask' is defined but never used.","line":5,"column":54,"nodeType":"Identifier","messageId":"unusedVar","endLine":5,"endColumn":66,"suggestions":[{"messageId":"removeVar","data":{"varName":"onCreateTask"},"fix":{"range":[103,117],"text":""},"desc":"Remove unused variable 'onCreateTask'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'onDeleteTask' is defined but never used.","line":5,"column":68,"nodeType":"Identifier","messageId":"unusedVar","endLine":5,"endColumn":80,"suggestions":[{"messageId":"removeVar","data":{"varName":"onDeleteTask"},"fix":{"range":[117,131],"text":""},"desc":"Remove unused variable 'onDeleteTask'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'TaskItem' is defined but never used.","line":315,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":315,"endColumn":18,"suggestions":[{"messageId":"removeVar","data":{"varName":"TaskItem"},"fix":{"range":[11606,13465],"text":""},"desc":"Remove unused variable 'TaskItem'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'TaskListItem' is defined but never used.","line":368,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":368,"endColumn":22,"suggestions":[{"messageId":"removeVar","data":{"varName":"TaskListItem"},"fix":{"range":[13501,15469],"text":""},"desc":"Remove unused variable 'TaskListItem'."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\"\r\n\r\nimport { useState } from \"react\"\r\n\r\nfunction TaskCenter({ tasks, projects, onUpdateTask, onCreateTask, onDeleteTask }) {\r\n  const [filters, setFilters] = useState({\r\n    status: \"all_status\",\r\n    priority: \"all_priority\",\r\n    project: \"all_projects\",\r\n    search: \"\",\r\n  })\r\n  const [activeTab, setActiveTab] = useState(\"kanban\")\r\n\r\n  // Filtrar tarefas\r\n  const filteredTasks = tasks.filter((task) => {\r\n    if (filters.status !== \"all_status\" && task.status !== filters.status) return false\r\n    if (filters.priority !== \"all_priority\" && task.priority !== filters.priority) return false\r\n    if (filters.project !== \"all_projects\" && task.leadId !== filters.project) return false\r\n    if (filters.search && !task.title.toLowerCase().includes(filters.search.toLowerCase())) return false\r\n    return true\r\n  })\r\n\r\n  // Agrupar tarefas por status\r\n  const tasksByStatus = {\r\n    pending: filteredTasks.filter((t) => t.status === \"pending\"),\r\n    in_progress: filteredTasks.filter((t) => t.status === \"in_progress\"),\r\n    completed: filteredTasks.filter((t) => t.status === \"completed\"),\r\n    cancelled: filteredTasks.filter((t) => t.status === \"cancelled\"),\r\n  }\r\n\r\n  // Estatísticas\r\n  const stats = {\r\n    total: tasks.length,\r\n    pending: tasks.filter((t) => t.status === \"pending\").length,\r\n    in_progress: tasks.filter((t) => t.status === \"in_progress\").length,\r\n    completed: tasks.filter((t) => t.status === \"completed\").length,\r\n    overdue: tasks.filter((t) => t.dueDate && new Date(t.dueDate) < new Date() && t.status !== \"completed\").length,\r\n  }\r\n\r\n  const getPriorityColor = (priority) => {\r\n    const colors = {\r\n      low: \"bg-blue-100 text-blue-800\",\r\n      medium: \"bg-yellow-100 text-yellow-800\",\r\n      high: \"bg-orange-100 text-orange-800\",\r\n      urgent: \"bg-red-100 text-red-800\",\r\n    }\r\n    return colors[priority] || colors.low\r\n  }\r\n\r\n  const getStatusColor = (status) => {\r\n    const colors = {\r\n      pending: \"bg-gray-100 text-gray-800\",\r\n      in_progress: \"bg-blue-100 text-blue-800\",\r\n      completed: \"bg-green-100 text-green-800\",\r\n      cancelled: \"bg-red-100 text-red-800\",\r\n    }\r\n    return colors[status] || colors.pending\r\n  }\r\n\r\n  return (\r\n    <div className=\"task-center\">\r\n      {/* Header com estatísticas */}\r\n      <div className=\"task-stats\">\r\n        <div className=\"task-stat-card\">\r\n          <div className=\"task-stat-header\">\r\n            <span className=\"task-stat-title\">Total</span>\r\n            <span className=\"task-stat-icon\">📋</span>\r\n          </div>\r\n          <div className=\"task-stat-value\">{stats.total}</div>\r\n        </div>\r\n\r\n        <div className=\"task-stat-card\">\r\n          <div className=\"task-stat-header\">\r\n            <span className=\"task-stat-title\">Pendentes</span>\r\n            <span className=\"task-stat-icon\">⏳</span>\r\n          </div>\r\n          <div className=\"task-stat-value\">{stats.pending}</div>\r\n        </div>\r\n\r\n        <div className=\"task-stat-card\">\r\n          <div className=\"task-stat-header\">\r\n            <span className=\"task-stat-title\">Em Andamento</span>\r\n            <span className=\"task-stat-icon\">🔄</span>\r\n          </div>\r\n          <div className=\"task-stat-value\">{stats.in_progress}</div>\r\n        </div>\r\n\r\n        <div className=\"task-stat-card\">\r\n          <div className=\"task-stat-header\">\r\n            <span className=\"task-stat-title\">Concluídas</span>\r\n            <span className=\"task-stat-icon\">✅</span>\r\n          </div>\r\n          <div className=\"task-stat-value\">{stats.completed}</div>\r\n        </div>\r\n\r\n        <div className=\"task-stat-card\">\r\n          <div className=\"task-stat-header\">\r\n            <span className=\"task-stat-title\">Atrasadas</span>\r\n            <span className=\"task-stat-icon\">⚠️</span>\r\n          </div>\r\n          <div className=\"task-stat-value\">{stats.overdue}</div>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Filtros */}\r\n      <div className=\"task-filters\">\r\n        <div className=\"task-filters-header\">\r\n          <h3>Central de Tarefas</h3>\r\n          <button className=\"btn btn-primary\">➕ Nova Tarefa</button>\r\n        </div>\r\n\r\n        <div className=\"task-filters-grid\">\r\n          <div className=\"task-search\">\r\n            <span className=\"task-search-icon\">🔍</span>\r\n            <input\r\n              type=\"text\"\r\n              className=\"form-input\"\r\n              placeholder=\"Buscar tarefas...\"\r\n              value={filters.search}\r\n              onChange={(e) => setFilters({ ...filters, search: e.target.value })}\r\n            />\r\n          </div>\r\n\r\n          <select\r\n            className=\"form-select\"\r\n            value={filters.status}\r\n            onChange={(e) => setFilters({ ...filters, status: e.target.value })}\r\n          >\r\n            <option value=\"all_status\">Todos os Status</option>\r\n            <option value=\"pending\">Pendente</option>\r\n            <option value=\"in_progress\">Em Andamento</option>\r\n            <option value=\"completed\">Concluída</option>\r\n            <option value=\"cancelled\">Cancelada</option>\r\n          </select>\r\n\r\n          <select\r\n            className=\"form-select\"\r\n            value={filters.priority}\r\n            onChange={(e) => setFilters({ ...filters, priority: e.target.value })}\r\n          >\r\n            <option value=\"all_priority\">Todas as Prioridades</option>\r\n            <option value=\"urgent\">Urgente</option>\r\n            <option value=\"high\">Alta</option>\r\n            <option value=\"medium\">Média</option>\r\n            <option value=\"low\">Baixa</option>\r\n          </select>\r\n\r\n          <select\r\n            className=\"form-select\"\r\n            value={filters.project}\r\n            onChange={(e) => setFilters({ ...filters, project: e.target.value })}\r\n          >\r\n            <option value=\"all_projects\">Todos os Projetos</option>\r\n            {projects.map((project) => (\r\n              <option key={project.id} value={project.id}>\r\n                {project.title}\r\n              </option>\r\n            ))}\r\n          </select>\r\n\r\n          <button\r\n            className=\"btn btn-outline\"\r\n            onClick={() =>\r\n              setFilters({\r\n                status: \"all_status\",\r\n                priority: \"all_priority\",\r\n                project: \"all_projects\",\r\n                search: \"\",\r\n              })\r\n            }\r\n          >\r\n            🔄 Limpar Filtros\r\n          </button>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Visualização em abas */}\r\n      <div className=\"task-tabs\">\r\n        <div className=\"task-tabs-header\">\r\n          <div className=\"tabs-list\">\r\n            <button\r\n              className={`tabs-trigger ${activeTab === \"kanban\" ? \"active\" : \"\"}`}\r\n              onClick={() => setActiveTab(\"kanban\")}\r\n            >\r\n              Kanban\r\n            </button>\r\n            <button\r\n              className={`tabs-trigger ${activeTab === \"list\" ? \"active\" : \"\"}`}\r\n              onClick={() => setActiveTab(\"list\")}\r\n            >\r\n              Lista\r\n            </button>\r\n            <button\r\n              className={`tabs-trigger ${activeTab === \"calendar\" ? \"active\" : \"\"}`}\r\n              onClick={() => setActiveTab(\"calendar\")}\r\n            >\r\n              Calendário\r\n            </button>\r\n          </div>\r\n        </div>\r\n\r\n        <div className=\"task-tabs-content\">\r\n          {activeTab === \"kanban\" && (\r\n            <div className=\"task-kanban\">\r\n              {/* Coluna Pendente */}\r\n              <div className=\"task-column pending\">\r\n                <h3 className=\"task-column-header\">\r\n                  <span className=\"task-column-icon\">⏳</span>\r\n                  Pendentes\r\n                  <span className=\"task-column-count\">({tasksByStatus.pending.length})</span>\r\n                </h3>\r\n                <div className=\"task-list\">\r\n                  {tasksByStatus.pending.map((task) => (\r\n                    <TaskItem\r\n                      key={task.id}\r\n                      task={task}\r\n                      onUpdate={onUpdateTask}\r\n                      getPriorityColor={getPriorityColor}\r\n                      getStatusColor={getStatusColor}\r\n                    />\r\n                  ))}\r\n                </div>\r\n              </div>\r\n\r\n              {/* Coluna Em Andamento */}\r\n              <div className=\"task-column in-progress\">\r\n                <h3 className=\"task-column-header\">\r\n                  <span className=\"task-column-icon\">🔄</span>\r\n                  Em Andamento\r\n                  <span className=\"task-column-count\">({tasksByStatus.in_progress.length})</span>\r\n                </h3>\r\n                <div className=\"task-list\">\r\n                  {tasksByStatus.in_progress.map((task) => (\r\n                    <TaskItem\r\n                      key={task.id}\r\n                      task={task}\r\n                      onUpdate={onUpdateTask}\r\n                      getPriorityColor={getPriorityColor}\r\n                      getStatusColor={getStatusColor}\r\n                    />\r\n                  ))}\r\n                </div>\r\n              </div>\r\n\r\n              {/* Coluna Concluída */}\r\n              <div className=\"task-column completed\">\r\n                <h3 className=\"task-column-header\">\r\n                  <span className=\"task-column-icon\">✅</span>\r\n                  Concluídas\r\n                  <span className=\"task-column-count\">({tasksByStatus.completed.length})</span>\r\n                </h3>\r\n                <div className=\"task-list\">\r\n                  {tasksByStatus.completed.map((task) => (\r\n                    <TaskItem\r\n                      key={task.id}\r\n                      task={task}\r\n                      onUpdate={onUpdateTask}\r\n                      getPriorityColor={getPriorityColor}\r\n                      getStatusColor={getStatusColor}\r\n                    />\r\n                  ))}\r\n                </div>\r\n              </div>\r\n\r\n              {/* Coluna Cancelada */}\r\n              <div className=\"task-column cancelled\">\r\n                <h3 className=\"task-column-header\">\r\n                  <span className=\"task-column-icon\">❌</span>\r\n                  Canceladas\r\n                  <span className=\"task-column-count\">({tasksByStatus.cancelled.length})</span>\r\n                </h3>\r\n                <div className=\"task-list\">\r\n                  {tasksByStatus.cancelled.map((task) => (\r\n                    <TaskItem\r\n                      key={task.id}\r\n                      task={task}\r\n                      onUpdate={onUpdateTask}\r\n                      getPriorityColor={getPriorityColor}\r\n                      getStatusColor={getStatusColor}\r\n                    />\r\n                  ))}\r\n                </div>\r\n              </div>\r\n            </div>\r\n          )}\r\n\r\n          {activeTab === \"list\" && (\r\n            <div className=\"task-list\">\r\n              {filteredTasks.map((task) => (\r\n                <TaskListItem\r\n                  key={task.id}\r\n                  task={task}\r\n                  onUpdate={onUpdateTask}\r\n                  getPriorityColor={getPriorityColor}\r\n                  getStatusColor={getStatusColor}\r\n                />\r\n              ))}\r\n            </div>\r\n          )}\r\n\r\n          {activeTab === \"calendar\" && (\r\n            <div className=\"text-center py-12\">\r\n              <span className=\"text-6xl\">📅</span>\r\n              <h3 className=\"text-lg font-medium mb-2\">Visualização de Calendário</h3>\r\n              <p className=\"text-gray-500\">Em desenvolvimento - Visualize tarefas por data</p>\r\n            </div>\r\n          )}\r\n        </div>\r\n      </div>\r\n    </div>\r\n  )\r\n}\r\n\r\n// Componente do item de tarefa\r\nfunction TaskItem({ task, onUpdate, getPriorityColor, getStatusColor }) {\r\n  const isOverdue = task.dueDate && new Date(task.dueDate) < new Date() && task.status !== \"completed\"\r\n\r\n  return (\r\n    <div className={`task-item ${isOverdue ? \"overdue\" : \"\"}`}>\r\n      <div className=\"task-item-header\">\r\n        <input\r\n          type=\"checkbox\"\r\n          className=\"task-checkbox\"\r\n          checked={task.status === \"completed\"}\r\n          onChange={(e) => {\r\n            onUpdate(task.id, {\r\n              status: e.target.checked ? \"completed\" : \"pending\",\r\n              completedAt: e.target.checked ? new Date().toISOString() : undefined,\r\n            })\r\n          }}\r\n        />\r\n        <div className=\"task-item-content\">\r\n          <h4 className=\"task-item-title\">{task.title}</h4>\r\n          <div className=\"task-item-meta\">\r\n            {task.dueDate && (\r\n              <div className={`task-item-date ${isOverdue ? \"text-red-600\" : \"\"}`}>\r\n                📅 {new Date(task.dueDate).toLocaleDateString(\"pt-BR\")}\r\n              </div>\r\n            )}\r\n          </div>\r\n        </div>\r\n      </div>\r\n      <div className=\"task-item-actions\">\r\n        <span className={`task-item-priority ${getPriorityColor(task.priority)}`}>\r\n          {task.priority === \"urgent\"\r\n            ? \"Urgente\"\r\n            : task.priority === \"high\"\r\n              ? \"Alta\"\r\n              : task.priority === \"medium\"\r\n                ? \"Média\"\r\n                : \"Baixa\"}\r\n        </span>\r\n        <span className={`task-item-status ${getStatusColor(task.status)}`}>\r\n          {task.status === \"pending\"\r\n            ? \"Pendente\"\r\n            : task.status === \"in_progress\"\r\n              ? \"Em Andamento\"\r\n              : task.status === \"completed\"\r\n                ? \"Concluída\"\r\n                : \"Cancelada\"}\r\n        </span>\r\n      </div>\r\n    </div>\r\n  )\r\n}\r\n\r\n// Componente do item da lista\r\nfunction TaskListItem({ task, onUpdate, getPriorityColor, getStatusColor }) {\r\n  const isOverdue = task.dueDate && new Date(task.dueDate) < new Date() && task.status !== \"completed\"\r\n\r\n  return (\r\n    <div className={`task-item ${isOverdue ? \"overdue\" : \"\"}`}>\r\n      <div className=\"task-item-header\">\r\n        <input\r\n          type=\"checkbox\"\r\n          className=\"task-checkbox\"\r\n          checked={task.status === \"completed\"}\r\n          onChange={(e) => {\r\n            onUpdate(task.id, {\r\n              status: e.target.checked ? \"completed\" : \"pending\",\r\n              completedAt: e.target.checked ? new Date().toISOString() : undefined,\r\n            })\r\n          }}\r\n        />\r\n        <div className=\"task-item-content\">\r\n          <h4 className=\"task-item-title\">{task.title}</h4>\r\n          <div className=\"task-item-meta\">\r\n            {task.dueDate && (\r\n              <div className={`task-item-date ${isOverdue ? \"text-red-600\" : \"\"}`}>\r\n                📅 {new Date(task.dueDate).toLocaleDateString(\"pt-BR\")}\r\n              </div>\r\n            )}\r\n          </div>\r\n        </div>\r\n        <div className=\"task-item-actions\">\r\n          <span className={`task-item-priority ${getPriorityColor(task.priority)}`}>\r\n            {task.priority === \"urgent\"\r\n              ? \"Urgente\"\r\n              : task.priority === \"high\"\r\n                ? \"Alta\"\r\n                : task.priority === \"medium\"\r\n                  ? \"Média\"\r\n                  : \"Baixa\"}\r\n          </span>\r\n          <span className={`task-item-status ${getStatusColor(task.status)}`}>\r\n            {task.status === \"pending\"\r\n              ? \"Pendente\"\r\n              : task.status === \"in_progress\"\r\n                ? \"Em Andamento\"\r\n                : task.status === \"completed\"\r\n                  ? \"Concluída\"\r\n                  : \"Cancelada\"}\r\n          </span>\r\n          <button className=\"btn btn-ghost btn-sm\">👁️</button>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  )\r\n}\r\n\r\nexport default TaskCenter\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Projetos\\Back_endCrm\\kanbanproject1\\components\\admin-controls.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projetos\\Back_endCrm\\kanbanproject1\\components\\admin-panel.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projetos\\Back_endCrm\\kanbanproject1\\components\\auth\\login-form.tsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'Image' is defined but never used.","line":4,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":4,"endColumn":13,"suggestions":[{"messageId":"removeVar","data":{"varName":"Image"},"fix":{"range":[55,66],"text":""},"desc":"Remove unused variable 'Image'."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Image' is defined but never used.","line":4,"column":8,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":13},{"ruleId":"no-unused-vars","severity":1,"message":"'data' is defined but never used.","line":16,"column":12,"nodeType":"Identifier","messageId":"unusedVar","endLine":16,"endColumn":30,"suggestions":[{"messageId":"removeVar","data":{"varName":"data"},"fix":{"range":[557,575],"text":""},"desc":"Remove unused variable 'data'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'err' is defined but never used.","line":41,"column":14,"nodeType":"Identifier","messageId":"unusedVar","endLine":41,"endColumn":17},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'err' is defined but never used.","line":41,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":41,"endColumn":17}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\"\r\n\r\nimport type React from \"react\"\r\nimport Image from \"next/image\"\r\nimport { useState } from \"react\"\r\nimport { Button } from \"@/components/ui/button\"\r\nimport { Input } from \"@/components/ui/input\"\r\nimport { Label } from \"@/components/ui/label\"\r\nimport { Checkbox } from \"@/components/ui/checkbox\"\r\nimport { Eye, EyeOff, Mail, Lock, AlertCircle } from \"lucide-react\"\r\nimport { useApiAuth } from \"@/hooks/use-api-auth\"\r\nimport type { LoginRequest } from \"@/lib/api/auth-api\"\r\n\r\ninterface LoginFormProps {\r\n  onLoginSuccess: () => void\r\n  login?: (data: LoginRequest) => Promise<void>\r\n  isLoading?: boolean\r\n  error?: string | null\r\n}\r\n\r\nexport default function LoginForm({ onLoginSuccess, login: loginProp, isLoading: isLoadingProp, error: errorProp }: LoginFormProps) {\r\n  const [email, setEmail] = useState(\"\")\r\n  const [password, setPassword] = useState(\"\")\r\n  const [showPassword, setShowPassword] = useState(false)\r\n  const [rememberMe, setRememberMe] = useState(false)\r\n  const [localError, setLocalError] = useState<string | null>(null)\r\n\r\n  const { login: loginHook, isLoading: isLoadingHook, error: apiErrorHook } = useApiAuth()\r\n\r\n  const loginFn = loginProp ?? loginHook\r\n  const isLoading = isLoadingProp ?? isLoadingHook\r\n  const apiError = errorProp ?? apiErrorHook\r\n\r\n  const handleSubmit = async (e: React.FormEvent) => {\r\n    e.preventDefault()\r\n    setLocalError(null)\r\n\r\n    try {\r\n      await loginFn({ email, password })\r\n      onLoginSuccess()\r\n    } catch (err) {\r\n      setLocalError(apiError || \"Erro ao fazer login\")\r\n    }\r\n  }\r\n\r\n  const fillDemoCredentials = () => {\r\n    setEmail(\"dev.tester@example.com\")\r\n    setPassword(\"Passw0rd!\")\r\n    setLocalError(null)\r\n  }\r\n\r\n  const displayError = localError || apiError\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-gray-50 flex items-center justify-center p-4\">\r\n      <div className=\"w-full max-w-md bg-white rounded-2xl shadow-lg p-8\">\r\n        {/* Logo */}\r\n        <div className=\"flex justify-center mb-8\">\r\n          <img src=\"/unicrm-logo.png\" alt=\"UniCRM Logo\" width={280} height={80} className=\"h-auto w-auto\" />\r\n        </div>\r\n\r\n        {/* Header */}\r\n        <div className=\"text-center mb-8\">\r\n          <p className=\"text-gray-600\">Faça login para acessar sua conta</p>\r\n        </div>\r\n\r\n        {displayError && (\r\n          <div className=\"mb-6 p-3 bg-red-50 border border-red-200 rounded-lg flex items-start gap-3\">\r\n            <AlertCircle className=\"w-5 h-5 text-red-600 flex-shrink-0 mt-0.5\" />\r\n            <p className=\"text-sm text-red-700\">{displayError}</p>\r\n          </div>\r\n        )}\r\n\r\n        {/* Form */}\r\n        <form onSubmit={handleSubmit} className=\"space-y-6\">\r\n          {/* Email */}\r\n          <div className=\"space-y-2\">\r\n            <Label htmlFor=\"email\" className=\"text-sm font-medium text-gray-700\">\r\n              Email\r\n            </Label>\r\n            <div className=\"relative\">\r\n              <Mail className=\"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5\" />\r\n              <Input\r\n                id=\"email\"\r\n                type=\"email\"\r\n                placeholder=\"seu@email.com\"\r\n                value={email}\r\n                onChange={(e) => setEmail(e.target.value)}\r\n                className=\"pl-10 h-12 bg-gray-50 border-gray-200 focus:bg-white\"\r\n                required\r\n                disabled={isLoading}\r\n              />\r\n            </div>\r\n          </div>\r\n\r\n          {/* Password */}\r\n          <div className=\"space-y-2\">\r\n            <Label htmlFor=\"password\" className=\"text-sm font-medium text-gray-700\">\r\n              Senha\r\n            </Label>\r\n            <div className=\"relative\">\r\n              <Lock className=\"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5\" />\r\n              <Input\r\n                id=\"password\"\r\n                type={showPassword ? \"text\" : \"password\"}\r\n                placeholder=\"Digite sua senha\"\r\n                value={password}\r\n                onChange={(e) => setPassword(e.target.value)}\r\n                className=\"pl-10 pr-10 h-12 bg-gray-50 border-gray-200 focus:bg-white\"\r\n                required\r\n                disabled={isLoading}\r\n              />\r\n              <button\r\n                type=\"button\"\r\n                onClick={() => setShowPassword(!showPassword)}\r\n                className=\"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600\"\r\n                disabled={isLoading}\r\n              >\r\n                {showPassword ? <EyeOff className=\"w-5 h-5\" /> : <Eye className=\"w-5 h-5\" />}\r\n              </button>\r\n            </div>\r\n          </div>\r\n\r\n          {/* Remember me and Forgot password */}\r\n          <div className=\"flex items-center justify-between\">\r\n            <div className=\"flex items-center space-x-2\">\r\n              <Checkbox\r\n                id=\"remember\"\r\n                checked={rememberMe}\r\n                onCheckedChange={(checked) => setRememberMe(checked as boolean)}\r\n                disabled={isLoading}\r\n              />\r\n              <Label htmlFor=\"remember\" className=\"text-sm text-gray-600\">\r\n                Lembrar de mim\r\n              </Label>\r\n            </div>\r\n            <button\r\n              type=\"button\"\r\n              className=\"text-sm text-primary hover:text-primary/80 font-medium\"\r\n              disabled={isLoading}\r\n            >\r\n              Esqueceu a senha?\r\n            </button>\r\n          </div>\r\n\r\n          {/* Login Button */}\r\n          <Button\r\n            type=\"submit\"\r\n            className=\"w-full h-12 bg-primary hover:bg-primary/90 text-white font-medium rounded-xl disabled:opacity-50\"\r\n            disabled={isLoading}\r\n          >\r\n            {isLoading ? \"Entrando...\" : \"Entrar\"}\r\n          </Button>\r\n\r\n          {/* Demo Helper */}\r\n          <div className=\"mt-4 text-center\">\r\n            <button\r\n              type=\"button\"\r\n              onClick={fillDemoCredentials}\r\n              className=\"text-sm text-gray-600 hover:text-gray-800\"\r\n              disabled={isLoading}\r\n            >\r\n              Usar credenciais demo\r\n            </button>\r\n          </div>\r\n        </form>\r\n      </div>\r\n    </div>\r\n  )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Projetos\\Back_endCrm\\kanbanproject1\\components\\auth\\register-form.tsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'data' is defined but never used.","line":16,"column":15,"nodeType":"Identifier","messageId":"unusedVar","endLine":16,"endColumn":36,"suggestions":[{"messageId":"removeVar","data":{"varName":"data"},"fix":{"range":[596,617],"text":""},"desc":"Remove unused variable 'data'."}]},{"ruleId":"no-case-declarations","severity":1,"message":"Unexpected lexical declaration in case block.","line":52,"column":9,"nodeType":"VariableDeclaration","messageId":"unexpected","endLine":52,"endColumn":56,"suggestions":[{"messageId":"addBrackets","fix":{"range":[2059,2270],"text":"{ const emailRegex = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/\r\n        if (!emailRegex.test(value)) {\r\n          newErrors.email = \"Email inválido\"\r\n        } else {\r\n          delete newErrors.email\r\n        }\r\n        break }"},"desc":"Add {} brackets around the case block."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\"\r\n\r\nimport type React from \"react\"\r\nimport Image from \"next/image\"\r\nimport { useState } from \"react\"\r\nimport { Button } from \"@/components/ui/button\"\r\nimport { Input } from \"@/components/ui/input\"\r\nimport { Label } from \"@/components/ui/label\"\r\nimport { Checkbox } from \"@/components/ui/checkbox\"\r\nimport { Eye, EyeOff, User, Building, Mail, Lock, Briefcase, AlertCircle } from \"lucide-react\"\r\nimport { useApiAuth } from \"@/hooks/use-api-auth\"\r\nimport type { RegisterRequest } from \"@/lib/api/auth-api\"\r\n\r\ninterface RegisterFormProps {\r\n  onRegisterSuccess: () => void\r\n  register?: (data: RegisterRequest) => Promise<void>\r\n  isLoading?: boolean\r\n  error?: string | null\r\n}\r\n\r\nexport default function RegisterForm({ onRegisterSuccess, register: registerProp, isLoading: isLoadingProp, error: errorProp }: RegisterFormProps) {\r\n  const [fullName, setFullName] = useState(\"\")\r\n  const [company, setCompany] = useState(\"\")\r\n  const [email, setEmail] = useState(\"\")\r\n  const [password, setPassword] = useState(\"\")\r\n  const [confirmPassword, setConfirmPassword] = useState(\"\")\r\n  const [role, setRole] = useState(\"\")\r\n  const [showPassword, setShowPassword] = useState(false)\r\n  const [showConfirmPassword, setShowConfirmPassword] = useState(false)\r\n  const [acceptTerms, setAcceptTerms] = useState(false)\r\n  const [errors, setErrors] = useState<{ [key: string]: string }>({})\r\n  const [isValidating, setIsValidating] = useState(false)\r\n\r\n  const { register: registerHook, isLoading: isLoadingHook, error: apiErrorHook } = useApiAuth()\r\n\r\n  const registerFn = registerProp ?? registerHook\r\n  const isLoading = isLoadingProp ?? isLoadingHook\r\n  const apiError = errorProp ?? apiErrorHook\r\n\r\n  const validateField = (field: string, value: string) => {\r\n    const newErrors = { ...errors }\r\n\r\n    switch (field) {\r\n      case \"fullName\":\r\n        if (value.length < 2) {\r\n          newErrors.fullName = \"Nome deve ter pelo menos 2 caracteres\"\r\n        } else {\r\n          delete newErrors.fullName\r\n        }\r\n        break\r\n      case \"email\":\r\n        const emailRegex = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/\r\n        if (!emailRegex.test(value)) {\r\n          newErrors.email = \"Email inválido\"\r\n        } else {\r\n          delete newErrors.email\r\n        }\r\n        break\r\n      case \"password\":\r\n        if (value.length < 6) {\r\n          newErrors.password = \"Senha deve ter pelo menos 6 caracteres\"\r\n        } else if (!/(?=.*[a-z])(?=.*[A-Z])(?=.*\\d)/.test(value)) {\r\n          newErrors.password = \"Senha deve conter maiúscula, minúscula e número\"\r\n        } else {\r\n          delete newErrors.password\r\n        }\r\n        break\r\n      case \"confirmPassword\":\r\n        if (value !== password) {\r\n          newErrors.confirmPassword = \"Senhas não coincidem\"\r\n        } else {\r\n          delete newErrors.confirmPassword\r\n        }\r\n        break\r\n      case \"role\":\r\n        if (value.length < 2) {\r\n          newErrors.role = \"Cargo deve ter pelo menos 2 caracteres\"\r\n        } else {\r\n          delete newErrors.role\r\n        }\r\n        break\r\n    }\r\n\r\n    setErrors(newErrors)\r\n  }\r\n\r\n  const handleSubmit = async (e: React.FormEvent) => {\r\n    e.preventDefault()\r\n    setIsValidating(true)\r\n\r\n    // Validate all fields\r\n    validateField(\"fullName\", fullName)\r\n    validateField(\"email\", email)\r\n    validateField(\"password\", password)\r\n    validateField(\"confirmPassword\", confirmPassword)\r\n    validateField(\"role\", role)\r\n\r\n    if (Object.keys(errors).length > 0) {\r\n      setIsValidating(false)\r\n      return\r\n    }\r\n\r\n    if (!acceptTerms) {\r\n      setErrors({ terms: \"Você deve aceitar os termos de uso\" })\r\n      setIsValidating(false)\r\n      return\r\n    }\r\n\r\n    try {\r\n      await registerFn({\r\n        name: fullName,\r\n        email,\r\n        password,\r\n        phone: \"\",\r\n        company,\r\n        role,\r\n      })\r\n      onRegisterSuccess()\r\n    } catch (err) {\r\n      console.error(\"[v0] Registration error:\", err)\r\n    } finally {\r\n      setIsValidating(false)\r\n    }\r\n  }\r\n\r\n  const displayError = apiError\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-gray-50 flex items-center justify-center p-4\">\r\n      <div className=\"w-full max-w-md bg-white rounded-2xl shadow-lg p-8\">\r\n        <div className=\"flex justify-center mb-6\">\r\n          <Image\r\n            src=\"/unicrm-logo.png\"\r\n            alt=\"UniCRM Logo\"\r\n            width={240}\r\n            height={70}\r\n            className=\"h-16 w-auto object-contain\"\r\n          />\r\n        </div>\r\n\r\n        {/* Header */}\r\n        <div className=\"text-center mb-8\">\r\n          <h1 className=\"text-2xl font-semibold text-gray-900 mb-2\">\r\n            Junte-se ao <span className=\"text-primary\">UniCRM</span>\r\n          </h1>\r\n          <p className=\"text-gray-600\">Crie sua conta e comece a gerenciar seus clientes</p>\r\n        </div>\r\n\r\n        {displayError && (\r\n          <div className=\"mb-6 p-3 bg-red-50 border border-red-200 rounded-lg flex items-start gap-3\">\r\n            <AlertCircle className=\"w-5 h-5 text-red-600 flex-shrink-0 mt-0.5\" />\r\n            <p className=\"text-sm text-red-700\">{displayError}</p>\r\n          </div>\r\n        )}\r\n\r\n        {/* Form */}\r\n        <form onSubmit={handleSubmit} className=\"space-y-6\">\r\n          {/* Full Name */}\r\n          <div className=\"space-y-2\">\r\n            <Label htmlFor=\"fullName\" className=\"text-sm font-medium text-gray-700\">\r\n              Nome completo\r\n            </Label>\r\n            <div className=\"relative\">\r\n              <User className=\"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5\" />\r\n              <Input\r\n                id=\"fullName\"\r\n                type=\"text\"\r\n                placeholder=\"Seu nome completo\"\r\n                value={fullName}\r\n                onChange={(e) => {\r\n                  setFullName(e.target.value)\r\n                  validateField(\"fullName\", e.target.value)\r\n                }}\r\n                className={`pl-10 h-12 bg-gray-50 border-gray-200 focus:bg-white ${errors.fullName ? \"border-red-500\" : \"\"}`}\r\n                required\r\n                disabled={isLoading || isValidating}\r\n              />\r\n            </div>\r\n            {errors.fullName && <p className=\"text-red-500 text-sm\">{errors.fullName}</p>}\r\n          </div>\r\n\r\n          {/* Company */}\r\n          <div className=\"space-y-2\">\r\n            <Label htmlFor=\"company\" className=\"text-sm font-medium text-gray-700\">\r\n              Empresa\r\n            </Label>\r\n            <div className=\"relative\">\r\n              <Building className=\"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5\" />\r\n              <Input\r\n                id=\"company\"\r\n                type=\"text\"\r\n                placeholder=\"Nome da sua empresa\"\r\n                value={company}\r\n                onChange={(e) => setCompany(e.target.value)}\r\n                className=\"pl-10 h-12 bg-gray-50 border-gray-200 focus:bg-white\"\r\n                required\r\n                disabled={isLoading || isValidating}\r\n              />\r\n            </div>\r\n          </div>\r\n\r\n          {/* Email */}\r\n          <div className=\"space-y-2\">\r\n            <Label htmlFor=\"email\" className=\"text-sm font-medium text-gray-700\">\r\n              Email\r\n            </Label>\r\n            <div className=\"relative\">\r\n              <Mail className=\"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5\" />\r\n              <Input\r\n                id=\"email\"\r\n                type=\"email\"\r\n                placeholder=\"seu@email.com\"\r\n                value={email}\r\n                onChange={(e) => {\r\n                  setEmail(e.target.value)\r\n                  validateField(\"email\", e.target.value)\r\n                }}\r\n                className={`pl-10 h-12 bg-gray-50 border-gray-200 focus:bg-white ${errors.email ? \"border-red-500\" : \"\"}`}\r\n                required\r\n                disabled={isLoading || isValidating}\r\n              />\r\n            </div>\r\n            {errors.email && <p className=\"text-red-500 text-sm\">{errors.email}</p>}\r\n          </div>\r\n\r\n          <div className=\"space-y-2\">\r\n            <Label htmlFor=\"role\" className=\"text-sm font-medium text-gray-700\">\r\n              Cargo\r\n            </Label>\r\n            <div className=\"relative\">\r\n              <Briefcase className=\"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5\" />\r\n              <Input\r\n                id=\"role\"\r\n                type=\"text\"\r\n                placeholder=\"Ex: CEO, Gerente, Desenvolvedor, Designer...\"\r\n                value={role}\r\n                onChange={(e) => {\r\n                  setRole(e.target.value)\r\n                  validateField(\"role\", e.target.value)\r\n                }}\r\n                className={`pl-10 h-12 bg-gray-50 border-gray-200 focus:bg-white ${errors.role ? \"border-red-500\" : \"\"}`}\r\n                required\r\n                disabled={isLoading || isValidating}\r\n              />\r\n            </div>\r\n            {errors.role && <p className=\"text-red-500 text-sm\">{errors.role}</p>}\r\n            <p className=\"text-xs text-gray-500\">Defina seu cargo ou função na empresa</p>\r\n          </div>\r\n\r\n          {/* Password */}\r\n          <div className=\"space-y-2\">\r\n            <Label htmlFor=\"password\" className=\"text-sm font-medium text-gray-700\">\r\n              Senha\r\n            </Label>\r\n            <div className=\"relative\">\r\n              <Lock className=\"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5\" />\r\n              <Input\r\n                id=\"password\"\r\n                type={showPassword ? \"text\" : \"password\"}\r\n                placeholder=\"Crie uma senha segura\"\r\n                value={password}\r\n                onChange={(e) => {\r\n                  setPassword(e.target.value)\r\n                  validateField(\"password\", e.target.value)\r\n                }}\r\n                className={`pl-10 pr-10 h-12 bg-gray-50 border-gray-200 focus:bg-white ${errors.password ? \"border-red-500\" : \"\"}`}\r\n                required\r\n                disabled={isLoading || isValidating}\r\n              />\r\n              <button\r\n                type=\"button\"\r\n                onClick={() => setShowPassword(!showPassword)}\r\n                className=\"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600\"\r\n                disabled={isLoading || isValidating}\r\n              >\r\n                {showPassword ? <EyeOff className=\"w-5 h-5\" /> : <Eye className=\"w-5 h-5\" />}\r\n              </button>\r\n            </div>\r\n            {errors.password && <p className=\"text-red-500 text-sm\">{errors.password}</p>}\r\n          </div>\r\n\r\n          {/* Confirm Password */}\r\n          <div className=\"space-y-2\">\r\n            <Label htmlFor=\"confirmPassword\" className=\"text-sm font-medium text-gray-700\">\r\n              Confirmar senha\r\n            </Label>\r\n            <div className=\"relative\">\r\n              <Lock className=\"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5\" />\r\n              <Input\r\n                id=\"confirmPassword\"\r\n                type={showConfirmPassword ? \"text\" : \"password\"}\r\n                placeholder=\"Confirme sua senha\"\r\n                value={confirmPassword}\r\n                onChange={(e) => {\r\n                  setConfirmPassword(e.target.value)\r\n                  validateField(\"confirmPassword\", e.target.value)\r\n                }}\r\n                className={`pl-10 pr-10 h-12 bg-gray-50 border-gray-200 focus:bg-white ${errors.confirmPassword ? \"border-red-500\" : \"\"}`}\r\n                required\r\n                disabled={isLoading || isValidating}\r\n              />\r\n              <button\r\n                type=\"button\"\r\n                onClick={() => setShowConfirmPassword(!showConfirmPassword)}\r\n                className=\"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600\"\r\n                disabled={isLoading || isValidating}\r\n              >\r\n                {showConfirmPassword ? <EyeOff className=\"w-5 h-5\" /> : <Eye className=\"w-5 h-5\" />}\r\n              </button>\r\n            </div>\r\n            {errors.confirmPassword && <p className=\"text-red-500 text-sm\">{errors.confirmPassword}</p>}\r\n          </div>\r\n\r\n          {/* Terms and Privacy */}\r\n          <div className=\"flex items-start space-x-2\">\r\n            <Checkbox\r\n              id=\"terms\"\r\n              checked={acceptTerms}\r\n              onCheckedChange={(checked) => {\r\n                setAcceptTerms(checked as boolean)\r\n                if (checked) {\r\n                  const newErrors = { ...errors }\r\n                  delete newErrors.terms\r\n                  setErrors(newErrors)\r\n                }\r\n              }}\r\n              className=\"mt-1\"\r\n              disabled={isLoading || isValidating}\r\n            />\r\n            <Label htmlFor=\"terms\" className=\"text-sm text-gray-600 leading-relaxed\">\r\n              Eu concordo com os{\" \"}\r\n              <button\r\n                type=\"button\"\r\n                className=\"text-primary hover:text-primary/80 font-medium\"\r\n                disabled={isLoading || isValidating}\r\n              >\r\n                Termos de Uso\r\n              </button>{\" \"}\r\n              e{\" \"}\r\n              <button\r\n                type=\"button\"\r\n                className=\"text-primary hover:text-primary/80 font-medium\"\r\n                disabled={isLoading || isValidating}\r\n              >\r\n                Política de Privacidade\r\n              </button>\r\n            </Label>\r\n          </div>\r\n          {errors.terms && <p className=\"text-red-500 text-sm\">{errors.terms}</p>}\r\n\r\n          {/* Register Button */}\r\n          <Button\r\n            type=\"submit\"\r\n            disabled={isLoading || isValidating || Object.keys(errors).length > 0}\r\n            className=\"w-full h-12 bg-primary hover:bg-primary/90 text-white font-medium rounded-xl disabled:opacity-50\"\r\n          >\r\n            {isLoading || isValidating ? \"Criando conta...\" : \"Criar conta\"}\r\n          </Button>\r\n        </form>\r\n      </div>\r\n    </div>\r\n  )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Projetos\\Back_endCrm\\kanbanproject1\\components\\conversation-panel.tsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'WhatsAppEvent' is defined but never used.","line":52,"column":31,"nodeType":"Identifier","messageId":"unusedVar","endLine":52,"endColumn":44,"suggestions":[{"messageId":"removeVar","data":{"varName":"WhatsAppEvent"},"fix":{"range":[1566,1586],"text":""},"desc":"Remove unused variable 'WhatsAppEvent'."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'WhatsAppEvent' is defined but never used.","line":52,"column":31,"nodeType":null,"messageId":"unusedVar","endLine":52,"endColumn":44},{"ruleId":"no-unused-vars","severity":1,"message":"'userRole' is assigned a value but never used.","line":94,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":94,"endColumn":18},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'userRole' is assigned a value but never used.","line":94,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":94,"endColumn":18},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has missing dependencies: 'initializeWhatsApp', 'loadContacts', 'loadConversations', and 'loadFilterOptions'. Either include them or remove the dependency array.","line":265,"column":6,"nodeType":"ArrayExpression","endLine":265,"endColumn":8,"suggestions":[{"desc":"Update the dependencies array to be: [initializeWhatsApp, loadContacts, loadConversations, loadFilterOptions]","fix":{"range":[9914,9916],"text":"[initializeWhatsApp, loadContacts, loadConversations, loadFilterOptions]"}}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has missing dependencies: 'loadContacts' and 'loadConversations'. Either include them or remove the dependency array.","line":381,"column":6,"nodeType":"ArrayExpression","endLine":381,"endColumn":37,"suggestions":[{"desc":"Update the dependencies array to be: [connectionStatus, isConnected, loadContacts, loadConversations]","fix":{"range":[13967,13998],"text":"[connectionStatus, isConnected, loadContacts, loadConversations]"}}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has missing dependencies: 'loadContacts' and 'loadConversations'. Either include them or remove the dependency array.","line":421,"column":6,"nodeType":"ArrayExpression","endLine":421,"endColumn":8,"suggestions":[{"desc":"Update the dependencies array to be: [loadContacts, loadConversations]","fix":{"range":[15493,15495],"text":"[loadContacts, loadConversations]"}}]},{"ruleId":"no-unused-vars","severity":1,"message":"'generateQr' is assigned a value but never used.","line":465,"column":9,"nodeType":"Identifier","messageId":"unusedVar","endLine":465,"endColumn":19},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'generateQr' is assigned a value but never used.","line":465,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":465,"endColumn":19},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'activeContact'. Either include it or remove the dependency array.","line":865,"column":6,"nodeType":"ArrayExpression","endLine":865,"endColumn":38,"suggestions":[{"desc":"Update the dependencies array to be: [activeContact, activeContact.id, isConnected]","fix":{"range":[30424,30456],"text":"[activeContact, activeContact.id, isConnected]"}}]},{"ruleId":"no-unused-vars","severity":1,"message":"'e' is defined but never used.","line":1003,"column":30,"nodeType":"Identifier","messageId":"unusedVar","endLine":1003,"endColumn":31},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'e' is defined but never used.","line":1003,"column":30,"nodeType":null,"messageId":"unusedVar","endLine":1003,"endColumn":31},{"ruleId":"no-unused-vars","severity":1,"message":"'contact' is defined but never used.","line":1712,"column":15,"nodeType":"Identifier","messageId":"unusedVar","endLine":1712,"endColumn":39,"suggestions":[{"messageId":"removeVar","data":{"varName":"contact"},"fix":{"range":[70183,70207],"text":""},"desc":"Remove unused variable 'contact'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'contact' is defined but never used.","line":1713,"column":16,"nodeType":"Identifier","messageId":"unusedVar","endLine":1713,"endColumn":40,"suggestions":[{"messageId":"removeVar","data":{"varName":"contact"},"fix":{"range":[70233,70257],"text":""},"desc":"Remove unused variable 'contact'."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":14,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\"\r\n\r\nimport type React from \"react\"\r\nimport { useState, useEffect, useRef } from \"react\"\r\nimport { Avatar, AvatarFallback, AvatarImage } from \"@/components/ui/avatar\"\r\nimport { Button } from \"@/components/ui/button\"\r\nimport { Input } from \"@/components/ui/input\"\r\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\"\r\nimport { Badge } from \"@/components/ui/badge\"\r\nimport { ScrollArea } from \"@/components/ui/scroll-area\"\r\nimport {\r\n  Send,\r\n  Phone,\r\n  Video,\r\n  Paperclip,\r\n  MoreVertical,\r\n  Search,\r\n  Plus,\r\n  MessageSquare,\r\n  Settings,\r\n  QrCode,\r\n  Smartphone,\r\n  RefreshCw,\r\n  Filter,\r\n  X,\r\n  Save,\r\n  Trash2,\r\n} from \"lucide-react\"\r\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\"\r\nimport {\r\n  whatsappService,\r\n  type WhatsAppContact,\r\n  type WhatsAppMessage,\r\n  type WhatsAppConversation,\r\n} from \"@/lib/whatsapp-api\"\r\nimport WhatsAppConfig from \"./whatsapp-config\"\r\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\"\r\nimport { Popover, PopoverContent, PopoverTrigger } from \"@/components/ui/popover\"\r\nimport { Label } from \"@/components/ui/label\"\r\nimport { Checkbox } from \"@/components/ui/checkbox\"\r\nimport { loadFromStorage, saveToStorage } from \"@/lib/storage\"\r\nimport { apiClient, API_BASE_URL } from \"@/lib/api-client\"\r\nimport { Power } from \"lucide-react\"\r\nimport {\r\n  Dialog,\r\n  DialogContent,\r\n  DialogDescription,\r\n  DialogFooter,\r\n  DialogHeader,\r\n  DialogTitle,\r\n} from \"@/components/ui/dialog\"\r\nimport { useWhatsappSse, type WhatsAppEvent } from \"@/hooks/use-whatsapp-sse\"\r\nimport { WhatsAppPresenceIndicator, type ChatPresenceData } from \"@/components/whatsapp-presence-indicator\"\r\nimport { WhatsAppStatusMonitor } from \"@/components/whatsapp-status-monitor\"\r\nimport { WhatsAppMessageStatus, type MessageStatusData } from \"@/components/whatsapp-message-status\"\r\n\r\ntype UserRole = \"admin\" | \"client\"\r\n\r\nconst getUserRole = (): UserRole => {\r\n  // In production, this would come from your authentication system\r\n  // For now, we'll check if there's an admin flag in localStorage or environment\r\n  const isAdmin = localStorage.getItem(\"is_admin\") === \"true\" || process.env.NEXT_PUBLIC_USER_ROLE === \"admin\"\r\n\r\n  return isAdmin ? \"admin\" : \"client\"\r\n}\r\n\r\ninterface ConversationFilters {\r\n  status: string[]\r\n  readStatus: string[]\r\n  queueIds: string[]\r\n  tags: string[]\r\n  assignedUserId: string\r\n}\r\n\r\ninterface FilterPreset {\r\n  id: string\r\n  name: string\r\n  filters: ConversationFilters\r\n}\r\n\r\nexport default function ConversationPanel() {\r\n  console.log(\"[v0] ConversationPanel montado\")\r\n  const [activeContact, setActiveContact] = useState<WhatsAppContact | null>(null)\r\n  const [messageInput, setMessageInput] = useState(\"\")\r\n  const [searchTerm, setSearchTerm] = useState(\"\")\r\n  const [contacts, setContacts] = useState<WhatsAppContact[]>([])\r\n  const [conversations, setConversations] = useState<Map<string, WhatsAppConversation>>(new Map())\r\n  const [showConfig, setShowConfig] = useState(false)\r\n  const [isConnected, setIsConnected] = useState(false)\r\n  const [qrCode, setQrCode] = useState<string | null>(null)\r\n  const [isGeneratingQR, setIsGeneratingQR] = useState(false)\r\n  const [connectionStatus, setConnectionStatus] = useState<\"connected\" | \"connecting\" | \"disconnected\">(\"disconnected\")\r\n  const [connectionError, setConnectionError] = useState<string | null>(null)\r\n  const [userRole] = useState<UserRole>(getUserRole())\r\n\r\n  const [filters, setFilters] = useState<ConversationFilters>({\r\n    status: [],\r\n    readStatus: [],\r\n    queueIds: [],\r\n    tags: [],\r\n    assignedUserId: \"\",\r\n  })\r\n  const [availableQueues, setAvailableQueues] = useState<any[]>([])\r\n  const [availableTags, setAvailableTags] = useState<string[]>([])\r\n  const [availableUsers, setAvailableUsers] = useState<any[]>([])\r\n  const [showFilters, setShowFilters] = useState(false)\r\n  const [showNewConversation, setShowNewConversation] = useState(false)\r\n  const [newContactPhone, setNewContactPhone] = useState(\"\")\r\n  const [newContactName, setNewContactName] = useState(\"\")\r\n  const [isEditingContactName, setIsEditingContactName] = useState(false)\r\n  const [editingContactName, setEditingContactName] = useState(\"\")\r\n  const [showPhoneConnect, setShowPhoneConnect] = useState(false)\r\n  const [phoneInput, setPhoneInput] = useState(\"\")\r\n  const [phoneCode, setPhoneCode] = useState<string | null>(null)\r\n  const [phoneLoading, setPhoneLoading] = useState(false)\r\n  const [phoneError, setPhoneError] = useState<string | null>(null)\r\n\r\n  const [filterPresets, setFilterPresets] = useState<FilterPreset[]>([])\r\n  const [activePresetId, setActivePresetId] = useState<string | null>(null)\r\n  const [showSavePresetDialog, setShowSavePresetDialog] = useState(false)\r\n  const [presetName, setPresetName] = useState(\"\")\r\n  const [chatPresenceMap, setChatPresenceMap] = useState<Map<string, ChatPresenceData>>(new Map())\r\n  const [messageStatusMap, setMessageStatusMap] = useState<Map<string, MessageStatusData>>(new Map())\r\n  const [showStatusMonitor, setShowStatusMonitor] = useState(false)\r\n\r\n  // UI overrides to persist local actions between refreshes\r\n  const [readContacts, setReadContacts] = useState<Set<string>>(new Set())\r\n  const [deletedContacts, setDeletedContacts] = useState<Set<string>>(new Set())\r\n\r\n  const READ_STORAGE_KEY = \"unicrm_chat_read_contacts\"\r\n  const DELETED_STORAGE_KEY = \"unicrm_chat_deleted_contacts\"\r\n  const messagesEndRef = useRef<HTMLDivElement>(null)\r\n  const [showDeleteConfirm, setShowDeleteConfirm] = useState(false)\r\n  const [contactToDelete, setContactToDelete] = useState<WhatsAppContact | null>(null)\r\n  const [isLoadingMessages, setIsLoadingMessages] = useState(false)\r\n  const [loadedMessagesCount, setLoadedMessagesCount] = useState(50) // Initial number of messages to load\r\n\r\n  // QR Code auto-generation states and refs\r\n  const hasRequestedQrRef = useRef(false) // evita múltiplas requisições concorrentes\r\n\r\n  const LOCAL_KEY = \"unicrm_whatsapp_config\"\r\n  const CONNECTED_STORAGE_KEY = \"whatsapp_connected\"\r\n\r\n  // Initialize WhatsApp SSE connection\r\n  const sse = useWhatsappSse({\r\n    apiBase: API_BASE_URL,\r\n    clientKey: loadFromStorage(\"clientKey\", \"\")\r\n  })\r\n\r\n  // Start SSE connection when connected to WhatsApp\r\n  useEffect(() => {\r\n    if (isConnected) {\r\n      sse.start()\r\n    } else {\r\n      sse.stop()\r\n    }\r\n  }, [isConnected, sse])\r\n\r\n  // Process chat presence events from SSE\r\n  useEffect(() => {\r\n    if (sse.lastChatPresence) {\r\n      const event = sse.lastChatPresence\r\n      const phone = event.payload.phone || event.payload.contactId\r\n      if (phone) {\r\n        setChatPresenceMap(prev => {\r\n          const newMap = new Map(prev)\r\n          newMap.set(phone, {\r\n            phone,\r\n            status: event.payload.status || \"UNAVAILABLE\",\r\n            lastSeen: event.payload.lastSeen,\r\n            instanceId: event.payload.instanceId\r\n          })\r\n          return newMap\r\n        })\r\n      }\r\n    }\r\n  }, [sse.lastChatPresence])\r\n\r\n  // Process message status events from SSE\r\n  useEffect(() => {\r\n    if (sse.lastMessageStatus) {\r\n      const event = sse.lastMessageStatus\r\n      const phone = event.payload.phone || event.payload.contactId\r\n      if (phone) {\r\n        setMessageStatusMap(prev => {\r\n          const newMap = new Map(prev)\r\n          newMap.set(phone, {\r\n            phone,\r\n            status: event.payload.status || \"SENT\",\r\n            ids: event.payload.ids || [],\r\n            instanceId: event.payload.instanceId,\r\n            isGroup: event.payload.isGroup,\r\n            momment: event.payload.momment\r\n          })\r\n          return newMap\r\n        })\r\n      }\r\n    }\r\n  }, [sse.lastMessageStatus])\r\n\r\n  useEffect(() => {\r\n    // Check if WhatsApp service is configured\r\n    const savedConfig = localStorage.getItem(LOCAL_KEY) || localStorage.getItem(\"whatsapp_config\")\r\n    if (savedConfig) {\r\n      try {\r\n        const config = JSON.parse(savedConfig)\r\n        initializeWhatsApp(config)\r\n      } catch (error) {\r\n        console.error(\"[v0] Error loading WhatsApp config:\", error)\r\n      }\r\n    }\r\n\r\n    const isWhatsAppConnected = localStorage.getItem(\"whatsapp_connected\") === \"true\"\r\n    if (isWhatsAppConnected) {\r\n      setConnectionStatus(\"connected\")\r\n      setIsConnected(true)\r\n    } else {\r\n      // Don't auto-connect, let user configure first\r\n      setConnectionStatus(\"disconnected\")\r\n    }\r\n\r\n    loadFilterOptions()\r\n    loadFilterPresets()\r\n\r\n    // Load local overrides for read/deleted\r\n    try {\r\n      if (typeof window !== \"undefined\") {\r\n        const rawRead = localStorage.getItem(READ_STORAGE_KEY)\r\n        if (rawRead) {\r\n          const arr = JSON.parse(rawRead)\r\n          if (Array.isArray(arr)) setReadContacts(new Set(arr))\r\n        }\r\n        const rawDeleted = localStorage.getItem(DELETED_STORAGE_KEY)\r\n        if (rawDeleted) {\r\n          const arr2 = JSON.parse(rawDeleted)\r\n          if (Array.isArray(arr2)) setDeletedContacts(new Set(arr2))\r\n        }\r\n      }\r\n    } catch {}\r\n\r\n    // Setup real-time listeners with cleanup\r\n    const messageCb = (message: WhatsAppMessage) => {\r\n      console.log(\"[v0] New message received in UI:\", message)\r\n      loadConversations()\r\n    }\r\n    const contactCb = (contact: WhatsAppContact) => {\r\n      console.log(\"[v0] Contact status changed in UI:\", contact)\r\n      loadContacts()\r\n    }\r\n    whatsappService.onMessageReceived(messageCb)\r\n    whatsappService.onContactStatusChanged(contactCb)\r\n\r\n    return () => {\r\n      whatsappService.offMessageReceived(messageCb)\r\n      whatsappService.offContactStatusChanged(contactCb)\r\n      if (qrPollRef.current) {\r\n        clearInterval(qrPollRef.current)\r\n        qrPollRef.current = null\r\n      }\r\n      if (statusPollRef.current) {\r\n        clearInterval(statusPollRef.current)\r\n        statusPollRef.current = null\r\n      }\r\n    }\r\n  }, [])\r\n\r\n  const loadFilterOptions = () => {\r\n    // Load queues from storage\r\n    const queues = loadFromStorage(\"queues\", [])\r\n    setAvailableQueues(Array.isArray(queues) ? queues : [])\r\n\r\n    // Load users from storage\r\n    const users = loadFromStorage(\"users\", [])\r\n    setAvailableUsers(Array.isArray(users) ? users.filter((u: any) => u.status === \"active\") : [])\r\n\r\n    // Extract unique tags from all conversations\r\n    const allTags = new Set<string>()\r\n    conversations.forEach((conv) => {\r\n      conv.tags?.forEach((tag) => allTags.add(tag))\r\n    })\r\n    setAvailableTags(Array.from(allTags))\r\n  }\r\n\r\n  const loadFilterPresets = () => {\r\n    const presets = loadFromStorage(\"chat_filter_presets\", [])\r\n    setFilterPresets(Array.isArray(presets) ? presets : [])\r\n  }\r\n\r\n  const saveFilterPreset = () => {\r\n    if (!presetName.trim()) return\r\n\r\n    const newPreset: FilterPreset = {\r\n      id: Date.now().toString(),\r\n      name: presetName.trim(),\r\n      filters: { ...filters },\r\n    }\r\n\r\n    const updatedPresets = [...filterPresets, newPreset]\r\n    setFilterPresets(updatedPresets)\r\n    saveToStorage(updatedPresets, \"chat_filter_presets\")\r\n    setActivePresetId(newPreset.id)\r\n    setPresetName(\"\")\r\n    setShowSavePresetDialog(false)\r\n  }\r\n\r\n  const loadFilterPreset = (presetId: string) => {\r\n    const preset = filterPresets.find((p) => p.id === presetId)\r\n    if (preset) {\r\n      setFilters(preset.filters)\r\n      setActivePresetId(presetId)\r\n    }\r\n  }\r\n\r\n  const deleteFilterPreset = (presetId: string) => {\r\n    const updatedPresets = filterPresets.filter((p) => p.id !== presetId)\r\n    setFilterPresets(updatedPresets)\r\n    saveToStorage(updatedPresets, \"chat_filter_presets\")\r\n    if (activePresetId === presetId) {\r\n      setActivePresetId(null)\r\n    }\r\n  }\r\n\r\n  const qrPollRef = useRef<number | null>(null)\r\n  const statusPollRef = useRef<number | null>(null)\r\n\r\n  // Status polling para conectar apenas durante processo de conexão manual\r\n  useEffect(() => {\r\n    // Clear existing status poll\r\n    if (statusPollRef.current) {\r\n      clearInterval(statusPollRef.current)\r\n      statusPollRef.current = null\r\n    }\r\n\r\n    // Start status polling only when connecting\r\n    if (connectionStatus === \"connecting\") {\r\n      statusPollRef.current = window.setInterval(async () => {\r\n        try {\r\n          const status = await apiClient.get<any>(\"/whatsapp/status\")\r\n          const connected = Boolean(status?.connected)\r\n          const smartphoneConnected = Boolean(status?.smartphoneConnected)\r\n          const session = Boolean(status?.session)\r\n          const sessionActive = Boolean(status?.sessionActive)\r\n\r\n          console.log(\"[v0] Status check:\", { connected, smartphoneConnected, session, sessionActive })\r\n\r\n          if (connected && (smartphoneConnected || session || sessionActive)) {\r\n            // Connected - stop polling and load data\r\n            if (statusPollRef.current) {\r\n              clearInterval(statusPollRef.current)\r\n              statusPollRef.current = null\r\n            }\r\n            if (qrPollRef.current) {\r\n              clearInterval(qrPollRef.current)\r\n              qrPollRef.current = null\r\n            }\r\n            setConnectionStatus(\"connected\")\r\n            setIsConnected(true)\r\n            setQrCode(null)\r\n            try { localStorage.setItem(CONNECTED_STORAGE_KEY, \"true\") } catch {}\r\n            await loadContacts()\r\n            await loadConversations()\r\n          }\r\n        } catch (error) {\r\n          console.error(\"[v0] Status polling error:\", error)\r\n          // Only set to disconnected if we're not already trying to connect\r\n          if (connectionStatus !== \"connecting\") {\r\n            setConnectionStatus(\"disconnected\")\r\n            setIsConnected(false)\r\n            try { localStorage.setItem(CONNECTED_STORAGE_KEY, \"false\") } catch {}\r\n          }\r\n        }\r\n      }, 8000)\r\n    }\r\n\r\n    return () => {\r\n      if (statusPollRef.current) {\r\n        clearInterval(statusPollRef.current)\r\n        statusPollRef.current = null\r\n      }\r\n    }\r\n  }, [connectionStatus, isConnected])\r\n\r\n  // Desativado: não gerar QR automaticamente e não revalidar estado ao mudar connectionStatus\r\n  useEffect(() => {}, [connectionStatus])\r\n\r\n  // Verificação inicial de conexão ao montar (valida uma única vez; depois confia no storage)\r\n  useEffect(() => {\r\n    const initStatus = async () => {\r\n      try {\r\n        // Trust local storage if marked connected\r\n        const localConnected = (() => {\r\n          try { return localStorage.getItem(CONNECTED_STORAGE_KEY) === \"true\" } catch { return false }\r\n        })()\r\n        if (localConnected) {\r\n          setConnectionStatus(\"connected\")\r\n          setIsConnected(true)\r\n          await loadContacts()\r\n          await loadConversations()\r\n          return\r\n        }\r\n\r\n        // Single backend validation when not yet validated\r\n        const status = await apiClient.get<any>(\"/whatsapp/status\")\r\n        const connected = Boolean(status?.connected || status?.sessionActive)\r\n        if (connected) {\r\n          setConnectionStatus(\"connected\")\r\n          setIsConnected(true)\r\n          try { localStorage.setItem(CONNECTED_STORAGE_KEY, \"true\") } catch {}\r\n          await loadContacts()\r\n          await loadConversations()\r\n        } else {\r\n          setConnectionStatus(\"disconnected\")\r\n          setIsConnected(false)\r\n          try { localStorage.setItem(CONNECTED_STORAGE_KEY, \"false\") } catch {}\r\n        }\r\n      } catch (e) {\r\n        console.error(\"[v0] init status error:\", e)\r\n      }\r\n    }\r\n    initStatus()\r\n  }, [])\r\n\r\n  const generateQRCode = async () => {\r\n    try {\r\n      setIsGeneratingQR(true)\r\n      setConnectionStatus(\"connecting\")\r\n      setConnectionError(null) // Limpar erro anterior\r\n      const url = `${API_BASE_URL}/whatsapp/qr/image?ts=${Date.now()}`\r\n      setQrCode(url)\r\n    } catch (error) {\r\n      console.error(\"[v0] Erro ao gerar QR:\", error)\r\n      setConnectionStatus(\"disconnected\")\r\n      setConnectionError(\"Erro ao gerar QR Code. Verifique a configuração.\")\r\n    } finally {\r\n      setIsGeneratingQR(false)\r\n    }\r\n\r\n    // Poll status até conectar\r\n    if (qrPollRef.current) {\r\n      clearInterval(qrPollRef.current)\r\n    }\r\n    qrPollRef.current = window.setInterval(async () => {\r\n      try {\r\n        const status = await apiClient.get<any>(\"/whatsapp/status\")\r\n        const connected = Boolean(status?.connected)\r\n        const smartphoneConnected = Boolean(status?.smartphoneConnected)\r\n        const session = Boolean(status?.session)\r\n        const sessionActive = Boolean(status?.sessionActive)\r\n        if (connected && (smartphoneConnected || session || sessionActive)) {\r\n          if (qrPollRef.current) {\r\n            clearInterval(qrPollRef.current)\r\n            qrPollRef.current = null\r\n          }\r\n          setConnectionStatus(\"connected\")\r\n          setIsConnected(true)\r\n          setQrCode(null)\r\n          await loadContacts()\r\n          await loadConversations()\r\n        }\r\n      } catch {}\r\n    }, 5000)\r\n  }\r\n\r\n  // Função para gerar QR automaticamente (sem interação do usuário)\r\n  const generateQr = async () => {\r\n    console.log(\"[v0] generateQr() chamado - isGeneratingQR:\", isGeneratingQR, \"hasRequestedQrRef:\", hasRequestedQrRef.current)\r\n    if (isGeneratingQR || hasRequestedQrRef.current) return\r\n    \r\n    setIsGeneratingQR(true)\r\n    hasRequestedQrRef.current = true\r\n    \r\n    try {\r\n      console.log(\"[v0] Gerando QR via backend...\")\r\n      const url = `${API_BASE_URL}/whatsapp/qr/image?ts=${Date.now()}`\r\n      setQrCode(url)\r\n    } catch (err) {\r\n      console.error(\"[v0] Erro ao gerar QR:\", err)\r\n      console.error(\"[v0] Tipo do erro:\", typeof err)\r\n      console.error(\"[v0] Mensagem do erro:\", (err as any)?.message)\r\n      console.error(\"[v0] Stack do erro:\", (err as any)?.stack)\r\n      hasRequestedQrRef.current = false\r\n    } finally {\r\n      setIsGeneratingQR(false)\r\n    }\r\n  }\r\n\r\n  const initializeWhatsApp = async (config: any) => {\r\n    try {\r\n      await whatsappService.initialize(config)\r\n      setIsConnected(true)\r\n      setConnectionStatus(\"connected\")\r\n      await loadContacts()\r\n      await loadConversations()\r\n      console.log(\"[v0] WhatsApp service initialized successfully\")\r\n    } catch (error) {\r\n      console.error(\"[v0] Failed to initialize WhatsApp service:\", error)\r\n      setIsConnected(false)\r\n      setConnectionStatus(\"disconnected\")\r\n    }\r\n  }\r\n\r\n  const loadContacts = async () => {\r\n    // Only load contacts if connected\r\n    if (!isConnected) {\r\n      console.log(\"[v0] Skipping contacts load - not connected\")\r\n      return\r\n    }\r\n\r\n    try {\r\n      const res = await apiClient.get<any>(\"/whatsapp/contacts\")\r\n      const backendContacts: WhatsAppContact[] = Array.isArray(res?.contacts)\r\n        ? res.contacts.map((c: any) => ({ id: (c.id || c.phone || \"\").replace(/\\D/g, \"\"), name: c.name || (c.phone || \"\"), phone: (c.phone || c.id || \"\").replace(/\\D/g, \"\"), isOnline: true }))\r\n        : []\r\n      if (backendContacts.length > 0) {\r\n        setContacts(backendContacts)\r\n        console.log(\"[v0] Loaded contacts from backend:\", backendContacts.length)\r\n        return\r\n      }\r\n      const loadedContacts = whatsappService.getContacts()\r\n      setContacts(loadedContacts)\r\n      console.log(\"[v0] Loaded contacts in UI:\", loadedContacts.length)\r\n    } catch (error) {\r\n      console.error(\"[v0] Error loading contacts:\", error)\r\n      const loadedContacts = whatsappService.getContacts()\r\n      setContacts(loadedContacts)\r\n    }\r\n  }\r\n\r\n  const loadConversations = async () => {\r\n    // Only load conversations if connected\r\n    if (!isConnected) {\r\n      console.log(\"[v0] Skipping conversations load - not connected\")\r\n      return\r\n    }\r\n\r\n    try {\r\n      const loadedConversations = whatsappService.getAllConversations()\r\n      const conversationMap = new Map()\r\n      loadedConversations.forEach((conv) => {\r\n        conversationMap.set(conv.contactId, conv)\r\n      })\r\n      setConversations(conversationMap)\r\n      console.log(\"[v0] Loaded conversations in UI:\", loadedConversations.length)\r\n\r\n      const allTags = new Set<string>()\r\n      loadedConversations.forEach((conv) => {\r\n        conv.tags?.forEach((tag) => allTags.add(tag))\r\n      })\r\n      setAvailableTags(Array.from(allTags))\r\n    } catch (error) {\r\n      console.error(\"[v0] Error loading conversations:\", error)\r\n    }\r\n  }\r\n\r\n  const applyFilters = (contact: WhatsAppContact): boolean => {\r\n    const conversation = getConversation(contact.id)\r\n    if (!conversation) return true\r\n\r\n    // Status filter\r\n    if (filters.status.length > 0) {\r\n      if (!conversation.status || !filters.status.includes(conversation.status)) {\r\n        return false\r\n      }\r\n    }\r\n\r\n    // Read/Unread filter (respect local overrides)\r\n    if (filters.readStatus.length > 0) {\r\n      const isRead = getUnreadCount(contact) === 0\r\n      if (filters.readStatus.includes(\"lido\") && !isRead) return false\r\n      if (filters.readStatus.includes(\"nao_lido\") && isRead) return false\r\n    }\r\n\r\n    // Queue filter\r\n    if (filters.queueIds.length > 0) {\r\n      if (!conversation.queueId || !filters.queueIds.includes(conversation.queueId)) {\r\n        return false\r\n      }\r\n    }\r\n\r\n    // Tags filter\r\n    if (filters.tags.length > 0) {\r\n      if (!conversation.tags || !filters.tags.some((tag) => conversation.tags?.includes(tag))) {\r\n        return false\r\n      }\r\n    }\r\n\r\n    // Assigned user filter\r\n    if (filters.assignedUserId && filters.assignedUserId !== \"all\") {\r\n      if (conversation.assignedUserId !== filters.assignedUserId) {\r\n        return false\r\n      }\r\n    }\r\n\r\n    return true\r\n  }\r\n\r\n  // Sort contacts by last message time (most recent first)\r\n  const sortContactsByLastMessage = (contacts: WhatsAppContact[]): WhatsAppContact[] => {\r\n    return [...contacts].sort((a, b) => {\r\n      const convA = getConversation(a.id)\r\n      const convB = getConversation(b.id)\r\n      \r\n      const timeA = convA?.lastMessage?.timestamp || 0\r\n      const timeB = convB?.lastMessage?.timestamp || 0\r\n      \r\n      return new Date(timeB).getTime() - new Date(timeA).getTime()\r\n    })\r\n  }\r\n\r\n  const filteredContacts = sortContactsByLastMessage(\r\n    contacts.filter(\r\n      (contact) => {\r\n        const nameMatch = contact.name.toLowerCase().includes(searchTerm.toLowerCase())\r\n        const phoneMatch = contact.phone.toLowerCase().includes(searchTerm.toLowerCase())\r\n        \r\n        // Search in message content\r\n        const conversation = getConversation(contact.id)\r\n        const messageMatch = conversation?.messages?.some(message => \r\n          message.content.toLowerCase().includes(searchTerm.toLowerCase())\r\n        ) || false\r\n        \r\n        // Exclude deleted locally\r\n        const notDeleted = !deletedContacts.has(contact.id)\r\n        return notDeleted && (nameMatch || phoneMatch || messageMatch) && applyFilters(contact)\r\n      }\r\n    )\r\n  )\r\n\r\n  const toggleFilter = (filterType: keyof ConversationFilters, value: string) => {\r\n    setFilters((prev) => {\r\n      const currentValues = prev[filterType] as string[]\r\n      const newValues = currentValues.includes(value)\r\n        ? currentValues.filter((v) => v !== value)\r\n        : [...currentValues, value]\r\n      return { ...prev, [filterType]: newValues }\r\n    })\r\n    setActivePresetId(null)\r\n  }\r\n\r\n  const clearFilters = () => {\r\n    setFilters({\r\n      status: [],\r\n      readStatus: [],\r\n      queueIds: [],\r\n      tags: [],\r\n      assignedUserId: \"\",\r\n    })\r\n    setActivePresetId(null)\r\n  }\r\n\r\n  const getActiveFilterCount = (): number => {\r\n    return (\r\n      filters.status.length +\r\n      filters.readStatus.length +\r\n      filters.queueIds.length +\r\n      filters.tags.length +\r\n      (filters.assignedUserId && filters.assignedUserId !== \"all\" ? 1 : 0)\r\n    )\r\n  }\r\n\r\n  const getStatusLabel = (status: string): string => {\r\n    const labels: Record<string, string> = {\r\n      em_atendimento: \"Em Atendimento\",\r\n      encerrado: \"Encerrado\",\r\n      aguardando: \"Aguardando\",\r\n    }\r\n    return labels[status] || status\r\n  }\r\n\r\n  // Send message with auto-scroll\r\n  const sendMessage = async (e: React.FormEvent) => {\r\n    e.preventDefault()\r\n    if (!messageInput.trim() || !activeContact) return\r\n\r\n    try {\r\n      const sentMessage = await whatsappService.sendMessage(activeContact.id, messageInput)\r\n      if (sentMessage) {\r\n        setMessageInput(\"\")\r\n        await loadConversations()\r\n        console.log(\"[v0] Message sent successfully\")\r\n        \r\n        // Auto-scroll to bottom after sending message\r\n        setTimeout(() => {\r\n          if (messagesEndRef.current) {\r\n            messagesEndRef.current.scrollIntoView({ behavior: 'smooth' })\r\n          }\r\n        }, 100)\r\n      }\r\n    } catch (error) {\r\n      console.error(\"[v0] Error sending message:\", error)\r\n    }\r\n  }\r\n\r\n  // Get conversation for contact\r\n  function getConversation(contactId: string): WhatsAppConversation | null {\r\n    return conversations.get(contactId) || null\r\n  }\r\n\r\n  // Get last message for contact\r\n  const getLastMessage = (contact: WhatsAppContact): string => {\r\n    const conversation = getConversation(contact.id)\r\n    return conversation?.lastMessage?.content || \"Nenhuma mensagem\"\r\n  }\r\n\r\n  // Get last message time for contact with relative formatting\r\n  const getLastMessageTime = (contact: WhatsAppContact): string => {\r\n    const conversation = getConversation(contact.id)\r\n    if (!conversation?.lastMessage) return \"\"\r\n\r\n    const messageDate = new Date(conversation.lastMessage.timestamp)\r\n    const now = new Date()\r\n    const diffInMs = now.getTime() - messageDate.getTime()\r\n    const diffInMinutes = Math.floor(diffInMs / (1000 * 60))\r\n    const diffInHours = Math.floor(diffInMs / (1000 * 60 * 60))\r\n    const diffInDays = Math.floor(diffInMs / (1000 * 60 * 60 * 24))\r\n\r\n    if (diffInMinutes < 1) {\r\n      return \"agora\"\r\n    } else if (diffInMinutes < 60) {\r\n      return `${diffInMinutes} min atrás`\r\n    } else if (diffInHours < 24) {\r\n      return `${diffInHours}h atrás`\r\n    } else if (diffInDays === 1) {\r\n      return \"ontem\"\r\n    } else if (diffInDays < 7) {\r\n      return `${diffInDays} dias atrás`\r\n    } else {\r\n      return messageDate.toLocaleDateString(\"pt-BR\", { day: \"2-digit\", month: \"2-digit\" })\r\n    }\r\n  }\r\n\r\n  // Get unread count for contact\r\n  const getUnreadCount = (contact: WhatsAppContact): number => {\r\n    const conversation = getConversation(contact.id)\r\n    if (readContacts.has(contact.id)) return 0\r\n    return conversation?.unreadCount || 0\r\n  }\r\n\r\n  // Open conversation and mark as read\r\n  const openConversation = async (contact: WhatsAppContact) => {\r\n    setActiveContact(contact)\r\n    setReadContacts(prev => {\r\n      const next = new Set(prev)\r\n      next.add(contact.id)\r\n      try {\r\n        if (typeof window !== \"undefined\") {\r\n          localStorage.setItem(READ_STORAGE_KEY, JSON.stringify(Array.from(next)))\r\n        }\r\n      } catch {}\r\n      return next\r\n    })\r\n    // Optimistically mark as read in UI\r\n    setConversations(prev => {\r\n      const next = new Map(prev)\r\n      const conv = next.get(contact.id)\r\n      if (conv) {\r\n        next.set(contact.id, { ...conv, unreadCount: 0 })\r\n      }\r\n      return next\r\n    })\r\n    // Notify backend to mark chat as read\r\n    try {\r\n      const phone = (contact.phone || contact.id || \"\").replace(/\\D/g, \"\")\r\n      if (phone) {\r\n        await apiClient.post(\"/whatsapp/modify-chat\", { phone, action: \"read\" })\r\n      }\r\n    } catch {}\r\n  }\r\n\r\n  const syncContactsToBackend = async () => {\r\n    if (!isConnected) {\r\n      console.log(\"[v0] Skipping contacts sync - not connected\")\r\n      return\r\n    }\r\n\r\n    try {\r\n      const list = whatsappService.getContacts()\r\n      for (const c of list) {\r\n        await apiClient.post(\"/whatsapp/contact\", { phone: c.phone || c.id, name: c.name || c.id })\r\n      }\r\n      await loadContacts()\r\n    } catch (error) {\r\n      console.error(\"[v0] Error syncing contacts:\", error)\r\n    }\r\n  }\r\n\r\n  // Delete conversation function\r\n  const deleteConversation = async (contact: WhatsAppContact) => {\r\n    try {\r\n      // Mark as deleted locally (persist across refreshes)\r\n      setDeletedContacts(prev => {\r\n        const next = new Set(prev)\r\n        next.add(contact.id)\r\n        try {\r\n          if (typeof window !== \"undefined\") {\r\n            localStorage.setItem(DELETED_STORAGE_KEY, JSON.stringify(Array.from(next)))\r\n          }\r\n        } catch {}\r\n        return next\r\n      })\r\n\r\n      // Clear active contact if it's the deleted one\r\n      if (activeContact?.id === contact.id) {\r\n        setActiveContact(null)\r\n      }\r\n\r\n      // Notify backend (if supported) to delete chat\r\n      try {\r\n        const phone = (contact.phone || contact.id || \"\").replace(/\\D/g, \"\")\r\n        if (phone) {\r\n          await apiClient.post(\"/whatsapp/modify-chat\", { phone, action: \"delete\" })\r\n        }\r\n      } catch {}\r\n\r\n      console.log(\"[v0] Conversation marked deleted:\", contact.id)\r\n    } catch (error) {\r\n      console.error(\"[v0] Error deleting conversation:\", error)\r\n    }\r\n  }\r\n\r\n  // Archive conversation function\r\n  const archiveConversation = async (contact: WhatsAppContact) => {\r\n    try {\r\n      // Update conversation status to archived\r\n      setConversations(prev => {\r\n        const newMap = new Map(prev)\r\n        const conversation = newMap.get(contact.id)\r\n        if (conversation) {\r\n          newMap.set(contact.id, { ...conversation, status: \"arquivado\" })\r\n        }\r\n        return newMap\r\n      })\r\n      \r\n      console.log(\"[v0] Conversation archived:\", contact.id)\r\n    } catch (error) {\r\n      console.error(\"[v0] Error archiving conversation:\", error)\r\n    }\r\n  }\r\n\r\n  // Load more messages for lazy loading\r\n  const loadMoreMessages = () => {\r\n    setIsLoadingMessages(true)\r\n    setTimeout(() => {\r\n      setLoadedMessagesCount(prev => prev + 50)\r\n      setIsLoadingMessages(false)\r\n    }, 500)\r\n  }\r\n\r\n  useEffect(() => {\r\n    if (!activeContact || !isConnected) return\r\n    let disposed = false\r\n    const refresh = async () => {\r\n      await whatsappService.refreshMessages(activeContact.id)\r\n      const all = whatsappService.getAllConversations()\r\n      const map = new Map<string, WhatsAppConversation>()\r\n      all.forEach((c) => map.set(c.contactId, c))\r\n      if (!disposed) setConversations(map)\r\n    }\r\n    refresh()\r\n    const interval = setInterval(refresh, 10000)\r\n    return () => {\r\n      disposed = true\r\n      clearInterval(interval)\r\n    }\r\n  }, [activeContact?.id, isConnected])\r\n\r\n  if (!isConnected) {\r\n    // Admin view - show configuration option\r\n    return (\r\n      <div className=\"flex h-[calc(100vh-200px)] md:h-[calc(100vh-200px)] border rounded-lg overflow-hidden\">\r\n        <div className=\"flex-1 flex items-center justify-center p-4\">\r\n          {connectionStatus === \"disconnected\" ? (\r\n            <Card className=\"w-full max-w-md\">\r\n              <CardHeader className=\"text-center\">\r\n                <QrCode className=\"h-12 w-12 mx-auto mb-4 text-green-600\" />\r\n                <CardTitle>Conectar WhatsApp</CardTitle>\r\n              </CardHeader>\r\n              <CardContent className=\"text-center space-y-4\">\r\n                <p className=\"text-muted-foreground\">\r\n                  Para começar a receber mensagens, conecte seu WhatsApp escaneando o código QR.\r\n                </p>\r\n                {connectionError && (\r\n                  <div className=\"bg-red-50 border border-red-200 rounded-lg p-3 text-sm text-red-700\">\r\n                    {connectionError}\r\n                  </div>\r\n                )}\r\n                \r\n                {/* Exibição automática do QR Code */}\r\n                {qrCode ? (\r\n                  <div className=\"mt-3 p-3 bg-gray-50 border rounded-lg\">\r\n                    <p className=\"text-sm mb-2\">Escaneie o QR abaixo no WhatsApp:</p>\r\n                    <img \r\n                      src={qrCode || \"\"} \r\n                      alt=\"QR Code WhatsApp\" \r\n                      className=\"w-48 h-48 border rounded-lg mx-auto\" \r\n                    />\r\n                  </div>\r\n                ) : !isGeneratingQR ? (\r\n                  <div className=\"mt-3 p-3 bg-yellow-50 border rounded-lg\">\r\n                    <p className=\"text-sm text-gray-600\">Aguardando geração do QR...</p>\r\n                  </div>\r\n                ) : (\r\n                  <div className=\"mt-3 p-3 bg-blue-50 border rounded-lg\">\r\n                    <p className=\"text-sm text-blue-600\">Gerando QR Code...</p>\r\n                  </div>\r\n                )}\r\n                \r\n                <Button onClick={generateQRCode} disabled={isGeneratingQR} className=\"w-full\">\r\n                  {isGeneratingQR ? (\r\n                    <>\r\n                      <RefreshCw className=\"h-4 w-4 mr-2 animate-spin\" />\r\n                      Gerando QR Code...\r\n                    </>\r\n                  ) : (\r\n                    <>\r\n                      <QrCode className=\"h-4 w-4 mr-2\" />\r\n                      Gerar QR Code\r\n                    </>\r\n                  )}\r\n                </Button>\r\n                <Button variant=\"outline\" onClick={() => setShowConfig(true)} className=\"w-full\">\r\n                  <Settings className=\"h-4 w-4 mr-2\" />\r\n                  Configurar API\r\n                </Button>\r\n              </CardContent>\r\n            </Card>\r\n          ) : connectionStatus === \"connecting\" && qrCode ? (\r\n            <Card className=\"w-full max-w-md\">\r\n              <CardHeader className=\"text-center\">\r\n                <Smartphone className=\"h-12 w-12 mx-auto mb-4 text-green-600\" />\r\n                <CardTitle>Escaneie o QR Code</CardTitle>\r\n              </CardHeader>\r\n              <CardContent className=\"text-center space-y-4\">\r\n                <div className=\"flex justify-center\">\r\n                  {qrCode && (\r\n                    <img\r\n                      src={qrCode}\r\n                      alt=\"QR Code WhatsApp\"\r\n                      className=\"w-48 h-48 border rounded-lg\"\r\n                    />\r\n                  )}\r\n                </div>\r\n                <div className=\"space-y-2\">\r\n                  <p className=\"text-sm font-medium\">Como conectar:</p>\r\n                  <ol className=\"text-sm text-muted-foreground text-left space-y-1\">\r\n                    <li>1. Abra o WhatsApp no seu celular</li>\r\n                    <li>2. Toque em Menu (⋮) e selecione \"Dispositivos conectados\"</li>\r\n                    <li>3. Toque em \"Conectar um dispositivo\"</li>\r\n                    <li>4. Aponte a câmera para este código</li>\r\n                  </ol>\r\n                </div>\r\n                <div className=\"flex items-center justify-center gap-2 text-sm text-blue-600\">\r\n                  <div className=\"animate-spin rounded-full h-4 w-4 border-b-2 border-blue-600\"></div>\r\n                  Aguardando conexão...\r\n                </div>\r\n                <Button\r\n                  variant=\"outline\"\r\n                  onClick={() => {\r\n                    if (qrPollRef.current) { clearInterval(qrPollRef.current); qrPollRef.current = null }\r\n                    setConnectionStatus(\"disconnected\"); setIsGeneratingQR(false)\r\n                  }}\r\n                  className=\"w-full\"\r\n                >\r\n                  Cancelar\r\n                </Button>\r\n              </CardContent>\r\n            </Card>\r\n          ) : (\r\n            <Card className=\"w-full max-w-md\">\r\n              <CardHeader className=\"text-center\">\r\n                <div className=\"animate-spin rounded-full h-12 w-12 mx-auto mb-4 border-b-2 border-green-600\"></div>\r\n                <CardTitle>Preparando conexão...</CardTitle>\r\n              </CardHeader>\r\n              <CardContent className=\"text-center\">\r\n                <p className=\"text-muted-foreground\">Aguarde, preparando a conexão com WhatsApp...</p>\r\n              </CardContent>\r\n            </Card>\r\n          )}\r\n        </div>\r\n\r\n        {showConfig && <WhatsAppConfig onClose={() => setShowConfig(false)} />}\r\n        <Dialog open={showPhoneConnect} onOpenChange={setShowPhoneConnect}>\r\n          <DialogContent>\r\n            <DialogHeader>\r\n              <DialogTitle>Conectar por telefone</DialogTitle>\r\n              <DialogDescription>Informe o número no formato internacional e gere o código.</DialogDescription>\r\n            </DialogHeader>\r\n            <div className=\"space-y-3\">\r\n              <Label htmlFor=\"phone-connect\">Telefone (DDI+DDD+Número)</Label>\r\n              <Input id=\"phone-connect\" value={phoneInput} onChange={(e) => setPhoneInput(e.target.value)} placeholder=\"5546999046386\" />\r\n              <div className=\"flex gap-2\">\r\n                <Button\r\n                  onClick={async () => {\r\n                    setPhoneError(null)\r\n                    setPhoneLoading(true)\r\n                    setPhoneCode(null)\r\n                    const raw = phoneInput || \"\"\r\n                    const digits = raw.replace(/\\D/g, \"\")\r\n                    const normalized = digits.length === 11 && !digits.startsWith(\"55\") ? `55${digits}` : digits\r\n                    try {\r\n                      const code = await whatsappService.generatePhoneCode(normalized)\r\n                      setPhoneCode(code || \"\")\r\n                    } catch (e) {\r\n                      setPhoneError(\"Falha ao gerar código de telefone\")\r\n                    } finally {\r\n                      setPhoneLoading(false)\r\n                    }\r\n                  }}\r\n                  disabled={phoneLoading || !phoneInput.trim()}\r\n                >\r\n                  {phoneLoading ? \"Gerando...\" : \"Gerar código\"}\r\n                </Button>\r\n                {phoneCode && (\r\n                  <Button\r\n                    variant=\"outline\"\r\n                    onClick={() => {\r\n                      try { navigator.clipboard.writeText(phoneCode) } catch {}\r\n                    }}\r\n                  >\r\n                    Copiar código\r\n                  </Button>\r\n                )}\r\n              </div>\r\n              {phoneError && <p className=\"text-sm text-red-600\">{phoneError}</p>}\r\n              {phoneCode && (\r\n                <div className=\"p-2 border rounded\">\r\n                  <p className=\"text-sm\">Código:</p>\r\n                  <p className=\"font-mono text-lg\">{phoneCode}</p>\r\n                  <p className=\"text-xs text-muted-foreground mt-2\">Insira este código no WhatsApp em “Conectar com número de telefone”.</p>\r\n                </div>\r\n              )}\r\n              <DialogFooter>\r\n                <Button variant=\"outline\" onClick={() => { setShowPhoneConnect(false); setPhoneInput(\"\"); setPhoneCode(null); setPhoneError(null); }}>Fechar</Button>\r\n              </DialogFooter>\r\n            </div>\r\n          </DialogContent>\r\n        </Dialog>\r\n      </div>\r\n    )\r\n  }\r\n\r\n  return (\r\n    <div className=\"flex flex-col md:flex-row h-auto md:h-[calc(100vh-200px)] border rounded-lg overflow-hidden\">\r\n      {/* Contacts panel */}\r\n      <div className=\"w-full md:w-1/3 border-b md:border-b-0 md:border-r flex flex-col h-full min-h-0 bg-gradient-to-b from-white to-gray-50\">\r\n        {/* Enhanced Header with UniCRM Identity */}\r\n        <div className=\"p-4 border-b bg-gradient-to-r from-green-50 to-blue-50 shadow-sm border-green-100\">\r\n          <div className=\"flex items-center justify-between mb-4\">\r\n            <h2 className=\"font-bold text-lg md:text-xl text-gray-900 flex items-center gap-2\">\r\n              <MessageSquare className=\"h-5 w-5 text-green-600\" />\r\n              Conversas\r\n            </h2>\r\n            <div className=\"flex items-center gap-1\">\r\n              <Button \r\n                variant=\"ghost\" \r\n                size=\"icon\" \r\n                className=\"h-8 w-8 md:h-10 md:w-10\"\r\n                onClick={() => setShowStatusMonitor(true)}\r\n                title=\"Monitor de Status WhatsApp\"\r\n              >\r\n                <MessageSquare className=\"h-4 w-4\" />\r\n              </Button>\r\n              <Popover open={showFilters} onOpenChange={setShowFilters}>\r\n                <PopoverTrigger asChild>\r\n                  <Button variant=\"ghost\" size=\"icon\" className=\"relative h-8 w-8 md:h-10 md:w-10\">\r\n                    <Filter className=\"h-4 w-4\" />\r\n                    {getActiveFilterCount() > 0 && (\r\n                      <Badge className=\"absolute -top-1 -right-1 h-5 w-5 p-0 flex items-center justify-center text-xs\">\r\n                        {getActiveFilterCount()}\r\n                      </Badge>\r\n                    )}\r\n                  </Button>\r\n                </PopoverTrigger>\r\n                <PopoverContent className=\"w-80 max-w-[calc(100vw-2rem)]\" align=\"end\">\r\n                  <div className=\"space-y-4\">\r\n                    <div className=\"flex items-center justify-between\">\r\n                      <h4 className=\"font-medium\">Filtros</h4>\r\n                      <div className=\"flex items-center gap-1\">\r\n                        {getActiveFilterCount() > 0 && (\r\n                          <Button variant=\"ghost\" size=\"sm\" onClick={() => setShowSavePresetDialog(true)}>\r\n                            <Save className=\"h-3 w-3 mr-1\" />\r\n                            Salvar\r\n                          </Button>\r\n                        )}\r\n                        {getActiveFilterCount() > 0 && (\r\n                          <Button variant=\"ghost\" size=\"sm\" onClick={clearFilters}>\r\n                            <X className=\"h-3 w-3 mr-1\" />\r\n                            Limpar\r\n                          </Button>\r\n                        )}\r\n                      </div>\r\n                    </div>\r\n\r\n                    {filterPresets.length > 0 && (\r\n                      <div className=\"space-y-2\">\r\n                        <Label className=\"text-sm font-medium\">Filtros Salvos</Label>\r\n                        <div className=\"space-y-1\">\r\n                          {filterPresets.map((preset) => (\r\n                            <div\r\n                              key={preset.id}\r\n                              className={`flex items-center justify-between p-2 rounded-md hover:bg-muted/50 ${\r\n                                activePresetId === preset.id ? \"bg-muted\" : \"\"\r\n                              }`}\r\n                            >\r\n                              <button\r\n                                type=\"button\"\r\n                                onClick={() => loadFilterPreset(preset.id)}\r\n                                className=\"flex-1 text-left text-sm\"\r\n                              >\r\n                                {preset.name}\r\n                              </button>\r\n                              <Button\r\n                                variant=\"ghost\"\r\n                                size=\"icon\"\r\n                                className=\"h-6 w-6\"\r\n                                onClick={() => deleteFilterPreset(preset.id)}\r\n                              >\r\n                                <Trash2 className=\"h-3 w-3\" />\r\n                              </Button>\r\n                            </div>\r\n                          ))}\r\n                        </div>\r\n                      </div>\r\n                    )}\r\n\r\n                    {/* Status filter */}\r\n                    <div className=\"space-y-2\">\r\n                      <Label className=\"text-sm font-medium\">Status</Label>\r\n                      <div className=\"space-y-2\">\r\n                        {[\"em_atendimento\", \"encerrado\", \"aguardando\"].map((status) => (\r\n                          <div key={status} className=\"flex items-center space-x-2\">\r\n                            <Checkbox\r\n                              id={`status-${status}`}\r\n                              checked={filters.status.includes(status)}\r\n                              onCheckedChange={() => toggleFilter(\"status\", status)}\r\n                            />\r\n                            <label htmlFor={`status-${status}`} className=\"text-sm cursor-pointer\">\r\n                              {getStatusLabel(status)}\r\n                            </label>\r\n                          </div>\r\n                        ))}\r\n                      </div>\r\n                    </div>\r\n\r\n                    {/* Read/Unread filter */}\r\n                    <div className=\"space-y-2\">\r\n                      <Label className=\"text-sm font-medium\">Leitura</Label>\r\n                      <div className=\"space-y-2\">\r\n                        <div className=\"flex items-center space-x-2\">\r\n                          <Checkbox\r\n                            id=\"read-lido\"\r\n                            checked={filters.readStatus.includes(\"lido\")}\r\n                            onCheckedChange={() => toggleFilter(\"readStatus\", \"lido\")}\r\n                          />\r\n                          <label htmlFor=\"read-lido\" className=\"text-sm cursor-pointer\">\r\n                            Lido\r\n                          </label>\r\n                        </div>\r\n                        <div className=\"flex items-center space-x-2\">\r\n                          <Checkbox\r\n                            id=\"read-nao-lido\"\r\n                            checked={filters.readStatus.includes(\"nao_lido\")}\r\n                            onCheckedChange={() => toggleFilter(\"readStatus\", \"nao_lido\")}\r\n                          />\r\n                          <label htmlFor=\"read-nao-lido\" className=\"text-sm cursor-pointer\">\r\n                            Não Lido\r\n                          </label>\r\n                        </div>\r\n                      </div>\r\n                    </div>\r\n\r\n                    {/* Queue filter */}\r\n                    {availableQueues.length > 0 && (\r\n                      <div className=\"space-y-2\">\r\n                        <Label className=\"text-sm font-medium\">Filas de Atendimento</Label>\r\n                        <div className=\"space-y-2 max-h-32 overflow-y-auto\">\r\n                          {availableQueues.map((queue) => (\r\n                            <div key={queue.id} className=\"flex items-center space-x-2\">\r\n                              <Checkbox\r\n                                id={`queue-${queue.id}`}\r\n                                checked={filters.queueIds.includes(queue.id)}\r\n                                onCheckedChange={() => toggleFilter(\"queueIds\", queue.id)}\r\n                              />\r\n                              <label\r\n                                htmlFor={`queue-${queue.id}`}\r\n                                className=\"text-sm cursor-pointer flex items-center gap-2\"\r\n                              >\r\n                                <div className={`w-2 h-2 rounded-full ${queue.color}`} />\r\n                                {queue.name}\r\n                              </label>\r\n                            </div>\r\n                          ))}\r\n                        </div>\r\n                      </div>\r\n                    )}\r\n\r\n                    {/* Tags filter */}\r\n                    {availableTags.length > 0 && (\r\n                      <div className=\"space-y-2\">\r\n                        <Label className=\"text-sm font-medium\">Tags</Label>\r\n                        <div className=\"space-y-2 max-h-32 overflow-y-auto\">\r\n                          {availableTags.map((tag) => (\r\n                            <div key={tag} className=\"flex items-center space-x-2\">\r\n                              <Checkbox\r\n                                id={`tag-${tag}`}\r\n                                checked={filters.tags.includes(tag)}\r\n                                onCheckedChange={() => toggleFilter(\"tags\", tag)}\r\n                              />\r\n                              <label htmlFor={`tag-${tag}`} className=\"text-sm cursor-pointer\">\r\n                                {tag}\r\n                              </label>\r\n                            </div>\r\n                          ))}\r\n                        </div>\r\n                      </div>\r\n                    )}\r\n\r\n                    {/* User filter */}\r\n                    {availableUsers.length > 0 && (\r\n                      <div className=\"space-y-2\">\r\n                        <Label className=\"text-sm font-medium\">Usuário</Label>\r\n                        <Select\r\n                          value={filters.assignedUserId || \"all\"}\r\n                          onValueChange={(value) => {\r\n                            setFilters((prev) => ({ ...prev, assignedUserId: value }))\r\n                            setActivePresetId(null)\r\n                          }}\r\n                        >\r\n                          <SelectTrigger>\r\n                            <SelectValue placeholder=\"Todos os usuários\" />\r\n                          </SelectTrigger>\r\n                          <SelectContent>\r\n                            <SelectItem value=\"all\">Todos os usuários</SelectItem>\r\n                            {availableUsers.map((user) => (\r\n                              <SelectItem key={user.id} value={user.id}>\r\n                                {user.name}\r\n                              </SelectItem>\r\n                            ))}\r\n                          </SelectContent>\r\n                        </Select>\r\n                      </div>\r\n                    )}\r\n                  </div>\r\n                </PopoverContent>\r\n              </Popover>\r\n              <Popover>\r\n                <PopoverTrigger asChild>\r\n                  <Button\r\n                    variant=\"ghost\"\r\n                    size=\"icon\"\r\n                    className=\"h-8 w-8 md:h-10 md:w-10\"\r\n                    aria-label=\"Opções do WhatsApp\"\r\n                    title=\"Opções do WhatsApp\"\r\n                  >\r\n                    <MoreVertical className=\"h-4 w-4\" />\r\n                  </Button>\r\n                </PopoverTrigger>\r\n                <PopoverContent className=\"w-56 p-2\" align=\"end\">\r\n                  <div className=\"flex flex-col gap-2\">\r\n                    <Button variant=\"outline\" onClick={() => setShowConfig(true)}>\r\n                      <Settings className=\"h-4 w-4 mr-2\" />\r\n                      Configurar WhatsApp\r\n                    </Button>\r\n                    <Button variant=\"outline\" onClick={generateQRCode} disabled={isGeneratingQR}>\r\n                      <QrCode className=\"h-4 w-4 mr-2\" />\r\n                      Gerar QR Code\r\n                    </Button>\r\n                    <Button variant=\"outline\" onClick={() => setShowPhoneConnect(true)}>\r\n                      <Smartphone className=\"h-4 w-4 mr-2\" />\r\n                      Conectar por telefone\r\n                    </Button>\r\n                    <Button variant=\"outline\" onClick={async () => { await whatsappService.disconnectInstance(); await loadConversations(); }}>\r\n                      <Power className=\"h-4 w-4 mr-2\" />\r\n                      Desconectar Instância\r\n                    </Button>\r\n                    <Button variant=\"outline\" onClick={async () => { await whatsappService.restartInstance(); await loadConversations(); }}>\r\n                      <RefreshCw className=\"h-4 w-4 mr-2\" />\r\n                      Reiniciar Instância\r\n                    </Button>\r\n                    <Button variant=\"outline\" onClick={syncContactsToBackend}>\r\n                      <RefreshCw className=\"h-4 w-4 mr-2\" />\r\n                      Sincronizar Contatos\r\n                    </Button>\r\n                  </div>\r\n                </PopoverContent>\r\n              </Popover>\r\n            </div>\r\n          </div>\r\n          {/* Enhanced Search Bar with UniCRM Styling */}\r\n          <div className=\"relative mb-4\">\r\n            <Search className=\"absolute left-3 top-3.5 h-4 w-4 text-green-500\" />\r\n            <Input\r\n              placeholder=\"Pesquisar por nome, número ou mensagem...\"\r\n              className=\"pl-10 pr-4 py-3 text-sm border-2 border-green-200 rounded-lg shadow-sm focus:ring-2 focus:ring-green-500 focus:border-green-500 transition-all bg-white hover:border-green-300\"\r\n              value={searchTerm}\r\n              onChange={(e) => setSearchTerm(e.target.value)}\r\n            />\r\n          </div>\r\n        </div>\r\n\r\n        {/* Enhanced Tabs with UniCRM Colors */}\r\n        <Tabs defaultValue=\"all\" className=\"flex-1 flex flex-col min-h-0\">\r\n          <TabsList className=\"grid grid-cols-2 mx-4 mt-3 mb-2 bg-green-50 p-1 rounded-lg border border-green-100\">\r\n            <TabsTrigger value=\"all\" className=\"text-sm font-medium data-[state=active]:bg-white data-[state=active]:text-green-700 data-[state=active]:shadow-sm rounded-md transition-all\">\r\n              Todos\r\n            </TabsTrigger>\r\n            <TabsTrigger value=\"whatsapp\" className=\"text-sm font-medium data-[state=active]:bg-white data-[state=active]:text-green-700 data-[state=active]:shadow-sm rounded-md transition-all\">\r\n              <MessageSquare className=\"h-4 w-4 mr-1 inline\" />\r\n              WhatsApp\r\n            </TabsTrigger>\r\n          </TabsList>\r\n\r\n          <ScrollArea className=\"flex-1 h-full min-h-0 overflow-y-auto\">\r\n            <TabsContent value=\"all\" className=\"m-0\">\r\n              {(() => {\r\n                const dedup = Array.from(new Map(filteredContacts.map(c => [c.id, c])).values())\r\n                const sorted = dedup.sort((a, b) => {\r\n                  const ta = getConversation(a.id)?.lastMessage?.timestamp || 0\r\n                  const tb = getConversation(b.id)?.lastMessage?.timestamp || 0\r\n                  return tb - ta\r\n                })\r\n                return sorted.map((contact) => (\r\n                <ContactItem\r\n                  key={contact.id}\r\n                  contact={contact}\r\n                  lastMessage={getLastMessage(contact)}\r\n                  lastMessageTime={getLastMessageTime(contact)}\r\n                  unreadCount={getUnreadCount(contact)}\r\n                  isActive={activeContact?.id === contact.id}\r\n                  onClick={() => openConversation(contact)}\r\n                  presenceData={chatPresenceMap.get(contact.phone)}\r\n                  onDelete={(contact) => {\r\n                    setContactToDelete(contact)\r\n                    setShowDeleteConfirm(true)\r\n                  }}\r\n                  onArchive={archiveConversation}\r\n                />\r\n              ))\r\n              })()}\r\n            </TabsContent>\r\n\r\n            <TabsContent value=\"whatsapp\" className=\"m-0\">\r\n              {(() => {\r\n                const dedup = Array.from(new Map(filteredContacts.map(c => [c.id, c])).values())\r\n                const sorted = dedup.sort((a, b) => {\r\n                  const ta = getConversation(a.id)?.lastMessage?.timestamp || 0\r\n                  const tb = getConversation(b.id)?.lastMessage?.timestamp || 0\r\n                  return tb - ta\r\n                })\r\n                return sorted.map((contact) => (\r\n                <ContactItem\r\n                  key={contact.id}\r\n                  contact={contact}\r\n                  lastMessage={getLastMessage(contact)}\r\n                  lastMessageTime={getLastMessageTime(contact)}\r\n                  unreadCount={getUnreadCount(contact)}\r\n                  isActive={activeContact?.id === contact.id}\r\n                  onClick={() => openConversation(contact)}\r\n                  presenceData={chatPresenceMap.get(contact.phone)}\r\n                  onDelete={(contact) => {\r\n                    setContactToDelete(contact)\r\n                    setShowDeleteConfirm(true)\r\n                  }}\r\n                  onArchive={archiveConversation}\r\n                />\r\n              ))\r\n              })()}\r\n            </TabsContent>\r\n          </ScrollArea>\r\n\r\n          <div className=\"p-3 border-t\">\r\n            <Button variant=\"outline\" className=\"w-full bg-transparent\" onClick={() => setShowNewConversation(true)}>\r\n              <Plus className=\"h-4 w-4 mr-2\" />\r\n              Nova Conversa\r\n            </Button>\r\n          </div>\r\n        </Tabs>\r\n      </div>\r\n\r\n      {/* Conversation panel */}\r\n      {activeContact ? (\r\n        <div className=\"flex-1 flex flex-col min-h-[50vh] md:min-h-0\">\r\n          <div className=\"p-2 md:p-3 border-b flex justify-between items-center\">\r\n            <div className=\"flex items-center min-w-0\">\r\n              <Avatar className=\"h-8 w-8 md:h-10 md:w-10 mr-2 md:mr-3 flex-shrink-0\">\r\n                <AvatarImage src={activeContact.avatar || \"/placeholder.svg\"} alt={activeContact.name} />\r\n                <AvatarFallback>{activeContact.name.substring(0, 2)}</AvatarFallback>\r\n              </Avatar>\r\n              <div className=\"min-w-0 flex-1\">\r\n                {isEditingContactName ? (\r\n                  <div className=\"flex items-center gap-2\">\r\n                    <Input\r\n                      value={editingContactName}\r\n                      onChange={(e) => setEditingContactName(e.target.value)}\r\n                      className=\"h-8 text-sm\"\r\n                    />\r\n                    <Button\r\n                      size=\"sm\"\r\n                      onClick={async () => {\r\n                        const name = editingContactName.trim()\r\n                        const phone = activeContact.phone || activeContact.id\r\n                        if (name) {\r\n                          try { await apiClient.post(\"/whatsapp/contact\", { phone, name }) } catch {}\r\n                          const updated = { ...activeContact, name }\r\n                          setActiveContact(updated)\r\n                          await loadContacts()\r\n                        }\r\n                        setIsEditingContactName(false)\r\n                      }}\r\n                    >\r\n                      Salvar\r\n                    </Button>\r\n                    <Button size=\"sm\" variant=\"outline\" onClick={() => setIsEditingContactName(false)}>Cancelar</Button>\r\n                  </div>\r\n                ) : (\r\n                  <div className=\"flex items-center gap-2\">\r\n                    <h3 className=\"font-medium text-sm md:text-base truncate\">{activeContact.name}</h3>\r\n                    <Button\r\n                      size=\"sm\"\r\n                      variant=\"ghost\"\r\n                      onClick={() => { setEditingContactName(activeContact.name || activeContact.id); setIsEditingContactName(true) }}\r\n                    >\r\n                      Editar\r\n                    </Button>\r\n                  </div>\r\n                )}\r\n                <div className=\"flex items-center\">\r\n                  <span className=\"text-xs md:text-sm text-muted-foreground mr-2 truncate\">{activeContact.phone}</span>\r\n                  <WhatsAppPresenceIndicator \r\n                    phone={activeContact.phone} \r\n                    presenceData={chatPresenceMap.get(activeContact.phone)}\r\n                    className=\"flex-shrink-0\"\r\n                  />\r\n                </div>\r\n              </div>\r\n            </div>\r\n            <div className=\"flex items-center gap-0.5 md:gap-1 flex-shrink-0\">\r\n              <Button type=\"button\" variant=\"ghost\" size=\"icon\" className=\"h-8 w-8 md:h-10 md:w-10\">\r\n                <Phone className=\"h-3 w-3 md:h-4 md:w-4\" />\r\n              </Button>\r\n              <Button type=\"button\" variant=\"ghost\" size=\"icon\" className=\"h-8 w-8 md:h-10 md:w-10 hidden sm:flex\">\r\n                <Video className=\"h-3 w-3 md:h-4 md:w-4\" />\r\n              </Button>\r\n              <Button type=\"button\" variant=\"ghost\" size=\"icon\" className=\"h-8 w-8 md:h-10 md:w-10\">\r\n                <MoreVertical className=\"h-3 w-3 md:h-4 md:w-4\" />\r\n              </Button>\r\n            </div>\r\n          </div>\r\n\r\n          <ScrollArea className=\"flex-1 p-2 md:p-4\">\r\n            <div className=\"space-y-2 md:space-y-4\">\r\n              {(() => {\r\n                const conv = getConversation(activeContact.id)\r\n                const list = conv?.messages || []\r\n                const uniq = Array.from(new Map(list.map(m => [m.id, m])).values())\r\n                \r\n                // Implement lazy loading - show only recent messages\r\n                const displayMessages = uniq.slice(-loadedMessagesCount)\r\n                \r\n                return (\r\n                  <>\r\n                    {displayMessages.map((message) => (\r\n                      <div key={message.id} className={`flex ${message.isFromMe ? \"justify-end\" : \"justify-start\"}`}>\r\n                        <div\r\n                          className={`max-w-[85%] md:max-w-[70%] rounded-lg p-2 md:p-3 text-sm md:text-base ${\r\n                            message.isFromMe ? \"bg-primary text-primary-foreground\" : \"bg-muted\"\r\n                          }`}\r\n                        >\r\n                          <p className=\"break-words\">{message.content}</p>\r\n                          <div className={`flex items-center justify-between mt-1 ${\r\n                            message.isFromMe ? \"text-primary-foreground/70\" : \"text-muted-foreground\"\r\n                          }`}>\r\n                            <p className=\"text-xs\">\r\n                              {new Date(message.timestamp).toLocaleTimeString(\"pt-BR\", {\r\n                                hour: \"2-digit\",\r\n                                minute: \"2-digit\",\r\n                              })}\r\n                            </p>\r\n                            {message.isFromMe && (\r\n                              <WhatsAppMessageStatus \r\n                                messageId={message.id}\r\n                                statusData={messageStatusMap.get(activeContact.phone)}\r\n                                className=\"ml-2\"\r\n                              />\r\n                            )}\r\n                          </div>\r\n                        </div>\r\n                      </div>\r\n                    ))}\r\n                    \r\n                    {/* Load more messages button */}\r\n                    {uniq.length > loadedMessagesCount && (\r\n                      <div className=\"flex justify-center py-4\">\r\n                        <Button\r\n                          variant=\"outline\"\r\n                          size=\"sm\"\r\n                          onClick={loadMoreMessages}\r\n                          disabled={isLoadingMessages}\r\n                          className=\"text-xs\"\r\n                        >\r\n                          {isLoadingMessages ? (\r\n                            <>\r\n                              <RefreshCw className=\"h-3 w-3 mr-1 animate-spin\" />\r\n                              Carregando...\r\n                            </>\r\n                          ) : (\r\n                            <>\r\n                              <RefreshCw className=\"h-3 w-3 mr-1\" />\r\n                              Carregar mais mensagens\r\n                            </>\r\n                          )}\r\n                        </Button>\r\n                      </div>\r\n                    )}\r\n                  </>\r\n                )\r\n              })()}\r\n            </div>\r\n            <div ref={messagesEndRef} />\r\n          </ScrollArea>\r\n\r\n          <div className=\"p-2 md:p-3 border-t\">\r\n            <form onSubmit={sendMessage} className=\"flex items-center gap-1 md:gap-2\">\r\n              <Button type=\"button\" variant=\"ghost\" size=\"icon\" className=\"h-8 w-8 md:h-10 md:w-10 flex-shrink-0\">\r\n                <Paperclip className=\"h-4 w-4\" />\r\n              </Button>\r\n              <Input\r\n                placeholder=\"Digite sua mensagem...\"\r\n                value={messageInput}\r\n                onChange={(e) => setMessageInput(e.target.value)}\r\n                className=\"flex-1 text-sm md:text-base\"\r\n              />\r\n              <Button type=\"submit\" size=\"icon\" className=\"h-8 w-8 md:h-10 md:w-10 flex-shrink-0\">\r\n                <Send className=\"h-4 w-4\" />\r\n              </Button>\r\n            </form>\r\n          </div>\r\n        </div>\r\n      ) : (\r\n        <div className=\"flex-1 flex items-center justify-center p-4 bg-gradient-to-br from-gray-50 to-white\">\r\n          <div className=\"text-center max-w-md\">\r\n            <div className=\"mx-auto mb-6 w-16 h-16 bg-green-100 rounded-full flex items-center justify-center\">\r\n              <MessageSquare className=\"h-8 w-8 text-green-600\" />\r\n            </div>\r\n            <h3 className=\"text-xl font-semibold text-gray-900 mb-2\">Bem-vindo ao Chat UniCRM</h3>\r\n            <p className=\"text-gray-600 mb-4\">\r\n              Selecione uma conversa ao lado ou crie uma nova para começar a atender seus clientes\r\n            </p>\r\n            <Button \r\n              variant=\"outline\" \r\n              onClick={() => setShowNewConversation(true)}\r\n              className=\"bg-white border-green-200 text-green-700 hover:bg-green-50\"\r\n            >\r\n              <Plus className=\"h-4 w-4 mr-2\" />\r\n              Nova Conversa\r\n            </Button>\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      <Dialog open={showNewConversation} onOpenChange={setShowNewConversation}>\r\n        <DialogContent>\r\n          <DialogHeader>\r\n            <DialogTitle>Nova Conversa</DialogTitle>\r\n            <DialogDescription>Informe o número e, opcionalmente, um nome.</DialogDescription>\r\n          </DialogHeader>\r\n          <div className=\"space-y-3\">\r\n            <Label>Número (DDI+DDD+Número, apenas dígitos)</Label>\r\n            <Input value={newContactPhone} onChange={(e) => setNewContactPhone(e.target.value)} placeholder=\"5546999046386\" />\r\n            <Label>Nome (opcional)</Label>\r\n            <Input value={newContactName} onChange={(e) => setNewContactName(e.target.value)} placeholder=\"Contato\" />\r\n          </div>\r\n          <DialogFooter>\r\n            <Button\r\n              onClick={async () => {\r\n                const raw = (newContactPhone || \"\")\r\n                const digits = raw.replace(/\\D/g, \"\")\r\n                if (!digits) return\r\n                const normalized = digits.length === 11 && !digits.startsWith(\"55\") ? `55${digits}` : digits\r\n                try {\r\n                  await apiClient.post(\"/whatsapp/contact\", { phone: normalized, name: newContactName })\r\n                } catch {}\r\n                const contact = whatsappService.createContact(normalized, newContactName)\r\n                setActiveContact(contact)\r\n                await loadContacts()\r\n                setShowNewConversation(false)\r\n                setNewContactPhone(\"\")\r\n                setNewContactName(\"\")\r\n              }}\r\n              disabled={!newContactPhone.trim()}\r\n            >\r\n              Criar\r\n            </Button>\r\n          </DialogFooter>\r\n        </DialogContent>\r\n      </Dialog>\r\n\r\n      {showConfig && <WhatsAppConfig onClose={() => setShowConfig(false)} />}\r\n\r\n      <Dialog open={showStatusMonitor} onOpenChange={setShowStatusMonitor}>\r\n        <DialogContent className=\"max-w-4xl max-h-[80vh]\">\r\n          <DialogHeader>\r\n            <DialogTitle>Monitor de Status WhatsApp</DialogTitle>\r\n            <DialogDescription>\r\n              Visualize em tempo real o status de presença e mensagens dos contatos.\r\n            </DialogDescription>\r\n          </DialogHeader>\r\n          <div className=\"py-4\">\r\n            <WhatsAppStatusMonitor \r\n              sse={sse}\r\n              presenceData={Array.from(chatPresenceMap.values())}\r\n              messageStatusData={Array.from(messageStatusMap.values())}\r\n            />\r\n          </div>\r\n          <DialogFooter>\r\n            <Button variant=\"outline\" onClick={() => setShowStatusMonitor(false)}>\r\n              Fechar\r\n            </Button>\r\n          </DialogFooter>\r\n        </DialogContent>\r\n      </Dialog>\r\n\r\n      <Dialog open={showSavePresetDialog} onOpenChange={setShowSavePresetDialog}>\r\n        <DialogContent>\r\n          <DialogHeader>\r\n            <DialogTitle>Salvar Filtro</DialogTitle>\r\n            <DialogDescription>\r\n              Dê um nome para este conjunto de filtros para acessá-lo rapidamente no futuro.\r\n            </DialogDescription>\r\n          </DialogHeader>\r\n          <div className=\"space-y-4 py-4\">\r\n            <div className=\"space-y-2\">\r\n              <Label htmlFor=\"preset-name\">Nome do Filtro</Label>\r\n              <Input\r\n                id=\"preset-name\"\r\n                placeholder=\"Ex: Atendimentos do João\"\r\n                value={presetName}\r\n                onChange={(e) => setPresetName(e.target.value)}\r\n                onKeyDown={(e) => {\r\n                  if (e.key === \"Enter\") {\r\n                    e.preventDefault()\r\n                    saveFilterPreset()\r\n                  }\r\n                }}\r\n              />\r\n            </div>\r\n          </div>\r\n          <DialogFooter>\r\n            <Button variant=\"outline\" onClick={() => setShowSavePresetDialog(false)}>\r\n              Cancelar\r\n            </Button>\r\n            <Button onClick={saveFilterPreset} disabled={!presetName.trim()}>\r\n              <Save className=\"h-4 w-4 mr-2\" />\r\n              Salvar\r\n            </Button>\r\n          </DialogFooter>\r\n        </DialogContent>\r\n      </Dialog>\r\n\r\n      {/* Delete Confirmation Dialog */}\r\n      <Dialog open={showDeleteConfirm} onOpenChange={setShowDeleteConfirm}>\r\n        <DialogContent>\r\n          <DialogHeader>\r\n            <DialogTitle>Confirmar Exclusão</DialogTitle>\r\n            <DialogDescription>\r\n              Tem certeza que deseja excluir esta conversa? Esta ação não pode ser desfeita.\r\n            </DialogDescription>\r\n          </DialogHeader>\r\n          <DialogFooter>\r\n            <Button variant=\"outline\" onClick={() => setShowDeleteConfirm(false)}>\r\n              Cancelar\r\n            </Button>\r\n            <Button \r\n              variant=\"destructive\" \r\n              onClick={() => {\r\n                if (contactToDelete) {\r\n                  deleteConversation(contactToDelete)\r\n                  setShowDeleteConfirm(false)\r\n                  setContactToDelete(null)\r\n                }\r\n              }}\r\n            >\r\n              <Trash2 className=\"h-4 w-4 mr-2\" />\r\n              Excluir\r\n            </Button>\r\n          </DialogFooter>\r\n        </DialogContent>\r\n      </Dialog>\r\n    </div>\r\n  )\r\n}\r\n\r\n// Enhanced Contact item component with delete/archive actions\r\nfunction ContactItem({\r\n  contact,\r\n  lastMessage,\r\n  lastMessageTime,\r\n  unreadCount,\r\n  isActive,\r\n  onClick,\r\n  presenceData,\r\n  onDelete,\r\n  onArchive,\r\n}: {\r\n  contact: WhatsAppContact\r\n  lastMessage: string\r\n  lastMessageTime: string\r\n  unreadCount: number\r\n  isActive: boolean\r\n  onClick: () => void\r\n  presenceData?: ChatPresenceData\r\n  onDelete?: (contact: WhatsAppContact) => void\r\n  onArchive?: (contact: WhatsAppContact) => void\r\n}) {\r\n  return (\r\n    <div className={`\r\n      p-4 cursor-pointer transition-all duration-200 ease-in-out group\r\n      ${isActive \r\n        ? \"bg-green-50 border-l-4 border-green-500 shadow-sm\" \r\n        : \"hover:bg-gray-50\"\r\n      }\r\n      border-b border-gray-100 last:border-b-0\r\n    `} onClick={onClick}>\r\n      <div className=\"flex items-center gap-3\">\r\n        {/* Enhanced Avatar */}\r\n        <div className=\"relative flex-shrink-0\">\r\n          <Avatar className=\"h-12 w-12 rounded-full\">\r\n            <AvatarImage \r\n              src={contact.avatar || \"/placeholder.svg\"} \r\n              alt={contact.name} \r\n              className=\"object-cover\"\r\n            />\r\n            <AvatarFallback className=\"bg-green-100 text-green-700 font-semibold\">\r\n              {contact.name.substring(0, 2).toUpperCase()}\r\n            </AvatarFallback>\r\n          </Avatar>\r\n          <WhatsAppPresenceIndicator \r\n            phone={contact.phone} \r\n            presenceData={presenceData}\r\n            className=\"absolute -bottom-1 -right-1\"\r\n          />\r\n        </div>\r\n        \r\n        {/* Enhanced Contact Info */}\r\n        <div className=\"flex-1 min-w-0\">\r\n          <div className=\"flex justify-between items-start mb-1\">\r\n            <h4 className={`font-semibold truncate ${\r\n              isActive ? \"text-gray-900\" : \"text-gray-800\"\r\n            }`}>\r\n              {contact.name}\r\n            </h4>\r\n            <span className=\"text-xs text-gray-500 ml-2 flex-shrink-0\">\r\n              {lastMessageTime}\r\n            </span>\r\n          </div>\r\n          \r\n          <div className=\"flex justify-between items-start mb-1\">\r\n            <p className={`text-sm truncate ${\r\n              unreadCount > 0 \r\n                ? \"text-gray-900 font-medium\" \r\n                : \"text-gray-600\"\r\n            }`}>\r\n              {lastMessage}\r\n            </p>\r\n            {unreadCount > 0 && (\r\n              <Badge className=\"ml-2 flex-shrink-0 bg-green-500 hover:bg-green-600 text-white text-xs font-semibold rounded-full px-2 py-0.5\">\r\n                {unreadCount}\r\n              </Badge>\r\n            )}\r\n          </div>\r\n          \r\n          <div className=\"flex items-center\">\r\n            <span className=\"text-xs text-gray-500\">{contact.phone}</span>\r\n            <MessageSquare className=\"h-3 w-3 ml-2 text-green-500 flex-shrink-0\" />\r\n          </div>\r\n        </div>\r\n        \r\n        {/* Action Buttons */}\r\n        {(onDelete || onArchive) && (\r\n          <div className=\"flex items-center gap-1 opacity-0 group-hover:opacity-100 transition-opacity\">\r\n            {onArchive && (\r\n              <Button\r\n                variant=\"ghost\"\r\n                size=\"icon\"\r\n                className=\"h-6 w-6 text-gray-400 hover:text-blue-600 hover:bg-blue-50\"\r\n                onClick={(e) => {\r\n                  e.stopPropagation()\r\n                  onArchive(contact)\r\n                }}\r\n                title=\"Arquivar conversa\"\r\n              >\r\n                <Save className=\"h-3 w-3\" />\r\n              </Button>\r\n            )}\r\n            {onDelete && (\r\n              <Button\r\n                variant=\"ghost\"\r\n                size=\"icon\"\r\n                className=\"h-6 w-6 text-gray-400 hover:text-red-600 hover:bg-red-50\"\r\n                onClick={(e) => {\r\n                  e.stopPropagation()\r\n                  onDelete(contact)\r\n                }}\r\n                title=\"Excluir conversa\"\r\n              >\r\n                <Trash2 className=\"h-3 w-3\" />\r\n              </Button>\r\n            )}\r\n          </div>\r\n        )}\r\n      </div>\r\n    </div>\r\n  )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Projetos\\Back_endCrm\\kanbanproject1\\components\\create-lead-dialog.tsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'leadData' is defined but never used.","line":94,"column":14,"nodeType":"Identifier","messageId":"unusedVar","endLine":94,"endColumn":54,"suggestions":[{"messageId":"removeVar","data":{"varName":"leadData"},"fix":{"range":[2297,2337],"text":""},"desc":"Remove unused variable 'leadData'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'people' is defined but never used.","line":116,"column":50,"nodeType":"Identifier","messageId":"unusedVar","endLine":116,"endColumn":56,"suggestions":[{"messageId":"removeVar","data":{"varName":"people"},"fix":{"range":[3155,3163],"text":""},"desc":"Remove unused variable 'people'."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'people' is defined but never used.","line":116,"column":50,"nodeType":null,"messageId":"unusedVar","endLine":116,"endColumn":56},{"ruleId":"no-unused-vars","severity":1,"message":"'getNextTab' is assigned a value but never used.","line":361,"column":9,"nodeType":"Identifier","messageId":"unusedVar","endLine":361,"endColumn":19},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'getNextTab' is assigned a value but never used.","line":361,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":361,"endColumn":19},{"ruleId":"no-unused-vars","severity":1,"message":"'getPreviousTab' is assigned a value but never used.","line":367,"column":9,"nodeType":"Identifier","messageId":"unusedVar","endLine":367,"endColumn":23},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'getPreviousTab' is assigned a value but never used.","line":367,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":367,"endColumn":23}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":7,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\"\r\n\r\nimport { useState, useEffect } from \"react\"\r\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogDescription } from \"@/components/ui/dialog\"\r\nimport { Button } from \"@/components/ui/button\"\r\nimport { Input } from \"@/components/ui/input\"\r\nimport { Label } from \"@/components/ui/label\"\r\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\"\r\nimport { Textarea } from \"@/components/ui/textarea\"\r\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\"\r\nimport { Badge } from \"@/components/ui/badge\"\r\nimport { Avatar, AvatarFallback, AvatarImage } from \"@/components/ui/avatar\"\r\nimport { RadioGroup, RadioGroupItem } from \"@/components/ui/radio-group\"\r\nimport { toast } from \"@/hooks/use-toast\"\r\nimport {\r\n  User,\r\n  Building,\r\n  Phone,\r\n  MapPin,\r\n  Target,\r\n  AlertCircle,\r\n  FileText,\r\n  CheckCircle,\r\n  Tag,\r\n  Users,\r\n  Star,\r\n  Plus,\r\n  Trash2,\r\n} from \"lucide-react\"\r\nimport TagInput from \"./tag-input\"\r\nimport { usersApi } from \"@/lib/api/users-api\"\r\nimport { authApi } from \"@/lib/api/auth-api\"\r\nimport { useApiTags } from \"@/hooks/use-api-tags\"\r\n\r\ntype Person = {\r\n  id: string\r\n  name: string\r\n  avatar: string\r\n  phone?: string\r\n  email?: string\r\n}\r\n\r\ntype Contact = {\r\n  id: string\r\n  name: string\r\n  email?: string\r\n  phone?: string\r\n  isPrincipal: boolean\r\n}\r\n\r\ntype Lead = {\r\n  id: string\r\n  title: string\r\n  client: string\r\n  clientEmail?: string\r\n  clientPhone?: string\r\n  clientAddress?: string\r\n  clientType?: \"fisica\" | \"juridica\"\r\n  clientCNPJ?: string\r\n  source: string\r\n  status: string\r\n  assignedTo?: Person\r\n  people: Person[]\r\n  priority?: string\r\n  estimatedValue?: number\r\n  expectedCloseDate?: string\r\n  notes?: string\r\n  tags?: string[]\r\n  contacts?: Contact[]\r\n  createdAt: string\r\n  interactions?: Array<{\r\n    id: string\r\n    type: \"call\" | \"email\" | \"meeting\" | \"note\" | \"feedback\"\r\n    description: string\r\n    date: string\r\n    createdBy: string\r\n    feedbackType?: \"positive\" | \"negative\" | \"neutral\" | \"important\"\r\n    rating?: number\r\n  }>\r\n}\r\n\r\ntype Column = {\r\n  id: string\r\n  name: string\r\n  color: string\r\n  order: number\r\n}\r\n\r\ntype CreateLeadDialogProps = {\r\n  open: boolean\r\n  people: Person[]\r\n  columns: Column[]\r\n  onClose: () => void\r\n  onCreate: (leadData: Omit<Lead, \"id\" | \"createdAt\">) => void\r\n}\r\n\r\nconst sources = [\r\n  { value: \"website\", label: \"Website\" },\r\n  { value: \"google_ads\", label: \"Google Ads\" },\r\n  { value: \"facebook_ads\", label: \"Facebook Ads\" },\r\n  { value: \"linkedin\", label: \"LinkedIn\" },\r\n  { value: \"referral\", label: \"Indicação\" },\r\n  { value: \"phone\", label: \"Telefone\" },\r\n  { value: \"email\", label: \"E-mail\" },\r\n  { value: \"event\", label: \"Evento\" },\r\n  { value: \"other\", label: \"Outros\" },\r\n]\r\n\r\nconst priorities = [\r\n  { value: \"low\", label: \"Baixa\", color: \"bg-blue-100 text-blue-800\" },\r\n  { value: \"medium\", label: \"Média\", color: \"bg-yellow-100 text-yellow-800\" },\r\n  { value: \"high\", label: \"Alta\", color: \"bg-orange-100 text-orange-800\" },\r\n  { value: \"urgent\", label: \"Urgente\", color: \"bg-red-100 text-red-800\" },\r\n]\r\n\r\nexport default function CreateLeadDialog({ open, people, columns, onClose, onCreate }: CreateLeadDialogProps) {\r\n  const [currentTab, setCurrentTab] = useState(\"contact\")\r\n  const [formData, setFormData] = useState({\r\n    title: \"\",\r\n    client: \"\",\r\n    clientEmail: \"\",\r\n    clientPhone: \"\",\r\n    clientAddress: \"\",\r\n    clientType: \"fisica\" as \"fisica\" | \"juridica\",\r\n    clientCNPJ: \"\",\r\n    source: \"\",\r\n    status: columns.find((col) => col.order === 0)?.id || \"\",\r\n    assignedTo: \"\",\r\n    priority: \"medium\",\r\n    estimatedValue: \"\",\r\n    expectedCloseDate: \"\",\r\n    notes: \"\",\r\n    tags: [] as string[],\r\n  })\r\n\r\n  const [contacts, setContacts] = useState<Contact[]>([\r\n    {\r\n      id: \"contact-1\",\r\n      name: \"\",\r\n      email: \"\",\r\n      phone: \"\",\r\n      isPrincipal: true,\r\n    },\r\n  ])\r\n\r\n  const [errors, setErrors] = useState<Record<string, string>>({})\r\n\r\n  // Responsáveis carregados da API\r\n  const [availableResponsibles, setAvailableResponsibles] = useState<\r\n    Array<{ id: string; name: string; email: string; avatar: string }>\r\n  >([])\r\n\r\n  // Carrega usuários quando o diálogo abre (ou no primeiro render)\r\n  // Evita usar funções legadas que retornam vazio\r\n  useEffect(() => {\r\n    let isMounted = true\r\n    const loadUsers = async () => {\r\n      try {\r\n        // Obter empresa atual do usuário autenticado\r\n        let companyId: string | undefined\r\n        try {\r\n          const me = await authApi.me()\r\n          companyId = me?.companyId || undefined\r\n          console.log(\"[v0] Current user for company scope:\", me)\r\n        } catch (e) {\r\n          console.warn(\"[v0] Failed to fetch /auth/me; fallback to all users.\", e)\r\n        }\r\n\r\n        const users = await usersApi.list(companyId)\r\n        const filtered = companyId ? (users || []).filter((u: any) => u.companyId === companyId) : (users || [])\r\n        const mapped = filtered.map((user: any) => ({\r\n          id: user.id,\r\n          name: user.name,\r\n          email: user.email,\r\n          avatar: `/placeholder.svg?height=32&width=32&query=${encodeURIComponent(user.name || \"Usuario\")}`,\r\n        }))\r\n        if (isMounted) setAvailableResponsibles(mapped)\r\n        console.log(\"[v0] Available responsibles loaded from API:\", mapped)\r\n      } catch (error) {\r\n        console.error(\"[v0] Failed to load users for responsibles:\", error)\r\n        if (isMounted) setAvailableResponsibles([])\r\n      }\r\n    }\r\n    loadUsers()\r\n    return () => {\r\n      isMounted = false\r\n    }\r\n  }, [])\r\n\r\n  console.log(\"[v0] Available responsibles for lead assignment:\", availableResponsibles)\r\n\r\n  const addContact = () => {\r\n    const newContact: Contact = {\r\n      id: `contact-${Date.now()}`,\r\n      name: \"\",\r\n      email: \"\",\r\n      phone: \"\",\r\n      isPrincipal: false,\r\n    }\r\n    setContacts([...contacts, newContact])\r\n  }\r\n\r\n  const removeContact = (id: string) => {\r\n    if (contacts.length === 1) {\r\n      toast({\r\n        title: \"Atenção\",\r\n        description: \"É necessário ter pelo menos um contato.\",\r\n        variant: \"destructive\",\r\n      })\r\n      return\r\n    }\r\n    setContacts(contacts.filter((c) => c.id !== id))\r\n  }\r\n\r\n  const updateContact = (id: string, field: keyof Contact, value: string | boolean) => {\r\n    setContacts(\r\n      contacts.map((c) => {\r\n        if (c.id === id) {\r\n          return { ...c, [field]: value }\r\n        }\r\n        return c\r\n      }),\r\n    )\r\n  }\r\n\r\n  const togglePrincipal = (id: string) => {\r\n    setContacts(\r\n      contacts.map((c) => {\r\n        if (c.id === id) {\r\n          return { ...c, isPrincipal: !c.isPrincipal }\r\n        }\r\n        return c\r\n      }),\r\n    )\r\n  }\r\n\r\n  const handleInputChange = (field: string, value: string | string[]) => {\r\n    setFormData((prev) => ({ ...prev, [field]: value }))\r\n    if (errors[field]) {\r\n      setErrors((prev) => ({ ...prev, [field]: \"\" }))\r\n    }\r\n  }\r\n\r\n  const validateCNPJ = (cnpj: string): boolean => {\r\n    const cleanCNPJ = cnpj.replace(/[^\\d]/g, \"\")\r\n    return cleanCNPJ.length === 14\r\n  }\r\n\r\n  const validateForm = () => {\r\n    const newErrors: Record<string, string> = {}\r\n\r\n    const principalContacts = contacts.filter((c) => c.isPrincipal && c.name.trim() && c.phone.trim())\r\n\r\n    if (principalContacts.length === 0) {\r\n      newErrors.contacts = \"É necessário ter pelo menos um contato principal com nome e telefone\"\r\n    }\r\n\r\n    if (formData.clientType === \"juridica\" && !formData.title.trim()) {\r\n      newErrors.title = \"Nome da empresa é obrigatório para pessoa jurídica\"\r\n    }\r\n\r\n    if (formData.clientType === \"juridica\" && formData.clientCNPJ && !validateCNPJ(formData.clientCNPJ)) {\r\n      newErrors.clientCNPJ = \"CNPJ deve ter 14 dígitos\"\r\n    }\r\n\r\n    // Removed validation for formData.client.trim() as it's replaced by contacts\r\n    // if (!formData.client.trim()) {\r\n    //   newErrors.client = \"Nome completo é obrigatório\"\r\n    // }\r\n\r\n    if (!formData.source) {\r\n      newErrors.source = \"Origem é obrigatória\"\r\n    }\r\n\r\n    if (!formData.status) {\r\n      newErrors.status = \"Status inicial é obrigatório\"\r\n    }\r\n\r\n    if (!formData.assignedTo) {\r\n      newErrors.assignedTo = \"Responsável é obrigatório\"\r\n    }\r\n\r\n    setErrors(newErrors)\r\n    return Object.keys(newErrors).length === 0\r\n  }\r\n\r\n  const handleSubmit = () => {\r\n    if (!validateForm()) {\r\n      toast({\r\n        title: \"Erro na validação\",\r\n        description: \"Por favor, corrija os campos obrigatórios.\",\r\n        variant: \"destructive\",\r\n      })\r\n      return\r\n    }\r\n\r\n    const assignedPerson = availableResponsibles.find((p) => p.id === formData.assignedTo)\r\n\r\n    const primaryContact = contacts.find((c) => c.isPrincipal) || contacts[0]\r\n\r\n    const leadData: Omit<Lead, \"id\" | \"createdAt\"> = {\r\n      title: formData.clientType === \"juridica\" ? formData.title : primaryContact.name,\r\n      client: primaryContact.name,\r\n      clientEmail: primaryContact.email || undefined,\r\n      clientPhone: primaryContact.phone,\r\n      clientAddress: formData.clientAddress || undefined,\r\n      clientType: formData.clientType,\r\n      clientCNPJ: formData.clientType === \"juridica\" ? formData.clientCNPJ || undefined : undefined,\r\n      source: formData.source,\r\n      status: formData.status,\r\n      assignedTo: assignedPerson,\r\n      people: assignedPerson ? [assignedPerson] : [],\r\n      priority: formData.priority as \"low\" | \"medium\" | \"high\" | \"urgent\",\r\n      estimatedValue: formData.estimatedValue ? Number.parseFloat(formData.estimatedValue) : undefined,\r\n      expectedCloseDate: formData.expectedCloseDate || undefined,\r\n      notes: formData.notes || undefined,\r\n      tags: formData.tags.length > 0 ? formData.tags : undefined,\r\n      contacts: contacts.filter((c) => c.name.trim()),\r\n      interactions: [],\r\n    }\r\n\r\n    console.log(\"[v0] Creating lead with tags:\", formData.tags)\r\n    console.log(\"[v0] Lead data being saved:\", leadData)\r\n\r\n    onCreate(leadData)\r\n    handleClose()\r\n  }\r\n\r\n  const handleClose = () => {\r\n    setFormData({\r\n      title: \"\",\r\n      client: \"\",\r\n      clientEmail: \"\",\r\n      clientPhone: \"\",\r\n      clientAddress: \"\",\r\n      clientType: \"fisica\",\r\n      clientCNPJ: \"\",\r\n      source: \"\",\r\n      status: columns.find((col) => col.order === 0)?.id || \"\",\r\n      assignedTo: \"\",\r\n      priority: \"medium\",\r\n      estimatedValue: \"\",\r\n      expectedCloseDate: \"\",\r\n      notes: \"\",\r\n      tags: [],\r\n    })\r\n    setContacts([\r\n      {\r\n        id: \"contact-1\",\r\n        name: \"\",\r\n        email: \"\",\r\n        phone: \"\",\r\n        isPrincipal: true,\r\n      },\r\n    ])\r\n    setErrors({})\r\n    setCurrentTab(\"contact\")\r\n    onClose()\r\n  }\r\n\r\n  const getNextTab = (current: string) => {\r\n    const tabs = [\"contact\", \"business\", \"details\", \"summary\"]\r\n    const currentIndex = tabs.indexOf(current)\r\n    return currentIndex < tabs.length - 1 ? tabs[currentIndex + 1] : current\r\n  }\r\n\r\n  const getPreviousTab = (current: string) => {\r\n    const tabs = [\"contact\", \"business\", \"details\", \"summary\"]\r\n    const currentIndex = tabs.indexOf(current)\r\n    return currentIndex > 0 ? tabs[currentIndex - 1] : current\r\n  }\r\n\r\n  const selectedPriority = priorities.find((p) => p.value === formData.priority)\r\n  const selectedSource = sources.find((s) => s.value === formData.source)\r\n  const selectedColumn = columns.find((c) => c.id === formData.status)\r\n  const selectedPerson = availableResponsibles.find((p) => p.id === formData.assignedTo)\r\n  \r\n  const { tags: availableTags, fetchTags } = useApiTags()\r\n\r\n  useEffect(() => {\r\n    if (open) {\r\n      fetchTags()\r\n    }\r\n  }, [open, fetchTags])\r\n\r\n  const selectedTags = Array.isArray(availableTags)\r\n    ? availableTags.filter((tag) => formData.tags.includes(tag.id))\r\n    : []\r\n\r\n  return (\r\n    <Dialog open={open} onOpenChange={handleClose}>\r\n      <DialogContent className=\"max-w-2xl max-h-[90vh] overflow-y-auto\">\r\n        <DialogHeader>\r\n          <DialogTitle>Novo Lead</DialogTitle>\r\n          <DialogDescription>\r\n            Preencha os dados para criar um novo lead.\r\n          </DialogDescription>\r\n        </DialogHeader>\r\n\r\n        <Tabs value={currentTab} onValueChange={setCurrentTab} className=\"w-full\">\r\n          <TabsList className=\"grid w-full grid-cols-4\">\r\n            <TabsTrigger value=\"contact\" className=\"flex items-center gap-2\">\r\n              <User className=\"h-4 w-4\" />\r\n              Contato\r\n            </TabsTrigger>\r\n            <TabsTrigger value=\"business\" className=\"flex items-center gap-2\">\r\n              <Building className=\"h-4 w-4\" />\r\n              Negócio\r\n            </TabsTrigger>\r\n            <TabsTrigger value=\"details\" className=\"flex items-center gap-2\">\r\n              <FileText className=\"h-4 w-4\" />\r\n              Detalhes\r\n            </TabsTrigger>\r\n            <TabsTrigger value=\"summary\" className=\"flex items-center gap-2\">\r\n              <CheckCircle className=\"h-4 w-4\" />\r\n              Resumo\r\n            </TabsTrigger>\r\n          </TabsList>\r\n\r\n          <TabsContent value=\"contact\" className=\"space-y-4\">\r\n            <div className=\"space-y-3\">\r\n              <Label>Tipo de Cliente</Label>\r\n              <RadioGroup\r\n                value={formData.clientType}\r\n                onValueChange={(value: \"fisica\" | \"juridica\") => handleInputChange(\"clientType\", value)}\r\n                className=\"flex gap-6\"\r\n              >\r\n                <div className=\"flex items-center space-x-2\">\r\n                  <RadioGroupItem value=\"fisica\" id=\"fisica\" />\r\n                  <Label htmlFor=\"fisica\">Pessoa Física</Label>\r\n                </div>\r\n                <div className=\"flex items-center space-x-2\">\r\n                  <RadioGroupItem value=\"juridica\" id=\"juridica\" />\r\n                  <Label htmlFor=\"juridica\">Pessoa Jurídica</Label>\r\n                </div>\r\n              </RadioGroup>\r\n            </div>\r\n\r\n            {formData.clientType === \"juridica\" && (\r\n              <>\r\n                <div className=\"space-y-2\">\r\n                  <Label htmlFor=\"title\">\r\n                    Nome da Empresa <span className=\"text-red-500\">*</span>\r\n                  </Label>\r\n                  <Input\r\n                    id=\"title\"\r\n                    placeholder=\"Nome da empresa\"\r\n                    value={formData.title}\r\n                    onChange={(e) => handleInputChange(\"title\", e.target.value)}\r\n                    className={errors.title ? \"border-red-500\" : \"\"}\r\n                  />\r\n                  {errors.title && <p className=\"text-sm text-red-500\">{errors.title}</p>}\r\n                </div>\r\n\r\n                <div className=\"space-y-2\">\r\n                  <Label htmlFor=\"clientCNPJ\">CNPJ</Label>\r\n                  <Input\r\n                    id=\"clientCNPJ\"\r\n                    placeholder=\"00.000.000/0000-00\"\r\n                    value={formData.clientCNPJ}\r\n                    onChange={(e) => handleInputChange(\"clientCNPJ\", e.target.value)}\r\n                    className={errors.clientCNPJ ? \"border-red-500\" : \"\"}\r\n                  />\r\n                  {errors.clientCNPJ && <p className=\"text-sm text-red-500\">{errors.clientCNPJ}</p>}\r\n                </div>\r\n              </>\r\n            )}\r\n\r\n            <div className=\"space-y-4\">\r\n              <div className=\"flex items-center justify-between\">\r\n                <Label className=\"text-base font-semibold\">\r\n                  Contatos <span className=\"text-red-500\">*</span>\r\n                </Label>\r\n                <Button type=\"button\" variant=\"outline\" size=\"sm\" onClick={addContact}>\r\n                  <Plus className=\"h-4 w-4 mr-2\" />\r\n                  Adicionar Contato\r\n                </Button>\r\n              </div>\r\n\r\n              {errors.contacts && <p className=\"text-sm text-red-500\">{errors.contacts}</p>}\r\n\r\n              <div className=\"space-y-4\">\r\n                {contacts.map((contact, index) => (\r\n                  <div key={contact.id} className=\"border rounded-lg p-4 space-y-3 relative\">\r\n                    <div className=\"flex items-center justify-between mb-2\">\r\n                      <div className=\"flex items-center gap-2\">\r\n                        <span className=\"text-sm font-medium\">Contato {index + 1}</span>\r\n                        <Button\r\n                          type=\"button\"\r\n                          variant=\"ghost\"\r\n                          size=\"sm\"\r\n                          onClick={() => togglePrincipal(contact.id)}\r\n                          className={contact.isPrincipal ? \"text-yellow-500\" : \"text-gray-400\"}\r\n                        >\r\n                          <Star className={`h-4 w-4 ${contact.isPrincipal ? \"fill-yellow-500\" : \"\"}`} />\r\n                        </Button>\r\n                        {contact.isPrincipal && (\r\n                          <Badge variant=\"secondary\" className=\"text-xs\">\r\n                            Principal\r\n                          </Badge>\r\n                        )}\r\n                      </div>\r\n                      {contacts.length > 1 && (\r\n                        <Button\r\n                          type=\"button\"\r\n                          variant=\"ghost\"\r\n                          size=\"sm\"\r\n                          onClick={() => removeContact(contact.id)}\r\n                          className=\"text-red-500 hover:text-red-700\"\r\n                        >\r\n                          <Trash2 className=\"h-4 w-4\" />\r\n                        </Button>\r\n                      )}\r\n                    </div>\r\n\r\n                    <div className=\"grid grid-cols-1 gap-3\">\r\n                      <div className=\"space-y-2\">\r\n                        <Label htmlFor={`contact-name-${contact.id}`}>\r\n                          Nome Completo {contact.isPrincipal && <span className=\"text-red-500\">*</span>}\r\n                        </Label>\r\n                        <Input\r\n                          id={`contact-name-${contact.id}`}\r\n                          placeholder=\"Nome do contato\"\r\n                          value={contact.name}\r\n                          onChange={(e) => updateContact(contact.id, \"name\", e.target.value)}\r\n                        />\r\n                      </div>\r\n\r\n                      <div className=\"grid grid-cols-2 gap-3\">\r\n                        <div className=\"space-y-2\">\r\n                          <Label htmlFor={`contact-email-${contact.id}`}>Email</Label>\r\n                          <Input\r\n                            id={`contact-email-${contact.id}`}\r\n                            type=\"email\"\r\n                            placeholder=\"email@exemplo.com\"\r\n                            value={contact.email}\r\n                            onChange={(e) => updateContact(contact.id, \"email\", e.target.value)}\r\n                          />\r\n                        </div>\r\n\r\n                        <div className=\"space-y-2\">\r\n                          <Label htmlFor={`contact-phone-${contact.id}`} className=\"flex items-center gap-2\">\r\n                            <Phone className=\"h-4 w-4\" />\r\n                            Telefone {contact.isPrincipal && <span className=\"text-red-500\">*</span>}\r\n                          </Label>\r\n                          <Input\r\n                            id={`contact-phone-${contact.id}`}\r\n                            placeholder=\"(11) 99999-9999\"\r\n                            value={contact.phone}\r\n                            onChange={(e) => updateContact(contact.id, \"phone\", e.target.value)}\r\n                          />\r\n                        </div>\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n                ))}\r\n              </div>\r\n\r\n              <p className=\"text-xs text-muted-foreground\">\r\n                Clique na estrela para marcar contatos como principais. Você pode ter múltiplos contatos principais.\r\n              </p>\r\n            </div>\r\n\r\n            <div className=\"space-y-2\">\r\n              <Label htmlFor=\"clientAddress\" className=\"flex items-center gap-2\">\r\n                <MapPin className=\"h-4 w-4\" />\r\n                Endereço\r\n              </Label>\r\n              <Input\r\n                id=\"clientAddress\"\r\n                placeholder=\"Endereço completo\"\r\n                value={formData.clientAddress}\r\n                onChange={(e) => handleInputChange(\"clientAddress\", e.target.value)}\r\n              />\r\n            </div>\r\n          </TabsContent>\r\n\r\n          <TabsContent value=\"business\" className=\"space-y-4\">\r\n            <div className=\"grid grid-cols-2 gap-4\">\r\n              <div className=\"space-y-2\">\r\n                <Label htmlFor=\"source\">\r\n                  Origem <span className=\"text-red-500\">*</span>\r\n                </Label>\r\n                <Select value={formData.source} onValueChange={(value) => handleInputChange(\"source\", value)}>\r\n                  <SelectTrigger className={errors.source ? \"border-red-500\" : \"\"}>\r\n                    <SelectValue placeholder=\"Selecione a origem\" />\r\n                  </SelectTrigger>\r\n                  <SelectContent>\r\n                    {sources.map((source) => (\r\n                      <SelectItem key={source.value} value={source.value}>\r\n                        {source.label}\r\n                      </SelectItem>\r\n                    ))}\r\n                  </SelectContent>\r\n                </Select>\r\n                {errors.source && <p className=\"text-sm text-red-500\">{errors.source}</p>}\r\n              </div>\r\n\r\n              <div className=\"space-y-2\">\r\n                <Label htmlFor=\"status\">\r\n                  Status Inicial <span className=\"text-red-500\">*</span>\r\n                </Label>\r\n                <Select value={formData.status} onValueChange={(value) => handleInputChange(\"status\", value)}>\r\n                  <SelectTrigger className={errors.status ? \"border-red-500\" : \"\"}>\r\n                    <SelectValue placeholder=\"Selecione o status\" />\r\n                  </SelectTrigger>\r\n                  <SelectContent>\r\n                    {columns\r\n                      .sort((a, b) => a.order - b.order)\r\n                      .map((column) => (\r\n                        <SelectItem key={column.id} value={column.id}>\r\n                          <div className=\"flex items-center gap-2\">\r\n                            <div className=\"w-3 h-3 rounded-full\" style={{ backgroundColor: column.color }} />\r\n                            {column.name}\r\n                          </div>\r\n                        </SelectItem>\r\n                      ))}\r\n                  </SelectContent>\r\n                </Select>\r\n                {errors.status && <p className=\"text-sm text-red-500\">{errors.status}</p>}\r\n              </div>\r\n            </div>\r\n\r\n            <div className=\"grid grid-cols-2 gap-4\">\r\n              <div className=\"space-y-2\">\r\n                <Label htmlFor=\"priority\" className=\"flex items-center gap-2\">\r\n                  <AlertCircle className=\"h-4 w-4\" />\r\n                  Prioridade\r\n                </Label>\r\n                <Select value={formData.priority} onValueChange={(value) => handleInputChange(\"priority\", value)}>\r\n                  <SelectTrigger>\r\n                    <SelectValue />\r\n                  </SelectTrigger>\r\n                  <SelectContent>\r\n                    {priorities.map((priority) => (\r\n                      <SelectItem key={priority.value} value={priority.value}>\r\n                        <div className=\"flex items-center gap-2\">\r\n                          <Badge className={priority.color}>{priority.label}</Badge>\r\n                        </div>\r\n                      </SelectItem>\r\n                    ))}\r\n                  </SelectContent>\r\n                </Select>\r\n              </div>\r\n\r\n              <div className=\"space-y-2\">\r\n                <Label htmlFor=\"assignedTo\" className=\"flex items-center gap-2\">\r\n                  <Users className=\"h-4 w-4\" />\r\n                  Responsável <span className=\"text-red-500\">*</span>\r\n                </Label>\r\n                <Select value={formData.assignedTo} onValueChange={(value) => handleInputChange(\"assignedTo\", value)}>\r\n                  <SelectTrigger className={errors.assignedTo ? \"border-red-500\" : \"\"}>\r\n                    {selectedPerson ? (\r\n                      <div className=\"flex items-center gap-2\">\r\n                        <Avatar className=\"h-6 w-6\">\r\n                          <AvatarImage src={selectedPerson.avatar || \"/placeholder.svg\"} alt={selectedPerson.name} />\r\n                          <AvatarFallback>{selectedPerson.name?.substring(0, 2) || \"??\"}</AvatarFallback>\r\n                        </Avatar>\r\n                        <span>{selectedPerson.name}</span>\r\n                      </div>\r\n                    ) : (\r\n                      <SelectValue placeholder=\"Selecione um responsável\" />\r\n                    )}\r\n                  </SelectTrigger>\r\n                  <SelectContent>\r\n                    {availableResponsibles.map((person) => (\r\n                      <SelectItem key={person.id} value={person.id}>\r\n                        <div className=\"flex items-center gap-2\">\r\n                          <Avatar className=\"h-6 w-6\">\r\n                            <AvatarImage src={person.avatar || \"/placeholder.svg\"} alt={person.name} />\r\n                            <AvatarFallback>{person.name?.substring(0, 2) || \"??\"}</AvatarFallback>\r\n                          </Avatar>\r\n                          <div>\r\n                            <div className=\"font-medium\">{person.name}</div>\r\n                            <div className=\"text-xs text-muted-foreground\">{person.email}</div>\r\n                          </div>\r\n                        </div>\r\n                      </SelectItem>\r\n                    ))}\r\n                  </SelectContent>\r\n                </Select>\r\n                {errors.assignedTo && <p className=\"text-sm text-red-500\">{errors.assignedTo}</p>}\r\n              </div>\r\n            </div>\r\n          </TabsContent>\r\n\r\n          <TabsContent value=\"details\" className=\"space-y-4\">\r\n            <div className=\"grid grid-cols-2 gap-4\">\r\n              <div className=\"space-y-2\">\r\n                <Label htmlFor=\"estimatedValue\" className=\"flex items-center gap-2\">\r\n                  <Target className=\"h-4 w-4\" />\r\n                  Valor Estimado (R$)\r\n                </Label>\r\n                <Input\r\n                  id=\"estimatedValue\"\r\n                  type=\"number\"\r\n                  placeholder=\"0,00\"\r\n                  value={formData.estimatedValue}\r\n                  onChange={(e) => handleInputChange(\"estimatedValue\", e.target.value)}\r\n                />\r\n              </div>\r\n\r\n              <div className=\"space-y-2\">\r\n                <Label htmlFor=\"expectedCloseDate\">Data Esperada de Fechamento</Label>\r\n                <Input\r\n                  id=\"expectedCloseDate\"\r\n                  type=\"date\"\r\n                  value={formData.expectedCloseDate}\r\n                  onChange={(e) => handleInputChange(\"expectedCloseDate\", e.target.value)}\r\n                />\r\n              </div>\r\n            </div>\r\n\r\n            <div className=\"space-y-2\">\r\n              <Label className=\"flex items-center gap-2\">\r\n                <Tag className=\"h-4 w-4\" />\r\n                Tags\r\n              </Label>\r\n              <TagInput\r\n                selectedTags={formData.tags}\r\n                onTagsChange={(tags) => handleInputChange(\"tags\", tags)}\r\n                placeholder=\"Digite para buscar ou criar tags...\"\r\n              />\r\n            </div>\r\n\r\n            <div className=\"space-y-2\">\r\n              <Label htmlFor=\"notes\">Observações</Label>\r\n              <Textarea\r\n                id=\"notes\"\r\n                placeholder=\"Adicione observações sobre este lead...\"\r\n                value={formData.notes}\r\n                onChange={(e) => handleInputChange(\"notes\", e.target.value)}\r\n                rows={4}\r\n              />\r\n            </div>\r\n          </TabsContent>\r\n\r\n          <TabsContent value=\"summary\" className=\"space-y-4\">\r\n            <div className=\"bg-gray-50 p-4 rounded-lg space-y-4\">\r\n              <h3 className=\"font-semibold text-lg\">Resumo do Lead</h3>\r\n\r\n              <div className=\"grid grid-cols-2 gap-4\">\r\n                <div>\r\n                  <p className=\"text-sm text-muted-foreground\">Tipo de Cliente</p>\r\n                  <p className=\"font-medium\">\r\n                    {formData.clientType === \"fisica\" ? \"Pessoa Física\" : \"Pessoa Jurídica\"}\r\n                  </p>\r\n                </div>\r\n                {formData.clientType === \"juridica\" && formData.title && (\r\n                  <div>\r\n                    <p className=\"text-sm text-muted-foreground\">Empresa</p>\r\n                    <p className=\"font-medium\">{formData.title}</p>\r\n                  </div>\r\n                )}\r\n              </div>\r\n\r\n              <div>\r\n                <p className=\"text-sm text-muted-foreground mb-2\">Contatos</p>\r\n                <div className=\"space-y-2\">\r\n                  {contacts\r\n                    .filter((c) => c.name.trim())\r\n                    .map((contact) => (\r\n                      <div key={contact.id} className=\"flex items-start gap-2 p-2 bg-white rounded border\">\r\n                        <div className=\"flex-1\">\r\n                          <div className=\"flex items-center gap-2\">\r\n                            <p className=\"font-medium\">{contact.name}</p>\r\n                            {contact.isPrincipal && <Star className=\"h-4 w-4 fill-yellow-500 text-yellow-500\" />}\r\n                          </div>\r\n                          {contact.email && <p className=\"text-sm text-muted-foreground\">{contact.email}</p>}\r\n                          {contact.phone && (\r\n                            <p className=\"text-sm text-muted-foreground flex items-center gap-1\">\r\n                              <Phone className=\"h-3 w-3\" />\r\n                              {contact.phone}\r\n                            </p>\r\n                          )}\r\n                        </div>\r\n                      </div>\r\n                    ))}\r\n                </div>\r\n              </div>\r\n\r\n              {formData.clientAddress && (\r\n                <div>\r\n                  <p className=\"text-sm text-muted-foreground\">Endereço</p>\r\n                  <p className=\"font-medium\">{formData.clientAddress}</p>\r\n                </div>\r\n              )}\r\n\r\n              <div className=\"grid grid-cols-2 gap-4\">\r\n                <div>\r\n                  <p className=\"text-sm text-muted-foreground\">Origem</p>\r\n                  <p className=\"font-medium\">{selectedSource?.label || \"Não informado\"}</p>\r\n                </div>\r\n                <div>\r\n                  <p className=\"text-sm text-muted-foreground\">Status Inicial</p>\r\n                  <div className=\"flex items-center gap-2\">\r\n                    {selectedColumn && (\r\n                      <div className=\"w-3 h-3 rounded-full\" style={{ backgroundColor: selectedColumn.color }} />\r\n                    )}\r\n                    <p className=\"font-medium\">{selectedColumn?.name || \"Não informado\"}</p>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n\r\n              <div className=\"grid grid-cols-2 gap-4\">\r\n                <div>\r\n                  <p className=\"text-sm text-muted-foreground\">Prioridade</p>\r\n                  {selectedPriority && <Badge className={selectedPriority.color}>{selectedPriority.label}</Badge>}\r\n                </div>\r\n                <div>\r\n                  <p className=\"text-sm text-muted-foreground\">Responsável</p>\r\n                  {selectedPerson && (\r\n                    <div className=\"flex items-center gap-2\">\r\n                      <Avatar className=\"h-6 w-6\">\r\n                        <AvatarImage src={selectedPerson.avatar || \"/placeholder.svg\"} alt={selectedPerson.name} />\r\n                        <AvatarFallback>{selectedPerson.name?.substring(0, 2) || \"??\"}</AvatarFallback>\r\n                      </Avatar>\r\n                      <div>\r\n                        <p className=\"font-medium\">{selectedPerson.name}</p>\r\n                        <p className=\"text-xs text-muted-foreground\">{selectedPerson.email}</p>\r\n                      </div>\r\n                    </div>\r\n                  )}\r\n                </div>\r\n              </div>\r\n\r\n              {selectedTags.length > 0 && (\r\n                <div>\r\n                  <p className=\"text-sm text-muted-foreground\">Tags</p>\r\n                  <div className=\"flex flex-wrap gap-2 mt-1\">\r\n                    {selectedTags.map((tag: any) => (\r\n                      <Badge key={tag.id} style={{ backgroundColor: tag.color, color: \"white\" }}>\r\n                        {tag.name}\r\n                      </Badge>\r\n                    ))}\r\n                  </div>\r\n                </div>\r\n              )}\r\n\r\n              {formData.estimatedValue && (\r\n                <div>\r\n                  <p className=\"text-sm text-muted-foreground\">Valor Estimado</p>\r\n                  <p className=\"font-medium\">R$ {Number.parseFloat(formData.estimatedValue).toLocaleString(\"pt-BR\")}</p>\r\n                </div>\r\n              )}\r\n\r\n              {formData.expectedCloseDate && (\r\n                <div>\r\n                  <p className=\"text-sm text-muted-foreground\">Data Esperada de Fechamento</p>\r\n                  <p className=\"font-medium\">{new Date(formData.expectedCloseDate).toLocaleDateString(\"pt-BR\")}</p>\r\n                </div>\r\n              )}\r\n\r\n              {formData.notes && (\r\n                <div>\r\n                  <p className=\"text-sm text-muted-foreground\">Observações</p>\r\n                  <p className=\"font-medium\">{formData.notes}</p>\r\n                </div>\r\n              )}\r\n            </div>\r\n          </TabsContent>\r\n        </Tabs>\r\n\r\n        <div className=\"flex justify-between pt-4\">\r\n          <Button\r\n            variant=\"outline\"\r\n            onClick={() =>\r\n              setCurrentTab(\r\n                currentTab === \"contact\"\r\n                  ? \"contact\"\r\n                  : currentTab === \"business\"\r\n                    ? \"contact\"\r\n                    : currentTab === \"details\"\r\n                      ? \"business\"\r\n                      : \"details\",\r\n              )\r\n            }\r\n            disabled={currentTab === \"contact\"}\r\n          >\r\n            Anterior\r\n          </Button>\r\n\r\n          <div className=\"flex gap-2\">\r\n            <Button variant=\"outline\" onClick={handleClose}>\r\n              Cancelar\r\n            </Button>\r\n\r\n            {currentTab === \"summary\" ? (\r\n              <Button onClick={handleSubmit}>Criar Lead</Button>\r\n            ) : (\r\n              <Button\r\n                onClick={() =>\r\n                  setCurrentTab(\r\n                    currentTab === \"contact\" ? \"business\" : currentTab === \"business\" ? \"details\" : \"summary\",\r\n                  )\r\n                }\r\n              >\r\n                Próximo\r\n              </Button>\r\n            )}\r\n          </div>\r\n        </div>\r\n      </DialogContent>\r\n    </Dialog>\r\n  )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Projetos\\Back_endCrm\\kanbanproject1\\components\\create-project-dialog.tsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'project' is defined but never used.","line":52,"column":14,"nodeType":"Identifier","messageId":"unusedVar","endLine":52,"endColumn":56,"suggestions":[{"messageId":"removeVar","data":{"varName":"project"},"fix":{"range":[1353,1395],"text":""},"desc":"Remove unused variable 'project'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'module' is defined but never used.","line":65,"column":17,"nodeType":"Identifier","messageId":"unusedVar","endLine":65,"endColumn":43,"suggestions":[{"messageId":"removeVar","data":{"varName":"module"},"fix":{"range":[1670,1696],"text":""},"desc":"Remove unused variable 'module'."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\"\r\n\r\nimport { useState } from \"react\"\r\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from \"@/components/ui/dialog\"\r\nimport { Button } from \"@/components/ui/button\"\r\nimport { Input } from \"@/components/ui/input\"\r\nimport { Label } from \"@/components/ui/label\"\r\nimport { Textarea } from \"@/components/ui/textarea\"\r\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\"\r\nimport { Badge } from \"@/components/ui/badge\"\r\nimport { Card, CardContent } from \"@/components/ui/card\"\r\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\"\r\nimport { Plus, X, User, Calendar, FileText, Settings } from \"lucide-react\"\r\n\r\ntype Module = {\r\n  id: string\r\n  name: string\r\n  description?: string\r\n  color?: string\r\n}\r\n\r\ntype Project = {\r\n  id: string\r\n  title: string\r\n  client: string\r\n  clientEmail?: string\r\n  clientPhone?: string\r\n  clientAddress?: string\r\n  modules: string[]\r\n  status: string\r\n  priority?: string\r\n  deadline?: string\r\n  budget?: number\r\n  description?: string\r\n  leadId?: string\r\n  createdAt: string\r\n  assignedTo?: {\r\n    id: string\r\n    name: string\r\n    avatar: string\r\n  }\r\n  people: Array<{\r\n    id: string\r\n    name: string\r\n    avatar: string\r\n  }>\r\n}\r\n\r\ntype CreateProjectDialogProps = {\r\n  open: boolean\r\n  onClose: () => void\r\n  onCreate: (project: Omit<Project, \"id\" | \"createdAt\">) => void\r\n  columns: Array<{ id: string; name: string; color: string }>\r\n  modules: Array<{\r\n    id: string\r\n    name: string\r\n    description?: string\r\n    color?: string\r\n  }>\r\n  people: Array<{\r\n    id: string\r\n    name: string\r\n    avatar: string\r\n  }>\r\n  onAddModule: (module: Omit<Module, \"id\">) => void\r\n  leadData?: {\r\n    id: string\r\n    title: string\r\n    client: string\r\n    clientEmail?: string\r\n    clientPhone?: string\r\n    estimatedValue?: number\r\n  }\r\n}\r\n\r\nconst moduleColors = [\r\n  { name: \"Azul\", value: \"bg-blue-500\" },\r\n  { name: \"Verde\", value: \"bg-green-500\" },\r\n  { name: \"Roxo\", value: \"bg-purple-500\" },\r\n  { name: \"Laranja\", value: \"bg-orange-500\" },\r\n  { name: \"Rosa\", value: \"bg-pink-500\" },\r\n  { name: \"Vermelho\", value: \"bg-red-500\" },\r\n  { name: \"Amarelo\", value: \"bg-yellow-500\" },\r\n  { name: \"Indigo\", value: \"bg-indigo-500\" },\r\n]\r\n\r\nexport default function CreateProjectDialog({\r\n  open,\r\n  onClose,\r\n  onCreate,\r\n  columns,\r\n  modules,\r\n  people,\r\n  onAddModule,\r\n  leadData,\r\n}: CreateProjectDialogProps) {\r\n  const [currentTab, setCurrentTab] = useState(\"basic\")\r\n  const [showModuleDialog, setShowModuleDialog] = useState(false)\r\n  const [newModule, setNewModule] = useState({\r\n    name: \"\",\r\n    description: \"\",\r\n    color: \"bg-blue-500\",\r\n  })\r\n\r\n  const [formData, setFormData] = useState({\r\n    title: leadData ? `Projeto - ${leadData.client}` : \"\",\r\n    client: leadData?.client || \"\",\r\n    clientEmail: leadData?.clientEmail || \"\",\r\n    clientPhone: leadData?.clientPhone || \"\",\r\n    clientAddress: \"\",\r\n    description: \"\",\r\n    status: columns[0]?.id || \"\",\r\n    priority: \"medium\",\r\n    deadline: \"\",\r\n    budget: leadData?.estimatedValue || 0,\r\n    modules: [] as string[],\r\n    assignedTo: undefined as { id: string; name: string; avatar: string } | undefined,\r\n    people: [] as Array<{ id: string; name: string; avatar: string }>,\r\n    leadId: leadData?.id,\r\n  })\r\n\r\n  const handleSubmit = () => {\r\n    // Validação mínima - apenas título e cliente são obrigatórios\r\n    if (!formData.title.trim() || !formData.client.trim()) return\r\n\r\n    onCreate({\r\n      ...formData,\r\n      people: formData.people.filter(Boolean),\r\n    })\r\n\r\n    // Reset form\r\n    setFormData({\r\n      title: \"\",\r\n      client: \"\",\r\n      clientEmail: \"\",\r\n      clientPhone: \"\",\r\n      clientAddress: \"\",\r\n      description: \"\",\r\n      status: columns[0]?.id || \"\",\r\n      priority: \"medium\",\r\n      deadline: \"\",\r\n      budget: 0,\r\n      modules: [],\r\n      assignedTo: undefined,\r\n      people: [],\r\n    })\r\n    setCurrentTab(\"basic\")\r\n    onClose()\r\n  }\r\n\r\n  const handleCreateModule = () => {\r\n    if (!newModule.name) return\r\n\r\n    onAddModule(newModule)\r\n    setNewModule({ name: \"\", description: \"\", color: \"bg-blue-500\" })\r\n    setShowModuleDialog(false)\r\n  }\r\n\r\n  const addModule = (moduleId: string) => {\r\n    if (!formData.modules.includes(moduleId)) {\r\n      setFormData({\r\n        ...formData,\r\n        modules: [...formData.modules, moduleId],\r\n      })\r\n    }\r\n  }\r\n\r\n  const removeModule = (moduleId: string) => {\r\n    setFormData({\r\n      ...formData,\r\n      modules: formData.modules.filter((id) => id !== moduleId),\r\n    })\r\n  }\r\n\r\n  const addTeamMember = () => {\r\n    setFormData({\r\n      ...formData,\r\n      people: [...formData.people, { id: \"\", name: \"\", avatar: \"\" }],\r\n    })\r\n  }\r\n\r\n  const updateTeamMember = (index: number, personId: string) => {\r\n    const person = people.find((p) => p.id === personId)\r\n    if (person) {\r\n      const newPeople = [...formData.people]\r\n      newPeople[index] = person\r\n      setFormData({ ...formData, people: newPeople })\r\n    }\r\n  }\r\n\r\n  const removeTeamMember = (index: number) => {\r\n    setFormData({\r\n      ...formData,\r\n      people: formData.people.filter((_, i) => i !== index),\r\n    })\r\n  }\r\n\r\n  const canProceed = (tab: string) => {\r\n    switch (tab) {\r\n      case \"basic\":\r\n        return formData.title.trim().length > 0 && formData.client.trim().length > 0\r\n      case \"details\":\r\n        return true\r\n      case \"modules\":\r\n        return true\r\n      case \"team\":\r\n        return true\r\n      case \"review\":\r\n        return formData.title.trim().length > 0 && formData.client.trim().length > 0\r\n      default:\r\n        return true\r\n    }\r\n  }\r\n\r\n  const nextTab = () => {\r\n    const tabs = [\"basic\", \"details\", \"modules\", \"team\", \"review\"]\r\n    const currentIndex = tabs.indexOf(currentTab)\r\n    if (currentIndex < tabs.length - 1) {\r\n      setCurrentTab(tabs[currentIndex + 1])\r\n    }\r\n  }\r\n\r\n  const prevTab = () => {\r\n    const tabs = [\"basic\", \"details\", \"modules\", \"team\", \"review\"]\r\n    const currentIndex = tabs.indexOf(currentTab)\r\n    if (currentIndex > 0) {\r\n      setCurrentTab(tabs[currentIndex - 1])\r\n    }\r\n  }\r\n\r\n  return (\r\n    <>\r\n      <Dialog open={open} onOpenChange={(open) => !open && onClose()}>\r\n        <DialogContent className=\"max-w-2xl max-h-[90vh] overflow-y-auto\">\r\n          <DialogHeader>\r\n            <DialogTitle>{leadData ? `Converter Lead em Projeto - ${leadData.client}` : \"Novo Projeto\"}</DialogTitle>\r\n          </DialogHeader>\r\n\r\n          <Tabs value={currentTab} onValueChange={setCurrentTab} className=\"w-full\">\r\n            <TabsList className=\"grid w-full grid-cols-5\">\r\n              <TabsTrigger value=\"basic\" className=\"flex items-center gap-1\">\r\n                <FileText className=\"h-3 w-3\" />\r\n                Básico\r\n              </TabsTrigger>\r\n              <TabsTrigger value=\"details\" className=\"flex items-center gap-1\">\r\n                <Settings className=\"h-3 w-3\" />\r\n                Detalhes\r\n              </TabsTrigger>\r\n              <TabsTrigger value=\"modules\" className=\"flex items-center gap-1\">\r\n                <Plus className=\"h-3 w-3\" />\r\n                Módulos\r\n              </TabsTrigger>\r\n              <TabsTrigger value=\"team\" className=\"flex items-center gap-1\">\r\n                <User className=\"h-3 w-3\" />\r\n                Equipe\r\n              </TabsTrigger>\r\n              <TabsTrigger value=\"review\" className=\"flex items-center gap-1\">\r\n                <Calendar className=\"h-3 w-3\" />\r\n                Resumo\r\n              </TabsTrigger>\r\n            </TabsList>\r\n\r\n            <div className=\"mt-6\">\r\n              <TabsContent value=\"basic\" className=\"space-y-4\">\r\n                <div className=\"grid grid-cols-2 gap-4\">\r\n                  <div>\r\n                    <Label>Título do Projeto *</Label>\r\n                    <Input\r\n                      value={formData.title}\r\n                      onChange={(e) => setFormData({ ...formData, title: e.target.value })}\r\n                      placeholder=\"Nome do projeto\"\r\n                    />\r\n                  </div>\r\n                  <div>\r\n                    <Label>Cliente *</Label>\r\n                    <Input\r\n                      value={formData.client}\r\n                      onChange={(e) => setFormData({ ...formData, client: e.target.value })}\r\n                      placeholder=\"Nome do cliente\"\r\n                    />\r\n                  </div>\r\n                </div>\r\n\r\n                <div className=\"grid grid-cols-2 gap-4\">\r\n                  <div>\r\n                    <Label>Email do Cliente</Label>\r\n                    <Input\r\n                      value={formData.clientEmail}\r\n                      onChange={(e) => setFormData({ ...formData, clientEmail: e.target.value })}\r\n                      placeholder=\"Email do cliente\"\r\n                    />\r\n                  </div>\r\n                  <div>\r\n                    <Label>Telefone do Cliente</Label>\r\n                    <Input\r\n                      value={formData.clientPhone}\r\n                      onChange={(e) => setFormData({ ...formData, clientPhone: e.target.value })}\r\n                      placeholder=\"Telefone do cliente\"\r\n                    />\r\n                  </div>\r\n                </div>\r\n\r\n                <div>\r\n                  <Label>Descrição</Label>\r\n                  <Textarea\r\n                    value={formData.description}\r\n                    onChange={(e) => setFormData({ ...formData, description: e.target.value })}\r\n                    placeholder=\"Descrição do projeto\"\r\n                    rows={3}\r\n                  />\r\n                </div>\r\n\r\n                <div className=\"grid grid-cols-2 gap-4\">\r\n                  <div>\r\n                    <Label>Status Inicial</Label>\r\n                    <Select\r\n                      value={formData.status}\r\n                      onValueChange={(value) => setFormData({ ...formData, status: value })}\r\n                    >\r\n                      <SelectTrigger>\r\n                        <SelectValue placeholder=\"Selecione o status\" />\r\n                      </SelectTrigger>\r\n                      <SelectContent>\r\n                        {columns.map((column) => (\r\n                          <SelectItem key={column.id} value={column.id}>\r\n                            {column.name}\r\n                          </SelectItem>\r\n                        ))}\r\n                      </SelectContent>\r\n                    </Select>\r\n                  </div>\r\n                  <div>\r\n                    <Label>Prioridade</Label>\r\n                    <Select\r\n                      value={formData.priority}\r\n                      onValueChange={(value: string) => setFormData({ ...formData, priority: value })}\r\n                    >\r\n                      <SelectTrigger>\r\n                        <SelectValue />\r\n                      </SelectTrigger>\r\n                      <SelectContent>\r\n                        <SelectItem value=\"low\">Baixa</SelectItem>\r\n                        <SelectItem value=\"medium\">Média</SelectItem>\r\n                        <SelectItem value=\"high\">Alta</SelectItem>\r\n                        <SelectItem value=\"urgent\">Urgente</SelectItem>\r\n                      </SelectContent>\r\n                    </Select>\r\n                  </div>\r\n                </div>\r\n              </TabsContent>\r\n\r\n              <TabsContent value=\"details\" className=\"space-y-4\">\r\n                <div className=\"grid grid-cols-2 gap-4\">\r\n                  <div>\r\n                    <Label>Data de Entrega</Label>\r\n                    <Input\r\n                      type=\"date\"\r\n                      value={formData.deadline}\r\n                      onChange={(e) => setFormData({ ...formData, deadline: e.target.value })}\r\n                    />\r\n                  </div>\r\n                  <div>\r\n                    <Label>Endereço do Cliente</Label>\r\n                    <Input\r\n                      value={formData.clientAddress}\r\n                      onChange={(e) => setFormData({ ...formData, clientAddress: e.target.value })}\r\n                      placeholder=\"Endereço do cliente\"\r\n                    />\r\n                  </div>\r\n                </div>\r\n\r\n                <div>\r\n                  <Label>Orçamento (R$)</Label>\r\n                  <Input\r\n                    type=\"number\"\r\n                    value={formData.budget}\r\n                    onChange={(e) => setFormData({ ...formData, budget: Number(e.target.value) })}\r\n                    placeholder=\"0,00\"\r\n                  />\r\n                </div>\r\n\r\n                <div>\r\n                  <Label>Responsável Principal</Label>\r\n                  <Select\r\n                    value={formData.assignedTo?.id || \"\"}\r\n                    onValueChange={(value) => {\r\n                      const person = people.find((p) => p.id === value)\r\n                      setFormData({ ...formData, assignedTo: person })\r\n                    }}\r\n                  >\r\n                    <SelectTrigger>\r\n                      <SelectValue placeholder=\"Selecione o responsável\" />\r\n                    </SelectTrigger>\r\n                    <SelectContent>\r\n                      {people.map((person) => (\r\n                        <SelectItem key={person.id} value={person.id}>\r\n                          {person.name}\r\n                        </SelectItem>\r\n                      ))}\r\n                    </SelectContent>\r\n                  </Select>\r\n                </div>\r\n              </TabsContent>\r\n\r\n              <TabsContent value=\"modules\" className=\"space-y-4\">\r\n                <div className=\"flex justify-between items-center\">\r\n                  <h3 className=\"text-lg font-medium\">Módulos do Projeto</h3>\r\n                  <Button variant=\"outline\" onClick={() => setShowModuleDialog(true)}>\r\n                    <Plus className=\"h-4 w-4 mr-2\" />\r\n                    Criar Módulo\r\n                  </Button>\r\n                </div>\r\n\r\n                <p className=\"text-sm text-muted-foreground\">\r\n                  Os módulos são opcionais e podem ser personalizados conforme a necessidade do projeto.\r\n                </p>\r\n\r\n                {modules.length > 0 && (\r\n                  <div>\r\n                    <h4 className=\"font-medium mb-2\">Módulos Disponíveis</h4>\r\n                    <div className=\"grid grid-cols-2 gap-2\">\r\n                      {modules.map((module) => (\r\n                        <Card\r\n                          key={module.id}\r\n                          className=\"cursor-pointer hover:shadow-md transition-shadow\"\r\n                          onClick={() => addModule(module.id)}\r\n                        >\r\n                          <CardContent className=\"p-3\">\r\n                            <div className=\"flex items-center justify-between\">\r\n                              <div className=\"flex items-center\">\r\n                                <div className={`w-3 h-3 rounded-full ${module.color} mr-2`} />\r\n                                <span className=\"font-medium text-sm\">{module.name}</span>\r\n                              </div>\r\n                              <Plus className=\"h-4 w-4 text-muted-foreground\" />\r\n                            </div>\r\n                            {module.description && (\r\n                              <p className=\"text-xs text-muted-foreground mt-1\">{module.description}</p>\r\n                            )}\r\n                          </CardContent>\r\n                        </Card>\r\n                      ))}\r\n                    </div>\r\n                  </div>\r\n                )}\r\n\r\n                {formData.modules.length > 0 && (\r\n                  <div>\r\n                    <h4 className=\"font-medium mb-2\">Módulos Selecionados</h4>\r\n                    <div className=\"space-y-2\">\r\n                      {formData.modules.map((moduleId) => {\r\n                        const module = modules.find((m) => m.id === moduleId)\r\n                        if (!module) return null\r\n                        return (\r\n                          <div key={module.id} className=\"flex items-center justify-between p-2 bg-muted rounded\">\r\n                            <div className=\"flex items-center\">\r\n                              <div className={`w-3 h-3 rounded-full ${module.color} mr-2`} />\r\n                              <span className=\"font-medium\">{module.name}</span>\r\n                            </div>\r\n                            <Button variant=\"ghost\" size=\"sm\" onClick={() => removeModule(moduleId)}>\r\n                              <X className=\"h-4 w-4\" />\r\n                            </Button>\r\n                          </div>\r\n                        )\r\n                      })}\r\n                    </div>\r\n                  </div>\r\n                )}\r\n              </TabsContent>\r\n\r\n              <TabsContent value=\"team\" className=\"space-y-4\">\r\n                <div className=\"flex justify-between items-center\">\r\n                  <h3 className=\"text-lg font-medium\">Equipe do Projeto</h3>\r\n                  <Button variant=\"outline\" onClick={addTeamMember}>\r\n                    <Plus className=\"h-4 w-4 mr-2\" />\r\n                    Adicionar Membro\r\n                  </Button>\r\n                </div>\r\n\r\n                <div className=\"space-y-2\">\r\n                  {formData.people.map((member, index) => (\r\n                    <div key={index} className=\"flex items-center gap-2\">\r\n                      <Select value={member.id} onValueChange={(value) => updateTeamMember(index, value)}>\r\n                        <SelectTrigger>\r\n                          <SelectValue placeholder=\"Selecione um membro\" />\r\n                        </SelectTrigger>\r\n                        <SelectContent>\r\n                          {people.map((person) => (\r\n                            <SelectItem key={person.id} value={person.id}>\r\n                              {person.name}\r\n                            </SelectItem>\r\n                          ))}\r\n                        </SelectContent>\r\n                      </Select>\r\n                      <Button variant=\"ghost\" size=\"sm\" onClick={() => removeTeamMember(index)}>\r\n                        <X className=\"h-4 w-4\" />\r\n                      </Button>\r\n                    </div>\r\n                  ))}\r\n                </div>\r\n\r\n                {formData.people.length === 0 && (\r\n                  <p className=\"text-sm text-muted-foreground text-center py-4\">\r\n                    Nenhum membro da equipe adicionado. Clique em \"Adicionar Membro\" para começar.\r\n                  </p>\r\n                )}\r\n              </TabsContent>\r\n\r\n              <TabsContent value=\"review\" className=\"space-y-4\">\r\n                <h3 className=\"text-lg font-medium\">Resumo do Projeto</h3>\r\n\r\n                <div className=\"space-y-4\">\r\n                  <div className=\"grid grid-cols-2 gap-4\">\r\n                    <div>\r\n                      <Label className=\"text-sm font-medium\">Título</Label>\r\n                      <p className=\"text-sm\">{formData.title || \"Não informado\"}</p>\r\n                    </div>\r\n                    <div>\r\n                      <Label className=\"text-sm font-medium\">Cliente</Label>\r\n                      <p className=\"text-sm\">{formData.client || \"Não informado\"}</p>\r\n                    </div>\r\n                  </div>\r\n\r\n                  <div className=\"grid grid-cols-2 gap-4\">\r\n                    <div>\r\n                      <Label className=\"text-sm font-medium\">Email do Cliente</Label>\r\n                      <p className=\"text-sm\">{formData.clientEmail || \"Não informado\"}</p>\r\n                    </div>\r\n                    <div>\r\n                      <Label className=\"text-sm font-medium\">Telefone do Cliente</Label>\r\n                      <p className=\"text-sm\">{formData.clientPhone || \"Não informado\"}</p>\r\n                    </div>\r\n                  </div>\r\n\r\n                  <div className=\"grid grid-cols-2 gap-4\">\r\n                    <div>\r\n                      <Label className=\"text-sm font-medium\">Endereço do Cliente</Label>\r\n                      <p className=\"text-sm\">{formData.clientAddress || \"Não informado\"}</p>\r\n                    </div>\r\n                    <div>\r\n                      <Label className=\"text-sm font-medium\">Responsável Principal</Label>\r\n                      <p className=\"text-sm\">{formData.assignedTo?.name || \"Não informado\"}</p>\r\n                    </div>\r\n                  </div>\r\n\r\n                  {formData.description && (\r\n                    <div>\r\n                      <Label className=\"text-sm font-medium\">Descrição</Label>\r\n                      <p className=\"text-sm\">{formData.description}</p>\r\n                    </div>\r\n                  )}\r\n\r\n                  <div className=\"grid grid-cols-2 gap-4\">\r\n                    <div>\r\n                      <Label className=\"text-sm font-medium\">Prioridade</Label>\r\n                      <Badge\r\n                        className={\r\n                          formData.priority === \"urgent\"\r\n                            ? \"bg-red-100 text-red-800\"\r\n                            : formData.priority === \"high\"\r\n                              ? \"bg-orange-100 text-orange-800\"\r\n                              : formData.priority === \"medium\"\r\n                                ? \"bg-yellow-100 text-yellow-800\"\r\n                                : \"bg-blue-100 text-blue-800\"\r\n                        }\r\n                      >\r\n                        {formData.priority === \"urgent\"\r\n                          ? \"Urgente\"\r\n                          : formData.priority === \"high\"\r\n                            ? \"Alta\"\r\n                            : formData.priority === \"medium\"\r\n                              ? \"Média\"\r\n                              : \"Baixa\"}\r\n                      </Badge>\r\n                    </div>\r\n                    <div>\r\n                      <Label className=\"text-sm font-medium\">Orçamento</Label>\r\n                      <p className=\"text-sm\">\r\n                        {formData.budget > 0 ? `R$ ${formData.budget.toLocaleString(\"pt-BR\")}` : \"Não informado\"}\r\n                      </p>\r\n                    </div>\r\n                  </div>\r\n\r\n                  {formData.modules.length > 0 && (\r\n                    <div>\r\n                      <Label className=\"text-sm font-medium\">Módulos ({formData.modules.length})</Label>\r\n                      <div className=\"flex flex-wrap gap-1 mt-1\">\r\n                        {formData.modules.map((moduleId) => {\r\n                          const module = modules.find((m) => m.id === moduleId)\r\n                          if (!module) return null\r\n                          return (\r\n                            <Badge key={module.id} variant=\"outline\" className=\"text-xs\">\r\n                              <div className={`w-2 h-2 rounded-full ${module.color} mr-1`} />\r\n                              {module.name}\r\n                            </Badge>\r\n                          )\r\n                        })}\r\n                      </div>\r\n                    </div>\r\n                  )}\r\n\r\n                  {formData.people.filter(Boolean).length > 0 && (\r\n                    <div>\r\n                      <Label className=\"text-sm font-medium\">Equipe ({formData.people.filter(Boolean).length})</Label>\r\n                      <div className=\"flex flex-wrap gap-1 mt-1\">\r\n                        {formData.people.filter(Boolean).map((member, index) => (\r\n                          <Badge key={index} variant=\"outline\" className=\"text-xs\">\r\n                            {member.name}\r\n                          </Badge>\r\n                        ))}\r\n                      </div>\r\n                    </div>\r\n                  )}\r\n                </div>\r\n              </TabsContent>\r\n            </div>\r\n\r\n            <div className=\"flex justify-between pt-6\">\r\n              <Button variant=\"outline\" onClick={prevTab} disabled={currentTab === \"basic\"}>\r\n                Anterior\r\n              </Button>\r\n\r\n              <div className=\"flex gap-2\">\r\n                <Button variant=\"outline\" onClick={onClose}>\r\n                  Cancelar\r\n                </Button>\r\n                {currentTab === \"review\" ? (\r\n                  <Button onClick={handleSubmit} disabled={!canProceed(currentTab)}>\r\n                    Criar Projeto\r\n                  </Button>\r\n                ) : (\r\n                  <Button onClick={nextTab} disabled={!canProceed(currentTab)}>\r\n                    Próximo\r\n                  </Button>\r\n                )}\r\n              </div>\r\n            </div>\r\n          </Tabs>\r\n        </DialogContent>\r\n      </Dialog>\r\n\r\n      {/* Dialog para criar módulo personalizado */}\r\n      <Dialog open={showModuleDialog} onOpenChange={setShowModuleDialog}>\r\n        <DialogContent className=\"max-w-md\">\r\n          <DialogHeader>\r\n            <DialogTitle>Criar Módulo Personalizado</DialogTitle>\r\n          </DialogHeader>\r\n\r\n          <div className=\"space-y-4\">\r\n            <div>\r\n              <Label>Nome do Módulo *</Label>\r\n              <Input\r\n                value={newModule.name}\r\n                onChange={(e) => setNewModule({ ...newModule, name: e.target.value })}\r\n                placeholder=\"Ex: Desenvolvimento Frontend\"\r\n              />\r\n            </div>\r\n\r\n            <div>\r\n              <Label>Descrição</Label>\r\n              <Textarea\r\n                value={newModule.description}\r\n                onChange={(e) => setNewModule({ ...newModule, description: e.target.value })}\r\n                placeholder=\"Descrição do módulo\"\r\n                rows={2}\r\n              />\r\n            </div>\r\n\r\n            <div>\r\n              <Label>Cor</Label>\r\n              <div className=\"grid grid-cols-4 gap-2 mt-2\">\r\n                {moduleColors.map((color) => (\r\n                  <button\r\n                    key={color.value}\r\n                    type=\"button\"\r\n                    className={`w-full h-8 rounded ${color.value} ${\r\n                      newModule.color === color.value ? \"ring-2 ring-offset-2 ring-gray-400\" : \"\"\r\n                    }`}\r\n                    onClick={() => setNewModule({ ...newModule, color: color.value })}\r\n                    title={color.name}\r\n                  />\r\n                ))}\r\n              </div>\r\n            </div>\r\n\r\n            <div className=\"flex justify-end gap-2 pt-4\">\r\n              <Button variant=\"outline\" onClick={() => setShowModuleDialog(false)}>\r\n                Cancelar\r\n              </Button>\r\n              <Button onClick={handleCreateModule} disabled={!newModule.name}>\r\n                Criar Módulo\r\n              </Button>\r\n            </div>\r\n          </div>\r\n        </DialogContent>\r\n      </Dialog>\r\n    </>\r\n  )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Projetos\\Back_endCrm\\kanbanproject1\\components\\dashboard.tsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'period' is defined but never used.","line":74,"column":20,"nodeType":"Identifier","messageId":"unusedVar","endLine":74,"endColumn":55,"suggestions":[{"messageId":"removeVar","data":{"varName":"period"},"fix":{"range":[1853,1888],"text":""},"desc":"Remove unused variable 'period'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'setLeads' is assigned a value but never used.","line":85,"column":17,"nodeType":"Identifier","messageId":"unusedVar","endLine":85,"endColumn":25,"suggestions":[{"messageId":"removeVar","data":{"varName":"setLeads"},"fix":{"range":[2330,2340],"text":""},"desc":"Remove unused variable 'setLeads'."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'setLeads' is assigned a value but never used.","line":85,"column":17,"nodeType":null,"messageId":"unusedVar","endLine":85,"endColumn":25},{"ruleId":"no-unused-vars","severity":1,"message":"'setTasks' is assigned a value but never used.","line":86,"column":17,"nodeType":"Identifier","messageId":"unusedVar","endLine":86,"endColumn":25,"suggestions":[{"messageId":"removeVar","data":{"varName":"setTasks"},"fix":{"range":[2380,2390],"text":""},"desc":"Remove unused variable 'setTasks'."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'setTasks' is assigned a value but never used.","line":86,"column":17,"nodeType":null,"messageId":"unusedVar","endLine":86,"endColumn":25},{"ruleId":"no-unused-vars","severity":1,"message":"'index' is defined but never used.","line":594,"column":52,"nodeType":"Identifier","messageId":"unusedVar","endLine":594,"endColumn":57,"suggestions":[{"messageId":"removeVar","data":{"varName":"index"},"fix":{"range":[23575,23582],"text":""},"desc":"Remove unused variable 'index'."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'index' is defined but never used.","line":594,"column":52,"nodeType":null,"messageId":"unusedVar","endLine":594,"endColumn":57}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":7,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\"\r\n\r\nimport { useState, useMemo, useEffect } from \"react\"\r\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\"\r\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\"\r\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\"\r\nimport { Button } from \"@/components/ui/button\"\r\nimport { Progress } from \"@/components/ui/progress\"\r\nimport LeadsMovementDashboard from \"./leads-movement-dashboard\"\r\nimport { loadFromStorage } from \"@/lib/storage\"\r\nimport { useApiAuth } from \"@/hooks/use-api-auth\"\r\nimport {\r\n  TrendingUp,\r\n  Users,\r\n  DollarSign,\r\n  Target,\r\n  Clock,\r\n  CheckCircle,\r\n  AlertCircle,\r\n  Activity,\r\n  Award,\r\n  Phone,\r\n  ArrowUp,\r\n  PieChartIcon,\r\n  BarChart3,\r\n  Filter,\r\n} from \"lucide-react\"\r\n\r\n// Tipos\r\ntype Lead = {\r\n  id: string\r\n  name: string\r\n  company: string\r\n  status: string\r\n  priority: \"low\" | \"medium\" | \"high\" | \"urgent\"\r\n  source: string\r\n  estimatedValue: number\r\n  expectedCloseDate: string\r\n  createdAt: string\r\n  funnelId?: string // Novo campo para identificar o funil\r\n}\r\n\r\ntype Task = {\r\n  id: string\r\n  title: string\r\n  status: \"pending\" | \"in_progress\" | \"completed\" | \"cancelled\"\r\n  priority: \"low\" | \"medium\" | \"high\" | \"urgent\"\r\n  dueDate?: string\r\n  createdAt: string\r\n  leadId?: string\r\n  funnelId?: string // Novo campo para identificar o funil\r\n}\r\n\r\ntype Funnel = {\r\n  id: string\r\n  name: string\r\n  description: string\r\n  columns: Array<{\r\n    id: string\r\n    name: string\r\n    color: string\r\n    order: number\r\n  }>\r\n  isActive: boolean\r\n  createdAt: string\r\n}\r\n\r\ntype DashboardProps = {\r\n  leads: Lead[]\r\n  projects: any[] // Mantemos para compatibilidade, mas não usamos\r\n  tasks: Task[]\r\n  funnels: Funnel[] // Nova prop para os funis\r\n  period: \"7d\" | \"30d\" | \"90d\" | \"1y\"\r\n  onPeriodChange: (period: \"7d\" | \"30d\" | \"90d\" | \"1y\") => void\r\n}\r\n\r\nconst COLORS = [\"#0088FE\", \"#00C49F\", \"#FFBB28\", \"#FF8042\", \"#8884D8\", \"#FF6B6B\"]\r\n\r\nexport default function Dashboard({ period, onPeriodChange }: DashboardProps) {\r\n  const { user } = useApiAuth()\r\n  const [activeTab, setActiveTab] = useState(\"overview\")\r\n  const [viewMode, setViewMode] = useState<\"standard\" | \"pizza\">(\"standard\")\r\n  const [selectedFunnelId, setSelectedFunnelId] = useState<string>(\"all\")\r\n\r\n  const [leads, setLeads] = useState<Lead[]>([])\r\n  const [tasks, setTasks] = useState<Task[]>([])\r\n  const [funnels, setFunnels] = useState<Funnel[]>([])\r\n\r\n  useEffect(() => {\r\n    let mounted = true\r\n    const load = async () => {\r\n      try {\r\n        // Load funnels from storage (UI only) while backend provides stats\r\n        const storedFunnels = loadFromStorage(\"funnels\", [])\r\n        const validFunnels = Array.isArray(storedFunnels) ? storedFunnels : []\r\n        if (mounted) setFunnels(validFunnels)\r\n\r\n        // Fetch stats/charts from backend\r\n        const params: Record<string, any> = { period }\r\n        if (user?.companyId) params.companyId = user.companyId\r\n        if (selectedFunnelId && selectedFunnelId !== \"all\") params.funnelId = selectedFunnelId\r\n        const resp = await (await import(\"@/lib/api-client\")).apiClient.get<any>(`/dashboard/leads`, params)\r\n\r\n        // Derive minimal local lists for compatibility, if needed\r\n        // Use backend stats directly in UI via state replacement\r\n        if (mounted) {\r\n          // Patch computed memo sources by injecting backend values\r\n          (window as any).__dashboard_backend__ = resp\r\n        }\r\n      } catch (e) {\r\n        console.error(\"[v0] Failed to load dashboard from backend:\", e)\r\n      }\r\n    }\r\n    load()\r\n    return () => { mounted = false }\r\n  }, [period, selectedFunnelId, user?.companyId])\r\n\r\n  const filteredData = useMemo(() => {\r\n    console.log(\"[v0] Filtering data for funnel:\", selectedFunnelId)\r\n    console.log(\"[v0] Available leads:\", leads.length)\r\n    console.log(\"[v0] Available tasks:\", tasks.length)\r\n\r\n    if (selectedFunnelId === \"all\") {\r\n      return {\r\n        leads: leads,\r\n        tasks: tasks,\r\n        selectedFunnel: null,\r\n      }\r\n    }\r\n\r\n    const selectedFunnel = funnels.find((f) => f.id === selectedFunnelId)\r\n    const funnelLeads = leads.filter((lead) => lead.funnelId === selectedFunnelId)\r\n    const funnelTasks = tasks.filter((task) => task.funnelId === selectedFunnelId)\r\n\r\n    console.log(\"[v0] Filtered leads for funnel:\", funnelLeads.length)\r\n    console.log(\"[v0] Filtered tasks for funnel:\", funnelTasks.length)\r\n\r\n    return {\r\n      leads: funnelLeads,\r\n      tasks: funnelTasks,\r\n      selectedFunnel,\r\n    }\r\n  }, [leads, tasks, funnels, selectedFunnelId])\r\n\r\n  const stats = useMemo(() => {\r\n    const backend = (typeof window !== \"undefined\" && (window as any).__dashboard_backend__) || null\r\n    if (backend?.stats) return backend.stats\r\n    const { leads: filteredLeads, tasks: filteredTasks, selectedFunnel } = filteredData\r\n    console.log(\"[v0] Calculating stats for\", filteredLeads.length, \"leads\")\r\n\r\n    const now = new Date()\r\n    const periodDays = period === \"7d\" ? 7 : period === \"30d\" ? 30 : period === \"90d\" ? 90 : 365\r\n    const periodStart = new Date(now.getTime() - periodDays * 24 * 60 * 60 * 1000)\r\n\r\n    // Leads calculations\r\n    const totalLeads = filteredLeads.length\r\n    const newLeads = filteredLeads.filter((lead) => new Date(lead.createdAt) >= periodStart).length\r\n\r\n    // Better status mapping for conversion detection\r\n    const wonStatuses = [\"ganho\", \"won\", \"fechado\", \"vendido\", \"convertido\"]\r\n    const convertedLeads = filteredLeads.filter((lead) =>\r\n      wonStatuses.some((status) => lead.status.toLowerCase().includes(status.toLowerCase())),\r\n    ).length\r\n\r\n    const conversionRate = totalLeads > 0 ? (convertedLeads / totalLeads) * 100 : 0\r\n    const totalLeadValue = filteredLeads.reduce((sum, lead) => sum + (lead.estimatedValue || 0), 0)\r\n    const avgLeadValue = totalLeads > 0 ? totalLeadValue / totalLeads : 0\r\n\r\n    // Enhanced status mapping using funnel columns\r\n    const statusCounts = {\r\n      qualified: 0,\r\n      proposal: 0,\r\n      negotiation: 0,\r\n      lost: 0,\r\n      new: 0,\r\n    }\r\n\r\n    if (selectedFunnel && selectedFunnel.columns) {\r\n      // Use actual funnel columns for more accurate counting\r\n      selectedFunnel.columns.forEach((column) => {\r\n        const columnLeads = filteredLeads.filter((lead) => lead.status === column.id)\r\n        statusCounts[column.id as keyof typeof statusCounts] = columnLeads.length\r\n      })\r\n    } else {\r\n      // Fallback to generic status mapping\r\n      const qualifiedStatuses = [\"qualificado\", \"qualified\", \"interessado\"]\r\n      const proposalStatuses = [\"proposta\", \"proposal\", \"orcamento\"]\r\n      const negotiationStatuses = [\"negociacao\", \"negotiation\", \"fechamento\"]\r\n      const lostStatuses = [\"perdido\", \"lost\", \"cancelado\"]\r\n      const newStatuses = [\"novo\", \"new\", \"lead\", \"contato\"]\r\n\r\n      statusCounts.qualified = filteredLeads.filter((lead) =>\r\n        qualifiedStatuses.some((status) => lead.status.toLowerCase().includes(status.toLowerCase())),\r\n      ).length\r\n\r\n      statusCounts.proposal = filteredLeads.filter((lead) =>\r\n        proposalStatuses.some((status) => lead.status.toLowerCase().includes(status.toLowerCase())),\r\n      ).length\r\n\r\n      statusCounts.negotiation = filteredLeads.filter((lead) =>\r\n        negotiationStatuses.some((status) => lead.status.toLowerCase().includes(status.toLowerCase())),\r\n      ).length\r\n\r\n      statusCounts.lost = filteredLeads.filter((lead) =>\r\n        lostStatuses.some((status) => lead.status.toLowerCase().includes(status.toLowerCase())),\r\n      ).length\r\n\r\n      statusCounts.new = filteredLeads.filter((lead) =>\r\n        newStatuses.some((status) => lead.status.toLowerCase().includes(status.toLowerCase())),\r\n      ).length\r\n    }\r\n\r\n    // Tasks calculations\r\n    const totalTasks = filteredTasks.length\r\n    const completedTasks = filteredTasks.filter((task) => task.status === \"completed\").length\r\n    const pendingTasks = filteredTasks.filter((task) => task.status === \"pending\").length\r\n    const overdueTasks = filteredTasks.filter(\r\n      (task) => task.dueDate && new Date(task.dueDate) < now && task.status !== \"completed\",\r\n    ).length\r\n\r\n    const calculatedStats = {\r\n      leads: {\r\n        total: totalLeads,\r\n        new: newLeads,\r\n        converted: convertedLeads,\r\n        conversionRate,\r\n        totalValue: totalLeadValue,\r\n        avgValue: avgLeadValue,\r\n        qualified: statusCounts.qualified,\r\n        proposal: statusCounts.proposal,\r\n        negotiation: statusCounts.negotiation,\r\n        lost: statusCounts.lost,\r\n        newCount: statusCounts.new,\r\n      },\r\n      tasks: {\r\n        total: totalTasks,\r\n        completed: completedTasks,\r\n        pending: pendingTasks,\r\n        overdue: overdueTasks,\r\n        completionRate: totalTasks > 0 ? (completedTasks / totalTasks) * 100 : 0,\r\n      },\r\n    }\r\n\r\n    console.log(\"[v0] Calculated stats:\", calculatedStats)\r\n    return calculatedStats\r\n  }, [filteredData, period])\r\n\r\n  // Dados para gráficos simplificados baseados no funil selecionado\r\n  const chartData = useMemo(() => {\r\n    const backend = (typeof window !== \"undefined\" && (window as any).__dashboard_backend__) || null\r\n    if (backend?.charts) return backend.charts\r\n    const { leads: filteredLeads, selectedFunnel } = filteredData\r\n\r\n    // Leads por status (usando colunas do funil se selecionado)\r\n    const leadsByStatus = filteredLeads.reduce(\r\n      (acc, lead) => {\r\n        acc[lead.status] = (acc[lead.status] || 0) + 1\r\n        return acc\r\n      },\r\n      {} as Record<string, number>,\r\n    )\r\n\r\n    const leadStatusData = Object.entries(leadsByStatus).map(([status, count]) => {\r\n      let statusName = status\r\n\r\n      // Se há um funil selecionado, usar os nomes das colunas\r\n      if (selectedFunnel) {\r\n        const column = selectedFunnel.columns.find((col) => col.id === status)\r\n        statusName = column ? column.name : status\r\n      } else {\r\n        // Mapeamento padrão\r\n        statusName =\r\n          status === \"novo\" || status === \"new\"\r\n            ? \"Novos\"\r\n            : status === \"qualificado\" || status === \"qualified\"\r\n              ? \"Qualificados\"\r\n              : status === \"proposta\" || status === \"proposal\"\r\n                ? \"Proposta\"\r\n                : status === \"negociacao\" || status === \"negotiation\"\r\n                  ? \"Negociação\"\r\n                  : status === \"ganho\" || status === \"won\"\r\n                    ? \"Ganhos\"\r\n                    : status === \"perdido\" || status === \"lost\"\r\n                      ? \"Perdidos\"\r\n                      : status\r\n      }\r\n\r\n      return {\r\n        name: statusName,\r\n        value: count,\r\n        percentage: filteredLeads.length > 0 ? ((count / filteredLeads.length) * 100).toFixed(1) : \"0\",\r\n      }\r\n    })\r\n\r\n    // Leads por origem\r\n    const leadsBySource = filteredLeads.reduce(\r\n      (acc, lead) => {\r\n        acc[lead.source] = (acc[lead.source] || 0) + 1\r\n        return acc\r\n      },\r\n      {} as Record<string, number>,\r\n    )\r\n\r\n    const leadSourceData = Object.entries(leadsBySource).map(([source, count]) => ({\r\n      name:\r\n        source === \"website\"\r\n          ? \"Website\"\r\n          : source === \"google_ads\"\r\n            ? \"Google Ads\"\r\n            : source === \"referral\"\r\n              ? \"Indicação\"\r\n              : source === \"linkedin\"\r\n                ? \"LinkedIn\"\r\n                : source === \"phone\"\r\n                  ? \"Telefone\"\r\n                  : source,\r\n      value: count,\r\n      percentage: filteredLeads.length > 0 ? ((count / filteredLeads.length) * 100).toFixed(1) : \"0\",\r\n    }))\r\n\r\n    // Leads por valor\r\n    const leadValueRanges = [\r\n      { range: \"0-25k\", min: 0, max: 25000 },\r\n      { range: \"25k-50k\", min: 25000, max: 50000 },\r\n      { range: \"50k-100k\", min: 50000, max: 100000 },\r\n      { range: \"100k+\", min: 100000, max: Number.POSITIVE_INFINITY },\r\n    ]\r\n\r\n    const leadValueData = leadValueRanges.map(({ range, min, max }) => {\r\n      const count = filteredLeads.filter((lead) => lead.estimatedValue >= min && lead.estimatedValue < max).length\r\n      return {\r\n        name: range,\r\n        value: count,\r\n        percentage: filteredLeads.length > 0 ? ((count / filteredLeads.length) * 100).toFixed(1) : \"0\",\r\n      }\r\n    })\r\n\r\n    return {\r\n      leadStatus: leadStatusData,\r\n      leadSource: leadSourceData,\r\n      leadValue: leadValueData,\r\n    }\r\n  }, [filteredData])\r\n\r\n  // Se o modo pizza estiver ativo, renderizar o dashboard de pizza\r\n  if (viewMode === \"pizza\") {\r\n    return (\r\n      <div className=\"space-y-6\">\r\n        <div className=\"flex justify-between items-center\">\r\n          <div>\r\n            <h1 className=\"text-3xl font-bold\">Dashboard CRM</h1>\r\n            <p className=\"text-muted-foreground\">\r\n              Visão geral do seu pipeline de vendas\r\n              {filteredData.selectedFunnel && (\r\n                <span className=\"ml-2 text-blue-600\">• {filteredData.selectedFunnel.name}</span>\r\n              )}\r\n            </p>\r\n          </div>\r\n          <div className=\"flex items-center space-x-2\">\r\n            <Select value={selectedFunnelId} onValueChange={setSelectedFunnelId}>\r\n              <SelectTrigger className=\"w-48\">\r\n                <SelectValue placeholder=\"Selecionar funil\" />\r\n              </SelectTrigger>\r\n              <SelectContent>\r\n                <SelectItem value=\"all\">\r\n                  <div className=\"flex items-center gap-2\">\r\n                    <Filter className=\"h-4 w-4\" />\r\n                    Todos os Funis\r\n                  </div>\r\n                </SelectItem>\r\n                {funnels.map((funnel) => (\r\n                  <SelectItem key={funnel.id} value={funnel.id}>\r\n                    <div className=\"flex items-center gap-2\">\r\n                      <div className=\"w-3 h-3 rounded-full bg-blue-500\" />\r\n                      {funnel.name}\r\n                    </div>\r\n                  </SelectItem>\r\n                ))}\r\n              </SelectContent>\r\n            </Select>\r\n            <Button\r\n              variant={viewMode === \"standard\" ? \"default\" : \"outline\"}\r\n              size=\"sm\"\r\n              onClick={() => setViewMode(\"standard\")}\r\n            >\r\n              <BarChart3 className=\"h-4 w-4 mr-2\" />\r\n              Padrão\r\n            </Button>\r\n            <Button\r\n              variant={viewMode === \"pizza\" ? \"default\" : \"outline\"}\r\n              size=\"sm\"\r\n              onClick={() => setViewMode(\"pizza\")}\r\n            >\r\n              <PieChartIcon className=\"h-4 w-4 mr-2\" />\r\n              Pizza\r\n            </Button>\r\n            <Select value={period} onValueChange={onPeriodChange}>\r\n              <SelectTrigger className=\"w-32\">\r\n                <SelectValue />\r\n              </SelectTrigger>\r\n              <SelectContent>\r\n                <SelectItem value=\"7d\">7 dias</SelectItem>\r\n                <SelectItem value=\"30d\">30 dias</SelectItem>\r\n                <SelectItem value=\"90d\">90 dias</SelectItem>\r\n                <SelectItem value=\"1y\">1 ano</SelectItem>\r\n              </SelectContent>\r\n            </Select>\r\n          </div>\r\n        </div>\r\n\r\n        <LeadsMovementDashboard leads={filteredData.leads} period={period} onPeriodChange={onPeriodChange} />\r\n      </div>\r\n    )\r\n  }\r\n\r\n  return (\r\n    <div className=\"space-y-6\">\r\n      {/* Header */}\r\n      <div className=\"flex justify-between items-center\">\r\n        <div>\r\n          <h1 className=\"text-3xl font-bold\">Dashboard CRM</h1>\r\n          <p className=\"text-muted-foreground\">\r\n            Visão geral do seu pipeline de vendas\r\n            {filteredData.selectedFunnel && (\r\n              <span className=\"ml-2 text-blue-600\">• {filteredData.selectedFunnel.name}</span>\r\n            )}\r\n          </p>\r\n        </div>\r\n        <div className=\"flex items-center space-x-2\">\r\n          <Select value={selectedFunnelId} onValueChange={setSelectedFunnelId}>\r\n            <SelectTrigger className=\"w-48\">\r\n              <SelectValue placeholder=\"Selecionar funil\" />\r\n            </SelectTrigger>\r\n            <SelectContent>\r\n              <SelectItem value=\"all\">\r\n                <div className=\"flex items-center gap-2\">\r\n                  <Filter className=\"h-4 w-4\" />\r\n                  Todos os Funis\r\n                </div>\r\n              </SelectItem>\r\n              {funnels.map((funnel) => (\r\n                <SelectItem key={funnel.id} value={funnel.id}>\r\n                  <div className=\"flex items-center gap-2\">\r\n                    <div className=\"w-3 h-3 rounded-full bg-blue-500\" />\r\n                    {funnel.name}\r\n                  </div>\r\n                </SelectItem>\r\n              ))}\r\n            </SelectContent>\r\n          </Select>\r\n          <Button\r\n            variant={viewMode === \"standard\" ? \"default\" : \"outline\"}\r\n            size=\"sm\"\r\n            onClick={() => setViewMode(\"standard\")}\r\n          >\r\n            <BarChart3 className=\"h-4 w-4 mr-2\" />\r\n            Padrão\r\n          </Button>\r\n          <Button variant={viewMode === \"pizza\" ? \"default\" : \"outline\"} size=\"sm\" onClick={() => setViewMode(\"pizza\")}>\r\n            <PieChartIcon className=\"h-4 w-4 mr-2\" />\r\n            Pizza\r\n          </Button>\r\n          <Select value={period} onValueChange={onPeriodChange}>\r\n            <SelectTrigger className=\"w-32\">\r\n              <SelectValue />\r\n            </SelectTrigger>\r\n            <SelectContent>\r\n              <SelectItem value=\"7d\">7 dias</SelectItem>\r\n              <SelectItem value=\"30d\">30 dias</SelectItem>\r\n              <SelectItem value=\"90d\">90 dias</SelectItem>\r\n              <SelectItem value=\"1y\">1 ano</SelectItem>\r\n            </SelectContent>\r\n          </Select>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Indicador de funil selecionado */}\r\n      {filteredData.selectedFunnel && (\r\n        <Card className=\"border-blue-200 bg-blue-50\">\r\n          <CardContent className=\"p-4\">\r\n            <div className=\"flex items-center justify-between\">\r\n              <div className=\"flex items-center space-x-3\">\r\n                <div className=\"w-4 h-4 rounded-full bg-blue-500\" />\r\n                <div>\r\n                  <h3 className=\"font-medium text-blue-900\">{filteredData.selectedFunnel.name}</h3>\r\n                  <p className=\"text-sm text-blue-700\">{filteredData.selectedFunnel.description}</p>\r\n                </div>\r\n              </div>\r\n              <div className=\"text-sm text-blue-600\">\r\n                {filteredData.leads.length} leads • {filteredData.tasks.length} tarefas\r\n              </div>\r\n            </div>\r\n          </CardContent>\r\n        </Card>\r\n      )}\r\n\r\n      <Tabs value={activeTab} onValueChange={setActiveTab} className=\"w-full\">\r\n        <TabsList className=\"grid w-full grid-cols-3\">\r\n          <TabsTrigger value=\"overview\">Visão Geral</TabsTrigger>\r\n          <TabsTrigger value=\"leads\">Análise de Leads</TabsTrigger>\r\n          <TabsTrigger value=\"tasks\">Gestão de Tarefas</TabsTrigger>\r\n        </TabsList>\r\n\r\n        <TabsContent value=\"overview\" className=\"space-y-6\">\r\n          {/* Cards de estatísticas principais */}\r\n          <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4\">\r\n            <Card>\r\n              <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\r\n                <CardTitle className=\"text-sm font-medium\">Total de Leads</CardTitle>\r\n                <Users className=\"h-4 w-4 text-muted-foreground\" />\r\n              </CardHeader>\r\n              <CardContent>\r\n                <div className=\"text-2xl font-bold\">{stats.leads.total}</div>\r\n                <p className=\"text-xs text-muted-foreground flex items-center\">\r\n                  <ArrowUp className=\"h-3 w-3 text-green-600 mr-1\" />\r\n                  <span className=\"text-green-600\">+{stats.leads.new}</span> novos no período\r\n                </p>\r\n              </CardContent>\r\n            </Card>\r\n\r\n            <Card>\r\n              <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\r\n                <CardTitle className=\"text-sm font-medium\">Taxa de Conversão</CardTitle>\r\n                <Target className=\"h-4 w-4 text-muted-foreground\" />\r\n              </CardHeader>\r\n              <CardContent>\r\n                <div className=\"text-2xl font-bold\">{stats.leads.conversionRate.toFixed(1)}%</div>\r\n                <p className=\"text-xs text-muted-foreground\">{stats.leads.converted} leads convertidos</p>\r\n                <Progress value={stats.leads.conversionRate} className=\"mt-2\" />\r\n              </CardContent>\r\n            </Card>\r\n\r\n            <Card>\r\n              <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\r\n                <CardTitle className=\"text-sm font-medium\">Valor Total Pipeline</CardTitle>\r\n                <DollarSign className=\"h-4 w-4 text-muted-foreground\" />\r\n              </CardHeader>\r\n              <CardContent>\r\n                <div className=\"text-2xl font-bold\">R$ {stats.leads.totalValue.toLocaleString(\"pt-BR\")}</div>\r\n                <p className=\"text-xs text-muted-foreground\">\r\n                  Média: R$ {stats.leads.avgValue.toLocaleString(\"pt-BR\")}\r\n                </p>\r\n              </CardContent>\r\n            </Card>\r\n\r\n            <Card>\r\n              <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\r\n                <CardTitle className=\"text-sm font-medium\">Leads Qualificados</CardTitle>\r\n                <Award className=\"h-4 w-4 text-muted-foreground\" />\r\n              </CardHeader>\r\n              <CardContent>\r\n                <div className=\"text-2xl font-bold\">{stats.leads.qualified}</div>\r\n                <p className=\"text-xs text-muted-foreground\">Prontos para proposta</p>\r\n              </CardContent>\r\n            </Card>\r\n          </div>\r\n\r\n          {/* Gráficos principais - versão simplificada */}\r\n          <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\r\n            <Card>\r\n              <CardHeader>\r\n                <CardTitle>Distribuição de Leads por Status</CardTitle>\r\n                {filteredData.selectedFunnel && (\r\n                  <p className=\"text-sm text-muted-foreground\">Funil: {filteredData.selectedFunnel.name}</p>\r\n                )}\r\n              </CardHeader>\r\n              <CardContent>\r\n                <div className=\"space-y-4\">\r\n                  {chartData.leadStatus.map((item, index) => (\r\n                    <div key={item.name} className=\"flex items-center justify-between\">\r\n                      <div className=\"flex items-center space-x-2\">\r\n                        <div\r\n                          className=\"w-3 h-3 rounded-full\"\r\n                          style={{ backgroundColor: COLORS[index % COLORS.length] }}\r\n                        />\r\n                        <span className=\"text-sm font-medium\">{item.name}</span>\r\n                      </div>\r\n                      <div className=\"flex items-center space-x-2\">\r\n                        <span className=\"text-sm text-muted-foreground\">{item.percentage}%</span>\r\n                        <span className=\"text-sm font-bold\">{item.value}</span>\r\n                      </div>\r\n                    </div>\r\n                  ))}\r\n                </div>\r\n              </CardContent>\r\n            </Card>\r\n\r\n            <Card>\r\n              <CardHeader>\r\n                <CardTitle>Leads por Origem</CardTitle>\r\n              </CardHeader>\r\n              <CardContent>\r\n                <div className=\"space-y-4\">\r\n                  {chartData.leadSource.map((item, index) => (\r\n                    <div key={item.name} className=\"space-y-2\">\r\n                      <div className=\"flex items-center justify-between\">\r\n                        <span className=\"text-sm font-medium\">{item.name}</span>\r\n                        <span className=\"text-sm text-muted-foreground\">\r\n                          {item.value} ({item.percentage}%)\r\n                        </span>\r\n                      </div>\r\n                      <Progress value={Number.parseFloat(item.percentage)} className=\"h-2\" />\r\n                    </div>\r\n                  ))}\r\n                </div>\r\n              </CardContent>\r\n            </Card>\r\n          </div>\r\n\r\n          {/* Cards de pipeline */}\r\n          <div className=\"grid grid-cols-1 md:grid-cols-4 gap-4\">\r\n            <Card>\r\n              <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\r\n                <CardTitle className=\"text-sm font-medium\">Em Proposta</CardTitle>\r\n                <Phone className=\"h-4 w-4 text-blue-600\" />\r\n              </CardHeader>\r\n              <CardContent>\r\n                <div className=\"text-2xl font-bold\">{stats.leads.proposal}</div>\r\n                <p className=\"text-xs text-muted-foreground\">Aguardando resposta</p>\r\n              </CardContent>\r\n            </Card>\r\n\r\n            <Card>\r\n              <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\r\n                <CardTitle className=\"text-sm font-medium\">Em Negociação</CardTitle>\r\n                <Activity className=\"h-4 w-4 text-orange-600\" />\r\n              </CardHeader>\r\n              <CardContent>\r\n                <div className=\"text-2xl font-bold\">{stats.leads.negotiation}</div>\r\n                <p className=\"text-xs text-muted-foreground\">Próximos ao fechamento</p>\r\n              </CardContent>\r\n            </Card>\r\n\r\n            <Card>\r\n              <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\r\n                <CardTitle className=\"text-sm font-medium\">Leads Ganhos</CardTitle>\r\n                <CheckCircle className=\"h-4 w-4 text-green-600\" />\r\n              </CardHeader>\r\n              <CardContent>\r\n                <div className=\"text-2xl font-bold\">{stats.leads.converted}</div>\r\n                <p className=\"text-xs text-muted-foreground\">Fechamentos realizados</p>\r\n              </CardContent>\r\n            </Card>\r\n\r\n            <Card>\r\n              <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\r\n                <CardTitle className=\"text-sm font-medium\">Leads Perdidos</CardTitle>\r\n                <AlertCircle className=\"h-4 w-4 text-red-600\" />\r\n              </CardHeader>\r\n              <CardContent>\r\n                <div className=\"text-2xl font-bold\">{stats.leads.lost}</div>\r\n                <p className=\"text-xs text-muted-foreground\">Oportunidades perdidas</p>\r\n              </CardContent>\r\n            </Card>\r\n          </div>\r\n        </TabsContent>\r\n\r\n        <TabsContent value=\"leads\" className=\"space-y-6\">\r\n          {/* Estatísticas detalhadas de Leads */}\r\n          <div className=\"grid grid-cols-1 md:grid-cols-4 gap-4\">\r\n            <Card>\r\n              <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\r\n                <CardTitle className=\"text-sm font-medium\">Total de Leads</CardTitle>\r\n                <Users className=\"h-4 w-4 text-muted-foreground\" />\r\n              </CardHeader>\r\n              <CardContent>\r\n                <div className=\"text-2xl font-bold\">{stats.leads.total}</div>\r\n                <p className=\"text-xs text-muted-foreground\">Todos os leads cadastrados</p>\r\n              </CardContent>\r\n            </Card>\r\n\r\n            <Card>\r\n              <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\r\n                <CardTitle className=\"text-sm font-medium\">Novos Leads</CardTitle>\r\n                <TrendingUp className=\"h-4 w-4 text-green-600\" />\r\n              </CardHeader>\r\n              <CardContent>\r\n                <div className=\"text-2xl font-bold\">{stats.leads.new}</div>\r\n                <p className=\"text-xs text-muted-foreground\">No período selecionado</p>\r\n              </CardContent>\r\n            </Card>\r\n\r\n            <Card>\r\n              <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\r\n                <CardTitle className=\"text-sm font-medium\">Taxa de Conversão</CardTitle>\r\n                <Target className=\"h-4 w-4 text-blue-600\" />\r\n              </CardHeader>\r\n              <CardContent>\r\n                <div className=\"text-2xl font-bold\">{stats.leads.conversionRate.toFixed(1)}%</div>\r\n                <p className=\"text-xs text-muted-foreground\">{stats.leads.converted} convertidos</p>\r\n                <Progress value={stats.leads.conversionRate} className=\"mt-2\" />\r\n              </CardContent>\r\n            </Card>\r\n\r\n            <Card>\r\n              <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\r\n                <CardTitle className=\"text-sm font-medium\">Valor Médio</CardTitle>\r\n                <DollarSign className=\"h-4 w-4 text-green-600\" />\r\n              </CardHeader>\r\n              <CardContent>\r\n                <div className=\"text-2xl font-bold\">R$ {stats.leads.avgValue.toLocaleString(\"pt-BR\")}</div>\r\n                <p className=\"text-xs text-muted-foreground\">Por lead</p>\r\n              </CardContent>\r\n            </Card>\r\n          </div>\r\n\r\n          {/* Análise detalhada de leads */}\r\n          <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\r\n            <Card>\r\n              <CardHeader>\r\n                <CardTitle>Análise por Origem</CardTitle>\r\n              </CardHeader>\r\n              <CardContent>\r\n                <div className=\"space-y-4\">\r\n                  {chartData.leadSource.map((item, index) => (\r\n                    <div key={item.name} className=\"space-y-2\">\r\n                      <div className=\"flex items-center justify-between\">\r\n                        <div className=\"flex items-center space-x-2\">\r\n                          <div\r\n                            className=\"w-3 h-3 rounded-full\"\r\n                            style={{ backgroundColor: COLORS[index % COLORS.length] }}\r\n                          />\r\n                          <span className=\"text-sm font-medium\">{item.name}</span>\r\n                        </div>\r\n                        <span className=\"text-sm text-muted-foreground\">\r\n                          {item.value} leads ({item.percentage}%)\r\n                        </span>\r\n                      </div>\r\n                      <Progress value={Number.parseFloat(item.percentage)} className=\"h-2\" />\r\n                    </div>\r\n                  ))}\r\n                </div>\r\n              </CardContent>\r\n            </Card>\r\n\r\n            <Card>\r\n              <CardHeader>\r\n                <CardTitle>Distribuição por Valor</CardTitle>\r\n              </CardHeader>\r\n              <CardContent>\r\n                <div className=\"space-y-4\">\r\n                  {chartData.leadValue.map((item, index) => (\r\n                    <div key={item.name} className=\"space-y-2\">\r\n                      <div className=\"flex items-center justify-between\">\r\n                        <div className=\"flex items-center space-x-2\">\r\n                          <div\r\n                            className=\"w-3 h-3 rounded-full\"\r\n                            style={{ backgroundColor: COLORS[index % COLORS.length] }}\r\n                          />\r\n                          <span className=\"text-sm font-medium\">R$ {item.name}</span>\r\n                        </div>\r\n                        <span className=\"text-sm text-muted-foreground\">\r\n                          {item.value} leads ({item.percentage}%)\r\n                        </span>\r\n                      </div>\r\n                      <Progress value={Number.parseFloat(item.percentage)} className=\"h-2\" />\r\n                    </div>\r\n                  ))}\r\n                </div>\r\n              </CardContent>\r\n            </Card>\r\n          </div>\r\n\r\n          {/* Funil de conversão */}\r\n          <Card>\r\n            <CardHeader>\r\n              <CardTitle>Funil de Conversão</CardTitle>\r\n              {filteredData.selectedFunnel && (\r\n                <p className=\"text-sm text-muted-foreground\">Funil: {filteredData.selectedFunnel.name}</p>\r\n              )}\r\n            </CardHeader>\r\n            <CardContent>\r\n              <div className=\"space-y-4\">\r\n                <div className=\"grid grid-cols-5 gap-4\">\r\n                  <div className=\"text-center\">\r\n                    <div className=\"text-2xl font-bold text-gray-600\">{stats.leads.newCount}</div>\r\n                    <div className=\"text-sm text-muted-foreground\">Novos</div>\r\n                    <div className=\"w-full bg-gray-200 rounded-full h-2 mt-2\">\r\n                      <div className=\"bg-gray-600 h-2 rounded-full w-full\" />\r\n                    </div>\r\n                  </div>\r\n                  <div className=\"text-center\">\r\n                    <div className=\"text-2xl font-bold text-blue-600\">{stats.leads.qualified}</div>\r\n                    <div className=\"text-sm text-muted-foreground\">Qualificados</div>\r\n                    <div className=\"w-full bg-gray-200 rounded-full h-2 mt-2\">\r\n                      <div\r\n                        className=\"bg-blue-600 h-2 rounded-full\"\r\n                        style={{\r\n                          width: `${stats.leads.newCount > 0 ? (stats.leads.qualified / stats.leads.newCount) * 100 : 0}%`,\r\n                        }}\r\n                      />\r\n                    </div>\r\n                  </div>\r\n                  <div className=\"text-center\">\r\n                    <div className=\"text-2xl font-bold text-yellow-600\">{stats.leads.proposal}</div>\r\n                    <div className=\"text-sm text-muted-foreground\">Proposta</div>\r\n                    <div className=\"w-full bg-gray-200 rounded-full h-2 mt-2\">\r\n                      <div\r\n                        className=\"bg-yellow-600 h-2 rounded-full\"\r\n                        style={{\r\n                          width: `${stats.leads.qualified > 0 ? (stats.leads.proposal / stats.leads.qualified) * 100 : 0}%`,\r\n                        }}\r\n                      />\r\n                    </div>\r\n                  </div>\r\n                  <div className=\"text-center\">\r\n                    <div className=\"text-2xl font-bold text-orange-600\">{stats.leads.negotiation}</div>\r\n                    <div className=\"text-sm text-muted-foreground\">Negociação</div>\r\n                    <div className=\"w-full bg-gray-200 rounded-full h-2 mt-2\">\r\n                      <div\r\n                        className=\"bg-orange-600 h-2 rounded-full\"\r\n                        style={{\r\n                          width: `${stats.leads.proposal > 0 ? (stats.leads.negotiation / stats.leads.proposal) * 100 : 0}%`,\r\n                        }}\r\n                      />\r\n                    </div>\r\n                  </div>\r\n                  <div className=\"text-center\">\r\n                    <div className=\"text-2xl font-bold text-green-600\">{stats.leads.converted}</div>\r\n                    <div className=\"text-sm text-muted-foreground\">Fechados</div>\r\n                    <div className=\"w-full bg-gray-200 rounded-full h-2 mt-2\">\r\n                      <div\r\n                        className=\"bg-green-600 h-2 rounded-full\"\r\n                        style={{\r\n                          width: `${stats.leads.negotiation > 0 ? (stats.leads.converted / stats.leads.negotiation) * 100 : 0}%`,\r\n                        }}\r\n                      />\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            </CardContent>\r\n          </Card>\r\n        </TabsContent>\r\n\r\n        <TabsContent value=\"tasks\" className=\"space-y-6\">\r\n          {/* Estatísticas de Tarefas */}\r\n          <div className=\"grid grid-cols-1 md:grid-cols-4 gap-4\">\r\n            <Card>\r\n              <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\r\n                <CardTitle className=\"text-sm font-medium\">Total de Tarefas</CardTitle>\r\n                <CheckCircle className=\"h-4 w-4 text-muted-foreground\" />\r\n              </CardHeader>\r\n              <CardContent>\r\n                <div className=\"text-2xl font-bold\">{stats.tasks.total}</div>\r\n                <p className=\"text-xs text-muted-foreground\">Todas as tarefas</p>\r\n              </CardContent>\r\n            </Card>\r\n\r\n            <Card>\r\n              <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\r\n                <CardTitle className=\"text-sm font-medium\">Concluídas</CardTitle>\r\n                <CheckCircle className=\"h-4 w-4 text-green-600\" />\r\n              </CardHeader>\r\n              <CardContent>\r\n                <div className=\"text-2xl font-bold\">{stats.tasks.completed}</div>\r\n                <p className=\"text-xs text-muted-foreground\">{stats.tasks.completionRate.toFixed(1)}% de conclusão</p>\r\n                <Progress value={stats.tasks.completionRate} className=\"mt-2\" />\r\n              </CardContent>\r\n            </Card>\r\n\r\n            <Card>\r\n              <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\r\n                <CardTitle className=\"text-sm font-medium\">Pendentes</CardTitle>\r\n                <Clock className=\"h-4 w-4 text-yellow-600\" />\r\n              </CardHeader>\r\n              <CardContent>\r\n                <div className=\"text-2xl font-bold\">{stats.tasks.pending}</div>\r\n                <p className=\"text-xs text-muted-foreground\">Aguardando execução</p>\r\n              </CardContent>\r\n            </Card>\r\n\r\n            <Card>\r\n              <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\r\n                <CardTitle className=\"text-sm font-medium\">Atrasadas</CardTitle>\r\n                <AlertCircle className=\"h-4 w-4 text-red-600\" />\r\n              </CardHeader>\r\n              <CardContent>\r\n                <div className=\"text-2xl font-bold\">{stats.tasks.overdue}</div>\r\n                <p className=\"text-xs text-muted-foreground\">Requerem atenção imediata</p>\r\n              </CardContent>\r\n            </Card>\r\n          </div>\r\n\r\n          {/* Gráfico de Performance de Tarefas */}\r\n          <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\r\n            <Card>\r\n              <CardHeader>\r\n                <CardTitle>Performance de Tarefas</CardTitle>\r\n              </CardHeader>\r\n              <CardContent>\r\n                <div className=\"space-y-4\">\r\n                  <div className=\"flex items-center justify-between\">\r\n                    <span className=\"text-sm font-medium\">Taxa de Conclusão</span>\r\n                    <span className=\"text-sm text-muted-foreground\">{stats.tasks.completionRate.toFixed(1)}%</span>\r\n                  </div>\r\n                  <Progress value={stats.tasks.completionRate} className=\"h-3\" />\r\n\r\n                  <div className=\"grid grid-cols-2 gap-4 mt-6\">\r\n                    <div className=\"text-center p-4 bg-green-50 rounded-lg\">\r\n                      <div className=\"text-2xl font-bold text-green-600\">{stats.tasks.completed}</div>\r\n                      <div className=\"text-sm text-muted-foreground\">Concluídas</div>\r\n                    </div>\r\n                    <div className=\"text-center p-4 bg-red-50 rounded-lg\">\r\n                      <div className=\"text-2xl font-bold text-red-600\">{stats.tasks.overdue}</div>\r\n                      <div className=\"text-sm text-muted-foreground\">Atrasadas</div>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              </CardContent>\r\n            </Card>\r\n\r\n            <Card>\r\n              <CardHeader>\r\n                <CardTitle>Distribuição de Tarefas</CardTitle>\r\n              </CardHeader>\r\n              <CardContent>\r\n                <div className=\"space-y-4\">\r\n                  <div className=\"space-y-2\">\r\n                    <div className=\"flex items-center justify-between\">\r\n                      <div className=\"flex items-center space-x-2\">\r\n                        <div className=\"w-3 h-3 rounded-full bg-green-500\" />\r\n                        <span className=\"text-sm font-medium\">Concluídas</span>\r\n                      </div>\r\n                      <span className=\"text-sm text-muted-foreground\">\r\n                        {stats.tasks.completed} ({stats.tasks.completionRate.toFixed(1)}%)\r\n                      </span>\r\n                    </div>\r\n                    <Progress value={stats.tasks.completionRate} className=\"h-2\" />\r\n                  </div>\r\n\r\n                  <div className=\"space-y-2\">\r\n                    <div className=\"flex items-center justify-between\">\r\n                      <div className=\"flex items-center space-x-2\">\r\n                        <div className=\"w-3 h-3 rounded-full bg-yellow-500\" />\r\n                        <span className=\"text-sm font-medium\">Pendentes</span>\r\n                      </div>\r\n                      <span className=\"text-sm text-muted-foreground\">\r\n                        {stats.tasks.pending} (\r\n                        {stats.tasks.total > 0 ? ((stats.tasks.pending / stats.tasks.total) * 100).toFixed(1) : 0}%)\r\n                      </span>\r\n                    </div>\r\n                    <Progress\r\n                      value={stats.tasks.total > 0 ? (stats.tasks.pending / stats.tasks.total) * 100 : 0}\r\n                      className=\"h-2\"\r\n                    />\r\n                  </div>\r\n\r\n                  <div className=\"space-y-2\">\r\n                    <div className=\"flex items-center justify-between\">\r\n                      <div className=\"flex items-center space-x-2\">\r\n                        <div className=\"w-3 h-3 rounded-full bg-red-500\" />\r\n                        <span className=\"text-sm font-medium\">Atrasadas</span>\r\n                      </div>\r\n                      <span className=\"text-sm text-muted-foreground\">\r\n                        {stats.tasks.overdue} (\r\n                        {stats.tasks.total > 0 ? ((stats.tasks.overdue / stats.tasks.total) * 100).toFixed(1) : 0}%)\r\n                      </span>\r\n                    </div>\r\n                    <Progress\r\n                      value={stats.tasks.total > 0 ? (stats.tasks.overdue / stats.tasks.total) * 100 : 0}\r\n                      className=\"h-2\"\r\n                    />\r\n                  </div>\r\n                </div>\r\n              </CardContent>\r\n            </Card>\r\n          </div>\r\n        </TabsContent>\r\n      </Tabs>\r\n    </div>\r\n  )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Projetos\\Back_endCrm\\kanbanproject1\\components\\donut-chart.tsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'index' is defined but never used.","line":120,"column":29,"nodeType":"Identifier","messageId":"unusedVar","endLine":120,"endColumn":34,"suggestions":[{"messageId":"removeVar","data":{"varName":"index"},"fix":{"range":[3230,3237],"text":""},"desc":"Remove unused variable 'index'."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'index' is defined but never used.","line":120,"column":29,"nodeType":null,"messageId":"unusedVar","endLine":120,"endColumn":34}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\"\r\n\r\nimport { useMemo } from \"react\"\r\n\r\ntype DonutChartData = {\r\n  name: string\r\n  value: number\r\n  percentage: string\r\n}\r\n\r\ntype DonutChartProps = {\r\n  data: DonutChartData[]\r\n  colors: string[]\r\n  width?: number\r\n  height?: number\r\n  showLabels?: boolean\r\n  showLegend?: boolean\r\n  innerRadius?: number\r\n}\r\n\r\nexport default function DonutChart({\r\n  data,\r\n  colors,\r\n  width = 400,\r\n  height = 300,\r\n  showLabels = true,\r\n  showLegend = true,\r\n  innerRadius = 0.4,\r\n}: DonutChartProps) {\r\n  const { slices, total } = useMemo(() => {\r\n    const total = data.reduce((sum, item) => sum + item.value, 0)\r\n    let currentAngle = 0\r\n\r\n    const slices = data.map((item, index) => {\r\n      const percentage = total > 0 ? (item.value / total) * 100 : 0\r\n      const angle = (percentage / 100) * 360\r\n      const startAngle = currentAngle\r\n      const endAngle = currentAngle + angle\r\n\r\n      currentAngle += angle\r\n\r\n      return {\r\n        ...item,\r\n        percentage,\r\n        angle,\r\n        startAngle,\r\n        endAngle,\r\n        color: colors[index % colors.length],\r\n      }\r\n    })\r\n\r\n    return { slices, total }\r\n  }, [data, colors])\r\n\r\n  const outerRadius = Math.min(width, height) / 2 - 40\r\n  const innerRadiusValue = outerRadius * innerRadius\r\n  const centerX = width / 2\r\n  const centerY = height / 2\r\n\r\n  const createPath = (startAngle: number, endAngle: number, outerRadius: number, innerRadius: number) => {\r\n    const outerStart = polarToCartesian(centerX, centerY, outerRadius, endAngle)\r\n    const outerEnd = polarToCartesian(centerX, centerY, outerRadius, startAngle)\r\n    const innerStart = polarToCartesian(centerX, centerY, innerRadius, endAngle)\r\n    const innerEnd = polarToCartesian(centerX, centerY, innerRadius, startAngle)\r\n\r\n    const largeArcFlag = endAngle - startAngle <= 180 ? \"0\" : \"1\"\r\n\r\n    return [\r\n      \"M\",\r\n      outerStart.x,\r\n      outerStart.y,\r\n      \"A\",\r\n      outerRadius,\r\n      outerRadius,\r\n      0,\r\n      largeArcFlag,\r\n      0,\r\n      outerEnd.x,\r\n      outerEnd.y,\r\n      \"L\",\r\n      innerEnd.x,\r\n      innerEnd.y,\r\n      \"A\",\r\n      innerRadius,\r\n      innerRadius,\r\n      0,\r\n      largeArcFlag,\r\n      1,\r\n      innerStart.x,\r\n      innerStart.y,\r\n      \"Z\",\r\n    ].join(\" \")\r\n  }\r\n\r\n  const polarToCartesian = (centerX: number, centerY: number, radius: number, angleInDegrees: number) => {\r\n    const angleInRadians = ((angleInDegrees - 90) * Math.PI) / 180.0\r\n    return {\r\n      x: centerX + radius * Math.cos(angleInRadians),\r\n      y: centerY + radius * Math.sin(angleInRadians),\r\n    }\r\n  }\r\n\r\n  const getLabelPosition = (startAngle: number, endAngle: number, radius: number) => {\r\n    const midAngle = (startAngle + endAngle) / 2\r\n    const labelRadius = (radius + innerRadiusValue) / 2\r\n    return polarToCartesian(centerX, centerY, labelRadius, midAngle)\r\n  }\r\n\r\n  if (total === 0) {\r\n    return (\r\n      <div className=\"flex items-center justify-center\" style={{ width, height }}>\r\n        <p className=\"text-muted-foreground\">Nenhum dado disponível</p>\r\n      </div>\r\n    )\r\n  }\r\n\r\n  return (\r\n    <div className=\"flex flex-col items-center space-y-4\">\r\n      <svg width={width} height={height} className=\"overflow-visible\">\r\n        {slices.map((slice, index) => (\r\n          <g key={slice.name}>\r\n            <path\r\n              d={createPath(slice.startAngle, slice.endAngle, outerRadius, innerRadiusValue)}\r\n              fill={slice.color}\r\n              stroke=\"white\"\r\n              strokeWidth=\"2\"\r\n              className=\"hover:opacity-80 transition-opacity cursor-pointer\"\r\n            />\r\n            {showLabels && slice.percentage > 5 && (\r\n              <text\r\n                x={getLabelPosition(slice.startAngle, slice.endAngle, outerRadius).x}\r\n                y={getLabelPosition(slice.startAngle, slice.endAngle, outerRadius).y}\r\n                textAnchor=\"middle\"\r\n                dominantBaseline=\"middle\"\r\n                className=\"fill-white text-xs font-medium\"\r\n                style={{ textShadow: \"1px 1px 2px rgba(0,0,0,0.7)\" }}\r\n              >\r\n                {slice.percentage.toFixed(1)}%\r\n              </text>\r\n            )}\r\n          </g>\r\n        ))}\r\n\r\n        {/* Centro do donut com informações */}\r\n        <g>\r\n          <text\r\n            x={centerX}\r\n            y={centerY - 10}\r\n            textAnchor=\"middle\"\r\n            dominantBaseline=\"middle\"\r\n            className=\"fill-gray-900 text-2xl font-bold\"\r\n          >\r\n            {total}\r\n          </text>\r\n          <text\r\n            x={centerX}\r\n            y={centerY + 10}\r\n            textAnchor=\"middle\"\r\n            dominantBaseline=\"middle\"\r\n            className=\"fill-gray-600 text-sm\"\r\n          >\r\n            Total\r\n          </text>\r\n        </g>\r\n      </svg>\r\n\r\n      {showLegend && (\r\n        <div className=\"grid grid-cols-2 gap-2 max-w-md\">\r\n          {slices.map((slice) => (\r\n            <div key={slice.name} className=\"flex items-center space-x-2\">\r\n              <div className=\"w-3 h-3 rounded-full\" style={{ backgroundColor: slice.color }} />\r\n              <span className=\"text-sm truncate\">{slice.name}</span>\r\n              <span className=\"text-xs text-muted-foreground\">({slice.value})</span>\r\n            </div>\r\n          ))}\r\n        </div>\r\n      )}\r\n    </div>\r\n  )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Projetos\\Back_endCrm\\kanbanproject1\\components\\funnel-manager.tsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'funnels' is defined but never used.","line":69,"column":12,"nodeType":"Identifier","messageId":"unusedVar","endLine":69,"endColumn":29,"suggestions":[{"messageId":"removeVar","data":{"varName":"funnels"},"fix":{"range":[1636,1653],"text":""},"desc":"Remove unused variable 'funnels'."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\"\r\n\r\nimport { useState } from \"react\"\r\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from \"@/components/ui/dialog\"\r\nimport { Button } from \"@/components/ui/button\"\r\nimport { Input } from \"@/components/ui/input\"\r\nimport { Label } from \"@/components/ui/label\"\r\nimport { Textarea } from \"@/components/ui/textarea\"\r\nimport { Badge } from \"@/components/ui/badge\"\r\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\"\r\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\"\r\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\"\r\nimport { Switch } from \"@/components/ui/switch\"\r\nimport { toast } from \"@/hooks/use-toast\"\r\nimport { DragDropContext, Droppable, Draggable } from \"@hello-pangea/dnd\"\r\nimport {\r\n  Plus,\r\n  Edit,\r\n  Trash2,\r\n  Copy,\r\n  Target,\r\n  Users,\r\n  Briefcase,\r\n  Heart,\r\n  Star,\r\n  TrendingUp,\r\n  Building,\r\n  Handshake,\r\n  GripVertical,\r\n  X,\r\n} from \"lucide-react\"\r\n\r\ntype Funnel = {\r\n  id: string\r\n  name: string\r\n  description: string\r\n  category: string\r\n  icon: string\r\n  columns: Array<{\r\n    id: string\r\n    name: string\r\n    color: string\r\n    order: number\r\n    description?: string\r\n    visible?: boolean\r\n    limit?: number\r\n  }>\r\n  isActive: boolean\r\n  createdAt: string\r\n}\r\n\r\ntype FunnelTemplate = {\r\n  id: string\r\n  name: string\r\n  description: string\r\n  category: string\r\n  icon: string\r\n  columns: Array<{\r\n    id: string\r\n    name: string\r\n    color: string\r\n    order: number\r\n    description?: string\r\n  }>\r\n}\r\n\r\ninterface FunnelManagerProps {\r\n  funnels: Funnel[]\r\n  onSave: (funnels: Funnel[]) => void\r\n  onClose: () => void\r\n}\r\n\r\n// Templates predefinidos\r\nconst funnelTemplates: FunnelTemplate[] = [\r\n  {\r\n    id: \"template1\",\r\n    name: \"Vendas B2B Tradicional\",\r\n    description: \"Funil clássico para vendas corporativas\",\r\n    category: \"Vendas\",\r\n    icon: \"briefcase\",\r\n    columns: [\r\n      { id: \"lead\", name: \"Lead\", color: \"#64748b\", order: 0, description: \"Novos contatos identificados\" },\r\n      {\r\n        id: \"qualificado\",\r\n        name: \"Qualificado\",\r\n        color: \"#3b82f6\",\r\n        order: 1,\r\n        description: \"Leads com potencial confirmado\",\r\n      },\r\n      { id: \"proposta\", name: \"Proposta\", color: \"#f59e0b\", order: 2, description: \"Proposta comercial enviada\" },\r\n      { id: \"negociacao\", name: \"Negociação\", color: \"#8b5cf6\", order: 3, description: \"Em processo de negociação\" },\r\n      { id: \"fechamento\", name: \"Fechamento\", color: \"#10b981\", order: 4, description: \"Venda concluída\" },\r\n      { id: \"perdido\", name: \"Perdido\", color: \"#ef4444\", order: 5, description: \"Oportunidade perdida\" },\r\n    ],\r\n  },\r\n  {\r\n    id: \"template2\",\r\n    name: \"Vendas B2C Rápidas\",\r\n    description: \"Funil otimizado para vendas diretas ao consumidor\",\r\n    category: \"Vendas\",\r\n    icon: \"users\",\r\n    columns: [\r\n      { id: \"interesse\", name: \"Interesse\", color: \"#64748b\", order: 0, description: \"Cliente demonstrou interesse\" },\r\n      {\r\n        id: \"contato\",\r\n        name: \"Primeiro Contato\",\r\n        color: \"#3b82f6\",\r\n        order: 1,\r\n        description: \"Primeiro contato realizado\",\r\n      },\r\n      { id: \"apresentacao\", name: \"Apresentação\", color: \"#f59e0b\", order: 2, description: \"Produto apresentado\" },\r\n      { id: \"fechamento\", name: \"Fechamento\", color: \"#10b981\", order: 3, description: \"Venda finalizada\" },\r\n      { id: \"perdido\", name: \"Perdido\", color: \"#ef4444\", order: 4, description: \"Não converteu\" },\r\n    ],\r\n  },\r\n  {\r\n    id: \"template3\",\r\n    name: \"Parcerias Estratégicas\",\r\n    description: \"Desenvolvimento de parcerias comerciais\",\r\n    category: \"Parcerias\",\r\n    icon: \"handshake\",\r\n    columns: [\r\n      { id: \"prospeccao\", name: \"Prospecção\", color: \"#64748b\", order: 0, description: \"Identificação de parceiros\" },\r\n      {\r\n        id: \"contato_inicial\",\r\n        name: \"Contato Inicial\",\r\n        color: \"#3b82f6\",\r\n        order: 1,\r\n        description: \"Primeiro contato estabelecido\",\r\n      },\r\n      { id: \"avaliacao\", name: \"Avaliação\", color: \"#f59e0b\", order: 2, description: \"Avaliação mútua de fit\" },\r\n      { id: \"negociacao\", name: \"Negociação\", color: \"#8b5cf6\", order: 3, description: \"Termos sendo negociados\" },\r\n      { id: \"acordo\", name: \"Acordo\", color: \"#10b981\", order: 4, description: \"Parceria estabelecida\" },\r\n      { id: \"rejeitado\", name: \"Rejeitado\", color: \"#ef4444\", order: 5, description: \"Parceria não estabelecida\" },\r\n    ],\r\n  },\r\n  {\r\n    id: \"template4\",\r\n    name: \"Atendimento ao Cliente\",\r\n    description: \"Gestão de tickets de suporte\",\r\n    category: \"Suporte\",\r\n    icon: \"heart\",\r\n    columns: [\r\n      { id: \"aberto\", name: \"Aberto\", color: \"#64748b\", order: 0, description: \"Ticket criado\" },\r\n      { id: \"em_andamento\", name: \"Em Andamento\", color: \"#3b82f6\", order: 1, description: \"Sendo analisado\" },\r\n      { id: \"aguardando\", name: \"Aguardando Cliente\", color: \"#f59e0b\", order: 2, description: \"Aguardando resposta\" },\r\n      { id: \"resolvido\", name: \"Resolvido\", color: \"#10b981\", order: 3, description: \"Problema solucionado\" },\r\n      { id: \"fechado\", name: \"Fechado\", color: \"#6b7280\", order: 4, description: \"Ticket finalizado\" },\r\n    ],\r\n  },\r\n  {\r\n    id: \"template5\",\r\n    name: \"Recrutamento\",\r\n    description: \"Processo seletivo de candidatos\",\r\n    category: \"RH\",\r\n    icon: \"star\",\r\n    columns: [\r\n      { id: \"candidatura\", name: \"Candidatura\", color: \"#64748b\", order: 0, description: \"Candidato se inscreveu\" },\r\n      { id: \"triagem\", name: \"Triagem\", color: \"#3b82f6\", order: 1, description: \"Análise inicial do perfil\" },\r\n      {\r\n        id: \"entrevista\",\r\n        name: \"Entrevista\",\r\n        color: \"#f59e0b\",\r\n        order: 2,\r\n        description: \"Entrevista agendada/realizada\",\r\n      },\r\n      { id: \"teste\", name: \"Teste Técnico\", color: \"#8b5cf6\", order: 3, description: \"Avaliação técnica\" },\r\n      { id: \"aprovado\", name: \"Aprovado\", color: \"#10b981\", order: 4, description: \"Candidato selecionado\" },\r\n      { id: \"reprovado\", name: \"Reprovado\", color: \"#ef4444\", order: 5, description: \"Candidato não selecionado\" },\r\n    ],\r\n  },\r\n]\r\n\r\n// Cores disponíveis\r\nconst availableColors = [\r\n  \"#64748b\",\r\n  \"#3b82f6\",\r\n  \"#f59e0b\",\r\n  \"#8b5cf6\",\r\n  \"#10b981\",\r\n  \"#ef4444\",\r\n  \"#06b6d4\",\r\n  \"#84cc16\",\r\n  \"#f97316\",\r\n  \"#ec4899\",\r\n  \"#6366f1\",\r\n  \"#14b8a6\",\r\n  \"#f59e0b\",\r\n  \"#8b5cf6\",\r\n  \"#ef4444\",\r\n  \"#10b981\",\r\n  \"#64748b\",\r\n]\r\n\r\n// Ícones disponíveis\r\nconst availableIcons = [\r\n  { id: \"target\", name: \"Alvo\", icon: Target },\r\n  { id: \"users\", name: \"Usuários\", icon: Users },\r\n  { id: \"briefcase\", name: \"Maleta\", icon: Briefcase },\r\n  { id: \"heart\", name: \"Coração\", icon: Heart },\r\n  { id: \"star\", name: \"Estrela\", icon: Star },\r\n  { id: \"trending-up\", name: \"Crescimento\", icon: TrendingUp },\r\n  { id: \"building\", name: \"Prédio\", icon: Building },\r\n  { id: \"handshake\", name: \"Aperto de Mão\", icon: Handshake },\r\n]\r\n\r\nexport default function FunnelManager({ funnels, onSave, onClose }: FunnelManagerProps) {\r\n  const [localFunnels, setLocalFunnels] = useState<Funnel[]>(funnels)\r\n  const [showCreateDialog, setShowCreateDialog] = useState(false)\r\n  const [editingFunnel, setEditingFunnel] = useState<Funnel | null>(null)\r\n  const [activeTab, setActiveTab] = useState(\"funnels\")\r\n\r\n  // Estados para criação/edição\r\n  const [funnelName, setFunnelName] = useState(\"\")\r\n  const [funnelDescription, setFunnelDescription] = useState(\"\")\r\n  const [funnelCategory, setFunnelCategory] = useState(\"\")\r\n  const [funnelIcon, setFunnelIcon] = useState(\"target\")\r\n  const [funnelColumns, setFunnelColumns] = useState<\r\n    Array<{\r\n      id: string\r\n      name: string\r\n      color: string\r\n      order: number\r\n      description?: string\r\n    }>\r\n  >([])\r\n\r\n  const handleCreateFunnel = () => {\r\n    setFunnelName(\"\")\r\n    setFunnelDescription(\"\")\r\n    setFunnelCategory(\"\")\r\n    setFunnelIcon(\"target\")\r\n    setFunnelColumns([{ id: \"step1\", name: \"Nova Etapa\", color: \"#64748b\", order: 0, description: \"\" }])\r\n    setEditingFunnel(null)\r\n    setShowCreateDialog(true)\r\n  }\r\n\r\n  const handleEditFunnel = (funnel: Funnel) => {\r\n    setFunnelName(funnel.name)\r\n    setFunnelDescription(funnel.description)\r\n    setFunnelCategory(funnel.category)\r\n    setFunnelIcon(funnel.icon)\r\n    setFunnelColumns(funnel.columns.map((col) => ({ ...col })))\r\n    setEditingFunnel(funnel)\r\n    setShowCreateDialog(true)\r\n  }\r\n\r\n  const handleDuplicateFunnel = (funnel: Funnel) => {\r\n    const newFunnel: Funnel = {\r\n      ...funnel,\r\n      id: `funnel_${Date.now()}`,\r\n      name: `${funnel.name} (Cópia)`,\r\n      createdAt: new Date().toISOString(),\r\n    }\r\n    setLocalFunnels((prev) => [...prev, newFunnel])\r\n    toast({\r\n      title: \"Funil duplicado\",\r\n      description: `O funil \"${newFunnel.name}\" foi criado com sucesso.`,\r\n    })\r\n  }\r\n\r\n  const handleDeleteFunnel = (funnelId: string) => {\r\n    const funnel = localFunnels.find((f) => f.id === funnelId)\r\n    if (!funnel) return\r\n\r\n    setLocalFunnels((prev) => prev.filter((f) => f.id !== funnelId))\r\n    toast({\r\n      title: \"Funil excluído\",\r\n      description: `O funil \"${funnel.name}\" foi removido.`,\r\n    })\r\n  }\r\n\r\n  const handleToggleFunnelActive = (funnelId: string) => {\r\n    setLocalFunnels((prev) => prev.map((f) => (f.id === funnelId ? { ...f, isActive: !f.isActive } : f)))\r\n  }\r\n\r\n  const handleSaveFunnel = () => {\r\n    if (!funnelName.trim()) {\r\n      toast({\r\n        title: \"Erro\",\r\n        description: \"O nome do funil é obrigatório.\",\r\n        variant: \"destructive\",\r\n      })\r\n      return\r\n    }\r\n\r\n    if (funnelColumns.length === 0) {\r\n      toast({\r\n        title: \"Erro\",\r\n        description: \"O funil deve ter pelo menos uma etapa.\",\r\n        variant: \"destructive\",\r\n      })\r\n      return\r\n    }\r\n\r\n    const funnelData: Funnel = {\r\n      id: editingFunnel?.id || `funnel_${Date.now()}`,\r\n      name: funnelName,\r\n      description: funnelDescription,\r\n      category: funnelCategory,\r\n      icon: funnelIcon,\r\n      columns: funnelColumns.map((col, index) => ({\r\n        ...col,\r\n        order: index,\r\n        visible: true,\r\n      })),\r\n      isActive: editingFunnel?.isActive ?? true,\r\n      createdAt: editingFunnel?.createdAt || new Date().toISOString(),\r\n    }\r\n\r\n    if (editingFunnel) {\r\n      setLocalFunnels((prev) => prev.map((f) => (f.id === editingFunnel.id ? funnelData : f)))\r\n      toast({\r\n        title: \"Funil atualizado\",\r\n        description: `O funil \"${funnelData.name}\" foi atualizado com sucesso.`,\r\n      })\r\n    } else {\r\n      setLocalFunnels((prev) => [...prev, funnelData])\r\n      toast({\r\n        title: \"Funil criado\",\r\n        description: `O funil \"${funnelData.name}\" foi criado com sucesso.`,\r\n      })\r\n    }\r\n\r\n    setShowCreateDialog(false)\r\n  }\r\n\r\n  const handleApplyTemplate = (template: FunnelTemplate) => {\r\n    const newFunnel: Funnel = {\r\n      id: `funnel_${Date.now()}`,\r\n      name: template.name,\r\n      description: template.description,\r\n      category: template.category,\r\n      icon: template.icon,\r\n      columns: template.columns.map((col) => ({\r\n        ...col,\r\n        visible: true,\r\n      })),\r\n      isActive: true,\r\n      createdAt: new Date().toISOString(),\r\n    }\r\n\r\n    setLocalFunnels((prev) => [...prev, newFunnel])\r\n    toast({\r\n      title: \"Template aplicado\",\r\n      description: `O funil \"${newFunnel.name}\" foi criado a partir do template.`,\r\n    })\r\n  }\r\n\r\n  const addColumn = () => {\r\n    const newColumn = {\r\n      id: `step_${Date.now()}`,\r\n      name: \"Nova Etapa\",\r\n      color: availableColors[funnelColumns.length % availableColors.length],\r\n      order: funnelColumns.length,\r\n      description: \"\",\r\n    }\r\n    setFunnelColumns((prev) => [...prev, newColumn])\r\n  }\r\n\r\n  const removeColumn = (columnId: string) => {\r\n    setFunnelColumns((prev) => prev.filter((col) => col.id !== columnId))\r\n  }\r\n\r\n  const updateColumn = (columnId: string, updates: Partial<(typeof funnelColumns)[0]>) => {\r\n    setFunnelColumns((prev) => prev.map((col) => (col.id === columnId ? { ...col, ...updates } : col)))\r\n  }\r\n\r\n  const onDragEnd = (result: any) => {\r\n    if (!result.destination) return\r\n\r\n    const items = Array.from(funnelColumns)\r\n    const [reorderedItem] = items.splice(result.source.index, 1)\r\n    items.splice(result.destination.index, 0, reorderedItem)\r\n\r\n    setFunnelColumns(items.map((item, index) => ({ ...item, order: index })))\r\n  }\r\n\r\n  const getIcon = (iconId: string) => {\r\n    const iconData = availableIcons.find((icon) => icon.id === iconId)\r\n    return iconData ? iconData.icon : Target\r\n  }\r\n\r\n  return (\r\n    <Dialog open={true} onOpenChange={onClose}>\r\n      <DialogContent className=\"max-w-6xl max-h-[90vh] overflow-y-auto\">\r\n        <DialogHeader>\r\n          <DialogTitle>Gerenciador de Funis</DialogTitle>\r\n        </DialogHeader>\r\n\r\n        <Tabs value={activeTab} onValueChange={setActiveTab}>\r\n          <TabsList className=\"grid w-full grid-cols-2\">\r\n            <TabsTrigger value=\"funnels\">Meus Funis</TabsTrigger>\r\n            <TabsTrigger value=\"templates\">Templates</TabsTrigger>\r\n          </TabsList>\r\n\r\n          <TabsContent value=\"funnels\" className=\"space-y-4\">\r\n            <div className=\"flex justify-between items-center\">\r\n              <div>\r\n                <h3 className=\"text-lg font-medium\">Funis Personalizados</h3>\r\n                <p className=\"text-sm text-muted-foreground\">Gerencie seus funis de vendas personalizados</p>\r\n              </div>\r\n              <Button onClick={handleCreateFunnel}>\r\n                <Plus className=\"h-4 w-4 mr-2\" />\r\n                Criar Funil\r\n              </Button>\r\n            </div>\r\n\r\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n              {localFunnels.map((funnel) => {\r\n                const IconComponent = getIcon(funnel.icon)\r\n                return (\r\n                  <Card key={funnel.id} className={`${!funnel.isActive ? \"opacity-60\" : \"\"}`}>\r\n                    <CardHeader className=\"pb-3\">\r\n                      <div className=\"flex items-center justify-between\">\r\n                        <div className=\"flex items-center space-x-3\">\r\n                          <div className=\"p-2 rounded-lg bg-blue-100\">\r\n                            <IconComponent className=\"h-5 w-5 text-blue-600\" />\r\n                          </div>\r\n                          <div>\r\n                            <CardTitle className=\"text-base\">{funnel.name}</CardTitle>\r\n                            <p className=\"text-sm text-muted-foreground\">{funnel.category}</p>\r\n                          </div>\r\n                        </div>\r\n                        <div className=\"flex items-center space-x-2\">\r\n                          <Switch\r\n                            checked={funnel.isActive}\r\n                            onCheckedChange={() => handleToggleFunnelActive(funnel.id)}\r\n                          />\r\n                        </div>\r\n                      </div>\r\n                    </CardHeader>\r\n                    <CardContent className=\"space-y-3\">\r\n                      <p className=\"text-sm text-muted-foreground\">{funnel.description}</p>\r\n\r\n                      <div className=\"flex flex-wrap gap-1\">\r\n                        {funnel.columns.slice(0, 4).map((column) => (\r\n                          <Badge\r\n                            key={column.id}\r\n                            variant=\"outline\"\r\n                            style={{ borderColor: column.color, color: column.color }}\r\n                          >\r\n                            {column.name}\r\n                          </Badge>\r\n                        ))}\r\n                        {funnel.columns.length > 4 && (\r\n                          <Badge variant=\"outline\">+{funnel.columns.length - 4} mais</Badge>\r\n                        )}\r\n                      </div>\r\n\r\n                      <div className=\"flex justify-between items-center pt-2\">\r\n                        <span className=\"text-xs text-muted-foreground\">{funnel.columns.length} etapas</span>\r\n                        <div className=\"flex space-x-1\">\r\n                          <Button variant=\"ghost\" size=\"sm\" onClick={() => handleEditFunnel(funnel)}>\r\n                            <Edit className=\"h-4 w-4\" />\r\n                          </Button>\r\n                          <Button variant=\"ghost\" size=\"sm\" onClick={() => handleDuplicateFunnel(funnel)}>\r\n                            <Copy className=\"h-4 w-4\" />\r\n                          </Button>\r\n                          <Button\r\n                            variant=\"ghost\"\r\n                            size=\"sm\"\r\n                            onClick={() => handleDeleteFunnel(funnel.id)}\r\n                            className=\"text-red-600 hover:text-red-700\"\r\n                          >\r\n                            <Trash2 className=\"h-4 w-4\" />\r\n                          </Button>\r\n                        </div>\r\n                      </div>\r\n                    </CardContent>\r\n                  </Card>\r\n                )\r\n              })}\r\n            </div>\r\n\r\n            <div className=\"flex justify-end space-x-2 pt-4\">\r\n              <Button variant=\"outline\" onClick={onClose}>\r\n                Cancelar\r\n              </Button>\r\n              <Button onClick={() => onSave(localFunnels)}>Salvar Alterações</Button>\r\n            </div>\r\n          </TabsContent>\r\n\r\n          <TabsContent value=\"templates\" className=\"space-y-4\">\r\n            <div>\r\n              <h3 className=\"text-lg font-medium\">Templates Predefinidos</h3>\r\n              <p className=\"text-sm text-muted-foreground\">Use templates prontos para acelerar a criação de funis</p>\r\n            </div>\r\n\r\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n              {funnelTemplates.map((template) => {\r\n                const IconComponent = getIcon(template.icon)\r\n                return (\r\n                  <Card key={template.id}>\r\n                    <CardHeader className=\"pb-3\">\r\n                      <div className=\"flex items-center space-x-3\">\r\n                        <div className=\"p-2 rounded-lg bg-green-100\">\r\n                          <IconComponent className=\"h-5 w-5 text-green-600\" />\r\n                        </div>\r\n                        <div>\r\n                          <CardTitle className=\"text-base\">{template.name}</CardTitle>\r\n                          <p className=\"text-sm text-muted-foreground\">{template.category}</p>\r\n                        </div>\r\n                      </div>\r\n                    </CardHeader>\r\n                    <CardContent className=\"space-y-3\">\r\n                      <p className=\"text-sm text-muted-foreground\">{template.description}</p>\r\n\r\n                      <div className=\"flex flex-wrap gap-1\">\r\n                        {template.columns.map((column) => (\r\n                          <Badge\r\n                            key={column.id}\r\n                            variant=\"outline\"\r\n                            style={{ borderColor: column.color, color: column.color }}\r\n                          >\r\n                            {column.name}\r\n                          </Badge>\r\n                        ))}\r\n                      </div>\r\n\r\n                      <div className=\"flex justify-between items-center pt-2\">\r\n                        <span className=\"text-xs text-muted-foreground\">{template.columns.length} etapas</span>\r\n                        <Button size=\"sm\" onClick={() => handleApplyTemplate(template)}>\r\n                          Usar Template\r\n                        </Button>\r\n                      </div>\r\n                    </CardContent>\r\n                  </Card>\r\n                )\r\n              })}\r\n            </div>\r\n          </TabsContent>\r\n        </Tabs>\r\n\r\n        {/* Dialog de Criação/Edição */}\r\n        {showCreateDialog && (\r\n          <Dialog open={showCreateDialog} onOpenChange={setShowCreateDialog}>\r\n            <DialogContent className=\"max-w-4xl max-h-[90vh] overflow-y-auto\">\r\n              <DialogHeader>\r\n                <DialogTitle>{editingFunnel ? \"Editar Funil\" : \"Criar Novo Funil\"}</DialogTitle>\r\n              </DialogHeader>\r\n\r\n              <div className=\"space-y-6\">\r\n                {/* Informações Básicas */}\r\n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n                  <div className=\"space-y-2\">\r\n                    <Label htmlFor=\"funnel-name\">Nome do Funil</Label>\r\n                    <Input\r\n                      id=\"funnel-name\"\r\n                      value={funnelName}\r\n                      onChange={(e) => setFunnelName(e.target.value)}\r\n                      placeholder=\"Ex: Vendas B2B\"\r\n                    />\r\n                  </div>\r\n\r\n                  <div className=\"space-y-2\">\r\n                    <Label htmlFor=\"funnel-category\">Categoria</Label>\r\n                    <Input\r\n                      id=\"funnel-category\"\r\n                      value={funnelCategory}\r\n                      onChange={(e) => setFunnelCategory(e.target.value)}\r\n                      placeholder=\"Ex: Vendas, Marketing, Suporte\"\r\n                    />\r\n                  </div>\r\n                </div>\r\n\r\n                <div className=\"space-y-2\">\r\n                  <Label htmlFor=\"funnel-description\">Descrição</Label>\r\n                  <Textarea\r\n                    id=\"funnel-description\"\r\n                    value={funnelDescription}\r\n                    onChange={(e) => setFunnelDescription(e.target.value)}\r\n                    placeholder=\"Descreva o propósito deste funil...\"\r\n                    rows={3}\r\n                  />\r\n                </div>\r\n\r\n                <div className=\"space-y-2\">\r\n                  <Label>Ícone</Label>\r\n                  <div className=\"grid grid-cols-4 md:grid-cols-8 gap-2\">\r\n                    {availableIcons.map((iconOption) => {\r\n                      const IconComponent = iconOption.icon\r\n                      return (\r\n                        <Button\r\n                          key={iconOption.id}\r\n                          variant={funnelIcon === iconOption.id ? \"default\" : \"outline\"}\r\n                          size=\"sm\"\r\n                          onClick={() => setFunnelIcon(iconOption.id)}\r\n                          className=\"flex flex-col items-center p-3 h-auto\"\r\n                        >\r\n                          <IconComponent className=\"h-4 w-4 mb-1\" />\r\n                          <span className=\"text-xs\">{iconOption.name}</span>\r\n                        </Button>\r\n                      )\r\n                    })}\r\n                  </div>\r\n                </div>\r\n\r\n                {/* Etapas do Funil */}\r\n                <div className=\"space-y-4\">\r\n                  <div className=\"flex justify-between items-center\">\r\n                    <div>\r\n                      <Label>Etapas do Funil</Label>\r\n                      <p className=\"text-sm text-muted-foreground\">Defina as etapas do seu processo de vendas</p>\r\n                    </div>\r\n                    <Button onClick={addColumn} size=\"sm\">\r\n                      <Plus className=\"h-4 w-4 mr-2\" />\r\n                      Adicionar Etapa\r\n                    </Button>\r\n                  </div>\r\n\r\n                  <DragDropContext onDragEnd={onDragEnd}>\r\n                    <Droppable droppableId=\"columns\">\r\n                      {(provided) => (\r\n                        <div {...provided.droppableProps} ref={provided.innerRef} className=\"space-y-3\">\r\n                          {funnelColumns.map((column, index) => (\r\n                            <Draggable key={column.id} draggableId={column.id} index={index}>\r\n                              {(provided) => (\r\n                                <div\r\n                                  ref={provided.innerRef}\r\n                                  {...provided.draggableProps}\r\n                                  className=\"flex items-center space-x-3 p-3 border rounded-lg bg-white\"\r\n                                >\r\n                                  <div {...provided.dragHandleProps}>\r\n                                    <GripVertical className=\"h-4 w-4 text-gray-400\" />\r\n                                  </div>\r\n\r\n                                  <div className=\"flex-1 grid grid-cols-1 md:grid-cols-3 gap-3\">\r\n                                    <div>\r\n                                      <Input\r\n                                        value={column.name}\r\n                                        onChange={(e) => updateColumn(column.id, { name: e.target.value })}\r\n                                        placeholder=\"Nome da etapa\"\r\n                                      />\r\n                                    </div>\r\n\r\n                                    <div>\r\n                                      <Select\r\n                                        value={column.color}\r\n                                        onValueChange={(color) => updateColumn(column.id, { color })}\r\n                                      >\r\n                                        <SelectTrigger>\r\n                                          <div className=\"flex items-center space-x-2\">\r\n                                            <div\r\n                                              className=\"w-4 h-4 rounded-full\"\r\n                                              style={{ backgroundColor: column.color }}\r\n                                            />\r\n                                            <SelectValue />\r\n                                          </div>\r\n                                        </SelectTrigger>\r\n                                        <SelectContent>\r\n                                          {availableColors.map((color) => (\r\n                                            <SelectItem key={color} value={color}>\r\n                                              <div className=\"flex items-center space-x-2\">\r\n                                                <div\r\n                                                  className=\"w-4 h-4 rounded-full\"\r\n                                                  style={{ backgroundColor: color }}\r\n                                                />\r\n                                                <span>{color}</span>\r\n                                              </div>\r\n                                            </SelectItem>\r\n                                          ))}\r\n                                        </SelectContent>\r\n                                      </Select>\r\n                                    </div>\r\n\r\n                                    <div>\r\n                                      <Input\r\n                                        value={column.description || \"\"}\r\n                                        onChange={(e) => updateColumn(column.id, { description: e.target.value })}\r\n                                        placeholder=\"Descrição (opcional)\"\r\n                                      />\r\n                                    </div>\r\n                                  </div>\r\n\r\n                                  {funnelColumns.length > 1 && (\r\n                                    <Button\r\n                                      variant=\"ghost\"\r\n                                      size=\"sm\"\r\n                                      onClick={() => removeColumn(column.id)}\r\n                                      className=\"text-red-600 hover:text-red-700\"\r\n                                    >\r\n                                      <X className=\"h-4 w-4\" />\r\n                                    </Button>\r\n                                  )}\r\n                                </div>\r\n                              )}\r\n                            </Draggable>\r\n                          ))}\r\n                          {provided.placeholder}\r\n                        </div>\r\n                      )}\r\n                    </Droppable>\r\n                  </DragDropContext>\r\n                </div>\r\n\r\n                <div className=\"flex justify-end space-x-2 pt-4\">\r\n                  <Button variant=\"outline\" onClick={() => setShowCreateDialog(false)}>\r\n                    Cancelar\r\n                  </Button>\r\n                  <Button onClick={handleSaveFunnel}>{editingFunnel ? \"Atualizar Funil\" : \"Criar Funil\"}</Button>\r\n                </div>\r\n              </div>\r\n            </DialogContent>\r\n          </Dialog>\r\n        )}\r\n      </DialogContent>\r\n    </Dialog>\r\n  )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Projetos\\Back_endCrm\\kanbanproject1\\components\\import-leads-dialog.tsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'leads' is defined but never used.","line":32,"column":14,"nodeType":"Identifier","messageId":"unusedVar","endLine":32,"endColumn":35,"suggestions":[{"messageId":"removeVar","data":{"varName":"leads"},"fix":{"range":[964,986],"text":""},"desc":"Remove unused variable 'leads'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'funnelId' is defined but never used.","line":32,"column":37,"nodeType":"Identifier","messageId":"unusedVar","endLine":32,"endColumn":53,"suggestions":[{"messageId":"removeVar","data":{"varName":"funnelId"},"fix":{"range":[985,1003],"text":""},"desc":"Remove unused variable 'funnelId'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'stageId' is defined but never used.","line":32,"column":55,"nodeType":"Identifier","messageId":"unusedVar","endLine":32,"endColumn":70,"suggestions":[{"messageId":"removeVar","data":{"varName":"stageId"},"fix":{"range":[1003,1020],"text":""},"desc":"Remove unused variable 'stageId'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'columns' is defined but never used.","line":37,"column":70,"nodeType":"Identifier","messageId":"unusedVar","endLine":37,"endColumn":77,"suggestions":[{"messageId":"removeVar","data":{"varName":"columns"},"fix":{"range":[1245,1254],"text":""},"desc":"Remove unused variable 'columns'."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'columns' is defined but never used.","line":37,"column":70,"nodeType":null,"messageId":"unusedVar","endLine":37,"endColumn":77}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\"\r\n\r\nimport type React from \"react\"\r\n\r\nimport { useState, useRef } from \"react\"\r\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogDescription } from \"@/components/ui/dialog\"\r\nimport { Button } from \"@/components/ui/button\"\r\nimport { Card, CardContent } from \"@/components/ui/card\"\r\nimport { Badge } from \"@/components/ui/badge\"\r\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\"\r\nimport { useToast } from \"@/hooks/use-toast\"\r\nimport { Upload, Download, AlertCircle, CheckCircle2, X } from \"lucide-react\"\r\nimport * as XLSX from \"xlsx\"\r\n\r\ntype ImportedLead = {\r\n  title: string\r\n  client: string\r\n  clientEmail?: string\r\n  clientPhone?: string\r\n  cnpj?: string\r\n  source: string\r\n  priority?: string\r\n  estimatedValue?: number\r\n  expectedCloseDate?: string\r\n  notes?: string\r\n  tags?: string[]\r\n}\r\n\r\ntype ImportLeadsDialogProps = {\r\n  open: boolean\r\n  onClose: () => void\r\n  onImport: (leads: ImportedLead[], funnelId: string, stageId: string) => void\r\n  columns: Array<{ id: string; name: string }>\r\n  funnels: Array<{ id: string; name: string; columns: Array<{ id: string; name: string }> }>\r\n}\r\n\r\nexport default function ImportLeadsDialog({ open, onClose, onImport, columns, funnels }: ImportLeadsDialogProps) {\r\n  const { toast } = useToast()\r\n  const fileInputRef = useRef<HTMLInputElement>(null)\r\n  const [file, setFile] = useState<File | null>(null)\r\n  const [previewData, setPreviewData] = useState<ImportedLead[]>([])\r\n  const [errors, setErrors] = useState<string[]>([])\r\n  const [step, setStep] = useState<\"config\" | \"upload\" | \"preview\" | \"confirm\">(\"config\")\r\n\r\n  const [selectedFunnelId, setSelectedFunnelId] = useState<string>(\"\")\r\n  const [selectedStageId, setSelectedStageId] = useState<string>(\"\")\r\n\r\n  const selectedFunnel = funnels.find((f) => f.id === selectedFunnelId)\r\n  const funnelStages = selectedFunnel?.columns || []\r\n\r\n  const downloadTemplate = () => {\r\n    const templateData = [\r\n      {\r\n        \"Nome do Lead\": \"Exemplo Lead 1\",\r\n        \"Cliente/Empresa\": \"Empresa XYZ\",\r\n        Email: \"contato@empresa.com\",\r\n        Telefone: \"+55 11 99999-0000\",\r\n        CNPJ: \"12.345.678/0001-90\",\r\n        Tags: \"tag1, tag2\",\r\n        Origem: \"Website\",\r\n        Prioridade: \"Alta\",\r\n        \"Valor Estimado\": \"5000\",\r\n        \"Data Esperada\": \"2025-12-31\",\r\n        Notas: \"Lead qualificado\",\r\n      },\r\n      {\r\n        \"Nome do Lead\": \"Exemplo Lead 2\",\r\n        \"Cliente/Empresa\": \"Empresa ABC\",\r\n        Email: \"vendas@empresa.com\",\r\n        Telefone: \"+55 11 88888-0000\",\r\n        CNPJ: \"98.765.432/0001-10\",\r\n        Tags: \"tag3\",\r\n        Origem: \"Indicação\",\r\n        Prioridade: \"Média\",\r\n        \"Valor Estimado\": \"3000\",\r\n        \"Data Esperada\": \"2025-11-30\",\r\n        Notas: \"Aguardando retorno\",\r\n      },\r\n    ]\r\n\r\n    const worksheet = XLSX.utils.json_to_sheet(templateData)\r\n    const workbook = XLSX.utils.book_new()\r\n    XLSX.utils.book_append_sheet(workbook, worksheet, \"Leads\")\r\n\r\n    // Set column widths for better readability\r\n    worksheet[\"!cols\"] = [\r\n      { wch: 20 }, // Nome do Lead\r\n      { wch: 20 }, // Cliente/Empresa\r\n      { wch: 25 }, // Email\r\n      { wch: 18 }, // Telefone\r\n      { wch: 18 }, // CNPJ\r\n      { wch: 15 }, // Tags\r\n      { wch: 15 }, // Origem\r\n      { wch: 12 }, // Prioridade\r\n      { wch: 15 }, // Valor Estimado\r\n      { wch: 15 }, // Data Esperada\r\n      { wch: 25 }, // Notas\r\n    ]\r\n\r\n    const timestamp = new Date().toISOString().split(\"T\")[0]\r\n    XLSX.writeFile(workbook, `template-leads-${timestamp}.xlsx`)\r\n\r\n    toast({\r\n      title: \"Template baixado\",\r\n      description: \"O arquivo de template foi baixado com sucesso.\",\r\n    })\r\n  }\r\n\r\n  const handleFileSelect = (e: React.ChangeEvent<HTMLInputElement>) => {\r\n    const selectedFile = e.target.files?.[0]\r\n    if (!selectedFile) return\r\n\r\n    if (!selectedFile.name.endsWith(\".xlsx\") && !selectedFile.name.endsWith(\".xls\")) {\r\n      toast({\r\n        title: \"Formato inválido\",\r\n        description: \"Por favor, selecione um arquivo Excel (.xlsx ou .xls)\",\r\n        variant: \"destructive\",\r\n      })\r\n      return\r\n    }\r\n\r\n    setFile(selectedFile)\r\n    parseExcelFile(selectedFile)\r\n  }\r\n\r\n  const parseExcelFile = (file: File) => {\r\n    const reader = new FileReader()\r\n\r\n    reader.onload = (e) => {\r\n      try {\r\n        const data = e.target?.result\r\n        const workbook = XLSX.read(data, { type: \"binary\" })\r\n        const worksheet = workbook.Sheets[workbook.SheetNames[0]]\r\n        const jsonData = XLSX.utils.sheet_to_json(worksheet)\r\n\r\n        const requiredColumns = [\r\n          \"Nome do Lead\",\r\n          \"Cliente/Empresa\",\r\n          \"Email\",\r\n          \"Telefone\",\r\n          \"CNPJ\",\r\n          \"Tags\",\r\n          \"Origem\",\r\n          \"Prioridade\",\r\n          \"Valor Estimado\",\r\n          \"Data Esperada\",\r\n          \"Notas\",\r\n        ]\r\n\r\n        // Get the actual columns from the first row\r\n        const firstRow = jsonData[0] as any\r\n        if (!firstRow) {\r\n          toast({\r\n            title: \"Arquivo vazio\",\r\n            description: \"O arquivo não contém dados para importar.\",\r\n            variant: \"destructive\",\r\n          })\r\n          return\r\n        }\r\n\r\n        const actualColumns = Object.keys(firstRow)\r\n\r\n        // Check if all required columns are present\r\n        const missingColumns = requiredColumns.filter((col) => !actualColumns.includes(col))\r\n        if (missingColumns.length > 0) {\r\n          toast({\r\n            title: \"Colunas obrigatórias ausentes\",\r\n            description: `As seguintes colunas estão faltando: ${missingColumns.join(\", \")}. Por favor, use o template fornecido.`,\r\n            variant: \"destructive\",\r\n          })\r\n          setFile(null)\r\n          return\r\n        }\r\n\r\n        // Check for extra columns with content\r\n        const extraColumns = actualColumns.filter((col) => !requiredColumns.includes(col))\r\n        if (extraColumns.length > 0) {\r\n          // Check if any of the extra columns have content\r\n          const hasContentInExtraColumns = jsonData.some((row: any) => {\r\n            return extraColumns.some((col) => {\r\n              const value = row[col]\r\n              return value !== undefined && value !== null && value.toString().trim() !== \"\"\r\n            })\r\n          })\r\n\r\n          if (hasContentInExtraColumns) {\r\n            toast({\r\n              title: \"Colunas não permitidas com conteúdo\",\r\n              description: `As seguintes colunas não são permitidas e contêm dados: ${extraColumns.join(\", \")}. Por favor, use apenas as colunas do template.`,\r\n              variant: \"destructive\",\r\n            })\r\n            setFile(null)\r\n            return\r\n          }\r\n        }\r\n\r\n        const importedLeads: ImportedLead[] = []\r\n        const newErrors: string[] = []\r\n\r\n        jsonData.forEach((row: any, index: number) => {\r\n          const rowNumber = index + 2 // +2 because of header and 0-based index\r\n\r\n          const estimatedValue = row[\"Valor Estimado\"] ? Number.parseFloat(row[\"Valor Estimado\"]) : undefined\r\n\r\n          if (row[\"Valor Estimado\"] && isNaN(estimatedValue)) {\r\n            newErrors.push(`Linha ${rowNumber}: Valor Estimado deve ser um número válido`)\r\n            return\r\n          }\r\n\r\n          const tagsString = row[\"Tags\"]?.toString().trim() || \"\"\r\n          const tags = tagsString\r\n            ? tagsString\r\n                .split(\",\")\r\n                .map((t: string) => t.trim())\r\n                .filter(Boolean)\r\n            : []\r\n\r\n          const lead: ImportedLead = {\r\n            title: row[\"Nome do Lead\"]?.toString().trim() || \"Lead sem nome\",\r\n            client: row[\"Cliente/Empresa\"]?.toString().trim() || \"Cliente não informado\",\r\n            clientEmail: row[\"Email\"]?.toString().trim() || undefined,\r\n            clientPhone: row[\"Telefone\"]?.toString().trim() || undefined,\r\n            cnpj: row[\"CNPJ\"]?.toString().trim() || undefined,\r\n            source: row[\"Origem\"]?.toString().trim() || \"Importação\",\r\n            priority: row[\"Prioridade\"]?.toString().trim() || \"medium\",\r\n            estimatedValue: estimatedValue,\r\n            expectedCloseDate: row[\"Data Esperada\"]?.toString().trim() || undefined,\r\n            notes: row[\"Notas\"]?.toString().trim() || undefined,\r\n            tags: tags.length > 0 ? tags : undefined,\r\n          }\r\n\r\n          importedLeads.push(lead)\r\n        })\r\n\r\n        if (importedLeads.length === 0 && newErrors.length === 0) {\r\n          newErrors.push(\"Nenhum lead válido encontrado no arquivo\")\r\n        }\r\n\r\n        setErrors(newErrors)\r\n        setPreviewData(importedLeads)\r\n        setStep(\"preview\")\r\n      } catch (error) {\r\n        console.error(\"[v0] Error parsing Excel file:\", error)\r\n        toast({\r\n          title: \"Erro ao processar arquivo\",\r\n          description: \"Não foi possível ler o arquivo Excel. Verifique o formato.\",\r\n          variant: \"destructive\",\r\n        })\r\n      }\r\n    }\r\n\r\n    reader.readAsBinaryString(file)\r\n  }\r\n\r\n  const handleImport = () => {\r\n    if (!selectedFunnelId || !selectedStageId) {\r\n      toast({\r\n        title: \"Configuração incompleta\",\r\n        description: \"Selecione o funil e a etapa para importar os leads\",\r\n        variant: \"destructive\",\r\n      })\r\n      return\r\n    }\r\n\r\n    if (previewData.length === 0) {\r\n      toast({\r\n        title: \"Nenhum lead para importar\",\r\n        description: \"Selecione um arquivo com leads válidos\",\r\n        variant: \"destructive\",\r\n      })\r\n      return\r\n    }\r\n\r\n    onImport(previewData, selectedFunnelId, selectedStageId)\r\n\r\n    toast({\r\n      title: \"Leads importados com sucesso!\",\r\n      description: `${previewData.length} leads foram adicionados ao pipeline.`,\r\n    })\r\n\r\n    // Reset state\r\n    setFile(null)\r\n    setPreviewData([])\r\n    setErrors([])\r\n    setStep(\"config\")\r\n    setSelectedFunnelId(\"\")\r\n    setSelectedStageId(\"\")\r\n    onClose()\r\n  }\r\n\r\n  const handleClose = () => {\r\n    setFile(null)\r\n    setPreviewData([])\r\n    setErrors([])\r\n    setStep(\"config\")\r\n    setSelectedFunnelId(\"\")\r\n    setSelectedStageId(\"\")\r\n    onClose()\r\n  }\r\n\r\n  return (\r\n    <Dialog open={open} onOpenChange={handleClose}>\r\n      <DialogContent className=\"max-w-2xl max-h-[80vh] overflow-y-auto\">\r\n        <DialogHeader>\r\n          <DialogTitle>Importar Leads</DialogTitle>\r\n          <DialogDescription>\r\n            Importe leads em lote usando um arquivo Excel. Baixe o template para ver o formato esperado.\r\n          </DialogDescription>\r\n        </DialogHeader>\r\n\r\n        <div className=\"space-y-6\">\r\n          {step === \"config\" && (\r\n            <div className=\"space-y-4\">\r\n              <div className=\"space-y-2\">\r\n                <label className=\"text-sm font-medium\">Selecione o Funil</label>\r\n                <Select\r\n                  value={selectedFunnelId}\r\n                  onValueChange={(value) => {\r\n                    setSelectedFunnelId(value)\r\n                    setSelectedStageId(\"\") // Reset stage when funnel changes\r\n                  }}\r\n                >\r\n                  <SelectTrigger>\r\n                    <SelectValue placeholder=\"Escolha um funil...\" />\r\n                  </SelectTrigger>\r\n                  <SelectContent>\r\n                    {funnels.map((funnel) => (\r\n                      <SelectItem key={funnel.id} value={funnel.id}>\r\n                        {funnel.name}\r\n                      </SelectItem>\r\n                    ))}\r\n                  </SelectContent>\r\n                </Select>\r\n              </div>\r\n\r\n              {selectedFunnelId && (\r\n                <div className=\"space-y-2\">\r\n                  <label className=\"text-sm font-medium\">Selecione a Etapa</label>\r\n                  <Select value={selectedStageId} onValueChange={setSelectedStageId}>\r\n                    <SelectTrigger>\r\n                      <SelectValue placeholder=\"Escolha uma etapa...\" />\r\n                    </SelectTrigger>\r\n                    <SelectContent>\r\n                      {funnelStages.map((stage) => (\r\n                        <SelectItem key={stage.id} value={stage.id}>\r\n                          {stage.name}\r\n                        </SelectItem>\r\n                      ))}\r\n                    </SelectContent>\r\n                  </Select>\r\n                </div>\r\n              )}\r\n\r\n              <div className=\"flex gap-2 pt-4\">\r\n                <Button variant=\"outline\" onClick={handleClose} className=\"flex-1 bg-transparent\">\r\n                  Cancelar\r\n                </Button>\r\n                <Button\r\n                  onClick={() => setStep(\"upload\")}\r\n                  disabled={!selectedFunnelId || !selectedStageId}\r\n                  className=\"flex-1\"\r\n                >\r\n                  Próximo\r\n                </Button>\r\n              </div>\r\n            </div>\r\n          )}\r\n\r\n          {step === \"upload\" && (\r\n            <div className=\"space-y-4\">\r\n              <div className=\"border-2 border-dashed rounded-lg p-8 text-center hover:bg-gray-50 transition-colors\">\r\n                <Upload className=\"h-12 w-12 mx-auto mb-4 text-gray-400\" />\r\n                <h3 className=\"font-semibold mb-2\">Selecione um arquivo Excel</h3>\r\n                <p className=\"text-sm text-gray-600 mb-4\">Arraste e solte ou clique para selecionar</p>\r\n\r\n                <input\r\n                  ref={fileInputRef}\r\n                  type=\"file\"\r\n                  accept=\".xlsx,.xls\"\r\n                  onChange={handleFileSelect}\r\n                  className=\"hidden\"\r\n                />\r\n\r\n                <Button onClick={() => fileInputRef.current?.click()} className=\"mb-4\">\r\n                  <Upload className=\"h-4 w-4 mr-2\" />\r\n                  Selecionar Arquivo\r\n                </Button>\r\n\r\n                {file && (\r\n                  <div className=\"mt-4 p-3 bg-green-50 border border-green-200 rounded-lg flex items-center justify-between\">\r\n                    <div className=\"flex items-center gap-2\">\r\n                      <CheckCircle2 className=\"h-5 w-5 text-green-600\" />\r\n                      <span className=\"text-sm text-green-800\">{file.name}</span>\r\n                    </div>\r\n                    <Button\r\n                      variant=\"ghost\"\r\n                      size=\"sm\"\r\n                      onClick={() => {\r\n                        setFile(null)\r\n                        setPreviewData([])\r\n                        setErrors([])\r\n                      }}\r\n                    >\r\n                      <X className=\"h-4 w-4\" />\r\n                    </Button>\r\n                  </div>\r\n                )}\r\n              </div>\r\n\r\n              <div className=\"flex gap-2\">\r\n                <Button variant=\"outline\" onClick={downloadTemplate} className=\"flex-1 bg-transparent\">\r\n                  <Download className=\"h-4 w-4 mr-2\" />\r\n                  Baixar Template\r\n                </Button>\r\n              </div>\r\n            </div>\r\n          )}\r\n\r\n          {step === \"preview\" && (\r\n            <div className=\"space-y-4\">\r\n              {errors.length > 0 && (\r\n                <div className=\"p-4 bg-red-50 border border-red-200 rounded-lg\">\r\n                  <div className=\"flex items-start gap-2 mb-2\">\r\n                    <AlertCircle className=\"h-5 w-5 text-red-600 flex-shrink-0 mt-0.5\" />\r\n                    <div>\r\n                      <h4 className=\"font-semibold text-red-800 mb-2\">Erros encontrados:</h4>\r\n                      <ul className=\"space-y-1\">\r\n                        {errors.map((error, index) => (\r\n                          <li key={index} className=\"text-sm text-red-700\">\r\n                            • {error}\r\n                          </li>\r\n                        ))}\r\n                      </ul>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              )}\r\n\r\n              <div>\r\n                <h4 className=\"font-semibold mb-3\">Preview: {previewData.length} lead(s) para importar</h4>\r\n\r\n                <div className=\"space-y-2 max-h-[300px] overflow-y-auto\">\r\n                  {previewData.map((lead, index) => (\r\n                    <Card key={index}>\r\n                      <CardContent className=\"p-3\">\r\n                        <div className=\"flex justify-between items-start mb-2\">\r\n                          <div className=\"flex-1\">\r\n                            <h5 className=\"font-medium\">{lead.title}</h5>\r\n                            <p className=\"text-sm text-gray-600\">{lead.client}</p>\r\n                          </div>\r\n                          {lead.priority && (\r\n                            <Badge\r\n                              className={\r\n                                lead.priority === \"urgent\"\r\n                                  ? \"bg-red-100 text-red-800\"\r\n                                  : lead.priority === \"high\"\r\n                                    ? \"bg-orange-100 text-orange-800\"\r\n                                    : lead.priority === \"medium\"\r\n                                      ? \"bg-yellow-100 text-yellow-800\"\r\n                                      : \"bg-blue-100 text-blue-800\"\r\n                              }\r\n                            >\r\n                              {lead.priority === \"urgent\"\r\n                                ? \"Urgente\"\r\n                                : lead.priority === \"high\"\r\n                                  ? \"Alta\"\r\n                                  : lead.priority === \"medium\"\r\n                                    ? \"Média\"\r\n                                    : \"Baixa\"}\r\n                            </Badge>\r\n                          )}\r\n                        </div>\r\n\r\n                        <div className=\"grid grid-cols-2 gap-2 text-sm\">\r\n                          {lead.clientEmail && (\r\n                            <div>\r\n                              <span className=\"text-gray-600\">Email:</span> {lead.clientEmail}\r\n                            </div>\r\n                          )}\r\n                          {lead.clientPhone && (\r\n                            <div>\r\n                              <span className=\"text-gray-600\">Telefone:</span> {lead.clientPhone}\r\n                            </div>\r\n                          )}\r\n                          {lead.cnpj && (\r\n                            <div>\r\n                              <span className=\"text-gray-600\">CNPJ:</span> {lead.cnpj}\r\n                            </div>\r\n                          )}\r\n                          {lead.estimatedValue && (\r\n                            <div>\r\n                              <span className=\"text-gray-600\">Valor:</span> R${\" \"}\r\n                              {lead.estimatedValue.toLocaleString(\"pt-BR\")}\r\n                            </div>\r\n                          )}\r\n                          {lead.source && (\r\n                            <div>\r\n                              <span className=\"text-gray-600\">Origem:</span> {lead.source}\r\n                            </div>\r\n                          )}\r\n                        </div>\r\n\r\n                        {lead.tags && lead.tags.length > 0 && (\r\n                          <div className=\"mt-2 flex flex-wrap gap-1\">\r\n                            {lead.tags.map((tag, idx) => (\r\n                              <Badge key={idx} variant=\"secondary\" className=\"text-xs\">\r\n                                {tag}\r\n                              </Badge>\r\n                            ))}\r\n                          </div>\r\n                        )}\r\n                      </CardContent>\r\n                    </Card>\r\n                  ))}\r\n                </div>\r\n              </div>\r\n            </div>\r\n          )}\r\n\r\n          <div className=\"flex justify-end gap-2 pt-4 border-t\">\r\n            <Button variant=\"outline\" onClick={handleClose}>\r\n              Cancelar\r\n            </Button>\r\n\r\n            {step === \"upload\" && (\r\n              <Button onClick={() => fileInputRef.current?.click()} disabled={!file}>\r\n                Próximo\r\n              </Button>\r\n            )}\r\n\r\n            {step === \"preview\" && (\r\n              <>\r\n                <Button\r\n                  variant=\"outline\"\r\n                  onClick={() => {\r\n                    setFile(null)\r\n                    setPreviewData([])\r\n                    setErrors([])\r\n                    setStep(\"upload\")\r\n                  }}\r\n                >\r\n                  Voltar\r\n                </Button>\r\n                <Button onClick={handleImport} disabled={previewData.length === 0 || errors.length > 0}>\r\n                  <CheckCircle2 className=\"h-4 w-4 mr-2\" />\r\n                  Importar {previewData.length} Lead(s)\r\n                </Button>\r\n              </>\r\n            )}\r\n          </div>\r\n        </div>\r\n      </DialogContent>\r\n    </Dialog>\r\n  )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Projetos\\Back_endCrm\\kanbanproject1\\components\\kanban-automations.tsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'automations' is defined but never used.","line":143,"column":12,"nodeType":"Identifier","messageId":"unusedVar","endLine":143,"endColumn":37,"suggestions":[{"messageId":"removeVar","data":{"varName":"automations"},"fix":{"range":[3676,3701],"text":""},"desc":"Remove unused variable 'automations'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'whatsappTemplates' is assigned a value but never used.","line":147,"column":7,"nodeType":"Identifier","messageId":"unusedVar","endLine":147,"endColumn":24},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'whatsappTemplates' is assigned a value but never used.","line":147,"column":7,"nodeType":null,"messageId":"unusedVar","endLine":147,"endColumn":24},{"ruleId":"no-case-declarations","severity":1,"message":"Unexpected lexical declaration in case block.","line":391,"column":9,"nodeType":"VariableDeclaration","messageId":"unexpected","endLine":398,"endColumn":49,"suggestions":[{"messageId":"addBrackets","fix":{"range":[12954,13342],"text":"{ const recipientText =\r\n          action.recipients === \"assigned\"\r\n            ? \"responsável\"\r\n            : action.recipients === \"all_members\"\r\n              ? \"todos os membros\"\r\n              : action.recipients === \"lead_contact\"\r\n                ? \"contato principal do lead\"\r\n                : \"destinatários personalizados\"\r\n        return `Enviar WhatsApp para ${recipientText}` }"},"desc":"Add {} brackets around the case block."}]},{"ruleId":"no-case-declarations","severity":1,"message":"Unexpected lexical declaration in case block.","line":407,"column":9,"nodeType":"VariableDeclaration","messageId":"unexpected","endLine":407,"endColumn":81,"suggestions":[{"messageId":"addBrackets","fix":{"range":[13591,13746],"text":"{ const targetColumn = columns.find((c) => c.id === action.targetColumnId)\r\n        return `Mover lead para: ${targetColumn?.name || \"Etapa não encontrada\"}` }"},"desc":"Add {} brackets around the case block."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'automation' is defined but never used.","line":504,"column":12,"nodeType":"Identifier","messageId":"unusedVar","endLine":504,"endColumn":34,"suggestions":[{"messageId":"removeVar","data":{"varName":"automation"},"fix":{"range":[17630,17652],"text":""},"desc":"Remove unused variable 'automation'."}]},{"ruleId":"no-case-declarations","severity":1,"message":"Unexpected lexical declaration in case block.","line":835,"column":9,"nodeType":"VariableDeclaration","messageId":"unexpected","endLine":835,"endColumn":81,"suggestions":[{"messageId":"addBrackets","fix":{"range":[30582,30732],"text":"{ const targetColumn = columns.find((c) => c.id === action.targetColumnId)\r\n        return `Mover para: ${targetColumn?.name || \"Etapa não encontrada\"}` }"},"desc":"Add {} brackets around the case block."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'action' is defined but never used.","line":874,"column":12,"nodeType":"Identifier","messageId":"unusedVar","endLine":874,"endColumn":36,"suggestions":[{"messageId":"removeVar","data":{"varName":"action"},"fix":{"range":[31799,31823],"text":""},"desc":"Remove unused variable 'action'."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":8,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\"\r\n\r\nimport { useState } from \"react\"\r\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from \"@/components/ui/dialog\"\r\nimport { Button } from \"@/components/ui/button\"\r\nimport { Input } from \"@/components/ui/input\"\r\nimport { Label } from \"@/components/ui/label\"\r\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\"\r\nimport { Badge } from \"@/components/ui/badge\"\r\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\"\r\nimport { Switch } from \"@/components/ui/switch\"\r\nimport {\r\n  Plus,\r\n  Trash2,\r\n  MessageSquare,\r\n  CheckSquare,\r\n  Mail,\r\n  Bell,\r\n  Zap,\r\n  Play,\r\n  Pause,\r\n  Copy,\r\n  Edit,\r\n  Clock,\r\n  ArrowRight,\r\n  AlertTriangle,\r\n  RefreshCw,\r\n} from \"lucide-react\"\r\n\r\n// Tipos para automações\r\ntype AutomationTrigger = \"on_enter\" | \"on_exit\" | \"on_time_spent\" | \"on_deadline\" | \"on_response\" | \"on_no_response\"\r\n\r\ntype ConditionalAction = {\r\n  condition: \"response_received\" | \"no_response\" | \"time_elapsed\"\r\n  timeLimit?: number\r\n  targetColumnId?: string\r\n  action: AutomationAction\r\n}\r\n\r\ntype WhatsAppAction = {\r\n  type: \"whatsapp\"\r\n  template: string\r\n  recipients: \"assigned\" | \"all_members\" | \"custom\" | \"lead_contact\"\r\n  customRecipients?: string[]\r\n  variables: Record<string, string>\r\n  waitForResponse?: boolean\r\n  responseTimeout?: number\r\n  onResponse?: ConditionalAction\r\n  onNoResponse?: ConditionalAction\r\n}\r\n\r\ntype TaskAction = {\r\n  type: \"task\"\r\n  title: string\r\n  description: string\r\n  assignTo: \"project_owner\" | \"column_responsible\" | \"custom\"\r\n  customAssignee?: string\r\n  dueDate?: string\r\n  priority: \"low\" | \"medium\" | \"high\"\r\n}\r\n\r\ntype EmailAction = {\r\n  type: \"email\"\r\n  subject: string\r\n  template: string\r\n  recipients: \"assigned\" | \"all_members\" | \"custom\"\r\n  customRecipients?: string[]\r\n  waitForResponse?: boolean\r\n  responseTimeout?: number\r\n  onResponse?: ConditionalAction\r\n  onNoResponse?: ConditionalAction\r\n}\r\n\r\ntype NotificationAction = {\r\n  type: \"notification\"\r\n  title: string\r\n  message: string\r\n  recipients: \"assigned\" | \"all_members\" | \"custom\"\r\n  customRecipients?: string[]\r\n}\r\n\r\ntype MoveLeadAction = {\r\n  type: \"move_lead\"\r\n  targetColumnId: string\r\n  delay?: number\r\n}\r\n\r\ntype TransferCommandAction = {\r\n  type: \"transfer_command\"\r\n  transferType: \"funnel_and_stage\" | \"user_only\"\r\n  targetFunnelId?: string\r\n  targetStageId?: string\r\n  userTransferOption: \"keep_same\" | \"transfer_to_specific\" | \"transfer_to_user\"\r\n  targetUserId?: string\r\n}\r\n\r\ntype BatchTransferAction = {\r\n  type: \"batch_transfer\"\r\n  targetFunnelId?: string\r\n  targetStageId?: string\r\n  batchSize: number\r\n  intervalValue: number\r\n  intervalUnit: \"minutes\" | \"hours\" | \"days\"\r\n  totalLeads?: number\r\n  userTransferOption: \"keep_same\" | \"transfer_to_specific\"\r\n  targetUserId?: string\r\n}\r\n\r\ntype AutomationAction =\r\n  | WhatsAppAction\r\n  | TaskAction\r\n  | EmailAction\r\n  | NotificationAction\r\n  | MoveLeadAction\r\n  | TransferCommandAction\r\n  | BatchTransferAction\r\n\r\ntype Automation = {\r\n  id: string\r\n  name: string\r\n  columnId: string\r\n  trigger: AutomationTrigger\r\n  conditions?: {\r\n    leadSource?: string[]\r\n    priority?: string[]\r\n    clientType?: string[]\r\n    leadValue?: { min?: number; max?: number }\r\n  }\r\n  actions: AutomationAction[]\r\n  active: boolean\r\n  delay?: number\r\n  isConditional?: boolean\r\n  conditionalFlow?: {\r\n    timeLimit: number\r\n    onSuccess: { targetColumnId: string; actions: AutomationAction[] }\r\n    onFailure: { targetColumnId: string; actions: AutomationAction[] }\r\n  }\r\n}\r\n\r\ntype KanbanAutomationsProps = {\r\n  columns: Array<{ id: string; name: string; color: string }>\r\n  automations: Automation[]\r\n  onSave: (automations: Automation[]) => void\r\n  onClose: () => void\r\n}\r\n\r\nconst whatsappTemplates = [\r\n  {\r\n    id: \"first_contact\",\r\n    name: \"Primeiro Contato\",\r\n    template:\r\n      \"Olá {client_name}! 👋\\n\\nObrigado pelo seu interesse em nossos serviços!\\n\\nGostaria de agendar uma conversa para entender melhor suas necessidades?\\n\\nResponda este WhatsApp e vamos conversar! 😊\",\r\n  },\r\n  {\r\n    id: \"follow_up\",\r\n    name: \"Follow-up\",\r\n    template:\r\n      \"Oi {client_name}! 📞\\n\\nVi que você demonstrou interesse em nossos serviços.\\n\\nTem alguns minutinhos para conversarmos hoje?\\n\\nPosso te ligar ou prefere que continuemos por aqui?\",\r\n  },\r\n  {\r\n    id: \"proposal_sent\",\r\n    name: \"Proposta Enviada\",\r\n    template:\r\n      \"Olá {client_name}! 📋\\n\\nEnviei a proposta personalizada para seu projeto.\\n\\nDá uma olhada e me fala o que achou!\\n\\nTem alguma dúvida ou ajuste que gostaria de fazer?\",\r\n  },\r\n  {\r\n    id: \"deadline_reminder\",\r\n    name: \"Lembrete de Prazo\",\r\n    template:\r\n      \"Oi {client_name}! ⏰\\n\\nSó lembrando que nossa proposta tem validade até {deadline}.\\n\\nQuer que a gente converse hoje para fechar?\\n\\nEstou aqui para esclarecer qualquer dúvida! 😊\",\r\n  },\r\n  {\r\n    id: \"no_response_follow\",\r\n    name: \"Sem Resposta - Follow-up\",\r\n    template:\r\n      \"Oi {client_name}! 🤔\\n\\nNotei que não conseguimos conversar ainda.\\n\\nAinda tem interesse no projeto? \\n\\nSe mudou de ideia, sem problemas! Só me avisa para eu não te incomodar mais 😊\",\r\n  },\r\n]\r\n\r\nexport default function KanbanAutomations({ columns, automations, onSave, onClose }: KanbanAutomationsProps) {\r\n  const [localAutomations, setLocalAutomations] = useState<Automation[]>([...automations])\r\n  const [selectedColumn, setSelectedColumn] = useState<string>(columns[0]?.id || \"\")\r\n  const [editingAutomation, setEditingAutomation] = useState<Automation | null>(null)\r\n\r\n  const columnAutomations = localAutomations.filter((auto) => auto.columnId === selectedColumn)\r\n\r\n  const addAutomation = () => {\r\n    const newAutomation: Automation = {\r\n      id: `auto_${Date.now()}`,\r\n      name: \"Nova Automação\",\r\n      columnId: selectedColumn,\r\n      trigger: \"on_enter\",\r\n      actions: [],\r\n      active: true,\r\n    }\r\n    setEditingAutomation(newAutomation)\r\n  }\r\n\r\n  const addConditionalAutomation = () => {\r\n    const newAutomation: Automation = {\r\n      id: `auto_${Date.now()}`,\r\n      name: \"Automação com Gatilho\",\r\n      columnId: selectedColumn,\r\n      trigger: \"on_enter\",\r\n      actions: [],\r\n      active: true,\r\n      isConditional: true,\r\n      conditionalFlow: {\r\n        timeLimit: 24,\r\n        onSuccess: { targetColumnId: \"\", actions: [] },\r\n        onFailure: { targetColumnId: \"\", actions: [] },\r\n      },\r\n    }\r\n    setEditingAutomation(newAutomation)\r\n  }\r\n\r\n  const saveAutomation = (automation: Automation) => {\r\n    if (localAutomations.find((a) => a.id === automation.id)) {\r\n      setLocalAutomations((prev) => prev.map((a) => (a.id === automation.id ? automation : a)))\r\n    } else {\r\n      setLocalAutomations((prev) => [...prev, automation])\r\n    }\r\n    setEditingAutomation(null)\r\n  }\r\n\r\n  const removeAutomation = (automationId: string) => {\r\n    setLocalAutomations((prev) => prev.filter((a) => a.id !== automationId))\r\n  }\r\n\r\n  const toggleAutomation = (automationId: string) => {\r\n    setLocalAutomations((prev) => prev.map((a) => (a.id === automationId ? { ...a, active: !a.active } : a)))\r\n  }\r\n\r\n  const duplicateAutomation = (automation: Automation) => {\r\n    const duplicated: Automation = {\r\n      ...automation,\r\n      id: `auto_${Date.now()}`,\r\n      name: `${automation.name} (Cópia)`,\r\n    }\r\n    setLocalAutomations((prev) => [...prev, duplicated])\r\n  }\r\n\r\n  return (\r\n    <Dialog open={true} onOpenChange={(open) => !open && onClose()}>\r\n      <DialogContent className=\"max-w-7xl max-h-[90vh] overflow-y-auto\">\r\n        <DialogHeader>\r\n          <DialogTitle className=\"flex items-center\">\r\n            <Zap className=\"h-5 w-5 mr-2\" />\r\n            Automações Inteligentes do Pipeline\r\n          </DialogTitle>\r\n        </DialogHeader>\r\n\r\n        <div className=\"grid grid-cols-4 gap-6\">\r\n          <div className=\"space-y-2\">\r\n            <h3 className=\"font-medium mb-3\">Etapas do Pipeline</h3>\r\n            {columns.map((column) => (\r\n              <Button\r\n                key={column.id}\r\n                variant={selectedColumn === column.id ? \"default\" : \"outline\"}\r\n                className=\"w-full justify-start\"\r\n                onClick={() => setSelectedColumn(column.id)}\r\n              >\r\n                <div className=\"w-3 h-3 rounded-full mr-2\" style={{ backgroundColor: column.color }} />\r\n                {column.name}\r\n                <Badge variant=\"secondary\" className=\"ml-auto\">\r\n                  {localAutomations.filter((a) => a.columnId === column.id).length}\r\n                </Badge>\r\n              </Button>\r\n            ))}\r\n          </div>\r\n\r\n          <div className=\"col-span-3\">\r\n            <div className=\"flex justify-between items-center mb-4\">\r\n              <h3 className=\"font-medium\">Automações - {columns.find((c) => c.id === selectedColumn)?.name}</h3>\r\n              <div className=\"flex gap-2\">\r\n                <Button onClick={addAutomation} size=\"sm\" variant=\"outline\">\r\n                  <Plus className=\"h-4 w-4 mr-2\" />\r\n                  Automação Simples\r\n                </Button>\r\n                <Button onClick={addConditionalAutomation} size=\"sm\">\r\n                  <Clock className=\"h-4 w-4 mr-2\" />\r\n                  Automação com Gatilho\r\n                </Button>\r\n              </div>\r\n            </div>\r\n\r\n            <div className=\"space-y-3\">\r\n              {columnAutomations.map((automation) => (\r\n                <AutomationCard\r\n                  key={automation.id}\r\n                  automation={automation}\r\n                  columns={columns}\r\n                  onEdit={() => setEditingAutomation(automation)}\r\n                  onToggle={() => toggleAutomation(automation.id)}\r\n                  onDuplicate={() => duplicateAutomation(automation)}\r\n                  onDelete={() => removeAutomation(automation.id)}\r\n                />\r\n              ))}\r\n\r\n              {columnAutomations.length === 0 && (\r\n                <Card className=\"border-dashed\">\r\n                  <CardContent className=\"p-6 text-center\">\r\n                    <Zap className=\"h-12 w-12 mx-auto text-muted-foreground mb-4\" />\r\n                    <h3 className=\"font-medium mb-2\">Nenhuma automação configurada</h3>\r\n                    <p className=\"text-muted-foreground mb-4\">\r\n                      Crie automações inteligentes para esta etapa e otimize seu pipeline\r\n                    </p>\r\n                    <div className=\"flex gap-2 justify-center\">\r\n                      <Button onClick={addAutomation} variant=\"outline\">\r\n                        <Plus className=\"h-4 w-4 mr-2\" />\r\n                        Automação Simples\r\n                      </Button>\r\n                      <Button onClick={addConditionalAutomation}>\r\n                        <Clock className=\"h-4 w-4 mr-2\" />\r\n                        Com Gatilho\r\n                      </Button>\r\n                    </div>\r\n                  </CardContent>\r\n                </Card>\r\n              )}\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        {editingAutomation && (\r\n          <AutomationEditor\r\n            automation={editingAutomation}\r\n            columns={columns}\r\n            onSave={saveAutomation}\r\n            onClose={() => setEditingAutomation(null)}\r\n          />\r\n        )}\r\n\r\n        <div className=\"flex justify-end gap-2 pt-4 border-t\">\r\n          <Button variant=\"outline\" onClick={onClose}>\r\n            Cancelar\r\n          </Button>\r\n          <Button onClick={() => onSave(localAutomations)}>Salvar Automações</Button>\r\n        </div>\r\n      </DialogContent>\r\n    </Dialog>\r\n  )\r\n}\r\n\r\nfunction AutomationCard({\r\n  automation,\r\n  columns,\r\n  onEdit,\r\n  onToggle,\r\n  onDuplicate,\r\n  onDelete,\r\n}: {\r\n  automation: Automation\r\n  columns: Array<{ id: string; name: string; color: string }>\r\n  onEdit: () => void\r\n  onToggle: () => void\r\n  onDuplicate: () => void\r\n  onDelete: () => void\r\n}) {\r\n  const getTriggerLabel = (trigger: AutomationTrigger) => {\r\n    const labels = {\r\n      on_enter: \"Ao entrar na etapa\",\r\n      on_exit: \"Ao sair da etapa\",\r\n      on_time_spent: \"Após tempo na etapa\",\r\n      on_deadline: \"Próximo ao prazo\",\r\n      on_response: \"Ao receber resposta\",\r\n      on_no_response: \"Sem resposta\",\r\n    }\r\n    return labels[trigger]\r\n  }\r\n\r\n  const getActionIcon = (type: string) => {\r\n    const icons = {\r\n      whatsapp: <MessageSquare className=\"h-4 w-4\" />,\r\n      task: <CheckSquare className=\"h-4 w-4\" />,\r\n      email: <Mail className=\"h-4 w-4\" />,\r\n      notification: <Bell className=\"h-4 w-4\" />,\r\n      move_lead: <ArrowRight className=\"h-4 w-4\" />,\r\n      transfer_command: <RefreshCw className=\"h-4 w-4\" />,\r\n    }\r\n    return icons[type as keyof typeof icons]\r\n  }\r\n\r\n  const getColumnName = (columnId: string) => {\r\n    return columns.find((c) => c.id === columnId)?.name || \"Etapa não encontrada\"\r\n  }\r\n\r\n  const getActionDescription = (action: AutomationAction) => {\r\n    switch (action.type) {\r\n      case \"whatsapp\":\r\n        const recipientText =\r\n          action.recipients === \"assigned\"\r\n            ? \"responsável\"\r\n            : action.recipients === \"all_members\"\r\n              ? \"todos os membros\"\r\n              : action.recipients === \"lead_contact\"\r\n                ? \"contato principal do lead\"\r\n                : \"destinatários personalizados\"\r\n        return `Enviar WhatsApp para ${recipientText}`\r\n      case \"task\":\r\n        return `Criar tarefa: ${action.title}`\r\n      case \"email\":\r\n        return `Enviar email: ${action.subject}`\r\n      case \"notification\":\r\n        return `Notificação: ${action.title}`\r\n      case \"move_lead\":\r\n        const targetColumn = columns.find((c) => c.id === action.targetColumnId)\r\n        return `Mover lead para: ${targetColumn?.name || \"Etapa não encontrada\"}`\r\n      case \"transfer_command\":\r\n        if (action.transferType === \"user_only\") {\r\n          return \"Transferir lead para outro usuário\"\r\n        } else {\r\n          return \"Transferir lead para outro funil/etapa\"\r\n        }\r\n      case \"batch_transfer\":\r\n        return \"Transferência em lote\"\r\n      default:\r\n        return \"Ação desconhecida\"\r\n    }\r\n  }\r\n\r\n  return (\r\n    <Card className={`${automation.active ? \"border-green-200 bg-green-50\" : \"border-gray-200 bg-gray-50\"}`}>\r\n      <CardContent className=\"p-4\">\r\n        <div className=\"flex items-start justify-between\">\r\n          <div className=\"flex-1\">\r\n            <div className=\"flex items-center gap-2 mb-2\">\r\n              <h4 className=\"font-medium\">{automation.name}</h4>\r\n              {automation.isConditional && (\r\n                <Badge className=\"bg-blue-100 text-blue-800\">\r\n                  <Clock className=\"h-3 w-3 mr-1\" />\r\n                  Gatilho\r\n                </Badge>\r\n              )}\r\n              {automation.active ? (\r\n                <Badge className=\"bg-green-100 text-green-800\">Ativa</Badge>\r\n              ) : (\r\n                <Badge variant=\"secondary\">Inativa</Badge>\r\n              )}\r\n            </div>\r\n\r\n            <p className=\"text-sm text-muted-foreground mb-3\">\r\n              {getTriggerLabel(automation.trigger)}\r\n              {automation.delay && ` (${automation.delay} min de atraso)`}\r\n            </p>\r\n\r\n            {automation.isConditional && automation.conditionalFlow && (\r\n              <div className=\"mb-3 p-2 bg-blue-50 rounded-lg border border-blue-200\">\r\n                <div className=\"flex items-center gap-2 text-sm text-blue-800 mb-2\">\r\n                  <AlertTriangle className=\"h-4 w-4\" />\r\n                  <span className=\"font-medium\">Fluxo Condicional ({automation.conditionalFlow.timeLimit}h)</span>\r\n                </div>\r\n                <div className=\"grid grid-cols-2 gap-2 text-xs\">\r\n                  <div className=\"flex items-center gap-1\">\r\n                    <div className=\"w-2 h-2 bg-green-500 rounded-full\"></div>\r\n                    <span>Resposta → {getColumnName(automation.conditionalFlow.onSuccess.targetColumnId)}</span>\r\n                  </div>\r\n                  <div className=\"flex items-center gap-1\">\r\n                    <div className=\"w-2 h-2 bg-red-500 rounded-full\"></div>\r\n                    <span>Sem resposta → {getColumnName(automation.conditionalFlow.onFailure.targetColumnId)}</span>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            )}\r\n\r\n            <div className=\"flex flex-wrap gap-1\">\r\n              {automation.actions.map((action, index) => (\r\n                <Badge key={index} variant=\"outline\" className=\"flex items-center gap-1\">\r\n                  {getActionIcon(action.type)}\r\n                  <span>{getActionDescription(action)}</span>\r\n                </Badge>\r\n              ))}\r\n            </div>\r\n          </div>\r\n\r\n          <div className=\"flex items-center gap-1\">\r\n            <Button variant=\"ghost\" size=\"icon\" onClick={onToggle}>\r\n              {automation.active ? <Pause className=\"h-4 w-4\" /> : <Play className=\"h-4 w-4\" />}\r\n            </Button>\r\n            <Button variant=\"ghost\" size=\"icon\" onClick={onEdit}>\r\n              <Edit className=\"h-4 w-4\" />\r\n            </Button>\r\n            <Button variant=\"ghost\" size=\"icon\" onClick={onDuplicate}>\r\n              <Copy className=\"h-4 w-4\" />\r\n            </Button>\r\n            <Button variant=\"ghost\" size=\"icon\" onClick={onDelete}>\r\n              <Trash2 className=\"h-4 w-4\" />\r\n            </Button>\r\n          </div>\r\n        </div>\r\n      </CardContent>\r\n    </Card>\r\n  )\r\n}\r\n\r\nfunction AutomationEditor({\r\n  automation,\r\n  columns,\r\n  onSave,\r\n  onClose,\r\n}: {\r\n  automation: Automation\r\n  columns: Array<{ id: string; name: string; color: string }>\r\n  onSave: (automation: Automation) => void\r\n  onClose: () => void\r\n}) {\r\n  const [localAutomation, setLocalAutomation] = useState<Automation>({ ...automation })\r\n  const [showActionDialog, setShowActionDialog] = useState(false)\r\n  const [editingActionIndex, setEditingActionIndex] = useState<number | null>(null)\r\n\r\n  const hasWhatsAppAction = localAutomation.actions.some((action) => action.type === \"whatsapp\")\r\n\r\n  const addAction = (action: AutomationAction) => {\r\n    if (editingActionIndex !== null) {\r\n      const newActions = [...localAutomation.actions]\r\n      newActions[editingActionIndex] = action\r\n      setLocalAutomation({ ...localAutomation, actions: newActions })\r\n    } else {\r\n      setLocalAutomation({\r\n        ...localAutomation,\r\n        actions: [...localAutomation.actions, action],\r\n      })\r\n    }\r\n    setShowActionDialog(false)\r\n    setEditingActionIndex(null)\r\n  }\r\n\r\n  const removeAction = (index: number) => {\r\n    setLocalAutomation({\r\n      ...localAutomation,\r\n      actions: localAutomation.actions.filter((_, i) => i !== index),\r\n    })\r\n  }\r\n\r\n  return (\r\n    <Dialog open={true} onOpenChange={(open) => !open && onClose()}>\r\n      <DialogContent className=\"max-w-5xl max-h-[90vh] overflow-y-auto\">\r\n        <DialogHeader>\r\n          <DialogTitle className=\"flex items-center\">\r\n            {localAutomation.isConditional ? (\r\n              <>\r\n                <Clock className=\"h-5 w-5 mr-2\" />\r\n                Automação com Gatilho\r\n              </>\r\n            ) : (\r\n              <>\r\n                <Zap className=\"h-5 w-5 mr-2\" />\r\n                Automação Simples\r\n              </>\r\n            )}\r\n          </DialogTitle>\r\n        </DialogHeader>\r\n\r\n        <div className=\"space-y-6\">\r\n          <div className=\"grid grid-cols-2 gap-4\">\r\n            <div>\r\n              <Label>Nome da Automação</Label>\r\n              <Input\r\n                value={localAutomation.name}\r\n                onChange={(e) => setLocalAutomation({ ...localAutomation, name: e.target.value })}\r\n                placeholder=\"Nome da automação\"\r\n              />\r\n            </div>\r\n            <div>\r\n              <Label>Etapa</Label>\r\n              <Select\r\n                value={localAutomation.columnId}\r\n                onValueChange={(value) => setLocalAutomation({ ...localAutomation, columnId: value })}\r\n              >\r\n                <SelectTrigger>\r\n                  <SelectValue />\r\n                </SelectTrigger>\r\n                <SelectContent>\r\n                  {columns.map((column) => (\r\n                    <SelectItem key={column.id} value={column.id}>\r\n                      <div className=\"flex items-center\">\r\n                        <div className=\"w-3 h-3 rounded-full mr-2\" style={{ backgroundColor: column.color }} />\r\n                        {column.name}\r\n                      </div>\r\n                    </SelectItem>\r\n                  ))}\r\n                </SelectContent>\r\n              </Select>\r\n            </div>\r\n          </div>\r\n\r\n          {hasWhatsAppAction && (\r\n            <div className=\"flex items-center space-x-2\">\r\n              <Switch\r\n                checked={localAutomation.isConditional}\r\n                onCheckedChange={(checked) =>\r\n                  setLocalAutomation({\r\n                    ...localAutomation,\r\n                    isConditional: checked,\r\n                    conditionalFlow: checked\r\n                      ? {\r\n                          timeLimit: 24,\r\n                          onSuccess: { targetColumnId: \"\", actions: [] },\r\n                          onFailure: { targetColumnId: \"\", actions: [] },\r\n                        }\r\n                      : undefined,\r\n                  })\r\n                }\r\n              />\r\n              <Label>Automação com gatilho de tempo e resposta (WhatsApp)</Label>\r\n            </div>\r\n          )}\r\n\r\n          {hasWhatsAppAction && localAutomation.isConditional && localAutomation.conditionalFlow && (\r\n            <Card className=\"p-4 bg-blue-50 border-blue-200\">\r\n              <CardHeader className=\"p-0 mb-4\">\r\n                <CardTitle className=\"text-lg flex items-center\">\r\n                  <Clock className=\"h-5 w-5 mr-2\" />\r\n                  Configuração do Gatilho\r\n                </CardTitle>\r\n              </CardHeader>\r\n              <div className=\"space-y-4\">\r\n                <div>\r\n                  <Label>Tempo limite para resposta (horas)</Label>\r\n                  <Input\r\n                    type=\"number\"\r\n                    value={localAutomation.conditionalFlow.timeLimit}\r\n                    onChange={(e) =>\r\n                      setLocalAutomation({\r\n                        ...localAutomation,\r\n                        conditionalFlow: {\r\n                          ...localAutomation.conditionalFlow!,\r\n                          timeLimit: Number(e.target.value),\r\n                        },\r\n                      })\r\n                    }\r\n                    placeholder=\"24\"\r\n                  />\r\n                  <p className=\"text-xs text-muted-foreground mt-1\">\r\n                    Tempo que o lead tem para responder antes da ação alternativa\r\n                  </p>\r\n                </div>\r\n\r\n                <div className=\"grid grid-cols-2 gap-4\">\r\n                  <div className=\"p-3 bg-green-50 border border-green-200 rounded-lg\">\r\n                    <Label className=\"text-green-800 font-medium\">Se RESPONDER</Label>\r\n                    <Select\r\n                      value={localAutomation.conditionalFlow.onSuccess.targetColumnId}\r\n                      onValueChange={(value) =>\r\n                        setLocalAutomation({\r\n                          ...localAutomation,\r\n                          conditionalFlow: {\r\n                            ...localAutomation.conditionalFlow!,\r\n                            onSuccess: {\r\n                              ...localAutomation.conditionalFlow!.onSuccess,\r\n                              targetColumnId: value,\r\n                            },\r\n                          },\r\n                        })\r\n                      }\r\n                    >\r\n                      <SelectTrigger className=\"mt-2\">\r\n                        <SelectValue placeholder=\"Mover para etapa...\" />\r\n                      </SelectTrigger>\r\n                      <SelectContent>\r\n                        {columns.map((column) => (\r\n                          <SelectItem key={column.id} value={column.id}>\r\n                            <div className=\"flex items-center\">\r\n                              <div className=\"w-3 h-3 rounded-full mr-2\" style={{ backgroundColor: column.color }} />\r\n                              {column.name}\r\n                            </div>\r\n                          </SelectItem>\r\n                        ))}\r\n                      </SelectContent>\r\n                    </Select>\r\n                  </div>\r\n\r\n                  <div className=\"p-3 bg-red-50 border border-red-200 rounded-lg\">\r\n                    <Label className=\"text-red-800 font-medium\">Se NÃO RESPONDER</Label>\r\n                    <Select\r\n                      value={localAutomation.conditionalFlow.onFailure.targetColumnId}\r\n                      onValueChange={(value) =>\r\n                        setLocalAutomation({\r\n                          ...localAutomation,\r\n                          conditionalFlow: {\r\n                            ...localAutomation.conditionalFlow!,\r\n                            onFailure: {\r\n                              ...localAutomation.conditionalFlow!.onFailure,\r\n                              targetColumnId: value,\r\n                            },\r\n                          },\r\n                        })\r\n                      }\r\n                    >\r\n                      <SelectTrigger className=\"mt-2\">\r\n                        <SelectValue placeholder=\"Mover para etapa...\" />\r\n                      </SelectTrigger>\r\n                      <SelectContent>\r\n                        {columns.map((column) => (\r\n                          <SelectItem key={column.id} value={column.id}>\r\n                            <div className=\"flex items-center\">\r\n                              <div className=\"w-3 h-3 rounded-full mr-2\" style={{ backgroundColor: column.color }} />\r\n                              {column.name}\r\n                            </div>\r\n                          </SelectItem>\r\n                        ))}\r\n                      </SelectContent>\r\n                    </Select>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            </Card>\r\n          )}\r\n\r\n          <div className=\"grid grid-cols-2 gap-4\">\r\n            <div>\r\n              <Label>Quando executar</Label>\r\n              <Select\r\n                value={localAutomation.trigger}\r\n                onValueChange={(value: AutomationTrigger) => setLocalAutomation({ ...localAutomation, trigger: value })}\r\n              >\r\n                <SelectTrigger>\r\n                  <SelectValue />\r\n                </SelectTrigger>\r\n                <SelectContent>\r\n                  <SelectItem value=\"on_enter\">Ao entrar na etapa</SelectItem>\r\n                  <SelectItem value=\"on_exit\">Ao sair da etapa</SelectItem>\r\n                  <SelectItem value=\"on_time_spent\">Após tempo na etapa</SelectItem>\r\n                  <SelectItem value=\"on_deadline\">Próximo ao prazo</SelectItem>\r\n                </SelectContent>\r\n              </Select>\r\n            </div>\r\n            <div>\r\n              <Label>Atraso inicial (minutos)</Label>\r\n              <Input\r\n                type=\"number\"\r\n                value={localAutomation.delay || \"\"}\r\n                onChange={(e) =>\r\n                  setLocalAutomation({\r\n                    ...localAutomation,\r\n                    delay: e.target.value ? Number.parseInt(e.target.value) : undefined,\r\n                  })\r\n                }\r\n                placeholder=\"0\"\r\n              />\r\n            </div>\r\n          </div>\r\n\r\n          <div>\r\n            <div className=\"flex justify-between items-center mb-4\">\r\n              <Label>Ações Iniciais</Label>\r\n              <Button onClick={() => setShowActionDialog(true)} size=\"sm\">\r\n                <Plus className=\"h-4 w-4 mr-2\" />\r\n                Adicionar Ação\r\n              </Button>\r\n            </div>\r\n\r\n            <div className=\"space-y-2\">\r\n              {localAutomation.actions.map((action, index) => (\r\n                <ActionCard\r\n                  key={index}\r\n                  action={action}\r\n                  columns={columns}\r\n                  onEdit={() => {\r\n                    setEditingActionIndex(index)\r\n                    setShowActionDialog(true)\r\n                  }}\r\n                  onDelete={() => removeAction(index)}\r\n                />\r\n              ))}\r\n            </div>\r\n          </div>\r\n\r\n          <div className=\"flex items-center space-x-2\">\r\n            <Switch\r\n              checked={localAutomation.active}\r\n              onCheckedChange={(active) => setLocalAutomation({ ...localAutomation, active })}\r\n            />\r\n            <Label>Automação ativa</Label>\r\n          </div>\r\n        </div>\r\n\r\n        {showActionDialog && (\r\n          <ActionEditor\r\n            action={editingActionIndex !== null ? localAutomation.actions[editingActionIndex] : null}\r\n            columns={columns}\r\n            onSave={addAction}\r\n            onClose={() => {\r\n              setShowActionDialog(false)\r\n              setEditingActionIndex(null)\r\n            }}\r\n          />\r\n        )}\r\n\r\n        <div className=\"flex justify-end gap-2 pt-4 border-t sticky bottom-0 bg-white\">\r\n          <Button variant=\"outline\" onClick={onClose}>\r\n            Cancelar\r\n          </Button>\r\n          <Button onClick={() => onSave(localAutomation)}>Salvar Automação</Button>\r\n        </div>\r\n      </DialogContent>\r\n    </Dialog>\r\n  )\r\n}\r\n\r\nfunction ActionCard({\r\n  action,\r\n  columns,\r\n  onEdit,\r\n  onDelete,\r\n}: {\r\n  action: AutomationAction\r\n  columns: Array<{ id: string; name: string; color: string }>\r\n  onEdit: () => void\r\n  onDelete: () => void\r\n}) {\r\n  const getActionIcon = (type: string) => {\r\n    const icons = {\r\n      whatsapp: <MessageSquare className=\"h-4 w-4\" />,\r\n      task: <CheckSquare className=\"h-4 w-4\" />,\r\n      email: <Mail className=\"h-4 w-4\" />,\r\n      notification: <Bell className=\"h-4 w-4\" />,\r\n      move_lead: <ArrowRight className=\"h-4 w-4\" />,\r\n      transfer_command: <RefreshCw className=\"h-4 w-4\" />,\r\n    }\r\n    return icons[type as keyof typeof icons]\r\n  }\r\n\r\n  const getActionDescription = (action: AutomationAction) => {\r\n    switch (action.type) {\r\n      case \"whatsapp\":\r\n        return `WhatsApp: ${action.template.substring(0, 50)}...`\r\n      case \"task\":\r\n        return `Tarefa: ${action.title}`\r\n      case \"email\":\r\n        return `Email: ${action.subject}`\r\n      case \"notification\":\r\n        return `Notificação: ${action.title}`\r\n      case \"move_lead\":\r\n        const targetColumn = columns.find((c) => c.id === action.targetColumnId)\r\n        return `Mover para: ${targetColumn?.name || \"Etapa não encontrada\"}`\r\n      case \"transfer_command\":\r\n        return \"Transferir lead\"\r\n      case \"batch_transfer\":\r\n        return \"Transferência em lote\"\r\n      default:\r\n        return \"Ação desconhecida\"\r\n    }\r\n  }\r\n\r\n  return (\r\n    <Card className=\"border-l-4 border-l-blue-500\">\r\n      <CardContent className=\"p-3 flex items-center justify-between\">\r\n        <div className=\"flex items-center gap-2\">\r\n          {getActionIcon(action.type)}\r\n          <span className=\"text-sm\">{getActionDescription(action)}</span>\r\n        </div>\r\n        <div className=\"flex gap-1\">\r\n          <Button variant=\"ghost\" size=\"icon\" onClick={onEdit}>\r\n            <Edit className=\"h-4 w-4\" />\r\n          </Button>\r\n          <Button variant=\"ghost\" size=\"icon\" onClick={onDelete}>\r\n            <Trash2 className=\"h-4 w-4\" />\r\n          </Button>\r\n        </div>\r\n      </CardContent>\r\n    </Card>\r\n  )\r\n}\r\n\r\nfunction ActionEditor({\r\n  action,\r\n  columns,\r\n  onSave,\r\n  onClose,\r\n}: {\r\n  action: AutomationAction | null\r\n  columns: Array<{ id: string; name: string; color: string }>\r\n  onSave: (action: AutomationAction) => void\r\n  onClose: () => void\r\n}) {\r\n  const [actionType, setActionType] = useState<string>(action?.type || \"whatsapp\")\r\n  const [actionData, setActionData] = useState<Record<string, any>>(action || {})\r\n\r\n  const handleSave = () => {\r\n    let variables: Record<string, string> | undefined\r\n    if (typeof actionData.variablesText === \"string\" && actionData.variablesText.trim()) {\r\n      try { variables = JSON.parse(actionData.variablesText) } catch { variables = undefined }\r\n    }\r\n    let customRecipients: string[] | undefined\r\n    if (actionData.recipients === \"custom\" && typeof actionData.customRecipientsText === \"string\") {\r\n      customRecipients = actionData.customRecipientsText\r\n        .split(/[,;\\s]+/)\r\n        .map((s: string) => s.replace(/[^0-9]/g, \"\"))\r\n        .filter((s: string) => s.length > 0)\r\n    }\r\n    const base: any = { ...actionData }\r\n    if (variables) base.variables = variables\r\n    if (customRecipients) base.customRecipients = customRecipients\r\n    delete base.variablesText\r\n    delete base.customRecipientsText\r\n\r\n    const newAction: AutomationAction = {\r\n      type: actionType as any,\r\n      ...base,\r\n    }\r\n    onSave(newAction)\r\n  }\r\n\r\n  return (\r\n    <Dialog open={true} onOpenChange={(open) => !open && onClose()}>\r\n      <DialogContent className=\"max-w-3xl max-h-[90vh] overflow-y-auto\">\r\n        <DialogHeader>\r\n          <DialogTitle>Configurar Ação</DialogTitle>\r\n        </DialogHeader>\r\n\r\n        <div className=\"space-y-4\">\r\n          <div>\r\n            <Label>Tipo de Ação</Label>\r\n            <Select value={actionType} onValueChange={setActionType}>\r\n              <SelectTrigger>\r\n                <SelectValue />\r\n              </SelectTrigger>\r\n              <SelectContent>\r\n                <SelectItem value=\"whatsapp\">WhatsApp</SelectItem>\r\n                <SelectItem value=\"task\">Tarefa</SelectItem>\r\n                <SelectItem value=\"email\">Email</SelectItem>\r\n                <SelectItem value=\"notification\">Notificação</SelectItem>\r\n                <SelectItem value=\"move_lead\">Mover Lead</SelectItem>\r\n                <SelectItem value=\"transfer_command\">Transferir Lead</SelectItem>\r\n                <SelectItem value=\"batch_transfer\">Disparo Automático em Lote</SelectItem>\r\n              </SelectContent>\r\n            </Select>\r\n          </div>\r\n\r\n          {actionType === \"whatsapp\" && (\r\n            <>\r\n              <div>\r\n                <Label>Template</Label>\r\n                <Input\r\n                  value={actionData.template || \"\"}\r\n                  onChange={(e) => setActionData({ ...actionData, template: e.target.value })}\r\n                  placeholder=\"Mensagem WhatsApp\"\r\n                />\r\n              </div>\r\n              <div>\r\n                <Label>Destinatários</Label>\r\n                <Select\r\n                  value={actionData.recipients || \"assigned\"}\r\n                  onValueChange={(value) => setActionData({ ...actionData, recipients: value })}\r\n                >\r\n                  <SelectTrigger>\r\n                    <SelectValue />\r\n                  </SelectTrigger>\r\n                  <SelectContent>\r\n                    <SelectItem value=\"assigned\">Responsável</SelectItem>\r\n                    <SelectItem value=\"all_members\">Todos os membros</SelectItem>\r\n                    <SelectItem value=\"lead_contact\">Contato principal</SelectItem>\r\n                    <SelectItem value=\"custom\">Personalizado</SelectItem>\r\n                  </SelectContent>\r\n                </Select>\r\n              </div>\r\n              {actionData.recipients === \"custom\" && (\r\n                <div>\r\n                  <Label>Números (separados por vírgula)</Label>\r\n                  <Input\r\n                    value={actionData.customRecipientsText || \"\"}\r\n                    onChange={(e) => setActionData({ ...actionData, customRecipientsText: e.target.value })}\r\n                    placeholder=\"5541999999999, 5511999999999\"\r\n                  />\r\n                </div>\r\n              )}\r\n              <div>\r\n                <Label>Variáveis do Template (JSON)</Label>\r\n                <Input\r\n                  value={actionData.variablesText || \"\"}\r\n                  onChange={(e) => setActionData({ ...actionData, variablesText: e.target.value })}\r\n                  placeholder='{\"client_name\":\"Marcio\"}'\r\n                />\r\n              </div>\r\n            </>\r\n          )}\r\n\r\n          {actionType === \"task\" && (\r\n            <>\r\n              <div>\r\n                <Label>Título da Tarefa</Label>\r\n                <Input\r\n                  value={actionData.title || \"\"}\r\n                  onChange={(e) => setActionData({ ...actionData, title: e.target.value })}\r\n                  placeholder=\"Título\"\r\n                />\r\n              </div>\r\n              <div>\r\n                <Label>Descrição</Label>\r\n                <Input\r\n                  value={actionData.description || \"\"}\r\n                  onChange={(e) => setActionData({ ...actionData, description: e.target.value })}\r\n                  placeholder=\"Descrição\"\r\n                />\r\n              </div>\r\n              <div>\r\n                <Label>Prioridade</Label>\r\n                <Select\r\n                  value={actionData.priority || \"medium\"}\r\n                  onValueChange={(value) => setActionData({ ...actionData, priority: value })}\r\n                >\r\n                  <SelectTrigger>\r\n                    <SelectValue />\r\n                  </SelectTrigger>\r\n                  <SelectContent>\r\n                    <SelectItem value=\"low\">Baixa</SelectItem>\r\n                    <SelectItem value=\"medium\">Média</SelectItem>\r\n                    <SelectItem value=\"high\">Alta</SelectItem>\r\n                  </SelectContent>\r\n                </Select>\r\n              </div>\r\n            </>\r\n          )}\r\n\r\n          {actionType === \"email\" && (\r\n            <>\r\n              <div>\r\n                <Label>Assunto</Label>\r\n                <Input\r\n                  value={actionData.subject || \"\"}\r\n                  onChange={(e) => setActionData({ ...actionData, subject: e.target.value })}\r\n                  placeholder=\"Assunto do email\"\r\n                />\r\n              </div>\r\n              <div>\r\n                <Label>Template</Label>\r\n                <Input\r\n                  value={actionData.template || \"\"}\r\n                  onChange={(e) => setActionData({ ...actionData, template: e.target.value })}\r\n                  placeholder=\"Corpo do email\"\r\n                />\r\n              </div>\r\n            </>\r\n          )}\r\n\r\n          {actionType === \"notification\" && (\r\n            <>\r\n              <div>\r\n                <Label>Título</Label>\r\n                <Input\r\n                  value={actionData.title || \"\"}\r\n                  onChange={(e) => setActionData({ ...actionData, title: e.target.value })}\r\n                  placeholder=\"Título da notificação\"\r\n                />\r\n              </div>\r\n              <div>\r\n                <Label>Mensagem</Label>\r\n                <Input\r\n                  value={actionData.message || \"\"}\r\n                  onChange={(e) => setActionData({ ...actionData, message: e.target.value })}\r\n                  placeholder=\"Mensagem\"\r\n                />\r\n              </div>\r\n            </>\r\n          )}\r\n\r\n          {actionType === \"move_lead\" && (\r\n            <div>\r\n              <Label>Mover para Etapa</Label>\r\n              <Select\r\n                value={actionData.targetColumnId || \"\"}\r\n                onValueChange={(value) => setActionData({ ...actionData, targetColumnId: value })}\r\n              >\r\n                <SelectTrigger>\r\n                  <SelectValue placeholder=\"Selecione uma etapa\" />\r\n                </SelectTrigger>\r\n                <SelectContent>\r\n                  {columns.map((column) => (\r\n                    <SelectItem key={column.id} value={column.id}>\r\n                      <div className=\"flex items-center\">\r\n                        <div className=\"w-3 h-3 rounded-full mr-2\" style={{ backgroundColor: column.color }} />\r\n                        {column.name}\r\n                      </div>\r\n                    </SelectItem>\r\n                  ))}\r\n                </SelectContent>\r\n              </Select>\r\n            </div>\r\n          )}\r\n\r\n          {actionType === \"batch_transfer\" && (\r\n            <div className=\"space-y-4\">\r\n              <div className=\"p-4 bg-blue-50 border border-blue-200 rounded-lg\">\r\n                <h3 className=\"font-medium text-blue-900 mb-2\">Configuração de Transferência em Lote</h3>\r\n                <p className=\"text-sm text-blue-800\">\r\n                  Processa leads em grupos (lotes) com intervalo de tempo entre cada processamento. Ideal para\r\n                  distribuir carga e evitar picos de atividade.\r\n                </p>\r\n              </div>\r\n\r\n              <div>\r\n                <Label className=\"font-medium\">Transferir para Etapa</Label>\r\n                <Select\r\n                  value={actionData.targetStageId || \"\"}\r\n                  onValueChange={(value) => setActionData({ ...actionData, targetStageId: value })}\r\n                >\r\n                  <SelectTrigger>\r\n                    <SelectValue placeholder=\"Selecione a etapa de destino\" />\r\n                  </SelectTrigger>\r\n                  <SelectContent>\r\n                    {columns.map((column) => (\r\n                      <SelectItem key={column.id} value={column.id}>\r\n                        <div className=\"flex items-center\">\r\n                          <div className=\"w-3 h-3 rounded-full mr-2\" style={{ backgroundColor: column.color }} />\r\n                          {column.name}\r\n                        </div>\r\n                      </SelectItem>\r\n                    ))}\r\n                  </SelectContent>\r\n                </Select>\r\n                <p className=\"text-xs text-muted-foreground mt-1\">\r\n                  Etapa para a qual os leads serão transferidos automaticamente\r\n                </p>\r\n              </div>\r\n\r\n              <div>\r\n                <Label className=\"font-medium\">Tamanho do Lote</Label>\r\n                <Input\r\n                  type=\"number\"\r\n                  value={actionData.batchSize || 5}\r\n                  onChange={(e) => setActionData({ ...actionData, batchSize: Number(e.target.value) })}\r\n                  placeholder=\"Quantidade de leads por lote\"\r\n                  min=\"1\"\r\n                />\r\n                <p className=\"text-xs text-muted-foreground mt-1\">\r\n                  Quantos leads serão processados em cada lote. Ex: 5 leads a cada intervalo\r\n                </p>\r\n              </div>\r\n\r\n              <div className=\"grid grid-cols-2 gap-4\">\r\n                <div>\r\n                  <Label className=\"font-medium\">Intervalo entre Lotes</Label>\r\n                  <Input\r\n                    type=\"number\"\r\n                    value={actionData.intervalValue || 1}\r\n                    onChange={(e) => setActionData({ ...actionData, intervalValue: Number(e.target.value) })}\r\n                    placeholder=\"Valor\"\r\n                    min=\"1\"\r\n                  />\r\n                  <p className=\"text-xs text-muted-foreground mt-1\">Tempo de espera entre cada lote</p>\r\n                </div>\r\n                <div>\r\n                  <Label className=\"font-medium\">Unidade de Tempo</Label>\r\n                  <Select\r\n                    value={actionData.intervalUnit || \"hours\"}\r\n                    onValueChange={(value) => setActionData({ ...actionData, intervalUnit: value })}\r\n                  >\r\n                    <SelectTrigger>\r\n                      <SelectValue />\r\n                    </SelectTrigger>\r\n                    <SelectContent>\r\n                      <SelectItem value=\"minutes\">Minutos</SelectItem>\r\n                      <SelectItem value=\"hours\">Horas</SelectItem>\r\n                      <SelectItem value=\"days\">Dias</SelectItem>\r\n                    </SelectContent>\r\n                  </Select>\r\n                  <p className=\"text-xs text-muted-foreground mt-1\">Minutos, horas ou dias entre cada lote</p>\r\n                </div>\r\n              </div>\r\n\r\n              <div>\r\n                <Label className=\"font-medium\">Total de Leads a Processar (opcional)</Label>\r\n                <Input\r\n                  type=\"number\"\r\n                  value={actionData.totalLeads || \"\"}\r\n                  onChange={(e) =>\r\n                    setActionData({ ...actionData, totalLeads: e.target.value ? Number(e.target.value) : undefined })\r\n                  }\r\n                  placeholder=\"Deixe em branco para processar todos os leads\"\r\n                  min=\"1\"\r\n                />\r\n                <p className=\"text-xs text-muted-foreground mt-1\">\r\n                  Deixe em branco para processar todos os leads disponíveis, ou especifique um número máximo\r\n                </p>\r\n              </div>\r\n\r\n              <div className=\"p-3 bg-amber-50 border border-amber-200 rounded-lg\">\r\n                <p className=\"text-xs text-amber-800\">\r\n                  <strong>Exemplo:</strong> Com tamanho de lote 5, intervalo 1 hora e total 50 leads, o sistema\r\n                  processará 5 leads a cada hora até completar os 50 leads (10 horas no total).\r\n                </p>\r\n              </div>\r\n            </div>\r\n          )}\r\n        </div>\r\n\r\n        <div className=\"flex justify-end gap-2 pt-4 border-t sticky bottom-0 bg-white\">\r\n          <Button variant=\"outline\" onClick={onClose}>\r\n            Cancelar\r\n          </Button>\r\n          <Button onClick={handleSave}>Salvar Ação</Button>\r\n        </div>\r\n      </DialogContent>\r\n    </Dialog>\r\n  )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Projetos\\Back_endCrm\\kanbanproject1\\components\\kanban-settings.tsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'config' is defined but never used.","line":43,"column":12,"nodeType":"Identifier","messageId":"unusedVar","endLine":43,"endColumn":32,"suggestions":[{"messageId":"removeVar","data":{"varName":"config"},"fix":{"range":[1354,1374],"text":""},"desc":"Remove unused variable 'config'."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\"\r\n\r\nimport { useState } from \"react\"\r\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from \"@/components/ui/dialog\"\r\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\"\r\nimport { Button } from \"@/components/ui/button\"\r\nimport { Input } from \"@/components/ui/input\"\r\nimport { Label } from \"@/components/ui/label\"\r\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\"\r\nimport { Badge } from \"@/components/ui/badge\"\r\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\"\r\nimport { Textarea } from \"@/components/ui/textarea\"\r\nimport { Switch } from \"@/components/ui/switch\"\r\nimport { DragDropContext, Droppable, Draggable } from \"@hello-pangea/dnd\"\r\nimport { Plus, Trash2, GripVertical, Settings, Eye, EyeOff, Save, RotateCcw, Copy } from \"lucide-react\"\r\n\r\n// Tipos\r\ntype KanbanColumn = {\r\n  id: string\r\n  name: string\r\n  color: string\r\n  order: number\r\n  visible?: boolean\r\n  limit?: number\r\n}\r\n\r\ntype CustomField = {\r\n  id: string\r\n  name: string\r\n  type: \"text\" | \"select\" | \"date\" | \"number\" | \"boolean\"\r\n  options?: string[]\r\n  required?: boolean\r\n  visible?: boolean\r\n}\r\n\r\ntype KanbanConfig = {\r\n  columns: KanbanColumn[]\r\n  customFields: CustomField[]\r\n}\r\n\r\ntype KanbanSettingsProps = {\r\n  config: KanbanConfig\r\n  onSave: (config: KanbanConfig) => void\r\n  onClose: () => void\r\n}\r\n\r\n// Cores predefinidas\r\nconst predefinedColors = [\r\n  \"#64748b\", // slate\r\n  \"#ef4444\", // red\r\n  \"#f97316\", // orange\r\n  \"#f59e0b\", // amber\r\n  \"#eab308\", // yellow\r\n  \"#84cc16\", // lime\r\n  \"#22c55e\", // green\r\n  \"#10b981\", // emerald\r\n  \"#06b6d4\", // cyan\r\n  \"#0ea5e9\", // sky\r\n  \"#3b82f6\", // blue\r\n  \"#6366f1\", // indigo\r\n  \"#8b5cf6\", // violet\r\n  \"#a855f7\", // purple\r\n  \"#d946ef\", // fuchsia\r\n  \"#ec4899\", // pink\r\n  \"#f43f5e\", // rose\r\n]\r\n\r\nexport default function KanbanSettings({ config, onSave, onClose }: KanbanSettingsProps) {\r\n  const [localConfig, setLocalConfig] = useState<KanbanConfig>(JSON.parse(JSON.stringify(config)))\r\n  const [activeTab, setActiveTab] = useState(\"columns\")\r\n\r\n  // Manipular reordenação de colunas\r\n  const handleColumnReorder = (result: any) => {\r\n    if (!result.destination) return\r\n\r\n    const items = Array.from(localConfig.columns)\r\n    const [reorderedItem] = items.splice(result.source.index, 1)\r\n    items.splice(result.destination.index, 0, reorderedItem)\r\n\r\n    // Atualizar a ordem\r\n    const updatedItems = items.map((item, index) => ({\r\n      ...item,\r\n      order: index,\r\n    }))\r\n\r\n    setLocalConfig({\r\n      ...localConfig,\r\n      columns: updatedItems,\r\n    })\r\n  }\r\n\r\n  // Adicionar nova coluna\r\n  const addColumn = () => {\r\n    const newColumn: KanbanColumn = {\r\n      id: `col_${Date.now()}`,\r\n      name: \"Nova Coluna\",\r\n      color: predefinedColors[Math.floor(Math.random() * predefinedColors.length)],\r\n      order: localConfig.columns.length,\r\n      visible: true,\r\n      limit: undefined,\r\n    }\r\n\r\n    setLocalConfig({\r\n      ...localConfig,\r\n      columns: [...localConfig.columns, newColumn],\r\n    })\r\n  }\r\n\r\n  // Remover coluna\r\n  const removeColumn = (columnId: string) => {\r\n    setLocalConfig({\r\n      ...localConfig,\r\n      columns: localConfig.columns.filter((col) => col.id !== columnId),\r\n    })\r\n  }\r\n\r\n  // Atualizar coluna\r\n  const updateColumn = (columnId: string, updates: Partial<KanbanColumn>) => {\r\n    setLocalConfig({\r\n      ...localConfig,\r\n      columns: localConfig.columns.map((col) => (col.id === columnId ? { ...col, ...updates } : col)),\r\n    })\r\n  }\r\n\r\n  // Adicionar campo personalizado\r\n  const addCustomField = () => {\r\n    const newField: CustomField = {\r\n      id: `field_${Date.now()}`,\r\n      name: \"Novo Campo\",\r\n      type: \"text\",\r\n      required: false,\r\n      visible: true,\r\n    }\r\n\r\n    setLocalConfig({\r\n      ...localConfig,\r\n      customFields: [...localConfig.customFields, newField],\r\n    })\r\n  }\r\n\r\n  // Remover campo personalizado\r\n  const removeCustomField = (fieldId: string) => {\r\n    setLocalConfig({\r\n      ...localConfig,\r\n      customFields: localConfig.customFields.filter((field) => field.id !== fieldId),\r\n    })\r\n  }\r\n\r\n  // Atualizar campo personalizado\r\n  const updateCustomField = (fieldId: string, updates: Partial<CustomField>) => {\r\n    setLocalConfig({\r\n      ...localConfig,\r\n      customFields: localConfig.customFields.map((field) => (field.id === fieldId ? { ...field, ...updates } : field)),\r\n    })\r\n  }\r\n\r\n  // Salvar configurações\r\n  const handleSave = () => {\r\n    onSave(localConfig)\r\n  }\r\n\r\n  // Resetar para configuração padrão\r\n  const handleReset = () => {\r\n    const defaultConfig: KanbanConfig = {\r\n      columns: [\r\n        { id: \"backlog\", name: \"Backlog\", color: \"#64748b\", order: 0, visible: true },\r\n        { id: \"em_andamento\", name: \"Em Andamento\", color: \"#3b82f6\", order: 1, visible: true },\r\n        { id: \"em_revisao\", name: \"Em Revisão\", color: \"#f59e0b\", order: 2, visible: true },\r\n        { id: \"concluido\", name: \"Concluído\", color: \"#10b981\", order: 3, visible: true },\r\n      ],\r\n      customFields: [\r\n        { id: \"priority\", name: \"Prioridade\", type: \"select\", options: [\"Baixa\", \"Média\", \"Alta\"], visible: true },\r\n        { id: \"deadline\", name: \"Prazo\", type: \"date\", visible: true },\r\n        { id: \"budget\", name: \"Orçamento\", type: \"number\", visible: true },\r\n      ],\r\n    }\r\n    setLocalConfig(defaultConfig)\r\n  }\r\n\r\n  return (\r\n    <Dialog open={true} onOpenChange={(open) => !open && onClose()}>\r\n      <DialogContent className=\"max-w-4xl max-h-[90vh] overflow-y-auto\">\r\n        <DialogHeader>\r\n          <DialogTitle className=\"flex items-center\">\r\n            <Settings className=\"h-5 w-5 mr-2\" />\r\n            Personalizar Kanban\r\n          </DialogTitle>\r\n        </DialogHeader>\r\n\r\n        <Tabs value={activeTab} onValueChange={setActiveTab}>\r\n          <TabsList className=\"grid w-full grid-cols-4\">\r\n            <TabsTrigger value=\"columns\">Colunas</TabsTrigger>\r\n            <TabsTrigger value=\"fields\">Campos</TabsTrigger>\r\n            <TabsTrigger value=\"workflow\">Workflow</TabsTrigger>\r\n            <TabsTrigger value=\"appearance\">Aparência</TabsTrigger>\r\n          </TabsList>\r\n\r\n          {/* Aba de Colunas */}\r\n          <TabsContent value=\"columns\" className=\"space-y-4\">\r\n            <div className=\"flex justify-between items-center\">\r\n              <h3 className=\"text-lg font-medium\">Gerenciar Colunas</h3>\r\n              <Button onClick={addColumn} size=\"sm\">\r\n                <Plus className=\"h-4 w-4 mr-2\" />\r\n                Adicionar Coluna\r\n              </Button>\r\n            </div>\r\n\r\n            <DragDropContext onDragEnd={handleColumnReorder}>\r\n              <Droppable droppableId=\"columns\">\r\n                {(provided) => (\r\n                  <div {...provided.droppableProps} ref={provided.innerRef} className=\"space-y-2\">\r\n                    {localConfig.columns\r\n                      .sort((a, b) => a.order - b.order)\r\n                      .map((column, index) => (\r\n                        <Draggable key={column.id} draggableId={column.id} index={index}>\r\n                          {(provided) => (\r\n                            <Card\r\n                              ref={provided.innerRef}\r\n                              {...provided.draggableProps}\r\n                              className=\"border-l-4\"\r\n                              style={{ borderLeftColor: column.color }}\r\n                            >\r\n                              <CardContent className=\"p-4\">\r\n                                <div className=\"flex items-center gap-4\">\r\n                                  <div {...provided.dragHandleProps}>\r\n                                    <GripVertical className=\"h-5 w-5 text-muted-foreground cursor-grab\" />\r\n                                  </div>\r\n\r\n                                  <div className=\"flex-1 grid grid-cols-3 gap-4\">\r\n                                    <div>\r\n                                      <Label>Nome da Coluna</Label>\r\n                                      <Input\r\n                                        value={column.name}\r\n                                        onChange={(e) => updateColumn(column.id, { name: e.target.value })}\r\n                                        placeholder=\"Nome da coluna\"\r\n                                      />\r\n                                    </div>\r\n\r\n                                    <div>\r\n                                      <Label>Cor</Label>\r\n                                      <div className=\"flex gap-2 mt-1\">\r\n                                        <div\r\n                                          className=\"w-8 h-8 rounded border cursor-pointer\"\r\n                                          style={{ backgroundColor: column.color }}\r\n                                          onClick={() => {\r\n                                            // Aqui você pode implementar um color picker\r\n                                          }}\r\n                                        />\r\n                                        <Select\r\n                                          value={column.color}\r\n                                          onValueChange={(color) => updateColumn(column.id, { color })}\r\n                                        >\r\n                                          <SelectTrigger className=\"flex-1\">\r\n                                            <SelectValue />\r\n                                          </SelectTrigger>\r\n                                          <SelectContent>\r\n                                            <div className=\"grid grid-cols-6 gap-2 p-2\">\r\n                                              {predefinedColors.map((color) => (\r\n                                                <SelectItem key={color} value={color}>\r\n                                                  <div\r\n                                                    className=\"w-6 h-6 rounded border\"\r\n                                                    style={{ backgroundColor: color }}\r\n                                                  />\r\n                                                </SelectItem>\r\n                                              ))}\r\n                                            </div>\r\n                                          </SelectContent>\r\n                                        </Select>\r\n                                      </div>\r\n                                    </div>\r\n\r\n                                    <div>\r\n                                      <Label>Limite de Cards</Label>\r\n                                      <Input\r\n                                        type=\"number\"\r\n                                        value={column.limit || \"\"}\r\n                                        onChange={(e) =>\r\n                                          updateColumn(column.id, {\r\n                                            limit: e.target.value ? Number.parseInt(e.target.value) : undefined,\r\n                                          })\r\n                                        }\r\n                                        placeholder=\"Sem limite\"\r\n                                      />\r\n                                    </div>\r\n                                  </div>\r\n\r\n                                  <div className=\"flex items-center gap-2\">\r\n                                    <Button\r\n                                      variant=\"ghost\"\r\n                                      size=\"icon\"\r\n                                      onClick={() => updateColumn(column.id, { visible: !column.visible })}\r\n                                    >\r\n                                      {column.visible ? <Eye className=\"h-4 w-4\" /> : <EyeOff className=\"h-4 w-4\" />}\r\n                                    </Button>\r\n                                    <Button\r\n                                      variant=\"ghost\"\r\n                                      size=\"icon\"\r\n                                      onClick={() => removeColumn(column.id)}\r\n                                      disabled={localConfig.columns.length <= 1}\r\n                                    >\r\n                                      <Trash2 className=\"h-4 w-4\" />\r\n                                    </Button>\r\n                                  </div>\r\n                                </div>\r\n                              </CardContent>\r\n                            </Card>\r\n                          )}\r\n                        </Draggable>\r\n                      ))}\r\n                    {provided.placeholder}\r\n                  </div>\r\n                )}\r\n              </Droppable>\r\n            </DragDropContext>\r\n          </TabsContent>\r\n\r\n          {/* Aba de Campos Personalizados */}\r\n          <TabsContent value=\"fields\" className=\"space-y-4\">\r\n            <div className=\"flex justify-between items-center\">\r\n              <h3 className=\"text-lg font-medium\">Campos Personalizados</h3>\r\n              <Button onClick={addCustomField} size=\"sm\">\r\n                <Plus className=\"h-4 w-4 mr-2\" />\r\n                Adicionar Campo\r\n              </Button>\r\n            </div>\r\n\r\n            <div className=\"space-y-4\">\r\n              {localConfig.customFields.map((field) => (\r\n                <Card key={field.id}>\r\n                  <CardContent className=\"p-4\">\r\n                    <div className=\"grid grid-cols-4 gap-4\">\r\n                      <div>\r\n                        <Label>Nome do Campo</Label>\r\n                        <Input\r\n                          value={field.name}\r\n                          onChange={(e) => updateCustomField(field.id, { name: e.target.value })}\r\n                          placeholder=\"Nome do campo\"\r\n                        />\r\n                      </div>\r\n\r\n                      <div>\r\n                        <Label>Tipo</Label>\r\n                        <Select\r\n                          value={field.type}\r\n                          onValueChange={(type: CustomField[\"type\"]) => updateCustomField(field.id, { type })}\r\n                        >\r\n                          <SelectTrigger>\r\n                            <SelectValue />\r\n                          </SelectTrigger>\r\n                          <SelectContent>\r\n                            <SelectItem value=\"text\">Texto</SelectItem>\r\n                            <SelectItem value=\"select\">Seleção</SelectItem>\r\n                            <SelectItem value=\"date\">Data</SelectItem>\r\n                            <SelectItem value=\"number\">Número</SelectItem>\r\n                            <SelectItem value=\"boolean\">Sim/Não</SelectItem>\r\n                          </SelectContent>\r\n                        </Select>\r\n                      </div>\r\n\r\n                      <div>\r\n                        <Label>Configurações</Label>\r\n                        <div className=\"flex items-center gap-2 mt-2\">\r\n                          <div className=\"flex items-center space-x-2\">\r\n                            <Switch\r\n                              id={`required-${field.id}`}\r\n                              checked={field.required || false}\r\n                              onCheckedChange={(required) => updateCustomField(field.id, { required })}\r\n                            />\r\n                            <Label htmlFor={`required-${field.id}`} className=\"text-sm\">\r\n                              Obrigatório\r\n                            </Label>\r\n                          </div>\r\n                          <div className=\"flex items-center space-x-2\">\r\n                            <Switch\r\n                              id={`visible-${field.id}`}\r\n                              checked={field.visible !== false}\r\n                              onCheckedChange={(visible) => updateCustomField(field.id, { visible })}\r\n                            />\r\n                            <Label htmlFor={`visible-${field.id}`} className=\"text-sm\">\r\n                              Visível\r\n                            </Label>\r\n                          </div>\r\n                        </div>\r\n                      </div>\r\n\r\n                      <div className=\"flex items-end\">\r\n                        <Button variant=\"ghost\" size=\"icon\" onClick={() => removeCustomField(field.id)}>\r\n                          <Trash2 className=\"h-4 w-4\" />\r\n                        </Button>\r\n                      </div>\r\n                    </div>\r\n\r\n                    {field.type === \"select\" && (\r\n                      <div className=\"mt-4\">\r\n                        <Label>Opções (uma por linha)</Label>\r\n                        <Textarea\r\n                          value={field.options?.join(\"\\n\") || \"\"}\r\n                          onChange={(e) =>\r\n                            updateCustomField(field.id, {\r\n                              options: e.target.value.split(\"\\n\").filter((opt) => opt.trim()),\r\n                            })\r\n                          }\r\n                          placeholder=\"Opção 1&#10;Opção 2&#10;Opção 3\"\r\n                          rows={3}\r\n                        />\r\n                      </div>\r\n                    )}\r\n                  </CardContent>\r\n                </Card>\r\n              ))}\r\n            </div>\r\n          </TabsContent>\r\n\r\n          {/* Aba de Workflow */}\r\n          <TabsContent value=\"workflow\" className=\"space-y-4\">\r\n            <h3 className=\"text-lg font-medium\">Regras de Workflow</h3>\r\n            <Card>\r\n              <CardHeader>\r\n                <CardTitle>Transições Permitidas</CardTitle>\r\n              </CardHeader>\r\n              <CardContent>\r\n                <p className=\"text-muted-foreground mb-4\">\r\n                  Configure quais transições entre colunas são permitidas para diferentes tipos de usuários.\r\n                </p>\r\n                <div className=\"space-y-4\">\r\n                  {localConfig.columns.map((column) => (\r\n                    <div key={column.id} className=\"flex items-center gap-4\">\r\n                      <Badge style={{ backgroundColor: column.color, color: \"white\" }}>{column.name}</Badge>\r\n                      <span className=\"text-sm text-muted-foreground\">pode mover para:</span>\r\n                      <div className=\"flex gap-2\">\r\n                        {localConfig.columns\r\n                          .filter((col) => col.id !== column.id)\r\n                          .map((targetColumn) => (\r\n                            <Badge key={targetColumn.id} variant=\"outline\">\r\n                              {targetColumn.name}\r\n                            </Badge>\r\n                          ))}\r\n                      </div>\r\n                    </div>\r\n                  ))}\r\n                </div>\r\n              </CardContent>\r\n            </Card>\r\n          </TabsContent>\r\n\r\n          {/* Aba de Aparência */}\r\n          <TabsContent value=\"appearance\" className=\"space-y-4\">\r\n            <h3 className=\"text-lg font-medium\">Configurações de Aparência</h3>\r\n            <div className=\"grid grid-cols-2 gap-4\">\r\n              <Card>\r\n                <CardHeader>\r\n                  <CardTitle>Layout</CardTitle>\r\n                </CardHeader>\r\n                <CardContent className=\"space-y-4\">\r\n                  <div className=\"flex items-center justify-between\">\r\n                    <Label>Mostrar contador de cards</Label>\r\n                    <Switch defaultChecked />\r\n                  </div>\r\n                  <div className=\"flex items-center justify-between\">\r\n                    <Label>Mostrar avatares dos responsáveis</Label>\r\n                    <Switch defaultChecked />\r\n                  </div>\r\n                  <div className=\"flex items-center justify-between\">\r\n                    <Label>Compactar visualização</Label>\r\n                    <Switch />\r\n                  </div>\r\n                </CardContent>\r\n              </Card>\r\n\r\n              <Card>\r\n                <CardHeader>\r\n                  <CardTitle>Cores e Temas</CardTitle>\r\n                </CardHeader>\r\n                <CardContent className=\"space-y-4\">\r\n                  <div>\r\n                    <Label>Tema do kanban</Label>\r\n                    <Select defaultValue=\"light\">\r\n                      <SelectTrigger>\r\n                        <SelectValue />\r\n                      </SelectTrigger>\r\n                      <SelectContent>\r\n                        <SelectItem value=\"light\">Claro</SelectItem>\r\n                        <SelectItem value=\"dark\">Escuro</SelectItem>\r\n                        <SelectItem value=\"auto\">Automático</SelectItem>\r\n                      </SelectContent>\r\n                    </Select>\r\n                  </div>\r\n                  <div>\r\n                    <Label>Densidade dos cards</Label>\r\n                    <Select defaultValue=\"normal\">\r\n                      <SelectTrigger>\r\n                        <SelectValue />\r\n                      </SelectTrigger>\r\n                      <SelectContent>\r\n                        <SelectItem value=\"compact\">Compacto</SelectItem>\r\n                        <SelectItem value=\"normal\">Normal</SelectItem>\r\n                        <SelectItem value=\"comfortable\">Confortável</SelectItem>\r\n                      </SelectContent>\r\n                    </Select>\r\n                  </div>\r\n                </CardContent>\r\n              </Card>\r\n            </div>\r\n          </TabsContent>\r\n        </Tabs>\r\n\r\n        <div className=\"flex justify-between pt-4 border-t\">\r\n          <div className=\"flex gap-2\">\r\n            <Button variant=\"outline\" onClick={handleReset}>\r\n              <RotateCcw className=\"h-4 w-4 mr-2\" />\r\n              Resetar\r\n            </Button>\r\n            <Button variant=\"outline\">\r\n              <Copy className=\"h-4 w-4 mr-2\" />\r\n              Duplicar Config\r\n            </Button>\r\n          </div>\r\n          <div className=\"flex gap-2\">\r\n            <Button variant=\"outline\" onClick={onClose}>\r\n              Cancelar\r\n            </Button>\r\n            <Button onClick={handleSave}>\r\n              <Save className=\"h-4 w-4 mr-2\" />\r\n              Salvar Configurações\r\n            </Button>\r\n          </div>\r\n        </div>\r\n      </DialogContent>\r\n    </Dialog>\r\n  )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Projetos\\Back_endCrm\\kanbanproject1\\components\\kanban-templates.tsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'template' is defined but never used.","line":36,"column":21,"nodeType":"Identifier","messageId":"unusedVar","endLine":36,"endColumn":45,"suggestions":[{"messageId":"removeVar","data":{"varName":"template"},"fix":{"range":[961,985],"text":""},"desc":"Remove unused variable 'template'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'categories' is assigned a value but never used.","line":243,"column":9,"nodeType":"Identifier","messageId":"unusedVar","endLine":243,"endColumn":19},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'categories' is assigned a value but never used.","line":243,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":243,"endColumn":19}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\"\r\n\r\nimport type React from \"react\"\r\n\r\nimport { useState } from \"react\"\r\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from \"@/components/ui/dialog\"\r\nimport { Button } from \"@/components/ui/button\"\r\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\"\r\nimport { Badge } from \"@/components/ui/badge\"\r\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\"\r\nimport { Building2, ShoppingCart, TrendingUp, Home, Shield, Briefcase, Eye, Check, Zap } from \"lucide-react\"\r\n\r\n// Tipos\r\ntype KanbanTemplate = {\r\n  id: string\r\n  name: string\r\n  description: string\r\n  icon: React.ReactNode\r\n  category: string\r\n  columns: Array<{\r\n    id: string\r\n    name: string\r\n    color: string\r\n    order: number\r\n  }>\r\n  customFields: Array<{\r\n    id: string\r\n    name: string\r\n    type: string\r\n    options?: string[]\r\n    visible: boolean\r\n  }>\r\n}\r\n\r\ntype KanbanTemplatesProps = {\r\n  onApplyTemplate: (template: KanbanTemplate) => void\r\n  onClose: () => void\r\n}\r\n\r\n// Templates predefinidos para CRM de Leads\r\nconst leadTemplates: KanbanTemplate[] = [\r\n  {\r\n    id: \"sales_classic\",\r\n    name: \"Pipeline de Vendas Clássico\",\r\n    description: \"Pipeline tradicional para vendas B2B com foco em qualificação e fechamento\",\r\n    icon: <TrendingUp className=\"h-5 w-5\" />,\r\n    category: \"Vendas\",\r\n    columns: [\r\n      { id: \"lead\", name: \"Leads\", color: \"#64748b\", order: 0 },\r\n      { id: \"qualificado\", name: \"Qualificados\", color: \"#3b82f6\", order: 1 },\r\n      { id: \"proposta\", name: \"Proposta\", color: \"#f59e0b\", order: 2 },\r\n      { id: \"negociacao\", name: \"Negociação\", color: \"#8b5cf6\", order: 3 },\r\n      { id: \"fechado\", name: \"Fechado\", color: \"#10b981\", order: 4 },\r\n      { id: \"perdido\", name: \"Perdidos\", color: \"#ef4444\", order: 5 },\r\n    ],\r\n    customFields: [\r\n      {\r\n        id: \"priority\",\r\n        name: \"Prioridade\",\r\n        type: \"select\",\r\n        options: [\"Baixa\", \"Média\", \"Alta\", \"Urgente\"],\r\n        visible: true,\r\n      },\r\n      { id: \"leadValue\", name: \"Valor Estimado\", type: \"number\", visible: true },\r\n      { id: \"closeDate\", name: \"Data Prevista\", type: \"date\", visible: true },\r\n      {\r\n        id: \"leadSource\",\r\n        name: \"Origem\",\r\n        type: \"select\",\r\n        options: [\"Website\", \"Indicação\", \"Google Ads\", \"LinkedIn\"],\r\n        visible: true,\r\n      },\r\n    ],\r\n  },\r\n  {\r\n    id: \"saas_sales\",\r\n    name: \"Vendas SaaS\",\r\n    description: \"Pipeline otimizado para vendas de software como serviço com trial e onboarding\",\r\n    icon: <Zap className=\"h-5 w-5\" />,\r\n    category: \"SaaS\",\r\n    columns: [\r\n      { id: \"trial\", name: \"Trial\", color: \"#64748b\", order: 0 },\r\n      { id: \"mql\", name: \"MQL\", color: \"#3b82f6\", order: 1 },\r\n      { id: \"sql\", name: \"SQL\", color: \"#f59e0b\", order: 2 },\r\n      { id: \"oportunidade\", name: \"Oportunidade\", color: \"#8b5cf6\", order: 3 },\r\n      { id: \"cliente\", name: \"Cliente\", color: \"#10b981\", order: 4 },\r\n      { id: \"churn\", name: \"Churn\", color: \"#ef4444\", order: 5 },\r\n    ],\r\n    customFields: [\r\n      { id: \"trialDays\", name: \"Dias de Trial\", type: \"number\", visible: true },\r\n      { id: \"mrr\", name: \"MRR Estimado\", type: \"number\", visible: true },\r\n      {\r\n        id: \"planType\",\r\n        name: \"Tipo de Plano\",\r\n        type: \"select\",\r\n        options: [\"Básico\", \"Pro\", \"Enterprise\"],\r\n        visible: true,\r\n      },\r\n      {\r\n        id: \"companySize\",\r\n        name: \"Tamanho da Empresa\",\r\n        type: \"select\",\r\n        options: [\"1-10\", \"11-50\", \"51-200\", \"200+\"],\r\n        visible: true,\r\n      },\r\n    ],\r\n  },\r\n  {\r\n    id: \"real_estate\",\r\n    name: \"Imobiliário\",\r\n    description: \"Pipeline especializado para corretores e imobiliárias\",\r\n    icon: <Home className=\"h-5 w-5\" />,\r\n    category: \"Imobiliário\",\r\n    columns: [\r\n      { id: \"lead\", name: \"Lead\", color: \"#64748b\", order: 0 },\r\n      { id: \"visita\", name: \"Visita Agendada\", color: \"#3b82f6\", order: 1 },\r\n      { id: \"interessado\", name: \"Interessado\", color: \"#f59e0b\", order: 2 },\r\n      { id: \"proposta\", name: \"Proposta\", color: \"#8b5cf6\", order: 3 },\r\n      { id: \"contrato\", name: \"Contrato\", color: \"#06b6d4\", order: 4 },\r\n      { id: \"vendido\", name: \"Vendido\", color: \"#10b981\", order: 5 },\r\n      { id: \"perdido\", name: \"Perdido\", color: \"#ef4444\", order: 6 },\r\n    ],\r\n    customFields: [\r\n      {\r\n        id: \"propertyType\",\r\n        name: \"Tipo de Imóvel\",\r\n        type: \"select\",\r\n        options: [\"Casa\", \"Apartamento\", \"Terreno\", \"Comercial\"],\r\n        visible: true,\r\n      },\r\n      { id: \"budget\", name: \"Orçamento\", type: \"number\", visible: true },\r\n      { id: \"location\", name: \"Localização\", type: \"text\", visible: true },\r\n      {\r\n        id: \"financing\",\r\n        name: \"Financiamento\",\r\n        type: \"select\",\r\n        options: [\"À vista\", \"Financiado\", \"FGTS\"],\r\n        visible: true,\r\n      },\r\n    ],\r\n  },\r\n  {\r\n    id: \"insurance\",\r\n    name: \"Seguros\",\r\n    description: \"Pipeline para corretores de seguros com foco em cotações e apólices\",\r\n    icon: <Shield className=\"h-5 w-5\" />,\r\n    category: \"Seguros\",\r\n    columns: [\r\n      { id: \"prospect\", name: \"Prospect\", color: \"#64748b\", order: 0 },\r\n      { id: \"cotacao\", name: \"Cotação\", color: \"#3b82f6\", order: 1 },\r\n      { id: \"analise\", name: \"Análise\", color: \"#f59e0b\", order: 2 },\r\n      { id: \"aprovado\", name: \"Aprovado\", color: \"#8b5cf6\", order: 3 },\r\n      { id: \"apolice\", name: \"Apólice Emitida\", color: \"#10b981\", order: 4 },\r\n      { id: \"rejeitado\", name: \"Rejeitado\", color: \"#ef4444\", order: 5 },\r\n    ],\r\n    customFields: [\r\n      {\r\n        id: \"insuranceType\",\r\n        name: \"Tipo de Seguro\",\r\n        type: \"select\",\r\n        options: [\"Auto\", \"Vida\", \"Residencial\", \"Empresarial\"],\r\n        visible: true,\r\n      },\r\n      { id: \"premium\", name: \"Prêmio Anual\", type: \"number\", visible: true },\r\n      { id: \"coverage\", name: \"Cobertura\", type: \"number\", visible: true },\r\n      {\r\n        id: \"riskProfile\",\r\n        name: \"Perfil de Risco\",\r\n        type: \"select\",\r\n        options: [\"Baixo\", \"Médio\", \"Alto\"],\r\n        visible: true,\r\n      },\r\n    ],\r\n  },\r\n  {\r\n    id: \"consulting\",\r\n    name: \"Consultoria\",\r\n    description: \"Pipeline para empresas de consultoria e serviços profissionais\",\r\n    icon: <Briefcase className=\"h-5 w-5\" />,\r\n    category: \"Consultoria\",\r\n    columns: [\r\n      { id: \"consulta\", name: \"Consulta Inicial\", color: \"#64748b\", order: 0 },\r\n      { id: \"descoberta\", name: \"Descoberta\", color: \"#3b82f6\", order: 1 },\r\n      { id: \"proposta\", name: \"Proposta\", color: \"#f59e0b\", order: 2 },\r\n      { id: \"negociacao\", name: \"Negociação\", color: \"#8b5cf6\", order: 3 },\r\n      { id: \"contrato\", name: \"Contrato Assinado\", color: \"#10b981\", order: 4 },\r\n      { id: \"perdido\", name: \"Perdido\", color: \"#ef4444\", order: 5 },\r\n    ],\r\n    customFields: [\r\n      {\r\n        id: \"serviceType\",\r\n        name: \"Tipo de Serviço\",\r\n        type: \"select\",\r\n        options: [\"Estratégia\", \"Processos\", \"TI\", \"RH\", \"Financeiro\"],\r\n        visible: true,\r\n      },\r\n      { id: \"projectValue\", name: \"Valor do Projeto\", type: \"number\", visible: true },\r\n      { id: \"duration\", name: \"Duração (meses)\", type: \"number\", visible: true },\r\n      { id: \"complexity\", name: \"Complexidade\", type: \"select\", options: [\"Baixa\", \"Média\", \"Alta\"], visible: true },\r\n    ],\r\n  },\r\n  {\r\n    id: \"ecommerce_b2b\",\r\n    name: \"E-commerce B2B\",\r\n    description: \"Pipeline para vendas B2B de e-commerce e marketplace\",\r\n    icon: <ShoppingCart className=\"h-5 w-5\" />,\r\n    category: \"E-commerce\",\r\n    columns: [\r\n      { id: \"visitante\", name: \"Visitante\", color: \"#64748b\", order: 0 },\r\n      { id: \"cadastrado\", name: \"Cadastrado\", color: \"#3b82f6\", order: 1 },\r\n      { id: \"cotacao\", name: \"Cotação\", color: \"#f59e0b\", order: 2 },\r\n      { id: \"pedido\", name: \"Pedido\", color: \"#8b5cf6\", order: 3 },\r\n      { id: \"pagamento\", name: \"Pagamento\", color: \"#06b6d4\", order: 4 },\r\n      { id: \"entregue\", name: \"Entregue\", color: \"#10b981\", order: 5 },\r\n      { id: \"cancelado\", name: \"Cancelado\", color: \"#ef4444\", order: 6 },\r\n    ],\r\n    customFields: [\r\n      { id: \"orderValue\", name: \"Valor do Pedido\", type: \"number\", visible: true },\r\n      {\r\n        id: \"paymentMethod\",\r\n        name: \"Forma de Pagamento\",\r\n        type: \"select\",\r\n        options: [\"Boleto\", \"Cartão\", \"PIX\", \"Transferência\"],\r\n        visible: true,\r\n      },\r\n      { id: \"deliveryTime\", name: \"Prazo de Entrega\", type: \"number\", visible: true },\r\n      {\r\n        id: \"customerType\",\r\n        name: \"Tipo de Cliente\",\r\n        type: \"select\",\r\n        options: [\"Novo\", \"Recorrente\", \"VIP\"],\r\n        visible: true,\r\n      },\r\n    ],\r\n  },\r\n]\r\n\r\nexport default function KanbanTemplates({ onApplyTemplate, onClose }: KanbanTemplatesProps) {\r\n  const [selectedTemplate, setSelectedTemplate] = useState<KanbanTemplate | null>(null)\r\n  const [activeCategory, setActiveCategory] = useState(\"all\")\r\n\r\n  // Obter categorias únicas\r\n  const categories = [\"all\", ...Array.from(new Set(leadTemplates.map((t) => t.category)))]\r\n\r\n  // Filtrar templates por categoria\r\n  const filteredTemplates =\r\n    activeCategory === \"all\" ? leadTemplates : leadTemplates.filter((t) => t.category === activeCategory)\r\n\r\n  const handleApplyTemplate = (template: KanbanTemplate) => {\r\n    onApplyTemplate(template)\r\n  }\r\n\r\n  return (\r\n    <Dialog open={true} onOpenChange={(open) => !open && onClose()}>\r\n      <DialogContent className=\"max-w-6xl max-h-[90vh] overflow-y-auto\">\r\n        <DialogHeader>\r\n          <DialogTitle className=\"flex items-center\">\r\n            <Briefcase className=\"h-5 w-5 mr-2\" />\r\n            Templates de Pipeline de Leads\r\n          </DialogTitle>\r\n        </DialogHeader>\r\n\r\n        <div className=\"space-y-6\">\r\n          {/* Filtros por categoria */}\r\n          <Tabs value={activeCategory} onValueChange={setActiveCategory}>\r\n            <TabsList className=\"grid w-full grid-cols-7\">\r\n              <TabsTrigger value=\"all\">Todos</TabsTrigger>\r\n              <TabsTrigger value=\"Vendas\">Vendas</TabsTrigger>\r\n              <TabsTrigger value=\"SaaS\">SaaS</TabsTrigger>\r\n              <TabsTrigger value=\"Imobiliário\">Imobiliário</TabsTrigger>\r\n              <TabsTrigger value=\"Seguros\">Seguros</TabsTrigger>\r\n              <TabsTrigger value=\"Consultoria\">Consultoria</TabsTrigger>\r\n              <TabsTrigger value=\"E-commerce\">E-commerce</TabsTrigger>\r\n            </TabsList>\r\n\r\n            <TabsContent value={activeCategory} className=\"mt-6\">\r\n              <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\r\n                {filteredTemplates.map((template) => (\r\n                  <TemplateCard\r\n                    key={template.id}\r\n                    template={template}\r\n                    onView={() => setSelectedTemplate(template)}\r\n                    onApply={() => handleApplyTemplate(template)}\r\n                  />\r\n                ))}\r\n              </div>\r\n            </TabsContent>\r\n          </Tabs>\r\n\r\n          {filteredTemplates.length === 0 && (\r\n            <div className=\"text-center py-12\">\r\n              <Building2 className=\"h-12 w-12 mx-auto text-muted-foreground mb-4\" />\r\n              <h3 className=\"text-lg font-medium mb-2\">Nenhum template encontrado</h3>\r\n              <p className=\"text-muted-foreground\">Tente selecionar uma categoria diferente.</p>\r\n            </div>\r\n          )}\r\n        </div>\r\n\r\n        {/* Modal de visualização do template */}\r\n        {selectedTemplate && (\r\n          <TemplatePreview\r\n            template={selectedTemplate}\r\n            onClose={() => setSelectedTemplate(null)}\r\n            onApply={() => {\r\n              handleApplyTemplate(selectedTemplate)\r\n              setSelectedTemplate(null)\r\n            }}\r\n          />\r\n        )}\r\n\r\n        <div className=\"flex justify-end gap-2 pt-4 border-t\">\r\n          <Button variant=\"outline\" onClick={onClose}>\r\n            Fechar\r\n          </Button>\r\n        </div>\r\n      </DialogContent>\r\n    </Dialog>\r\n  )\r\n}\r\n\r\n// Componente do card de template\r\nfunction TemplateCard({\r\n  template,\r\n  onView,\r\n  onApply,\r\n}: {\r\n  template: KanbanTemplate\r\n  onView: () => void\r\n  onApply: () => void\r\n}) {\r\n  return (\r\n    <Card className=\"hover:shadow-md transition-shadow\">\r\n      <CardHeader className=\"pb-3\">\r\n        <div className=\"flex items-center justify-between\">\r\n          <div className=\"flex items-center space-x-2\">\r\n            {template.icon}\r\n            <CardTitle className=\"text-lg\">{template.name}</CardTitle>\r\n          </div>\r\n          <Badge variant=\"secondary\">{template.category}</Badge>\r\n        </div>\r\n      </CardHeader>\r\n      <CardContent className=\"space-y-4\">\r\n        <p className=\"text-sm text-muted-foreground\">{template.description}</p>\r\n\r\n        {/* Preview das colunas */}\r\n        <div className=\"space-y-2\">\r\n          <p className=\"text-xs font-medium text-muted-foreground\">ETAPAS DO PIPELINE:</p>\r\n          <div className=\"flex flex-wrap gap-1\">\r\n            {template.columns.slice(0, 4).map((column) => (\r\n              <Badge key={column.id} variant=\"outline\" className=\"text-xs\">\r\n                {column.name}\r\n              </Badge>\r\n            ))}\r\n            {template.columns.length > 4 && (\r\n              <Badge variant=\"outline\" className=\"text-xs\">\r\n                +{template.columns.length - 4}\r\n              </Badge>\r\n            )}\r\n          </div>\r\n        </div>\r\n\r\n        {/* Campos personalizados */}\r\n        <div className=\"space-y-2\">\r\n          <p className=\"text-xs font-medium text-muted-foreground\">CAMPOS PERSONALIZADOS:</p>\r\n          <div className=\"flex flex-wrap gap-1\">\r\n            {template.customFields.slice(0, 3).map((field) => (\r\n              <Badge key={field.id} variant=\"secondary\" className=\"text-xs\">\r\n                {field.name}\r\n              </Badge>\r\n            ))}\r\n            {template.customFields.length > 3 && (\r\n              <Badge variant=\"secondary\" className=\"text-xs\">\r\n                +{template.customFields.length - 3}\r\n              </Badge>\r\n            )}\r\n          </div>\r\n        </div>\r\n\r\n        <div className=\"flex gap-2 pt-2\">\r\n          <Button variant=\"outline\" size=\"sm\" onClick={onView} className=\"flex-1 bg-transparent\">\r\n            <Eye className=\"h-4 w-4 mr-2\" />\r\n            Visualizar\r\n          </Button>\r\n          <Button size=\"sm\" onClick={onApply} className=\"flex-1\">\r\n            <Check className=\"h-4 w-4 mr-2\" />\r\n            Usar Template\r\n          </Button>\r\n        </div>\r\n      </CardContent>\r\n    </Card>\r\n  )\r\n}\r\n\r\n// Componente de preview do template\r\nfunction TemplatePreview({\r\n  template,\r\n  onClose,\r\n  onApply,\r\n}: {\r\n  template: KanbanTemplate\r\n  onClose: () => void\r\n  onApply: () => void\r\n}) {\r\n  return (\r\n    <Dialog open={true} onOpenChange={(open) => !open && onClose()}>\r\n      <DialogContent className=\"max-w-4xl max-h-[90vh] overflow-y-auto\">\r\n        <DialogHeader>\r\n          <DialogTitle className=\"flex items-center flex-wrap gap-2\">\r\n            {template.icon}\r\n            <span className=\"ml-2\">{template.name}</span>\r\n            <Badge variant=\"secondary\" className=\"ml-2\">\r\n              {template.category}\r\n            </Badge>\r\n          </DialogTitle>\r\n        </DialogHeader>\r\n\r\n        <div className=\"space-y-6\">\r\n          <p className=\"text-muted-foreground\">{template.description}</p>\r\n\r\n          <div>\r\n            <h3 className=\"font-medium mb-3\">Etapas do Pipeline</h3>\r\n            <div className=\"grid grid-cols-2 md:grid-cols-3 gap-3\">\r\n              {template.columns\r\n                .sort((a, b) => a.order - b.order)\r\n                .map((column) => (\r\n                  <div key={column.id} className=\"flex items-center space-x-2 p-2 border rounded-lg\">\r\n                    <div className=\"w-3 h-3 rounded-full flex-shrink-0\" style={{ backgroundColor: column.color }} />\r\n                    <span className=\"text-sm font-medium truncate\">{column.name}</span>\r\n                  </div>\r\n                ))}\r\n            </div>\r\n          </div>\r\n\r\n          <div>\r\n            <h3 className=\"font-medium mb-3\">Campos Personalizados</h3>\r\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-3\">\r\n              {template.customFields.map((field) => (\r\n                <div key={field.id} className=\"flex items-center justify-between p-2 border rounded-lg\">\r\n                  <div className=\"min-w-0 flex-1\">\r\n                    <span className=\"text-sm font-medium truncate block\">{field.name}</span>\r\n                    <p className=\"text-xs text-muted-foreground capitalize\">{field.type}</p>\r\n                  </div>\r\n                  {field.options && (\r\n                    <Badge variant=\"outline\" className=\"text-xs ml-2 flex-shrink-0\">\r\n                      {field.options.length} opções\r\n                    </Badge>\r\n                  )}\r\n                </div>\r\n              ))}\r\n            </div>\r\n          </div>\r\n\r\n          {/* Fluxo do Pipeline */}\r\n          <div>\r\n            <h3 className=\"font-medium mb-3\">Fluxo do Pipeline</h3>\r\n            <div className=\"flex flex-wrap items-center gap-2\">\r\n              {template.columns\r\n                .sort((a, b) => a.order - b.order)\r\n                .map((column, index) => (\r\n                  <div key={column.id} className=\"flex items-center gap-2\">\r\n                    <div className=\"flex items-center space-x-2 px-3 py-2 bg-gray-50 rounded-lg\">\r\n                      <div className=\"w-2 h-2 rounded-full flex-shrink-0\" style={{ backgroundColor: column.color }} />\r\n                      <span className=\"text-sm font-medium whitespace-nowrap\">{column.name}</span>\r\n                    </div>\r\n                    {index < template.columns.length - 1 && (\r\n                      <div className=\"text-muted-foreground flex-shrink-0\">→</div>\r\n                    )}\r\n                  </div>\r\n                ))}\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Botões */}\r\n        <div className=\"flex justify-end gap-2 pt-4 border-t mt-4\">\r\n          <Button variant=\"outline\" onClick={onClose}>\r\n            Fechar\r\n          </Button>\r\n          <Button onClick={onApply}>\r\n            <Check className=\"h-4 w-4 mr-2\" />\r\n            Usar Este Template\r\n          </Button>\r\n        </div>\r\n      </DialogContent>\r\n    </Dialog>\r\n  )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Projetos\\Back_endCrm\\kanbanproject1\\components\\landing-pages\\builder\\builder-header.tsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'elements' is defined but never used.","line":28,"column":17,"nodeType":"Identifier","messageId":"unusedVar","endLine":28,"endColumn":43,"suggestions":[{"messageId":"removeVar","data":{"varName":"elements"},"fix":{"range":[808,834],"text":""},"desc":"Remove unused variable 'elements'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'elements' is defined but never used.","line":29,"column":13,"nodeType":"Identifier","messageId":"unusedVar","endLine":29,"endColumn":39,"suggestions":[{"messageId":"removeVar","data":{"varName":"elements"},"fix":{"range":[857,884],"text":""},"desc":"Remove unused variable 'elements'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'settings' is defined but never used.","line":29,"column":41,"nodeType":"Identifier","messageId":"unusedVar","endLine":29,"endColumn":64,"suggestions":[{"messageId":"removeVar","data":{"varName":"settings"},"fix":{"range":[883,908],"text":""},"desc":"Remove unused variable 'settings'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'handleLoad' is assigned a value but never used.","line":79,"column":9,"nodeType":"Identifier","messageId":"unusedVar","endLine":79,"endColumn":19,"suggestions":[{"messageId":"removeVar","data":{"varName":"handleLoad"},"fix":{"range":[2414,3078],"text":""},"desc":"Remove unused variable 'handleLoad'."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'handleLoad' is assigned a value but never used.","line":79,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":79,"endColumn":19},{"ruleId":"no-unused-vars","severity":1,"message":"'e' is defined but never used.","line":89,"column":16,"nodeType":"Identifier","messageId":"unusedVar","endLine":89,"endColumn":17},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'e' is defined but never used.","line":89,"column":16,"nodeType":null,"messageId":"unusedVar","endLine":89,"endColumn":17}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":7,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { Button } from '@/components/ui/button';\nimport { \n  Save, \n  Eye, \n  Download,\n  LayoutTemplate,\n  MoreVertical,\n  Tag,\n  Filter\n} from 'lucide-react';\nimport { BuilderElement, PageSettings } from '@/lib/types/builder-types';\nimport { useToast } from '@/hooks/use-toast';\nimport { useState } from 'react';\nimport { TemplatesDialog } from './templates-dialog';\nimport { Template } from '@/lib/data/templates';\nimport { v4 as uuidv4 } from 'uuid';\nimport {\n  DropdownMenu,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuTrigger,\n} from '@/components/ui/dropdown-menu';\nimport { TagSelectionDialog } from './dialogs/tag-selection-dialog';\nimport { FunnelSelectionDialog } from './dialogs/funnel-selection-dialog';\n\ninterface BuilderHeaderProps {\n  elements: BuilderElement[];\n  setElements: (elements: BuilderElement[]) => void;\n  onSave?: (elements: BuilderElement[], settings?: PageSettings) => void;\n  onClose?: () => void;\n  initialSettings?: PageSettings;\n}\n\nexport function BuilderHeader({ elements, setElements, onSave, onClose, initialSettings }: BuilderHeaderProps) {\n  const [showTemplates, setShowTemplates] = useState(false);\n  const { toast } = useToast();\n  \n  const [settings, setSettings] = useState<PageSettings>(initialSettings || {});\n  const [showTagDialog, setShowTagDialog] = useState(false);\n  const [showFunnelDialog, setShowFunnelDialog] = useState(false);\n\n  const handleTemplateSelect = (template: Template) => {\n    if (elements.length > 0) {\n      if (!confirm('Isso irá substituir o layout atual. Deseja continuar?')) {\n        return;\n      }\n    }\n\n    // Deep clone to ensure new IDs\n    const cloneElement = (el: BuilderElement): BuilderElement => ({\n      ...el,\n      id: uuidv4(),\n      children: el.children ? el.children.map(cloneElement) : undefined\n    });\n\n    const newElements = template.elements.map(cloneElement);\n    \n    setElements(newElements);\n    setShowTemplates(false);\n    toast({\n      title: \"Template aplicado!\",\n      description: `O template \"${template.name}\" foi carregado com sucesso.`,\n    });\n  };\n\n  const handleSave = () => {\n    if (onSave) {\n      onSave(elements, settings);\n    } else {\n      const data = JSON.stringify(elements, null, 2);\n      localStorage.setItem('landing-page-builder', data);\n      toast({\n        title: \"Página salva!\",\n        description: \"Seu layout foi salvo com sucesso.\",\n      });\n    }\n  };\n\n  const handleLoad = () => {\n    const data = localStorage.getItem('landing-page-builder');\n    if (data) {\n      try {\n        const parsed = JSON.parse(data);\n        setElements(parsed);\n        toast({\n          title: \"Página carregada!\",\n          description: \"Seu layout foi restaurado com sucesso.\",\n        });\n      } catch (e) {\n        toast({\n          title: \"Erro ao carregar\",\n          description: \"Não foi possível carregar o layout salvo.\",\n          variant: \"destructive\",\n        });\n      }\n    } else {\n      toast({\n        title: \"Nenhum layout salvo\",\n        description: \"Não há nenhum layout salvo no navegador.\",\n      });\n    }\n  };\n\n  const handleExport = () => {\n    const data = JSON.stringify(elements, null, 2);\n    const blob = new Blob([data], { type: 'application/json' });\n    const url = URL.createObjectURL(blob);\n    const a = document.createElement('a');\n    a.href = url;\n    a.download = 'landing-page.json';\n    a.click();\n    URL.revokeObjectURL(url);\n    toast({\n      title: \"Exportado!\",\n      description: \"O arquivo JSON foi baixado.\",\n    });\n  };\n\n  return (\n    <header className=\"h-16 border-b border-border bg-card px-4 flex items-center justify-between shrink-0 z-20\">\n      <div className=\"flex items-center gap-4\">\n        <h1 className=\"font-bold text-lg\">Page Weaver</h1>\n        <div className=\"h-6 w-px bg-border\" />\n        <Button \n          variant=\"outline\" \n          size=\"sm\" \n          onClick={() => setShowTemplates(true)}\n          className=\"gap-2\"\n        >\n          <LayoutTemplate className=\"w-4 h-4\" />\n          Templates\n        </Button>\n      </div>\n\n      <div className=\"flex items-center gap-2\">\n        <DropdownMenu>\n          <DropdownMenuTrigger asChild>\n            <Button variant=\"ghost\" size=\"icon\" className=\"h-8 w-8\">\n              <MoreVertical className=\"w-4 h-4\" />\n            </Button>\n          </DropdownMenuTrigger>\n          <DropdownMenuContent align=\"end\">\n            <DropdownMenuItem onClick={() => setShowTagDialog(true)}>\n              <Tag className=\"w-4 h-4 mr-2\" />\n              Vincular Tag\n            </DropdownMenuItem>\n            <DropdownMenuItem onClick={() => setShowFunnelDialog(true)}>\n              <Filter className=\"w-4 h-4 mr-2\" />\n              Vincular Funil\n            </DropdownMenuItem>\n          </DropdownMenuContent>\n        </DropdownMenu>\n\n        <Button variant=\"ghost\" size=\"sm\" onClick={handleExport}>\n          <Download className=\"w-4 h-4 mr-2\" />\n          Exportar JSON\n        </Button>\n        {onClose && (\n          <Button variant=\"ghost\" size=\"sm\" onClick={onClose}>\n            Voltar\n          </Button>\n        )}\n        <Button variant=\"outline\" size=\"sm\" onClick={handleSave}>\n          <Save className=\"w-4 h-4 mr-2\" />\n          Salvar\n        </Button>\n        <Button size=\"sm\">\n          <Eye className=\"w-4 h-4 mr-2\" />\n          Visualizar\n        </Button>\n      </div>\n\n      <TemplatesDialog \n        open={showTemplates} \n        onOpenChange={setShowTemplates}\n        onSelect={handleTemplateSelect}\n      />\n      \n      <TagSelectionDialog\n        open={showTagDialog}\n        onOpenChange={setShowTagDialog}\n        selectedTagIds={settings.tagIds || []}\n        onTagsChange={(tagIds) => setSettings(prev => ({ ...prev, tagIds }))}\n      />\n      \n      <FunnelSelectionDialog\n        open={showFunnelDialog}\n        onOpenChange={setShowFunnelDialog}\n        funnelId={settings.funnelId}\n        stageId={settings.stageId}\n        onSelectionChange={(funnelId, stageId, funnelStage) => setSettings(prev => ({ ...prev, funnelId, stageId, funnelStage }))}\n      />\n    </header>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Projetos\\Back_endCrm\\kanbanproject1\\components\\landing-pages\\builder\\builder-layout.tsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'elements' is defined but never used.","line":24,"column":13,"nodeType":"Identifier","messageId":"unusedVar","endLine":24,"endColumn":39,"suggestions":[{"messageId":"removeVar","data":{"varName":"elements"},"fix":{"range":[808,835],"text":""},"desc":"Remove unused variable 'elements'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'settings' is defined but never used.","line":24,"column":41,"nodeType":"Identifier","messageId":"unusedVar","endLine":24,"endColumn":64,"suggestions":[{"messageId":"removeVar","data":{"varName":"settings"},"fix":{"range":[834,859],"text":""},"desc":"Remove unused variable 'settings'."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has missing dependencies: 'initialElements' and 'setElements'. Either include them or remove the dependency array.","line":45,"column":6,"nodeType":"ArrayExpression","endLine":45,"endColumn":8,"suggestions":[{"desc":"Update the dependencies array to be: [initialElements, setElements]","fix":{"range":[1310,1312],"text":"[initialElements, setElements]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import {\n  DndContext,\n  DragEndEvent,\n  DragOverlay,\n  DragStartEvent,\n  DragOverEvent,\n  PointerSensor,\n  useSensor,\n  useSensors,\n  closestCenter,\n} from '@dnd-kit/core';\nimport { useState, useEffect } from 'react';\nimport { ComponentsSidebar } from './components-sidebar';\nimport { Canvas } from './canvas';\nimport { PropertiesPanel } from './properties-panel';\nimport { BuilderHeader } from './builder-header';\nimport { useBuilder } from '@/hooks/use-builder';\nimport { ElementType, COMPONENT_DEFINITIONS, BuilderElement, PageSettings } from '@/lib/types/builder-types';\nimport { findElementById, moveElement, insertElementAfter, insertElementAtEnd } from '@/lib/builder/tree-utils';\nimport { v4 as uuidv4 } from 'uuid';\n\ninterface BuilderLayoutProps {\n  initialElements?: BuilderElement[];\n  onSave?: (elements: BuilderElement[], settings?: PageSettings) => void;\n  onClose?: () => void;\n  initialSettings?: PageSettings;\n}\n\nexport function BuilderLayout({ initialElements, onSave, onClose, initialSettings }: BuilderLayoutProps) {\n  const {\n    elements,\n    selectedId,\n    selectedElement,\n    setSelectedId,\n    updateElement,\n    deleteElement,\n    duplicateElement,\n    setElements,\n  } = useBuilder();\n\n  useEffect(() => {\n    if (initialElements) {\n      setElements(initialElements);\n    }\n  }, []); // Run only once on mount\n\n  const [activeId, setActiveId] = useState<string | null>(null);\n\n  const sensors = useSensors(\n    useSensor(PointerSensor, {\n      activationConstraint: {\n        distance: 8,\n      },\n    })\n  );\n\n  const handleDragStart = (event: DragStartEvent) => {\n    setActiveId(String(event.active.id));\n  };\n\n  const handleDragOver = (event: DragOverEvent) => {\n    const { active, over } = event;\n    if (!over) return;\n    if (active.id === over.id) return;\n\n    const activeIdStr = String(active.id);\n    const overIdStr = String(over.id);\n\n    // Only handle moving existing elements during drag over\n    if (activeIdStr.startsWith('new-')) return;\n\n    // Use moveElement to speculatively move items in the UI\n    const activeNode = findElementById(elements, activeIdStr);\n    const overNode = findElementById(elements, overIdStr);\n\n    if (!activeNode || !overNode) return;\n\n    // Only move if they are in different containers to avoid flickering in same container\n    // But dnd-kit sortable needs items to be in the list to sort them.\n    // If we move across containers, we must update state.\n    if (activeNode.parent?.id !== overNode.parent?.id) {\n       setElements((items) => moveElement(items, activeIdStr, overIdStr));\n    }\n  };\n\n  const handleDragEnd = (event: DragEndEvent) => {\n    const { active, over } = event;\n    setActiveId(null);\n\n    if (!over) return;\n\n    const activeIdStr = String(active.id);\n    const overIdStr = String(over.id);\n    \n    // Handle new component\n    if (activeIdStr.startsWith('new-')) {\n      const type = activeIdStr.replace('new-', '') as ElementType;\n      const definition = COMPONENT_DEFINITIONS.find(c => c.type === type);\n      if (!definition) return;\n\n      // Create new element logic\n      let children: BuilderElement[] | undefined = undefined;\n      if (type === 'section') children = [];\n      else if (type === 'columns') {\n         children = [\n            { id: uuidv4(), type: 'column', content: {}, styles: {}, children: [] },\n            { id: uuidv4(), type: 'column', content: {}, styles: {}, children: [] }\n         ];\n      } else if (type === 'column') children = [];\n\n      const newElement: BuilderElement = {\n        id: uuidv4(),\n        type,\n        content: { \n          ...definition.defaultContent,\n          columns: type === 'columns' ? 2 : undefined\n        },\n        styles: { ...definition.defaultStyles },\n        children\n      };\n      \n      const overNode = findElementById(elements, overIdStr);\n      const isContainer = overNode && (overNode.element.type === 'column' || overNode.element.type === 'section');\n\n      if (overIdStr === 'canvas') {\n        setElements(prev => [...prev, newElement]);\n      } else if (isContainer) {\n        setElements(prev => insertElementAtEnd(prev, overIdStr, newElement));\n      } else {\n        setElements(prev => insertElementAfter(prev, overIdStr, newElement));\n      }\n    } else {\n        // Handle existing component move (reorder)\n        if (activeIdStr !== overIdStr) {\n            setElements((items) => moveElement(items, activeIdStr, overIdStr));\n        }\n    }\n  };\n\n  const getActiveComponent = () => {\n    if (!activeId) return null;\n    \n    if (activeId.startsWith('new-')) {\n      const type = activeId.replace('new-', '') as ElementType;\n      const def = COMPONENT_DEFINITIONS.find(c => c.type === type);\n      return def?.label || type;\n    }\n    \n    const node = findElementById(elements, activeId);\n    if (node) {\n      const def = COMPONENT_DEFINITIONS.find(c => c.type === node.element.type);\n      return def?.label || node.element.type;\n    }\n    \n    return null;\n  };\n\n  return (\n    <DndContext\n      sensors={sensors}\n      collisionDetection={closestCenter}\n      onDragStart={handleDragStart}\n      onDragOver={handleDragOver}\n      onDragEnd={handleDragEnd}\n    >\n      <div className=\"h-screen flex flex-col bg-background\">\n        <BuilderHeader \n          elements={elements} \n          setElements={setElements} \n          onSave={onSave}\n          onClose={onClose}\n          initialSettings={initialSettings}\n        />\n        \n        <div className=\"flex-1 flex overflow-hidden\">\n          <ComponentsSidebar />\n          <Canvas\n            elements={elements}\n            selectedId={selectedId}\n            onSelect={setSelectedId}\n            onDelete={deleteElement}\n            onDuplicate={duplicateElement}\n            onUpdate={updateElement}\n          />\n          <PropertiesPanel\n            element={selectedElement}\n            onUpdate={updateElement}\n          />\n        </div>\n      </div>\n\n      <DragOverlay>\n        {activeId && (\n          <div className=\"px-4 py-2 bg-primary text-primary-foreground rounded-lg shadow-xl text-sm font-medium animate-pulse\">\n            {getActiveComponent()}\n          </div>\n        )}\n      </DragOverlay>\n    </DndContext>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Projetos\\Back_endCrm\\kanbanproject1\\components\\landing-pages\\builder\\canvas.tsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'id' is defined but never used.","line":12,"column":14,"nodeType":"Identifier","messageId":"unusedVar","endLine":12,"endColumn":31,"suggestions":[{"messageId":"removeVar","data":{"varName":"id"},"fix":{"range":[472,489],"text":""},"desc":"Remove unused variable 'id'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'id' is defined but never used.","line":13,"column":14,"nodeType":"Identifier","messageId":"unusedVar","endLine":13,"endColumn":24,"suggestions":[{"messageId":"removeVar","data":{"varName":"id"},"fix":{"range":[513,523],"text":""},"desc":"Remove unused variable 'id'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'id' is defined but never used.","line":14,"column":17,"nodeType":"Identifier","messageId":"unusedVar","endLine":14,"endColumn":27,"suggestions":[{"messageId":"removeVar","data":{"varName":"id"},"fix":{"range":[550,560],"text":""},"desc":"Remove unused variable 'id'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'id' is defined but never used.","line":15,"column":14,"nodeType":"Identifier","messageId":"unusedVar","endLine":15,"endColumn":24,"suggestions":[{"messageId":"removeVar","data":{"varName":"id"},"fix":{"range":[584,595],"text":""},"desc":"Remove unused variable 'id'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'updates' is defined but never used.","line":15,"column":26,"nodeType":"Identifier","messageId":"unusedVar","endLine":15,"endColumn":58,"suggestions":[{"messageId":"removeVar","data":{"varName":"updates"},"fix":{"range":[594,628],"text":""},"desc":"Remove unused variable 'updates'."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useDroppable } from '@dnd-kit/core';\nimport { SortableContext, verticalListSortingStrategy } from '@dnd-kit/sortable';\nimport { BuilderElement } from '@/lib/types/builder-types';\nimport { ElementRenderer } from './element-renderer';\nimport { SortableElement } from './sortable-element';\nimport { GripVertical } from 'lucide-react';\nimport { cn } from '@/lib/utils';\n\ninterface CanvasProps {\n  elements: BuilderElement[];\n  selectedId: string | null;\n  onSelect: (id: string | null) => void;\n  onDelete: (id: string) => void;\n  onDuplicate: (id: string) => void;\n  onUpdate: (id: string, updates: Partial<BuilderElement>) => void;\n}\n\nexport function Canvas({ elements, selectedId, onSelect, onDelete, onDuplicate, onUpdate }: CanvasProps) {\n  const { setNodeRef, isOver } = useDroppable({\n    id: 'canvas',\n  });\n\n  return (\n    <div className=\"flex-1 bg-muted/30 overflow-auto p-6\">\n      <div className=\"max-w-4xl mx-auto\">\n        <div\n          ref={setNodeRef}\n          className={cn(\n            'bg-background min-h-[calc(100vh-120px)] rounded-lg shadow-xl p-8 transition-colors',\n            isOver && 'ring-2 ring-primary ring-offset-2'\n          )}\n          onClick={() => onSelect(null)}\n        >\n          {elements.length === 0 ? (\n            <div className=\"h-full flex flex-col items-center justify-center py-20\">\n              <div className=\"w-16 h-16 rounded-full bg-muted flex items-center justify-center mb-4\">\n                <GripVertical className=\"w-8 h-8 text-muted-foreground\" />\n              </div>\n              <h3 className=\"text-lg font-medium text-foreground mb-2\">\n                Canvas Vazio\n              </h3>\n              <p className=\"text-sm text-muted-foreground text-center max-w-sm\">\n                Arraste componentes da barra lateral esquerda para começar a construir sua landing page\n              </p>\n            </div>\n          ) : (\n            <SortableContext items={elements.map(e => e.id)} strategy={verticalListSortingStrategy}>\n              <div className=\"space-y-4\">\n                {elements.map((element) => (\n                  <SortableElement\n                    key={element.id}\n                    element={element}\n                    isSelected={selectedId === element.id}\n                    onSelect={() => onSelect(element.id)}\n                    onDelete={() => onDelete(element.id)}\n                    onDuplicate={() => onDuplicate(element.id)}\n                  >\n                    <ElementRenderer \n                      element={element} \n                      isSelected={selectedId === element.id}\n                      onUpdate={(updates) => onUpdate(element.id, updates)}\n                      onElementUpdate={onUpdate}\n                      onSelect={onSelect}\n                      onDelete={onDelete}\n                      onDuplicate={onDuplicate}\n                      selectedId={selectedId}\n                    />\n                  </SortableElement>\n                ))}\n              </div>\n            </SortableContext>\n          )}\n        </div>\n      </div>\n    </div>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Projetos\\Back_endCrm\\kanbanproject1\\components\\landing-pages\\builder\\components-sidebar.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projetos\\Back_endCrm\\kanbanproject1\\components\\landing-pages\\builder\\dialogs\\funnel-selection-dialog.tsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'open' is defined but never used.","line":24,"column":18,"nodeType":"Identifier","messageId":"unusedVar","endLine":24,"endColumn":31,"suggestions":[{"messageId":"removeVar","data":{"varName":"open"},"fix":{"range":[636,649],"text":""},"desc":"Remove unused variable 'open'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'funnelId' is defined but never used.","line":27,"column":23,"nodeType":"Identifier","messageId":"unusedVar","endLine":27,"endColumn":39,"suggestions":[{"messageId":"removeVar","data":{"varName":"funnelId"},"fix":{"range":[723,740],"text":""},"desc":"Remove unused variable 'funnelId'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'stageId' is defined but never used.","line":27,"column":41,"nodeType":"Identifier","messageId":"unusedVar","endLine":27,"endColumn":56,"suggestions":[{"messageId":"removeVar","data":{"varName":"stageId"},"fix":{"range":[739,756],"text":""},"desc":"Remove unused variable 'stageId'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'stageName' is defined but never used.","line":27,"column":58,"nodeType":"Identifier","messageId":"unusedVar","endLine":27,"endColumn":76,"suggestions":[{"messageId":"removeVar","data":{"varName":"stageName"},"fix":{"range":[756,776],"text":""},"desc":"Remove unused variable 'stageName'."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from 'react';\nimport {\n  Dialog,\n  DialogContent,\n  DialogHeader,\n  DialogTitle,\n  DialogDescription,\n} from '@/components/ui/dialog';\nimport { Button } from '@/components/ui/button';\nimport { Label } from '@/components/ui/label';\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from '@/components/ui/select';\nimport { useApiFunnels } from '@/hooks/use-api-funnels';\nimport { Filter, AlertCircle, RefreshCw } from 'lucide-react';\nimport { Alert, AlertDescription } from '@/components/ui/alert';\n\ninterface FunnelSelectionDialogProps {\n  open: boolean;\n  onOpenChange: (open: boolean) => void;\n  funnelId?: string;\n  stageId?: string;\n  onSelectionChange: (funnelId: string, stageId: string, stageName?: string) => void;\n}\n\nexport function FunnelSelectionDialog({\n  open,\n  onOpenChange,\n  funnelId,\n  stageId,\n  onSelectionChange,\n}: FunnelSelectionDialogProps) {\n  const { funnels, fetchFunnels, isLoading, error } = useApiFunnels();\n  const [selectedFunnelId, setSelectedFunnelId] = useState<string>(funnelId || '');\n  const [selectedStageId, setSelectedStageId] = useState<string>(stageId || '');\n\n  useEffect(() => {\n    if (open) {\n      fetchFunnels();\n    }\n  }, [open, fetchFunnels]);\n\n  useEffect(() => {\n    if (funnelId) setSelectedFunnelId(funnelId);\n    if (stageId) setSelectedStageId(stageId);\n  }, [funnelId, stageId]);\n\n  const selectedFunnel = funnels.find(f => f.id === selectedFunnelId);\n  const stages = selectedFunnel?.columns || [];\n\n  const handleSave = () => {\n    const stage = stages.find(s => s.id === selectedStageId);\n    onSelectionChange(selectedFunnelId, selectedStageId, stage?.name);\n    onOpenChange(false);\n  };\n\n  return (\n    <Dialog open={open} onOpenChange={onOpenChange}>\n      <DialogContent className=\"sm:max-w-[425px]\">\n        <DialogHeader>\n          <DialogTitle className=\"flex items-center gap-2\">\n            <Filter className=\"w-5 h-5\" />\n            Vincular Funil\n          </DialogTitle>\n          <DialogDescription>\n            Selecione o funil e a etapa onde os leads capturados serão criados.\n          </DialogDescription>\n        </DialogHeader>\n        \n        <div className=\"grid gap-4 py-4\">\n          {error && (\n            <Alert variant=\"destructive\">\n              <AlertCircle className=\"h-4 w-4\" />\n              <AlertDescription>\n                Erro ao carregar funis: {error}\n                <Button \n                  variant=\"link\" \n                  className=\"p-0 h-auto text-destructive underline ml-2\" \n                  onClick={() => fetchFunnels()}\n                >\n                  Tentar novamente\n                </Button>\n              </AlertDescription>\n            </Alert>\n          )}\n\n          <div className=\"space-y-2\">\n            <div className=\"flex justify-between items-center\">\n              <Label>Funil</Label>\n              <Button \n                variant=\"ghost\" \n                size=\"sm\" \n                className=\"h-6 w-6 p-0\" \n                onClick={() => fetchFunnels()} \n                disabled={isLoading}\n                title=\"Atualizar lista de funis\"\n              >\n                <RefreshCw className={`h-3 w-3 ${isLoading ? 'animate-spin' : ''}`} />\n              </Button>\n            </div>\n            <Select \n              value={selectedFunnelId} \n              onValueChange={(val) => {\n                setSelectedFunnelId(val);\n                setSelectedStageId(''); // Reset stage when funnel changes\n              }}\n              disabled={isLoading || funnels.length === 0}\n            >\n              <SelectTrigger>\n                <SelectValue placeholder={isLoading ? \"Carregando funis...\" : \"Selecione um funil\"} />\n              </SelectTrigger>\n              <SelectContent>\n                {funnels.length === 0 && !isLoading ? (\n                  <div className=\"p-2 text-sm text-muted-foreground text-center\">\n                    Nenhum funil encontrado\n                  </div>\n                ) : (\n                  funnels.map(funnel => (\n                    <SelectItem key={funnel.id} value={funnel.id}>\n                      {funnel.name}\n                    </SelectItem>\n                  ))\n                )}\n              </SelectContent>\n            </Select>\n            {funnels.length === 0 && !isLoading && !error && (\n              <p className=\"text-xs text-muted-foreground\">\n                Você ainda não possui funis cadastrados.\n              </p>\n            )}\n          </div>\n\n          <div className=\"space-y-2\">\n            <Label>Etapa do Funil</Label>\n            <Select \n              value={selectedStageId} \n              onValueChange={setSelectedStageId}\n              disabled={!selectedFunnelId || stages.length === 0}\n            >\n              <SelectTrigger>\n                <SelectValue placeholder=\"Selecione uma etapa\" />\n              </SelectTrigger>\n              <SelectContent>\n                {stages.map(stage => (\n                  <SelectItem key={stage.id} value={stage.id}>\n                    <div className=\"flex items-center gap-2\">\n                      <div \n                        className=\"w-2 h-2 rounded-full\" \n                        style={{ backgroundColor: stage.color }}\n                      />\n                      {stage.name}\n                    </div>\n                  </SelectItem>\n                ))}\n              </SelectContent>\n            </Select>\n          </div>\n        </div>\n        \n        <div className=\"flex justify-end gap-2\">\n          <Button variant=\"outline\" onClick={() => onOpenChange(false)}>\n            Cancelar\n          </Button>\n          <Button \n            onClick={handleSave} \n            disabled={!selectedFunnelId || !selectedStageId}\n          >\n            Salvar Vinculação\n          </Button>\n        </div>\n      </DialogContent>\n    </Dialog>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Projetos\\Back_endCrm\\kanbanproject1\\components\\landing-pages\\builder\\dialogs\\tag-selection-dialog.tsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'CommandSeparator' is defined but never used.","line":19,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":19,"endColumn":19,"suggestions":[{"messageId":"removeVar","data":{"varName":"CommandSeparator"},"fix":{"range":[405,425],"text":""},"desc":"Remove unused variable 'CommandSeparator'."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'CommandSeparator' is defined but never used.","line":19,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":19,"endColumn":19},{"ruleId":"no-unused-vars","severity":1,"message":"'open' is defined but never used.","line":28,"column":18,"nodeType":"Identifier","messageId":"unusedVar","endLine":28,"endColumn":31,"suggestions":[{"messageId":"removeVar","data":{"varName":"open"},"fix":{"range":[720,733],"text":""},"desc":"Remove unused variable 'open'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'tagIds' is defined but never used.","line":30,"column":18,"nodeType":"Identifier","messageId":"unusedVar","endLine":30,"endColumn":34,"suggestions":[{"messageId":"removeVar","data":{"varName":"tagIds"},"fix":{"range":[789,805],"text":""},"desc":"Remove unused variable 'tagIds'."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from 'react';\nimport {\n  Dialog,\n  DialogContent,\n  DialogHeader,\n  DialogTitle,\n  DialogDescription,\n} from '@/components/ui/dialog';\nimport { Button } from '@/components/ui/button';\nimport { Label } from '@/components/ui/label';\nimport { Badge } from '@/components/ui/badge';\nimport {\n  Command,\n  CommandEmpty,\n  CommandGroup,\n  CommandInput,\n  CommandItem,\n  CommandList,\n  CommandSeparator,\n} from \"@/components/ui/command\"\nimport { Check, Plus, Tag as TagIcon, X } from 'lucide-react';\nimport { cn } from \"@/lib/utils\"\nimport { useApiTags } from '@/hooks/use-api-tags';\nimport { Tag } from '@/lib/api/tags-api';\n\ninterface TagSelectionDialogProps {\n  open: boolean;\n  onOpenChange: (open: boolean) => void;\n  selectedTagIds: string[];\n  onTagsChange: (tagIds: string[]) => void;\n}\n\nexport function TagSelectionDialog({\n  open,\n  onOpenChange,\n  selectedTagIds,\n  onTagsChange,\n}: TagSelectionDialogProps) {\n  const { tags: availableTags, fetchTags, createTag } = useApiTags();\n  const [searchValue, setSearchValue] = useState(\"\");\n\n  useEffect(() => {\n    if (open) {\n      fetchTags();\n    }\n  }, [open, fetchTags]);\n\n  const handleCreateTag = async () => {\n    const tagName = searchValue.trim();\n    if (!tagName) return;\n\n    // Check if tag already exists (case insensitive)\n    const existingTag = availableTags.find(t => t.name.toLowerCase() === tagName.toLowerCase());\n    if (existingTag) {\n      if (!selectedTagIds.includes(existingTag.id)) {\n        onTagsChange([...selectedTagIds, existingTag.id]);\n      }\n      setSearchValue(\"\");\n      return;\n    }\n\n    try {\n      const newTag = await createTag({ name: tagName });\n      onTagsChange([...selectedTagIds, newTag.id]);\n      setSearchValue(\"\");\n    } catch (error) {\n      console.error(\"Failed to create tag\", error);\n    }\n  };\n\n  const toggleTag = (tagId: string) => {\n    if (selectedTagIds.includes(tagId)) {\n      onTagsChange(selectedTagIds.filter(id => id !== tagId));\n    } else {\n      onTagsChange([...selectedTagIds, tagId]);\n    }\n  };\n\n  const getSelectedTags = () => {\n    return selectedTagIds.map(id => {\n      const tag = availableTags.find(t => t.id === id);\n      return tag || { id, name: id, color: '#3b82f6' } as Tag; // Fallback for ID-only tags\n    });\n  };\n\n  return (\n    <Dialog open={open} onOpenChange={onOpenChange}>\n      <DialogContent className=\"sm:max-w-[450px] p-0 gap-0 overflow-hidden\">\n        <DialogHeader className=\"px-4 py-4 border-b\">\n          <DialogTitle className=\"flex items-center gap-2\">\n            <TagIcon className=\"w-5 h-5\" />\n            Vincular Tags\n          </DialogTitle>\n          <DialogDescription>\n            Busque tags existentes ou crie novas para segmentar seus leads.\n          </DialogDescription>\n        </DialogHeader>\n\n        <div className=\"p-4 bg-muted/20 border-b\">\n           <Label className=\"mb-2 block text-xs font-medium uppercase text-muted-foreground\">\n             Tags Selecionadas\n           </Label>\n           <div className=\"flex flex-wrap gap-2 min-h-[32px]\">\n             {selectedTagIds.length === 0 ? (\n               <span className=\"text-sm text-muted-foreground italic\">Nenhuma tag selecionada</span>\n             ) : (\n               getSelectedTags().map(tag => (\n                 <Badge \n                    key={tag.id} \n                    style={{ backgroundColor: tag.color, color: 'white' }}\n                    className=\"gap-1 pr-1 hover:opacity-90\"\n                 >\n                   {tag.name}\n                   <Button\n                     variant=\"ghost\"\n                     size=\"icon\"\n                     className=\"h-3 w-3 hover:bg-transparent text-white\"\n                     onClick={(e) => {\n                       e.stopPropagation();\n                       toggleTag(tag.id);\n                     }}\n                   >\n                     <X className=\"h-3 w-3\" />\n                   </Button>\n                 </Badge>\n               ))\n             )}\n           </div>\n        </div>\n\n        <Command className=\"overflow-hidden border-t bg-transparent\">\n          <CommandInput \n            placeholder=\"Buscar ou criar tag...\" \n            value={searchValue}\n            onValueChange={setSearchValue}\n          />\n          <CommandList>\n            <CommandEmpty className=\"py-6 text-center text-sm\">\n              {searchValue.trim() ? (\n                <div className=\"flex flex-col items-center gap-2\">\n                  <span>Nenhuma tag encontrada.</span>\n                  <Button \n                    variant=\"outline\" \n                    size=\"sm\" \n                    className=\"h-8 gap-1\"\n                    onClick={handleCreateTag}\n                  >\n                    <Plus className=\"h-3.5 w-3.5\" />\n                    Criar \"{searchValue}\"\n                  </Button>\n                </div>\n              ) : (\n                \"Digite para buscar...\"\n              )}\n            </CommandEmpty>\n            <CommandGroup heading=\"Tags Disponíveis\">\n              {availableTags.map((tag) => (\n                <CommandItem\n                  key={tag.id}\n                  value={tag.name}\n                  onSelect={() => {\n                    toggleTag(tag.id);\n                    setSearchValue(\"\");\n                  }}\n                  className=\"cursor-pointer\"\n                >\n                  <div className={cn(\n                    \"mr-2 flex h-4 w-4 items-center justify-center rounded-sm border\",\n                    selectedTagIds.includes(tag.id)\n                      ? \"bg-primary border-primary text-primary-foreground\"\n                      : \"border-primary opacity-50 [&_svg]:invisible\"\n                  )}>\n                    <Check className={cn(\"h-4 w-4\")} />\n                  </div>\n                  <div className=\"flex items-center gap-2\">\n                    <div \n                        className=\"w-3 h-3 rounded-full\" \n                        style={{ backgroundColor: tag.color }}\n                    />\n                    <span>{tag.name}</span>\n                  </div>\n                </CommandItem>\n              ))}\n            </CommandGroup>\n            {searchValue.trim() && !availableTags.some(t => t.name.toLowerCase() === searchValue.trim().toLowerCase()) && (\n               <CommandGroup heading=\"Ações\">\n                 <CommandItem onSelect={handleCreateTag} value={`create-${searchValue}`}>\n                   <Plus className=\"mr-2 h-4 w-4\" />\n                   Criar tag \"{searchValue}\"\n                 </CommandItem>\n               </CommandGroup>\n            )}\n          </CommandList>\n        </Command>\n        \n        <div className=\"flex justify-end p-4 border-t bg-muted/10\">\n          <Button onClick={() => onOpenChange(false)}>\n            Concluir\n          </Button>\n        </div>\n      </DialogContent>\n    </Dialog>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Projetos\\Back_endCrm\\kanbanproject1\\components\\landing-pages\\builder\\element-renderer.tsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'updates' is defined but never used.","line":17,"column":15,"nodeType":"Identifier","messageId":"unusedVar","endLine":17,"endColumn":47,"suggestions":[{"messageId":"removeVar","data":{"varName":"updates"},"fix":{"range":[793,825],"text":""},"desc":"Remove unused variable 'updates'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'id' is defined but never used.","line":18,"column":22,"nodeType":"Identifier","messageId":"unusedVar","endLine":18,"endColumn":32,"suggestions":[{"messageId":"removeVar","data":{"varName":"id"},"fix":{"range":[901,912],"text":""},"desc":"Remove unused variable 'id'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'updates' is defined but never used.","line":18,"column":34,"nodeType":"Identifier","messageId":"unusedVar","endLine":18,"endColumn":66,"suggestions":[{"messageId":"removeVar","data":{"varName":"updates"},"fix":{"range":[911,945],"text":""},"desc":"Remove unused variable 'updates'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'id' is defined but never used.","line":20,"column":15,"nodeType":"Identifier","messageId":"unusedVar","endLine":20,"endColumn":32,"suggestions":[{"messageId":"removeVar","data":{"varName":"id"},"fix":{"range":[1026,1043],"text":""},"desc":"Remove unused variable 'id'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'id' is defined but never used.","line":21,"column":15,"nodeType":"Identifier","messageId":"unusedVar","endLine":21,"endColumn":25,"suggestions":[{"messageId":"removeVar","data":{"varName":"id"},"fix":{"range":[1068,1078],"text":""},"desc":"Remove unused variable 'id'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'id' is defined but never used.","line":22,"column":18,"nodeType":"Identifier","messageId":"unusedVar","endLine":22,"endColumn":28,"suggestions":[{"messageId":"removeVar","data":{"varName":"id"},"fix":{"range":[1106,1116],"text":""},"desc":"Remove unused variable 'id'."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":6,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { BuilderElement } from '@/lib/types/builder-types';\nimport { HeadingElement } from './elements/heading-element';\nimport { ParagraphElement } from './elements/paragraph-element';\nimport { ButtonElement } from './elements/button-element';\nimport { ImageElement } from './elements/image-element';\nimport { VideoElement } from './elements/video-element';\nimport { SectionElement } from './elements/section-element';\nimport { ColumnsElement } from './elements/columns-element';\nimport { ColumnElement } from './elements/column-element';\nimport { FormElement } from './elements/form-element';\nimport { SpacerElement } from './elements/spacer-element';\nimport { CodeElement } from './elements/code-element';\n\ninterface Props {\n  element: BuilderElement;\n  isSelected?: boolean;\n  onUpdate?: (updates: Partial<BuilderElement>) => void; // Kept for backward compat or direct usage\n  onElementUpdate?: (id: string, updates: Partial<BuilderElement>) => void; // Global update\n  // Context props for nested elements\n  onSelect?: (id: string | null) => void;\n  onDelete?: (id: string) => void;\n  onDuplicate?: (id: string) => void;\n  selectedId?: string | null;\n}\n\nexport function ElementRenderer({ \n  element, \n  isSelected, \n  onUpdate,\n  onElementUpdate,\n  onSelect,\n  onDelete,\n  onDuplicate,\n  selectedId\n}: Props) {\n  // Helper to use either local or global update\n  const handleUpdate = (updates: Partial<BuilderElement>) => {\n    if (onUpdate) onUpdate(updates);\n    else if (onElementUpdate) onElementUpdate(element.id, updates);\n  };\n\n  switch (element.type) {\n    case 'heading':\n      return <HeadingElement element={element} />;\n    case 'paragraph':\n      return <ParagraphElement element={element} />;\n    case 'button':\n      return <ButtonElement element={element} />;\n    case 'image':\n      return <ImageElement element={element} isSelected={isSelected} onUpdate={handleUpdate} />;\n    case 'video':\n      return <VideoElement element={element} />;\n    case 'section':\n      return (\n        <SectionElement \n          element={element}\n          onUpdate={handleUpdate}\n          onElementUpdate={onElementUpdate}\n          onSelect={onSelect}\n          onDelete={onDelete}\n          onDuplicate={onDuplicate}\n          selectedId={selectedId}\n        />\n      );\n    case 'columns':\n      return (\n        <ColumnsElement \n          element={element} \n          onUpdate={handleUpdate}\n          onElementUpdate={onElementUpdate}\n          onSelect={onSelect}\n          onDelete={onDelete}\n          onDuplicate={onDuplicate}\n          selectedId={selectedId}\n        />\n      );\n    case 'column':\n      return (\n        <ColumnElement \n          element={element}\n          onUpdate={handleUpdate}\n          onElementUpdate={onElementUpdate}\n          onSelect={onSelect}\n          onDelete={onDelete}\n          onDuplicate={onDuplicate}\n          selectedId={selectedId}\n        />\n      );\n    case 'form':\n      return <FormElement element={element} />;\n    case 'spacer':\n      return <SpacerElement element={element} />;\n    case 'code':\n      return <CodeElement element={element} />;\n    default:\n      return <div>Elemento desconhecido: {element.type}</div>;\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Projetos\\Back_endCrm\\kanbanproject1\\components\\landing-pages\\builder\\elements\\button-element.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projetos\\Back_endCrm\\kanbanproject1\\components\\landing-pages\\builder\\elements\\code-element.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projetos\\Back_endCrm\\kanbanproject1\\components\\landing-pages\\builder\\elements\\column-element.tsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'updates' is defined but never used.","line":10,"column":15,"nodeType":"Identifier","messageId":"unusedVar","endLine":10,"endColumn":47,"suggestions":[{"messageId":"removeVar","data":{"varName":"updates"},"fix":{"range":[392,424],"text":""},"desc":"Remove unused variable 'updates'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'id' is defined but never used.","line":11,"column":22,"nodeType":"Identifier","messageId":"unusedVar","endLine":11,"endColumn":32,"suggestions":[{"messageId":"removeVar","data":{"varName":"id"},"fix":{"range":[456,467],"text":""},"desc":"Remove unused variable 'id'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'updates' is defined but never used.","line":11,"column":34,"nodeType":"Identifier","messageId":"unusedVar","endLine":11,"endColumn":66,"suggestions":[{"messageId":"removeVar","data":{"varName":"updates"},"fix":{"range":[466,500],"text":""},"desc":"Remove unused variable 'updates'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'id' is defined but never used.","line":12,"column":15,"nodeType":"Identifier","messageId":"unusedVar","endLine":12,"endColumn":32,"suggestions":[{"messageId":"removeVar","data":{"varName":"id"},"fix":{"range":[525,542],"text":""},"desc":"Remove unused variable 'id'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'id' is defined but never used.","line":13,"column":15,"nodeType":"Identifier","messageId":"unusedVar","endLine":13,"endColumn":25,"suggestions":[{"messageId":"removeVar","data":{"varName":"id"},"fix":{"range":[567,577],"text":""},"desc":"Remove unused variable 'id'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'id' is defined but never used.","line":14,"column":18,"nodeType":"Identifier","messageId":"unusedVar","endLine":14,"endColumn":28,"suggestions":[{"messageId":"removeVar","data":{"varName":"id"},"fix":{"range":[605,615],"text":""},"desc":"Remove unused variable 'id'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'onUpdate' is defined but never used.","line":20,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":20,"endColumn":11,"suggestions":[{"messageId":"removeVar","data":{"varName":"onUpdate"},"fix":{"range":[701,714],"text":""},"desc":"Remove unused variable 'onUpdate'."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'onUpdate' is defined but never used.","line":20,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":20,"endColumn":11}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":8,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useDroppable } from '@dnd-kit/core';\nimport { SortableContext, verticalListSortingStrategy } from '@dnd-kit/sortable';\nimport { BuilderElement } from '@/lib/types/builder-types';\nimport { ElementRenderer } from '../element-renderer';\nimport { SortableElement } from '../sortable-element';\nimport { cn } from '@/lib/utils';\n\ninterface Props {\n  element: BuilderElement;\n  onUpdate?: (updates: Partial<BuilderElement>) => void;\n  onElementUpdate?: (id: string, updates: Partial<BuilderElement>) => void;\n  onSelect?: (id: string | null) => void;\n  onDelete?: (id: string) => void;\n  onDuplicate?: (id: string) => void;\n  selectedId?: string | null;\n}\n\nexport function ColumnElement({ \n  element, \n  onUpdate, \n  onElementUpdate,\n  onSelect, \n  onDelete, \n  onDuplicate, \n  selectedId \n}: Props) {\n  const { setNodeRef, isOver } = useDroppable({\n    id: element.id,\n    data: {\n      type: 'column',\n    }\n  });\n\n  return (\n    <div\n      ref={setNodeRef}\n      className={cn(\n        \"flex-1 min-h-[50px] p-2 border border-dashed border-transparent transition-colors rounded-md\",\n        isOver && \"bg-muted/50 border-primary/50\",\n        (!element.children || element.children.length === 0) && \"bg-muted/30 border-muted-foreground/20\"\n      )}\n    >\n      <SortableContext \n        items={element.children?.map(e => e.id) || []} \n        strategy={verticalListSortingStrategy}\n      >\n        <div className=\"space-y-2 w-full h-full flex flex-col\">\n          {element.children?.map((child) => (\n            <SortableElement\n              key={child.id}\n              element={child}\n              isSelected={selectedId === child.id}\n              onSelect={() => onSelect?.(child.id)}\n              onDelete={() => onDelete?.(child.id)}\n              onDuplicate={() => onDuplicate?.(child.id)}\n            >\n              <ElementRenderer \n                element={child}\n                isSelected={selectedId === child.id}\n                onUpdate={(updates) => onElementUpdate?.(child.id, updates)}\n                onElementUpdate={onElementUpdate}\n                onSelect={onSelect}\n                onDelete={onDelete}\n                onDuplicate={onDuplicate}\n                selectedId={selectedId}\n              />\n            </SortableElement>\n          ))}\n          {(!element.children || element.children.length === 0) && (\n             <div className=\"h-full min-h-[50px] flex items-center justify-center text-xs text-muted-foreground/50\">\n               Arraste elementos aqui\n             </div>\n          )}\n        </div>\n      </SortableContext>\n    </div>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Projetos\\Back_endCrm\\kanbanproject1\\components\\landing-pages\\builder\\elements\\columns-element.tsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'updates' is defined but never used.","line":6,"column":15,"nodeType":"Identifier","messageId":"unusedVar","endLine":6,"endColumn":47,"suggestions":[{"messageId":"removeVar","data":{"varName":"updates"},"fix":{"range":[175,207],"text":""},"desc":"Remove unused variable 'updates'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'id' is defined but never used.","line":7,"column":22,"nodeType":"Identifier","messageId":"unusedVar","endLine":7,"endColumn":32,"suggestions":[{"messageId":"removeVar","data":{"varName":"id"},"fix":{"range":[239,250],"text":""},"desc":"Remove unused variable 'id'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'updates' is defined but never used.","line":7,"column":34,"nodeType":"Identifier","messageId":"unusedVar","endLine":7,"endColumn":66,"suggestions":[{"messageId":"removeVar","data":{"varName":"updates"},"fix":{"range":[249,283],"text":""},"desc":"Remove unused variable 'updates'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'id' is defined but never used.","line":8,"column":15,"nodeType":"Identifier","messageId":"unusedVar","endLine":8,"endColumn":32,"suggestions":[{"messageId":"removeVar","data":{"varName":"id"},"fix":{"range":[308,325],"text":""},"desc":"Remove unused variable 'id'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'id' is defined but never used.","line":9,"column":15,"nodeType":"Identifier","messageId":"unusedVar","endLine":9,"endColumn":25,"suggestions":[{"messageId":"removeVar","data":{"varName":"id"},"fix":{"range":[350,360],"text":""},"desc":"Remove unused variable 'id'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'id' is defined but never used.","line":10,"column":18,"nodeType":"Identifier","messageId":"unusedVar","endLine":10,"endColumn":28,"suggestions":[{"messageId":"removeVar","data":{"varName":"id"},"fix":{"range":[388,398],"text":""},"desc":"Remove unused variable 'id'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'onUpdate' is defined but never used.","line":16,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":16,"endColumn":11,"suggestions":[{"messageId":"removeVar","data":{"varName":"onUpdate"},"fix":{"range":[485,497],"text":""},"desc":"Remove unused variable 'onUpdate'."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'onUpdate' is defined but never used.","line":16,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":16,"endColumn":11}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":8,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { BuilderElement } from '@/lib/types/builder-types';\nimport { ElementRenderer } from '../element-renderer';\n\ninterface Props {\n  element: BuilderElement;\n  onUpdate?: (updates: Partial<BuilderElement>) => void;\n  onElementUpdate?: (id: string, updates: Partial<BuilderElement>) => void;\n  onSelect?: (id: string | null) => void;\n  onDelete?: (id: string) => void;\n  onDuplicate?: (id: string) => void;\n  selectedId?: string | null;\n}\n\nexport function ColumnsElement({ \n  element,\n  onUpdate,\n  onElementUpdate,\n  onSelect,\n  onDelete,\n  onDuplicate,\n  selectedId\n}: Props) {\n  const columns = element.content.columns || 2;\n  const columnWidths = element.content.columnWidths;\n  \n  const styles: React.CSSProperties = {\n    padding: element.styles.padding,\n    margin: element.styles.margin,\n    gap: element.styles.gap || '20px',\n    alignItems: element.styles.alignItems || 'stretch',\n    backgroundColor: element.styles.backgroundColor,\n  };\n\n  // Calculate grid template columns based on widths or count\n  let gridTemplateColumns = `repeat(${columns}, 1fr)`;\n  if (columnWidths && columnWidths.length === columns) {\n      gridTemplateColumns = columnWidths.map(w => `${w}fr`).join(' ');\n  }\n\n  const containerStyles: React.CSSProperties = {\n    ...styles,\n    gridTemplateColumns,\n  };\n\n  return (\n    <div \n      style={containerStyles}\n      className=\"w-full grid\"\n    >\n      {element.children?.map((child) => (\n         <ElementRenderer \n            key={child.id}\n            element={child}\n            isSelected={selectedId === child.id}\n            onUpdate={(updates: Partial<BuilderElement>) => onElementUpdate?.(child.id, updates)}\n            onElementUpdate={onElementUpdate}\n            onSelect={onSelect}\n            onDelete={onDelete}\n            onDuplicate={onDuplicate}\n            selectedId={selectedId}\n          />\n      ))}\n      {(!element.children || element.children.length === 0) && Array.from({ length: columns }).map((_, i) => (\n        <div \n          key={i}\n          className=\"min-h-[80px] bg-muted/30 border-2 border-dashed border-muted-foreground/20 rounded-lg flex items-center justify-center\"\n        >\n          <span className=\"text-sm text-muted-foreground/50\">Coluna {i + 1} (Vazia)</span>\n        </div>\n      ))}\n    </div>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Projetos\\Back_endCrm\\kanbanproject1\\components\\landing-pages\\builder\\elements\\form-element.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fields'. Either include it or remove the dependency array.","line":53,"column":6,"nodeType":"ArrayExpression","endLine":53,"endColumn":30,"suggestions":[{"desc":"Update the dependencies array to be: [fields]","fix":{"range":[2002,2026],"text":"[fields]"}}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a complex expression in the dependency array. Extract it to a separate variable so it can be statically checked.","line":53,"column":7,"nodeType":"CallExpression","endLine":53,"endColumn":29}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from 'react';\nimport { useForm, Controller } from 'react-hook-form';\nimport { zodResolver } from '@hookform/resolvers/zod';\nimport * as z from 'zod';\nimport { BuilderElement, FormFieldConfig } from '@/lib/types/builder-types';\nimport { Input } from '@/components/ui/input';\nimport { Button } from '@/components/ui/button';\nimport { Label } from '@/components/ui/label';\nimport { Textarea } from '@/components/ui/textarea';\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\nimport { maskCPF, maskCNPJ, maskCEP, maskPhone, validateCPF, validateCNPJ, countries } from '@/lib/builder/form-utils';\nimport { toast } from 'sonner';\n\ninterface Props {\n  element: BuilderElement;\n}\n\nexport function FormElement({ element }: Props) {\n  const styles: React.CSSProperties = {\n    backgroundColor: element.styles.backgroundColor,\n    padding: element.styles.padding,\n    borderRadius: element.styles.borderRadius,\n    borderWidth: element.styles.borderWidth,\n    borderColor: element.styles.borderColor,\n    borderStyle: element.styles.borderWidth ? 'solid' : undefined,\n  };\n\n  const rawFields = element.content.formFields || [];\n  const fields: FormFieldConfig[] = rawFields.map(f => {\n    if (typeof f === 'string') {\n        return {\n            id: f,\n            type: f === 'email' ? 'email' : f === 'phone' ? 'phone' : 'text',\n            label: f === 'name' ? 'Nome' : f === 'email' ? 'E-mail' : 'Telefone',\n            placeholder: '',\n            required: true,\n            defaultCountry: 'BR'\n        } as FormFieldConfig;\n    }\n    return f;\n  });\n\n  const [countrySelections, setCountrySelections] = useState<Record<string, string>>({});\n\n  useEffect(() => {\n    const initialCountries: Record<string, string> = {};\n    fields.forEach(field => {\n      if (field.type === 'phone') {\n        initialCountries[field.id] = field.defaultCountry || 'BR';\n      }\n    });\n    setCountrySelections(initialCountries);\n  }, [JSON.stringify(fields)]);\n\n  const formSchema = z.object(\n    fields.reduce((acc, field) => {\n      let schema: z.ZodTypeAny = z.string();\n\n      if (field.required) {\n        schema = schema.min(1, 'Campo obrigatório');\n      } else {\n        schema = schema.optional().or(z.literal(''));\n      }\n\n      if (field.type === 'email' && field.required) {\n        schema = schema.email('E-mail inválido');\n      }\n      \n      if (field.type === 'cpf' && field.required) {\n         schema = schema.refine(validateCPF, 'CPF inválido');\n      }\n\n      if (field.type === 'cnpj' && field.required) {\n         schema = schema.refine(validateCNPJ, 'CNPJ inválido');\n      }\n      \n      if (field.type === 'number') {\n        const numberSchema = field.required\n          ? z.coerce.number().min(1, 'Campo obrigatório')\n          : z.coerce.number().optional();\n        schema = numberSchema;\n      }\n\n      acc[field.id] = schema;\n      return acc;\n    }, {} as Record<string, z.ZodTypeAny>)\n  );\n\n  const form = useForm<z.infer<typeof formSchema>>({\n    resolver: zodResolver(formSchema),\n    defaultValues: fields.reduce((acc, field) => ({ ...acc, [field.id]: '' }), {}),\n  });\n\n  const onSubmit = (data: z.infer<typeof formSchema>) => {\n    const formattedData: Record<string, unknown> = { ...data };\n    \n    fields.forEach(field => {\n      if (field.type === 'phone') {\n        const countryCode = countrySelections[field.id] || 'BR';\n        const country = countries.find(c => c.code === countryCode);\n        if (country) {\n          const fieldId = field.id as keyof typeof data;\n          const rawValue = data[fieldId];\n          const cleanNumber = String(rawValue ?? '').replace(/\\D/g, '');\n          formattedData[field.id] = `${country.ddi}${cleanNumber}`;\n        }\n      }\n    });\n    \n    formattedData.source = 'landing-page-builder';\n\n    console.log('Form Submitted:', formattedData);\n    toast.success('Formulário enviado com sucesso!', {\n      description: 'Os dados foram validados e processados.'\n    });\n  };\n\n  return (\n    <form style={styles} className=\"w-full space-y-4\" onSubmit={form.handleSubmit(onSubmit)}>\n      {fields.map((field) => (\n        <div key={field.id} className=\"space-y-2\">\n          <Label htmlFor={field.id}>\n            {field.label}\n            {field.required && <span className=\"text-red-500 ml-1\">*</span>}\n          </Label>\n          \n          {field.type === 'textarea' ? (\n             <Textarea \n               {...form.register(field.id)} \n               placeholder={field.placeholder} \n             />\n          ) : field.type === 'phone' ? (\n             <div className=\"flex gap-2\">\n                <Select \n                  value={countrySelections[field.id]} \n                  onValueChange={(val) => {\n                    setCountrySelections(prev => ({ ...prev, [field.id]: val }));\n                    const currentVal = form.getValues(field.id);\n                    form.setValue(field.id, maskPhone(currentVal, val));\n                  }}\n                >\n                  <SelectTrigger className=\"w-[110px]\">\n                    <SelectValue />\n                  </SelectTrigger>\n                  <SelectContent>\n                    {countries.map(country => (\n                      <SelectItem key={country.code} value={country.code}>\n                        <span className=\"mr-2\">{country.flag}</span>\n                        {country.ddi}\n                      </SelectItem>\n                    ))}\n                  </SelectContent>\n                </Select>\n                <Controller\n                  control={form.control}\n                  name={field.id}\n                  render={({ field: { onChange, value, ...rest } }) => (\n                    <Input\n                      {...rest}\n                      value={value}\n                      onChange={(e) => {\n                        const masked = maskPhone(e.target.value, countrySelections[field.id]);\n                        onChange(masked);\n                      }}\n                      placeholder={field.placeholder}\n                      type=\"tel\"\n                    />\n                  )}\n                />\n             </div>\n          ) : (\n            <Controller\n              control={form.control}\n              name={field.id}\n              render={({ field: { onChange, value, ...rest } }) => (\n                <Input\n                  {...rest}\n                  value={value}\n                  onChange={(e) => {\n                    let val = e.target.value;\n                    if (field.type === 'cpf') val = maskCPF(val);\n                    if (field.type === 'cnpj') val = maskCNPJ(val);\n                    if (field.type === 'cep') val = maskCEP(val);\n                    onChange(val);\n                  }}\n                  type={field.type === 'number' ? 'number' : 'text'}\n                  placeholder={field.placeholder}\n                />\n              )}\n            />\n          )}\n          \n          {form.formState.errors[field.id] && (\n            <p className=\"text-sm text-red-500\">\n              {form.formState.errors[field.id]?.message as string}\n            </p>\n          )}\n        </div>\n      ))}\n      \n      <Button \n        type=\"submit\" \n        className=\"w-full\"\n        style={{\n          backgroundColor: '#2563eb',\n          color: '#ffffff'\n        }}\n      >\n        {element.content.buttonText || 'Enviar'}\n      </Button>\n    </form>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Projetos\\Back_endCrm\\kanbanproject1\\components\\landing-pages\\builder\\elements\\heading-element.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projetos\\Back_endCrm\\kanbanproject1\\components\\landing-pages\\builder\\elements\\image-element.tsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'updates' is defined but never used.","line":9,"column":15,"nodeType":"Identifier","messageId":"unusedVar","endLine":9,"endColumn":47,"suggestions":[{"messageId":"removeVar","data":{"varName":"updates"},"fix":{"range":[300,332],"text":""},"desc":"Remove unused variable 'updates'."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { BuilderElement } from '@/lib/types/builder-types';\nimport { ImageIcon, Lock, Unlock } from 'lucide-react';\nimport { useState, useRef, useEffect, useCallback } from 'react';\nimport { cn } from '@/lib/utils';\n\ninterface Props {\n  element: BuilderElement;\n  isSelected?: boolean;\n  onUpdate?: (updates: Partial<BuilderElement>) => void;\n}\n\ntype ResizeHandle = 'nw' | 'ne' | 'sw' | 'se' | 'n' | 's' | 'e' | 'w';\n\nexport function ImageElement({ element, isSelected, onUpdate }: Props) {\n  const containerRef = useRef<HTMLDivElement>(null);\n  const imageRef = useRef<HTMLImageElement>(null);\n  const [isResizing, setIsResizing] = useState(false);\n  const [activeHandle, setActiveHandle] = useState<ResizeHandle | null>(null);\n  const [dimensions, setDimensions] = useState({\n    width: parseInt(element.styles.width || '100%') || 400,\n    height: element.styles.height === 'auto' ? 0 : parseInt(element.styles.height || '0') || 0,\n  });\n  const [aspectRatio, setAspectRatio] = useState(1);\n  const startPos = useRef({ x: 0, y: 0, width: 0, height: 0 });\n\n  const isLocked = element.styles.aspectRatioLocked !== false;\n\n  // Get natural dimensions when image loads\n  const handleImageLoad = useCallback((e: React.SyntheticEvent<HTMLImageElement>) => {\n    const img = e.currentTarget;\n    const ratio = img.naturalWidth / img.naturalHeight;\n    setAspectRatio(ratio);\n    \n    if (!element.styles.naturalWidth && onUpdate) {\n      onUpdate({\n        styles: {\n          ...element.styles,\n          naturalWidth: img.naturalWidth,\n          naturalHeight: img.naturalHeight,\n        }\n      });\n    }\n\n    // Set initial dimensions if not set\n    if (!element.styles.width || element.styles.width === '100%') {\n      const containerWidth = containerRef.current?.parentElement?.clientWidth || 400;\n      const initialWidth = Math.min(img.naturalWidth, containerWidth);\n      const initialHeight = initialWidth / ratio;\n      setDimensions({ width: initialWidth, height: initialHeight });\n    }\n  }, [element.styles, onUpdate]);\n\n  // Sync dimensions from props\n  useEffect(() => {\n    if (element.styles.width && element.styles.width !== '100%') {\n      const w = parseInt(element.styles.width);\n      const h = element.styles.height && element.styles.height !== 'auto' \n        ? parseInt(element.styles.height) \n        : w / aspectRatio;\n      if (!isNaN(w)) {\n        setDimensions({ width: w, height: h || w / aspectRatio });\n      }\n    }\n  }, [element.styles.width, element.styles.height, aspectRatio]);\n\n  const handleMouseDown = useCallback((e: React.MouseEvent, handle: ResizeHandle) => {\n    e.preventDefault();\n    e.stopPropagation();\n    setIsResizing(true);\n    setActiveHandle(handle);\n    startPos.current = {\n      x: e.clientX,\n      y: e.clientY,\n      width: dimensions.width,\n      height: dimensions.height,\n    };\n  }, [dimensions]);\n\n  const handleMouseMove = useCallback((e: MouseEvent) => {\n    if (!isResizing || !activeHandle) return;\n\n    const deltaX = e.clientX - startPos.current.x;\n    const deltaY = e.clientY - startPos.current.y;\n    \n    let newWidth = startPos.current.width;\n    let newHeight = startPos.current.height;\n\n    // Calculate new dimensions based on handle\n    switch (activeHandle) {\n      case 'se':\n        newWidth = Math.max(50, startPos.current.width + deltaX);\n        newHeight = isLocked ? newWidth / aspectRatio : Math.max(50, startPos.current.height + deltaY);\n        break;\n      case 'sw':\n        newWidth = Math.max(50, startPos.current.width - deltaX);\n        newHeight = isLocked ? newWidth / aspectRatio : Math.max(50, startPos.current.height + deltaY);\n        break;\n      case 'ne':\n        newWidth = Math.max(50, startPos.current.width + deltaX);\n        newHeight = isLocked ? newWidth / aspectRatio : Math.max(50, startPos.current.height - deltaY);\n        break;\n      case 'nw':\n        newWidth = Math.max(50, startPos.current.width - deltaX);\n        newHeight = isLocked ? newWidth / aspectRatio : Math.max(50, startPos.current.height - deltaY);\n        break;\n      case 'e':\n        newWidth = Math.max(50, startPos.current.width + deltaX);\n        if (isLocked) newHeight = newWidth / aspectRatio;\n        break;\n      case 'w':\n        newWidth = Math.max(50, startPos.current.width - deltaX);\n        if (isLocked) newHeight = newWidth / aspectRatio;\n        break;\n      case 'n':\n        newHeight = Math.max(50, startPos.current.height - deltaY);\n        if (isLocked) newWidth = newHeight * aspectRatio;\n        break;\n      case 's':\n        newHeight = Math.max(50, startPos.current.height + deltaY);\n        if (isLocked) newWidth = newHeight * aspectRatio;\n        break;\n    }\n\n    setDimensions({ width: Math.round(newWidth), height: Math.round(newHeight) });\n  }, [isResizing, activeHandle, isLocked, aspectRatio]);\n\n  const handleMouseUp = useCallback(() => {\n    if (isResizing && onUpdate) {\n      onUpdate({\n        styles: {\n          ...element.styles,\n          width: `${dimensions.width}px`,\n          height: `${dimensions.height}px`,\n        }\n      });\n    }\n    setIsResizing(false);\n    setActiveHandle(null);\n  }, [isResizing, dimensions, element.styles, onUpdate]);\n\n  useEffect(() => {\n    if (isResizing) {\n      window.addEventListener('mousemove', handleMouseMove);\n      window.addEventListener('mouseup', handleMouseUp);\n      return () => {\n        window.removeEventListener('mousemove', handleMouseMove);\n        window.removeEventListener('mouseup', handleMouseUp);\n      };\n    }\n  }, [isResizing, handleMouseMove, handleMouseUp]);\n\n  const handleStyle: React.CSSProperties = {\n    position: 'absolute',\n    width: '12px',\n    height: '12px',\n    backgroundColor: 'hsl(var(--primary))',\n    border: '2px solid white',\n    borderRadius: '2px',\n    zIndex: 50,\n    boxShadow: '0 2px 4px rgba(0,0,0,0.2)',\n  };\n\n  const sideHandleStyle: React.CSSProperties = {\n    ...handleStyle,\n    width: '8px',\n    height: '24px',\n    borderRadius: '4px',\n  };\n\n  const topBottomHandleStyle: React.CSSProperties = {\n    ...handleStyle,\n    width: '24px',\n    height: '8px',\n    borderRadius: '4px',\n  };\n\n  const containerStyles: React.CSSProperties = {\n    width: dimensions.width > 0 ? `${dimensions.width}px` : element.styles.width || '100%',\n    height: dimensions.height > 0 ? `${dimensions.height}px` : 'auto',\n    borderRadius: element.styles.borderRadius,\n    padding: element.styles.padding,\n    margin: element.styles.margin,\n    position: 'relative',\n    display: 'inline-block',\n  };\n\n  const wrapperStyles: React.CSSProperties = {\n    textAlign: (element.styles.textAlign as React.CSSProperties['textAlign']) || 'center',\n  };\n\n  if (!element.content.src) {\n    return (\n      <div style={wrapperStyles}>\n        <div \n          style={{ ...containerStyles, width: '100%', height: 'auto' }}\n          className=\"flex flex-col items-center justify-center bg-muted/50 border-2 border-dashed border-muted-foreground/30 rounded-lg py-12\"\n        >\n          <ImageIcon className=\"w-12 h-12 text-muted-foreground/50\" />\n          <span className=\"text-sm text-muted-foreground mt-2\">Adicione uma URL de imagem</span>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div style={wrapperStyles}>\n      <div\n        ref={containerRef}\n        style={containerStyles}\n        className={cn(\n          'relative group',\n          isResizing && 'select-none'\n        )}\n      >\n        <img\n          ref={imageRef}\n          src={element.content.src}\n          alt=\"Imagem\"\n          onLoad={handleImageLoad}\n          className=\"w-full h-full object-cover\"\n          style={{ borderRadius: element.styles.borderRadius }}\n          draggable={false}\n        />\n\n        {/* Resize Handles - Only show when selected */}\n        {isSelected && (\n          <>\n            {/* Dimension indicator */}\n            <div className=\"absolute -top-8 left-1/2 -translate-x-1/2 px-2 py-1 bg-primary text-primary-foreground text-xs font-mono rounded shadow-lg whitespace-nowrap flex items-center gap-2\">\n              <span>{dimensions.width} × {dimensions.height}px</span>\n              {isLocked ? (\n                <Lock className=\"w-3 h-3\" />\n              ) : (\n                <Unlock className=\"w-3 h-3\" />\n              )}\n            </div>\n\n            {/* Corner handles */}\n            <div\n              style={{ ...handleStyle, top: '-6px', left: '-6px', cursor: 'nwse-resize' }}\n              onMouseDown={(e) => handleMouseDown(e, 'nw')}\n            />\n            <div\n              style={{ ...handleStyle, top: '-6px', right: '-6px', cursor: 'nesw-resize' }}\n              onMouseDown={(e) => handleMouseDown(e, 'ne')}\n            />\n            <div\n              style={{ ...handleStyle, bottom: '-6px', left: '-6px', cursor: 'nesw-resize' }}\n              onMouseDown={(e) => handleMouseDown(e, 'sw')}\n            />\n            <div\n              style={{ ...handleStyle, bottom: '-6px', right: '-6px', cursor: 'nwse-resize' }}\n              onMouseDown={(e) => handleMouseDown(e, 'se')}\n            />\n\n            {/* Side handles */}\n            <div\n              style={{ \n                ...sideHandleStyle, \n                top: '50%', \n                left: '-4px', \n                transform: 'translateY(-50%)',\n                cursor: 'ew-resize' \n              }}\n              onMouseDown={(e) => handleMouseDown(e, 'w')}\n            />\n            <div\n              style={{ \n                ...sideHandleStyle, \n                top: '50%', \n                right: '-4px', \n                transform: 'translateY(-50%)',\n                cursor: 'ew-resize' \n              }}\n              onMouseDown={(e) => handleMouseDown(e, 'e')}\n            />\n            <div\n              style={{ \n                ...topBottomHandleStyle, \n                top: '-4px', \n                left: '50%', \n                transform: 'translateX(-50%)',\n                cursor: 'ns-resize' \n              }}\n              onMouseDown={(e) => handleMouseDown(e, 'n')}\n            />\n            <div\n              style={{ \n                ...topBottomHandleStyle, \n                bottom: '-4px', \n                left: '50%', \n                transform: 'translateX(-50%)',\n                cursor: 'ns-resize' \n              }}\n              onMouseDown={(e) => handleMouseDown(e, 's')}\n            />\n\n            {/* Selection border */}\n            <div \n              className=\"absolute inset-0 border-2 border-primary pointer-events-none rounded-[inherit]\"\n              style={{ borderRadius: element.styles.borderRadius }}\n            />\n          </>\n        )}\n      </div>\n    </div>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Projetos\\Back_endCrm\\kanbanproject1\\components\\landing-pages\\builder\\elements\\paragraph-element.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projetos\\Back_endCrm\\kanbanproject1\\components\\landing-pages\\builder\\elements\\section-element.tsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'updates' is defined but never used.","line":10,"column":15,"nodeType":"Identifier","messageId":"unusedVar","endLine":10,"endColumn":47,"suggestions":[{"messageId":"removeVar","data":{"varName":"updates"},"fix":{"range":[392,424],"text":""},"desc":"Remove unused variable 'updates'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'id' is defined but never used.","line":11,"column":22,"nodeType":"Identifier","messageId":"unusedVar","endLine":11,"endColumn":32,"suggestions":[{"messageId":"removeVar","data":{"varName":"id"},"fix":{"range":[456,467],"text":""},"desc":"Remove unused variable 'id'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'updates' is defined but never used.","line":11,"column":34,"nodeType":"Identifier","messageId":"unusedVar","endLine":11,"endColumn":66,"suggestions":[{"messageId":"removeVar","data":{"varName":"updates"},"fix":{"range":[466,500],"text":""},"desc":"Remove unused variable 'updates'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'id' is defined but never used.","line":12,"column":15,"nodeType":"Identifier","messageId":"unusedVar","endLine":12,"endColumn":32,"suggestions":[{"messageId":"removeVar","data":{"varName":"id"},"fix":{"range":[525,542],"text":""},"desc":"Remove unused variable 'id'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'id' is defined but never used.","line":13,"column":15,"nodeType":"Identifier","messageId":"unusedVar","endLine":13,"endColumn":25,"suggestions":[{"messageId":"removeVar","data":{"varName":"id"},"fix":{"range":[567,577],"text":""},"desc":"Remove unused variable 'id'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'id' is defined but never used.","line":14,"column":18,"nodeType":"Identifier","messageId":"unusedVar","endLine":14,"endColumn":28,"suggestions":[{"messageId":"removeVar","data":{"varName":"id"},"fix":{"range":[605,615],"text":""},"desc":"Remove unused variable 'id'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'onUpdate' is defined but never used.","line":20,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":20,"endColumn":11,"suggestions":[{"messageId":"removeVar","data":{"varName":"onUpdate"},"fix":{"range":[702,714],"text":""},"desc":"Remove unused variable 'onUpdate'."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'onUpdate' is defined but never used.","line":20,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":20,"endColumn":11}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":8,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useDroppable } from '@dnd-kit/core';\nimport { SortableContext, verticalListSortingStrategy } from '@dnd-kit/sortable';\nimport { BuilderElement } from '@/lib/types/builder-types';\nimport { ElementRenderer } from '../element-renderer';\nimport { SortableElement } from '../sortable-element';\nimport { cn } from '@/lib/utils';\n\ninterface Props {\n  element: BuilderElement;\n  onUpdate?: (updates: Partial<BuilderElement>) => void;\n  onElementUpdate?: (id: string, updates: Partial<BuilderElement>) => void;\n  onSelect?: (id: string | null) => void;\n  onDelete?: (id: string) => void;\n  onDuplicate?: (id: string) => void;\n  selectedId?: string | null;\n}\n\nexport function SectionElement({ \n  element,\n  onUpdate,\n  onElementUpdate,\n  onSelect,\n  onDelete,\n  onDuplicate,\n  selectedId \n}: Props) {\n  const { setNodeRef, isOver } = useDroppable({\n    id: element.id,\n    data: {\n      type: 'section',\n    }\n  });\n\n  const styles: React.CSSProperties = {\n    backgroundColor: element.styles.backgroundColor,\n    padding: element.styles.padding || '20px',\n    margin: element.styles.margin,\n    borderRadius: element.styles.borderRadius,\n    borderWidth: element.styles.borderWidth,\n    borderColor: element.styles.borderColor,\n    borderStyle: element.styles.borderWidth ? 'solid' : undefined,\n    minHeight: '100px',\n  };\n\n  return (\n    <div\n      ref={setNodeRef}\n      style={styles}\n      className={cn(\n        \"w-full transition-colors\",\n        isOver && \"ring-2 ring-primary/50 bg-muted/50\",\n        (!element.children || element.children.length === 0) && \"bg-muted/10 border-dashed border border-muted-foreground/20\"\n      )}\n    >\n      <SortableContext \n        items={element.children?.map(e => e.id) || []} \n        strategy={verticalListSortingStrategy}\n      >\n        <div className=\"space-y-4 w-full\">\n          {element.children?.map((child) => (\n            <SortableElement\n              key={child.id}\n              element={child}\n              isSelected={selectedId === child.id}\n              onSelect={() => onSelect?.(child.id)}\n              onDelete={() => onDelete?.(child.id)}\n              onDuplicate={() => onDuplicate?.(child.id)}\n            >\n              <ElementRenderer \n                element={child}\n                isSelected={selectedId === child.id}\n                onUpdate={(updates: Partial<BuilderElement>) => onElementUpdate?.(child.id, updates)}\n                onElementUpdate={onElementUpdate}\n                onSelect={onSelect}\n                onDelete={onDelete}\n                onDuplicate={onDuplicate}\n                selectedId={selectedId}\n              />\n            </SortableElement>\n          ))}\n          {(!element.children || element.children.length === 0) && (\n             <div className=\"h-full min-h-[100px] flex items-center justify-center text-sm text-muted-foreground/50\">\n               Seção - arraste elementos aqui\n             </div>\n          )}\n        </div>\n      </SortableContext>\n    </div>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Projetos\\Back_endCrm\\kanbanproject1\\components\\landing-pages\\builder\\elements\\spacer-element.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projetos\\Back_endCrm\\kanbanproject1\\components\\landing-pages\\builder\\elements\\video-element.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projetos\\Back_endCrm\\kanbanproject1\\components\\landing-pages\\builder\\properties-panel.tsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'countries' is defined but never used.","line":10,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":10,"endColumn":19,"suggestions":[{"messageId":"removeVar","data":{"varName":"countries"},"fix":{"range":[593,646],"text":""},"desc":"Remove unused variable 'countries'."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'countries' is defined but never used.","line":10,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":10,"endColumn":19},{"ruleId":"no-unused-vars","severity":1,"message":"'Ruler' is defined but never used.","line":23,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":23,"endColumn":8,"suggestions":[{"messageId":"removeVar","data":{"varName":"Ruler"},"fix":{"range":[782,791],"text":""},"desc":"Remove unused variable 'Ruler'."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Ruler' is defined but never used.","line":23,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":23,"endColumn":8},{"ruleId":"no-unused-vars","severity":1,"message":"'Link' is defined but never used.","line":24,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":24,"endColumn":7,"suggestions":[{"messageId":"removeVar","data":{"varName":"Link"},"fix":{"range":[791,799],"text":""},"desc":"Remove unused variable 'Link'."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Link' is defined but never used.","line":24,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":24,"endColumn":7},{"ruleId":"no-unused-vars","severity":1,"message":"'Lock' is defined but never used.","line":25,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":25,"endColumn":7,"suggestions":[{"messageId":"removeVar","data":{"varName":"Lock"},"fix":{"range":[799,807],"text":""},"desc":"Remove unused variable 'Lock'."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Lock' is defined but never used.","line":25,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":25,"endColumn":7},{"ruleId":"no-unused-vars","severity":1,"message":"'Unlock' is defined but never used.","line":26,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":26,"endColumn":9,"suggestions":[{"messageId":"removeVar","data":{"varName":"Unlock"},"fix":{"range":[807,817],"text":""},"desc":"Remove unused variable 'Unlock'."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Unlock' is defined but never used.","line":26,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":26,"endColumn":9},{"ruleId":"no-unused-vars","severity":1,"message":"'Move' is defined but never used.","line":27,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":27,"endColumn":7,"suggestions":[{"messageId":"removeVar","data":{"varName":"Move"},"fix":{"range":[817,825],"text":""},"desc":"Remove unused variable 'Move'."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Move' is defined but never used.","line":27,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":27,"endColumn":7},{"ruleId":"no-unused-vars","severity":1,"message":"'id' is defined but never used.","line":37,"column":14,"nodeType":"Identifier","messageId":"unusedVar","endLine":37,"endColumn":24,"suggestions":[{"messageId":"removeVar","data":{"varName":"id"},"fix":{"range":[1012,1023],"text":""},"desc":"Remove unused variable 'id'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'updates' is defined but never used.","line":37,"column":26,"nodeType":"Identifier","messageId":"unusedVar","endLine":37,"endColumn":58,"suggestions":[{"messageId":"removeVar","data":{"varName":"updates"},"fix":{"range":[1022,1056],"text":""},"desc":"Remove unused variable 'updates'."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":14,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { BuilderElement, ElementContent, ElementStyles, COMPONENT_DEFINITIONS, FormFieldConfig } from '@/lib/types/builder-types';\nimport { Input } from '@/components/ui/input';\nimport { Label } from '@/components/ui/label';\nimport { Textarea } from '@/components/ui/textarea';\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\nimport { Separator } from '@/components/ui/separator';\nimport { ScrollArea } from '@/components/ui/scroll-area';\nimport { Switch } from '@/components/ui/switch';\nimport { Button } from '@/components/ui/button';\nimport { countries } from '@/lib/builder/form-utils';\nimport { \n  Type, \n  AlignLeft, \n  MousePointer, \n  Image, \n  Play, \n  Square, \n  Columns, \n  FileText, \n  Minus,\n  Settings,\n  Palette,\n  Ruler,\n  Link,\n  Lock,\n  Unlock,\n  Move,\n  Plus,\n  Trash,\n  ChevronUp,\n  ChevronDown\n} from 'lucide-react';\nimport { v4 as uuidv4 } from 'uuid';\n\ninterface PropertiesPanelProps {\n  element: BuilderElement | null;\n  onUpdate: (id: string, updates: Partial<BuilderElement>) => void;\n}\n\nconst iconMap: Record<string, React.ReactNode> = {\n  heading: <Type className=\"w-4 h-4\" />,\n  paragraph: <AlignLeft className=\"w-4 h-4\" />,\n  button: <MousePointer className=\"w-4 h-4\" />,\n  image: <Image className=\"w-4 h-4\" />,\n  video: <Play className=\"w-4 h-4\" />,\n  section: <Square className=\"w-4 h-4\" />,\n  columns: <Columns className=\"w-4 h-4\" />,\n  form: <FileText className=\"w-4 h-4\" />,\n  spacer: <Minus className=\"w-4 h-4\" />,\n};\n\nexport function PropertiesPanel({ element, onUpdate }: PropertiesPanelProps) {\n  if (!element) {\n    return (\n      <aside className=\"w-72 bg-card border-l border-border flex flex-col h-full shrink-0\">\n        <div className=\"p-4 border-b border-border\">\n          <h2 className=\"text-sm font-semibold uppercase tracking-wider text-muted-foreground\">\n            Propriedades\n          </h2>\n        </div>\n        <div className=\"flex-1 flex items-center justify-center p-6\">\n          <div className=\"text-center\">\n            <Settings className=\"w-12 h-12 text-muted-foreground/30 mx-auto mb-3\" />\n            <p className=\"text-sm text-muted-foreground\">\n              Selecione um elemento para editar suas propriedades\n            </p>\n          </div>\n        </div>\n      </aside>\n    );\n  }\n\n  const definition = COMPONENT_DEFINITIONS.find(c => c.type === element.type);\n\n  const updateContent = <K extends keyof ElementContent>(key: K, value: ElementContent[K]) => {\n    onUpdate(element.id, {\n      content: { ...element.content, [key]: value }\n    });\n  };\n\n  const updateStyles = <K extends keyof ElementStyles>(key: K, value: ElementStyles[K]) => {\n    onUpdate(element.id, {\n      styles: { ...element.styles, [key]: value }\n    });\n  };\n\n  const handleColumnsChange = (count: number) => {\n    const currentChildren = element.children || [];\n    let newChildren = [...currentChildren];\n\n    if (count > currentChildren.length) {\n      // Add columns\n      const toAdd = count - currentChildren.length;\n      for (let i = 0; i < toAdd; i++) {\n        newChildren.push({\n          id: uuidv4(),\n          type: 'column',\n          content: {},\n          styles: {},\n          children: []\n        });\n      }\n    } else if (count < currentChildren.length) {\n      // Remove columns (from the end)\n      newChildren = newChildren.slice(0, count);\n    }\n\n    onUpdate(element.id, {\n      content: { ...element.content, columns: count },\n      children: newChildren\n    });\n  };\n\n  const addFormField = () => {\n    const currentFields = element.content.formFields || [];\n    const newField: FormFieldConfig = {\n      id: uuidv4(),\n      type: 'text',\n      label: 'Novo Campo',\n      placeholder: '',\n      required: false,\n      width: 'full'\n    };\n    \n    updateContent('formFields', [...currentFields, newField]);\n  };\n\n  const updateFormField = (index: number, updates: Partial<FormFieldConfig>) => {\n    const currentFields = [...(element.content.formFields || [])];\n    const field = currentFields[index];\n    \n    if (typeof field === 'string') return; // Should not happen with new structure\n    \n    currentFields[index] = { ...field, ...updates };\n    updateContent('formFields', currentFields);\n  };\n\n  const removeFormField = (index: number) => {\n    const currentFields = [...(element.content.formFields || [])];\n    currentFields.splice(index, 1);\n    updateContent('formFields', currentFields);\n  };\n\n  const moveFormField = (index: number, direction: 'up' | 'down') => {\n    const currentFields = [...(element.content.formFields || [])];\n    if (direction === 'up' && index > 0) {\n      [currentFields[index], currentFields[index - 1]] = [currentFields[index - 1], currentFields[index]];\n    } else if (direction === 'down' && index < currentFields.length - 1) {\n      [currentFields[index], currentFields[index + 1]] = [currentFields[index + 1], currentFields[index]];\n    }\n    updateContent('formFields', currentFields);\n  };\n\n  return (\n    <aside className=\"w-80 bg-card border-l border-border flex flex-col h-full shrink-0 overflow-hidden\">\n      <div className=\"p-4 border-b border-border flex items-center gap-2\">\n        {definition?.icon && iconMap[definition.icon]}\n        <h2 className=\"text-sm font-semibold uppercase tracking-wider text-muted-foreground\">\n          {definition?.label || element.type}\n        </h2>\n      </div>\n\n      <ScrollArea className=\"flex-1\">\n        <div className=\"p-4 space-y-6\">\n          \n          {/* Content Section */}\n          <div className=\"space-y-4\">\n            <div className=\"flex items-center gap-2 text-sm font-medium text-foreground\">\n              <FileText className=\"w-4 h-4\" />\n              Conteúdo\n            </div>\n            \n            {element.type === 'heading' && (\n              <div className=\"space-y-2\">\n                <Label>Texto</Label>\n                <Input \n                  value={element.content.text || ''} \n                  onChange={(e) => updateContent('text', e.target.value)}\n                />\n              </div>\n            )}\n\n            {element.type === 'paragraph' && (\n              <div className=\"space-y-2\">\n                <Label>Texto</Label>\n                <Textarea \n                  value={element.content.text || ''} \n                  onChange={(e) => updateContent('text', e.target.value)}\n                  className=\"min-h-[100px]\"\n                />\n              </div>\n            )}\n\n            {element.type === 'button' && (\n              <>\n                <div className=\"space-y-2\">\n                  <Label>Texto do Botão</Label>\n                  <Input \n                    value={element.content.text || ''} \n                    onChange={(e) => updateContent('text', e.target.value)}\n                  />\n                </div>\n                <div className=\"space-y-2\">\n                  <Label>Link (URL)</Label>\n                  <Input \n                    value={element.content.href || ''} \n                    onChange={(e) => updateContent('href', e.target.value)}\n                    placeholder=\"https://\"\n                  />\n                </div>\n              </>\n            )}\n\n            {element.type === 'image' && (\n              <>\n                <div className=\"space-y-2\">\n                  <Label>URL da Imagem</Label>\n                  <Input \n                    value={element.content.src || ''} \n                    onChange={(e) => updateContent('src', e.target.value)}\n                    placeholder=\"https://\"\n                  />\n                </div>\n                <div className=\"space-y-2\">\n                  <Label>Texto Alternativo (Alt)</Label>\n                  <Input \n                    value={element.content.alt || ''} \n                    onChange={(e) => updateContent('alt', e.target.value)}\n                  />\n                </div>\n                <div className=\"flex items-center space-x-2\">\n                  <Switch \n                    id=\"aspect-ratio\" \n                    checked={element.styles.aspectRatioLocked}\n                    onCheckedChange={(checked) => updateStyles('aspectRatioLocked', checked)}\n                  />\n                  <Label htmlFor=\"aspect-ratio\">Manter Proporção</Label>\n                </div>\n              </>\n            )}\n\n            {element.type === 'video' && (\n              <div className=\"space-y-2\">\n                <Label>URL do Vídeo (YouTube/Vimeo)</Label>\n                <Input \n                  value={element.content.videoUrl || ''} \n                  onChange={(e) => updateContent('videoUrl', e.target.value)}\n                  placeholder=\"https://\"\n                />\n              </div>\n            )}\n\n            {element.type === 'columns' && (\n              <div className=\"space-y-2\">\n                <Label>Número de Colunas</Label>\n                <Select \n                  value={String(element.content.columns || 2)} \n                  onValueChange={(v) => handleColumnsChange(parseInt(v))}\n                >\n                  <SelectTrigger>\n                    <SelectValue />\n                  </SelectTrigger>\n                  <SelectContent>\n                    <SelectItem value=\"1\">1 Coluna</SelectItem>\n                    <SelectItem value=\"2\">2 Colunas</SelectItem>\n                    <SelectItem value=\"3\">3 Colunas</SelectItem>\n                    <SelectItem value=\"4\">4 Colunas</SelectItem>\n                  </SelectContent>\n                </Select>\n                \n                <div className=\"flex items-center space-x-2 pt-2\">\n                  <Switch \n                    id=\"stack-mobile\" \n                    checked={element.content.stackOnMobile !== false}\n                    onCheckedChange={(checked) => updateContent('stackOnMobile', checked)}\n                  />\n                  <Label htmlFor=\"stack-mobile\">Empilhar no Mobile</Label>\n                </div>\n              </div>\n            )}\n            \n            {element.type === 'form' && (\n              <div className=\"space-y-4\">\n                <div className=\"space-y-2\">\n                  <Label>Texto do Botão</Label>\n                  <Input \n                    value={element.content.submitLabel || 'Enviar'} \n                    onChange={(e) => updateContent('submitLabel', e.target.value)}\n                  />\n                </div>\n                \n                <div className=\"space-y-2\">\n                  <Label>Mensagem de Sucesso</Label>\n                  <Input \n                    value={element.content.successMessage || 'Enviado com sucesso!'} \n                    onChange={(e) => updateContent('successMessage', e.target.value)}\n                  />\n                </div>\n\n                <div className=\"space-y-2\">\n                  <Label>Redirecionar para (URL)</Label>\n                  <Input \n                    value={element.content.redirectUrl || ''} \n                    onChange={(e) => updateContent('redirectUrl', e.target.value)}\n                    placeholder=\"https://\"\n                  />\n                </div>\n\n                <Separator />\n                \n                <div className=\"flex items-center justify-between\">\n                  <Label>Campos do Formulário</Label>\n                  <Button variant=\"outline\" size=\"sm\" onClick={addFormField}>\n                    <Plus className=\"w-3 h-3 mr-1\" /> Adicionar\n                  </Button>\n                </div>\n                \n                <div className=\"space-y-3\">\n                  {(element.content.formFields || []).map((field, index) => {\n                    if (typeof field === 'string') return null;\n                    return (\n                      <div key={field.id} className=\"border rounded-md p-3 space-y-3 bg-muted/20\">\n                        <div className=\"flex items-center justify-between\">\n                          <span className=\"text-xs font-medium\">Campo {index + 1}</span>\n                          <div className=\"flex items-center gap-1\">\n                            <Button variant=\"ghost\" size=\"icon\" className=\"h-6 w-6\" onClick={() => moveFormField(index, 'up')} disabled={index === 0}>\n                              <ChevronUp className=\"w-3 h-3\" />\n                            </Button>\n                            <Button variant=\"ghost\" size=\"icon\" className=\"h-6 w-6\" onClick={() => moveFormField(index, 'down')} disabled={index === (element.content.formFields?.length || 0) - 1}>\n                              <ChevronDown className=\"w-3 h-3\" />\n                            </Button>\n                            <Button variant=\"ghost\" size=\"icon\" className=\"h-6 w-6 text-destructive\" onClick={() => removeFormField(index)}>\n                              <Trash className=\"w-3 h-3\" />\n                            </Button>\n                          </div>\n                        </div>\n                        \n                        <div className=\"grid grid-cols-2 gap-2\">\n                          <div className=\"space-y-1\">\n                            <Label className=\"text-xs\">Rótulo</Label>\n                            <Input \n                              value={field.label} \n                              onChange={(e) => updateFormField(index, { label: e.target.value })}\n                              className=\"h-8 text-xs\"\n                            />\n                          </div>\n                          <div className=\"space-y-1\">\n                            <Label className=\"text-xs\">Tipo</Label>\n                            <Select \n                              value={field.type} \n                              onValueChange={(v: any) => updateFormField(index, { type: v })}\n                            >\n                              <SelectTrigger className=\"h-8 text-xs\">\n                                <SelectValue />\n                              </SelectTrigger>\n                              <SelectContent>\n                                <SelectItem value=\"text\">Texto</SelectItem>\n                                <SelectItem value=\"email\">Email</SelectItem>\n                                <SelectItem value=\"tel\">Telefone (Simples)</SelectItem>\n                                <SelectItem value=\"phone\">Telefone (Brasil)</SelectItem>\n                                <SelectItem value=\"textarea\">Área de Texto</SelectItem>\n                                <SelectItem value=\"select\">Seleção</SelectItem>\n                                <SelectItem value=\"cpf\">CPF</SelectItem>\n                                <SelectItem value=\"cnpj\">CNPJ</SelectItem>\n                                <SelectItem value=\"cep\">CEP</SelectItem>\n                              </SelectContent>\n                            </Select>\n                          </div>\n                        </div>\n                        \n                        <div className=\"grid grid-cols-2 gap-2\">\n                          <div className=\"space-y-1\">\n                            <Label className=\"text-xs\">Placeholder</Label>\n                            <Input \n                              value={field.placeholder || ''} \n                              onChange={(e) => updateFormField(index, { placeholder: e.target.value })}\n                              className=\"h-8 text-xs\"\n                            />\n                          </div>\n                          <div className=\"space-y-1\">\n                            <Label className=\"text-xs\">Largura</Label>\n                            <Select \n                              value={field.width || 'full'} \n                              onValueChange={(v: any) => updateFormField(index, { width: v })}\n                            >\n                              <SelectTrigger className=\"h-8 text-xs\">\n                                <SelectValue />\n                              </SelectTrigger>\n                              <SelectContent>\n                                <SelectItem value=\"full\">100%</SelectItem>\n                                <SelectItem value=\"half\">50%</SelectItem>\n                                <SelectItem value=\"third\">33%</SelectItem>\n                              </SelectContent>\n                            </Select>\n                          </div>\n                        </div>\n\n                        <div className=\"flex items-center space-x-2\">\n                          <Switch \n                            id={`required-${field.id}`}\n                            checked={field.required}\n                            onCheckedChange={(checked) => updateFormField(index, { required: checked })}\n                          />\n                          <Label htmlFor={`required-${field.id}`} className=\"text-xs\">Obrigatório</Label>\n                        </div>\n                      </div>\n                    );\n                  })}\n                </div>\n              </div>\n            )}\n            \n            {element.type === 'code' && (\n              <div className=\"space-y-2\">\n                <Label>Código HTML/Embed</Label>\n                <Textarea \n                  value={element.content.html || ''} \n                  onChange={(e) => updateContent('html', e.target.value)}\n                  className=\"min-h-[200px] font-mono text-xs\"\n                  placeholder=\"<div>...</div>\"\n                />\n              </div>\n            )}\n          </div>\n\n          <Separator />\n\n          {/* Styles Section */}\n          <div className=\"space-y-4\">\n            <div className=\"flex items-center gap-2 text-sm font-medium text-foreground\">\n              <Palette className=\"w-4 h-4\" />\n              Estilo\n            </div>\n\n            <div className=\"space-y-2\">\n              <Label>Cor de Fundo</Label>\n              <div className=\"flex gap-2\">\n                <Input \n                  type=\"color\" \n                  value={element.styles.backgroundColor || '#ffffff'} \n                  onChange={(e) => updateStyles('backgroundColor', e.target.value)}\n                  className=\"w-10 h-10 p-1 cursor-pointer\"\n                />\n                <Input \n                  value={element.styles.backgroundColor || ''} \n                  onChange={(e) => updateStyles('backgroundColor', e.target.value)}\n                  placeholder=\"#ffffff\"\n                  className=\"flex-1\"\n                />\n              </div>\n            </div>\n\n            <div className=\"space-y-2\">\n              <Label>Cor do Texto</Label>\n              <div className=\"flex gap-2\">\n                <Input \n                  type=\"color\" \n                  value={element.styles.color || '#000000'} \n                  onChange={(e) => updateStyles('color', e.target.value)}\n                  className=\"w-10 h-10 p-1 cursor-pointer\"\n                />\n                <Input \n                  value={element.styles.color || ''} \n                  onChange={(e) => updateStyles('color', e.target.value)}\n                  placeholder=\"#000000\"\n                  className=\"flex-1\"\n                />\n              </div>\n            </div>\n\n            <div className=\"grid grid-cols-2 gap-4\">\n              <div className=\"space-y-2\">\n                <Label>Padding (Interno)</Label>\n                <Input \n                  value={element.styles.padding || ''} \n                  onChange={(e) => updateStyles('padding', e.target.value)}\n                  placeholder=\"20px\"\n                />\n              </div>\n              <div className=\"space-y-2\">\n                <Label>Margin (Externo)</Label>\n                <Input \n                  value={element.styles.margin || ''} \n                  onChange={(e) => updateStyles('margin', e.target.value)}\n                  placeholder=\"0px\"\n                />\n              </div>\n            </div>\n\n            {(element.type === 'heading' || element.type === 'paragraph' || element.type === 'button') && (\n              <>\n                <div className=\"grid grid-cols-2 gap-4\">\n                  <div className=\"space-y-2\">\n                    <Label>Tamanho da Fonte</Label>\n                    <Input \n                      value={element.styles.fontSize || ''} \n                      onChange={(e) => updateStyles('fontSize', e.target.value)}\n                      placeholder=\"16px\"\n                    />\n                  </div>\n                  <div className=\"space-y-2\">\n                    <Label>Peso da Fonte</Label>\n                    <Select \n                      value={element.styles.fontWeight || 'normal'} \n                      onValueChange={(v) => updateStyles('fontWeight', v)}\n                    >\n                      <SelectTrigger>\n                        <SelectValue />\n                      </SelectTrigger>\n                      <SelectContent>\n                        <SelectItem value=\"normal\">Normal</SelectItem>\n                        <SelectItem value=\"medium\">Médio</SelectItem>\n                        <SelectItem value=\"bold\">Negrito</SelectItem>\n                        <SelectItem value=\"100\">100</SelectItem>\n                        <SelectItem value=\"200\">200</SelectItem>\n                        <SelectItem value=\"300\">300</SelectItem>\n                        <SelectItem value=\"400\">400</SelectItem>\n                        <SelectItem value=\"500\">500</SelectItem>\n                        <SelectItem value=\"600\">600</SelectItem>\n                        <SelectItem value=\"700\">700</SelectItem>\n                        <SelectItem value=\"800\">800</SelectItem>\n                        <SelectItem value=\"900\">900</SelectItem>\n                      </SelectContent>\n                    </Select>\n                  </div>\n                </div>\n\n                <div className=\"space-y-2\">\n                  <Label>Alinhamento</Label>\n                  <div className=\"flex bg-muted rounded-md p-1\">\n                    <Button \n                      variant={element.styles.textAlign === 'left' ? 'secondary' : 'ghost'} \n                      size=\"sm\" \n                      className=\"flex-1 h-8\"\n                      onClick={() => updateStyles('textAlign', 'left')}\n                    >\n                      Esq\n                    </Button>\n                    <Button \n                      variant={element.styles.textAlign === 'center' ? 'secondary' : 'ghost'} \n                      size=\"sm\" \n                      className=\"flex-1 h-8\"\n                      onClick={() => updateStyles('textAlign', 'center')}\n                    >\n                      Centro\n                    </Button>\n                    <Button \n                      variant={element.styles.textAlign === 'right' ? 'secondary' : 'ghost'} \n                      size=\"sm\" \n                      className=\"flex-1 h-8\"\n                      onClick={() => updateStyles('textAlign', 'right')}\n                    >\n                      Dir\n                    </Button>\n                    <Button \n                      variant={element.styles.textAlign === 'justify' ? 'secondary' : 'ghost'} \n                      size=\"sm\" \n                      className=\"flex-1 h-8\"\n                      onClick={() => updateStyles('textAlign', 'justify')}\n                    >\n                      Just\n                    </Button>\n                  </div>\n                </div>\n              </>\n            )}\n\n            <div className=\"space-y-2\">\n              <Label>Borda</Label>\n              <div className=\"grid grid-cols-2 gap-2\">\n                <Input \n                  value={element.styles.borderWidth || ''} \n                  onChange={(e) => updateStyles('borderWidth', e.target.value)}\n                  placeholder=\"Largura (1px)\"\n                />\n                <Input \n                  value={element.styles.borderColor || ''} \n                  onChange={(e) => updateStyles('borderColor', e.target.value)}\n                  placeholder=\"Cor (#ccc)\"\n                />\n              </div>\n              <div className=\"grid grid-cols-2 gap-2 mt-2\">\n                <Select \n                  value={element.styles.borderStyle || 'none'} \n                  onValueChange={(v) => updateStyles('borderStyle', v)}\n                >\n                  <SelectTrigger>\n                    <SelectValue placeholder=\"Estilo\" />\n                  </SelectTrigger>\n                  <SelectContent>\n                    <SelectItem value=\"none\">Nenhuma</SelectItem>\n                    <SelectItem value=\"solid\">Sólida</SelectItem>\n                    <SelectItem value=\"dashed\">Tracejada</SelectItem>\n                    <SelectItem value=\"dotted\">Pontilhada</SelectItem>\n                  </SelectContent>\n                </Select>\n                <Input \n                  value={element.styles.borderRadius || ''} \n                  onChange={(e) => updateStyles('borderRadius', e.target.value)}\n                  placeholder=\"Raio (4px)\"\n                />\n              </div>\n            </div>\n            \n            {(element.type === 'image' || element.type === 'button') && (\n               <div className=\"space-y-2\">\n                <Label>Largura</Label>\n                <Input \n                  value={element.styles.width || ''} \n                  onChange={(e) => updateStyles('width', e.target.value)}\n                  placeholder=\"100% ou 200px\"\n                />\n               </div>\n            )}\n            \n            {element.type === 'section' && (\n              <div className=\"space-y-2\">\n                <Label>Imagem de Fundo (URL)</Label>\n                <Input \n                  value={element.styles.backgroundImage ? element.styles.backgroundImage.replace(/^url\\(['\"](.+)['\"]\\)$/, '$1') : ''} \n                  onChange={(e) => updateStyles('backgroundImage', e.target.value ? `url('${e.target.value}')` : undefined)}\n                  placeholder=\"https://\"\n                />\n                {element.styles.backgroundImage && (\n                  <div className=\"grid grid-cols-2 gap-2 mt-2\">\n                    <Select \n                      value={element.styles.backgroundSize || 'cover'} \n                      onValueChange={(v) => updateStyles('backgroundSize', v)}\n                    >\n                      <SelectTrigger>\n                        <SelectValue />\n                      </SelectTrigger>\n                      <SelectContent>\n                        <SelectItem value=\"cover\">Cobrir</SelectItem>\n                        <SelectItem value=\"contain\">Conter</SelectItem>\n                        <SelectItem value=\"auto\">Original</SelectItem>\n                      </SelectContent>\n                    </Select>\n                    <Select \n                      value={element.styles.backgroundPosition || 'center'} \n                      onValueChange={(v) => updateStyles('backgroundPosition', v)}\n                    >\n                      <SelectTrigger>\n                        <SelectValue />\n                      </SelectTrigger>\n                      <SelectContent>\n                        <SelectItem value=\"center\">Centro</SelectItem>\n                        <SelectItem value=\"top\">Topo</SelectItem>\n                        <SelectItem value=\"bottom\">Fundo</SelectItem>\n                        <SelectItem value=\"left\">Esquerda</SelectItem>\n                        <SelectItem value=\"right\">Direita</SelectItem>\n                      </SelectContent>\n                    </Select>\n                  </div>\n                )}\n              </div>\n            )}\n          </div>\n\n        </div>\n      </ScrollArea>\n    </aside>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Projetos\\Back_endCrm\\kanbanproject1\\components\\landing-pages\\builder\\sortable-element.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projetos\\Back_endCrm\\kanbanproject1\\components\\landing-pages\\builder\\templates-dialog.tsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'open' is defined but never used.","line":17,"column":18,"nodeType":"Identifier","messageId":"unusedVar","endLine":17,"endColumn":31,"suggestions":[{"messageId":"removeVar","data":{"varName":"open"},"fix":{"range":[495,508],"text":""},"desc":"Remove unused variable 'open'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'template' is defined but never used.","line":18,"column":22,"nodeType":"Identifier","messageId":"unusedVar","endLine":18,"endColumn":40,"suggestions":[{"messageId":"removeVar","data":{"varName":"template"},"fix":{"range":[540,558],"text":""},"desc":"Remove unused variable 'template'."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState } from 'react';\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogHeader,\n  DialogTitle,\n} from '@/components/ui/dialog';\nimport { Button } from '@/components/ui/button';\nimport { ScrollArea } from '@/components/ui/scroll-area';\nimport { Badge } from '@/components/ui/badge';\nimport { TEMPLATES, Template } from '@/lib/data/templates';\nimport { Layout, MousePointerClick } from 'lucide-react';\n\ninterface TemplatesDialogProps {\n  open: boolean;\n  onOpenChange: (open: boolean) => void;\n  onSelectTemplate: (template: Template) => void;\n}\n\nexport function TemplatesDialog({ open, onOpenChange, onSelectTemplate }: TemplatesDialogProps) {\n  const [selectedCategory, setSelectedCategory] = useState<string | null>(null);\n\n  const categories = [\n    { id: 'all', label: 'Todos' },\n    { id: 'lead-generation', label: 'Geração de Leads' },\n    { id: 'sales', label: 'Página de Vendas' },\n    { id: 'product', label: 'Produto' },\n    { id: 'webinar', label: 'Webinar / Evento' },\n    { id: 'waiting-list', label: 'Lista de Espera' },\n    { id: 'contact', label: 'Orçamento / B2B' },\n    { id: 'health', label: 'Saúde' },\n    { id: 'real-estate', label: 'Imobiliário' },\n  ];\n\n  const filteredTemplates = selectedCategory && selectedCategory !== 'all'\n    ? TEMPLATES.filter(t => t.category === selectedCategory)\n    : TEMPLATES;\n\n  return (\n    <Dialog open={open} onOpenChange={onOpenChange}>\n      <DialogContent className=\"max-w-5xl h-[80vh] flex flex-col p-0 gap-0 bg-background/95 backdrop-blur-xl\">\n        <DialogHeader className=\"p-6 border-b\">\n          <DialogTitle className=\"text-2xl font-bold flex items-center gap-2\">\n            <Layout className=\"w-6 h-6 text-primary\" />\n            Escolha um Modelo\n          </DialogTitle>\n          <DialogDescription className=\"text-base\">\n            Comece com um template profissional e personalize como quiser.\n          </DialogDescription>\n        </DialogHeader>\n\n        <div className=\"flex flex-1 overflow-hidden\">\n          {/* Sidebar Filters */}\n          <aside className=\"w-64 border-r p-4 flex flex-col gap-2 bg-muted/30\">\n            <h3 className=\"text-sm font-semibold text-muted-foreground mb-2 px-2\">Categorias</h3>\n            {categories.map(cat => (\n              <Button\n                key={cat.id}\n                variant={selectedCategory === cat.id || (cat.id === 'all' && !selectedCategory) ? \"secondary\" : \"ghost\"}\n                className=\"justify-start w-full\"\n                onClick={() => setSelectedCategory(cat.id)}\n              >\n                {cat.label}\n              </Button>\n            ))}\n          </aside>\n\n          {/* Templates Grid */}\n          <ScrollArea className=\"flex-1 p-8 bg-muted/10\">\n            <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\n              {filteredTemplates.map((template) => (\n                <div \n                  key={template.id}\n                  className=\"group relative bg-card border rounded-xl overflow-hidden shadow-sm hover:shadow-xl transition-all duration-300 hover:scale-[1.02] flex flex-col h-[320px]\"\n                >\n                  {/* Thumbnail Placeholder */}\n                  <div className=\"h-40 bg-muted flex items-center justify-center relative overflow-hidden\">\n                    <div className=\"absolute inset-0 bg-gradient-to-t from-black/50 to-transparent opacity-0 group-hover:opacity-100 transition-opacity z-10\" />\n                    <Layout className=\"w-12 h-12 text-muted-foreground/30 group-hover:scale-110 transition-transform duration-500\" />\n                    \n                    <div className=\"absolute bottom-4 left-0 right-0 flex justify-center gap-2 opacity-0 group-hover:opacity-100 transition-all duration-300 translate-y-4 group-hover:translate-y-0 z-20 px-4\">\n                      <Button \n                        size=\"sm\" \n                        className=\"w-full font-semibold shadow-lg\"\n                        onClick={() => onSelectTemplate(template)}\n                      >\n                        <MousePointerClick className=\"w-4 h-4 mr-2\" />\n                        Usar Template\n                      </Button>\n                    </div>\n                  </div>\n\n                  {/* Content */}\n                  <div className=\"p-5 flex flex-col flex-1\">\n                    <div className=\"flex items-start justify-between mb-2\">\n                      <Badge variant=\"outline\" className=\"text-xs font-normal bg-primary/5 text-primary border-primary/20\">\n                        {categories.find(c => c.id === template.category)?.label}\n                      </Badge>\n                    </div>\n                    \n                    <h3 className=\"font-bold text-lg leading-tight mb-2 group-hover:text-primary transition-colors\">\n                      {template.name}\n                    </h3>\n                    \n                    <p className=\"text-sm text-muted-foreground line-clamp-3\">\n                      {template.description}\n                    </p>\n                  </div>\n                </div>\n              ))}\n            </div>\n          </ScrollArea>\n        </div>\n      </DialogContent>\n    </Dialog>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Projetos\\Back_endCrm\\kanbanproject1\\components\\landing-pages\\drag-drop-builder.tsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'landingPage' is defined but never used.","line":37,"column":12,"nodeType":"Identifier","messageId":"unusedVar","endLine":37,"endColumn":76,"suggestions":[{"messageId":"removeVar","data":{"varName":"landingPage"},"fix":{"range":[1279,1343],"text":""},"desc":"Remove unused variable 'landingPage'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'updates' is defined but never used.","line":619,"column":14,"nodeType":"Identifier","messageId":"unusedVar","endLine":619,"endColumn":50,"suggestions":[{"messageId":"removeVar","data":{"varName":"updates"},"fix":{"range":[25188,25224],"text":""},"desc":"Remove unused variable 'updates'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'updates' is defined but never used.","line":972,"column":14,"nodeType":"Identifier","messageId":"unusedVar","endLine":972,"endColumn":50,"suggestions":[{"messageId":"removeVar","data":{"varName":"updates"},"fix":{"range":[38810,38846],"text":""},"desc":"Remove unused variable 'updates'."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has missing dependencies: 'element.styles', 'element.type', and 'onUpdate'. Either include them or remove the dependency array. If 'onUpdate' changes too often, find the parent component that defines it and wrap that definition in useCallback.","line":1013,"column":6,"nodeType":"ArrayExpression","endLine":1013,"endColumn":23,"suggestions":[{"desc":"Update the dependencies array to be: [element.content, element.styles, element.type, onUpdate]","fix":{"range":[40083,40100],"text":"[element.content, element.styles, element.type, onUpdate]"}}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'aspectRatio'. Either include it or remove the dependency array.","line":1023,"column":6,"nodeType":"ArrayExpression","endLine":1023,"endColumn":51,"suggestions":[{"desc":"Update the dependencies array to be: [element.styles.width, element.styles.height, aspectRatio]","fix":{"range":[40456,40501],"text":"[element.styles.width, element.styles.height, aspectRatio]"}}]},{"ruleId":"no-unused-vars","severity":1,"message":"'startHeight' is assigned a value but never used.","line":1033,"column":11,"nodeType":"Identifier","messageId":"unusedVar","endLine":1033,"endColumn":22},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'startHeight' is assigned a value but never used.","line":1033,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":1033,"endColumn":22}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":7,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\"\r\n\r\nimport type React from \"react\"\r\n\r\nimport { useState, useEffect, useRef } from \"react\"\r\nimport { DragDropContext, Droppable, Draggable } from \"@hello-pangea/dnd\"\r\nimport { Button } from \"@/components/ui/button\"\r\nimport { Card, CardContent } from \"@/components/ui/card\"\r\nimport { Input } from \"@/components/ui/input\"\r\nimport { Label } from \"@/components/ui/label\"\r\nimport { Textarea } from \"@/components/ui/textarea\"\r\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from \"@/components/ui/dialog\"\r\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\"\r\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\"\r\nimport { Checkbox } from \"@/components/ui/checkbox\"\r\nimport { Badge } from \"@/components/ui/badge\"\r\nimport { PhoneInputComponent } from \"@/components/ui/phone-input\"\r\nimport {\r\n  Type,\r\n  ImageIcon,\r\n  Square,\r\n  Trash2,\r\n  Eye,\r\n  Save,\r\n  Plus,\r\n  GripVertical,\r\n  Settings,\r\n  FileText,\r\n  Tag,\r\n  X,\r\n} from \"lucide-react\"\r\nimport type { LandingPage, LandingPageElement, FormField, FieldType } from \"@/lib/types/landing-page\"\r\nimport { formatCPF, formatCNPJ } from \"@/lib/input-formatters\"\r\n\r\ninterface DragDropBuilderProps {\r\n  landingPage?: LandingPage\r\n  onSave: (landingPage: Omit<LandingPage, \"id\" | \"createdAt\" | \"updatedAt\">) => void\r\n  onClose: () => void\r\n}\r\n\r\nconst availableElements = [\r\n  { id: \"heading\", type: \"heading\" as const, icon: Type, label: \"Título\" },\r\n  { id: \"text\", type: \"text\" as const, icon: Type, label: \"Texto\" },\r\n  { id: \"button\", type: \"button\" as const, icon: Square, label: \"Botão\" },\r\n  { id: \"image\", type: \"image\" as const, icon: ImageIcon, label: \"Imagem\" },\r\n  { id: \"form\", type: \"form\" as const, icon: FileText, label: \"Formulário\" },\r\n]\r\n\r\nexport default function DragDropBuilder({ landingPage, onSave, onClose }: DragDropBuilderProps) {\r\n  const [name, setName] = useState(landingPage?.name || \"\")\r\n  const [funnelId, setFunnelId] = useState(landingPage?.funnelId || \"\")\r\n  const [stageId, setStageId] = useState(landingPage?.stageId || \"\")\r\n  const [tagIds, setTagIds] = useState<string[]>(landingPage?.tagIds || [])\r\n  const [funnels, setFunnels] = useState<any[]>([])\r\n  const [availableTags, setAvailableTags] = useState<any[]>([])\r\n  const [elements, setElements] = useState<LandingPageElement[]>(landingPage?.elements || [])\r\n  const [selectedElement, setSelectedElement] = useState<LandingPageElement | null>(null)\r\n  const [showPreview, setShowPreview] = useState(false)\r\n  const [backgroundColor, setBackgroundColor] = useState(landingPage?.backgroundColor || \"#ffffff\")\r\n\r\n  useEffect(() => {\r\n    const currentUserStr = localStorage.getItem(\"unicrm_auth\")\r\n    if (currentUserStr) {\r\n      const authData = JSON.parse(currentUserStr)\r\n      const currentUser = authData.user\r\n\r\n      const companyKey = `${currentUser.companyId}_funnels`\r\n      const storedFunnels = localStorage.getItem(companyKey)\r\n      if (storedFunnels) {\r\n        const parsedFunnels = JSON.parse(storedFunnels)\r\n        setFunnels(Array.isArray(parsedFunnels) ? parsedFunnels.filter((f: any) => f.isActive) : [])\r\n      }\r\n\r\n      const tagsKey = `${currentUser.companyId}_tags`\r\n      const storedTags = localStorage.getItem(tagsKey)\r\n      if (storedTags) {\r\n        const parsedTags = JSON.parse(storedTags)\r\n        setAvailableTags(Array.isArray(parsedTags) ? parsedTags : [])\r\n      }\r\n    }\r\n  }, [])\r\n\r\n  const handleDragEnd = (result: any) => {\r\n    const { source, destination, draggableId } = result\r\n\r\n    if (!destination) return\r\n\r\n    if (source.droppableId === \"sidebar\" && destination.droppableId === \"canvas\") {\r\n      const elementType = draggableId.replace(\"sidebar-\", \"\") as LandingPageElement[\"type\"]\r\n      const newElement: LandingPageElement = {\r\n        id: `element-${Date.now()}`,\r\n        type: elementType,\r\n        content: getDefaultContent(elementType),\r\n        styles: getDefaultStyles(elementType),\r\n        order: destination.index,\r\n        formFields: elementType === \"form\" ? getDefaultFormFields() : undefined,\r\n      }\r\n\r\n      const newElements = [...elements]\r\n      newElements.splice(destination.index, 0, newElement)\r\n      setElements(newElements.map((el, idx) => ({ ...el, order: idx })))\r\n      return\r\n    }\r\n\r\n    if (source.droppableId === \"canvas\" && destination.droppableId === \"canvas\") {\r\n      const newElements = Array.from(elements)\r\n      const [removed] = newElements.splice(source.index, 1)\r\n      newElements.splice(destination.index, 0, removed)\r\n      setElements(newElements.map((el, idx) => ({ ...el, order: idx })))\r\n    }\r\n  }\r\n\r\n  const getDefaultContent = (type: LandingPageElement[\"type\"]): string => {\r\n    switch (type) {\r\n      case \"heading\":\r\n        return \"Título Principal\"\r\n      case \"text\":\r\n        return \"Adicione seu texto aqui\"\r\n      case \"button\":\r\n        return \"Clique Aqui\"\r\n      case \"image\":\r\n        return \"/abstract-hero.png\"\r\n      case \"form\":\r\n        return \"Formulário de Captura\"\r\n      default:\r\n        return \"\"\r\n    }\r\n  }\r\n\r\n  const getDefaultStyles = (type: LandingPageElement[\"type\"]) => {\r\n    switch (type) {\r\n      case \"heading\":\r\n        return { fontSize: \"48px\", fontWeight: \"bold\", color: \"#1a1a1a\", textAlign: \"center\" }\r\n      case \"text\":\r\n        return { fontSize: \"18px\", color: \"#4a5568\", textAlign: \"center\", lineHeight: \"1.6\" }\r\n      case \"button\":\r\n        return {\r\n          backgroundColor: \"#14b8a6\",\r\n          color: \"#ffffff\",\r\n          padding: \"16px 32px\",\r\n          borderRadius: \"8px\",\r\n          fontSize: \"18px\",\r\n          fontWeight: \"600\",\r\n        }\r\n      case \"image\":\r\n        return { width: \"100%\", maxWidth: \"600px\", borderRadius: \"8px\" }\r\n      case \"form\":\r\n        return { backgroundColor: \"#ffffff\", padding: \"32px\", borderRadius: \"12px\", maxWidth: \"500px\" }\r\n      default:\r\n        return {}\r\n    }\r\n  }\r\n\r\n  const getDefaultFormFields = (): FormField[] => {\r\n    return [\r\n      {\r\n        id: `field-${Date.now()}-1`,\r\n        type: \"text\",\r\n        label: \"Nome\",\r\n        placeholder: \"Seu nome completo\",\r\n        required: true,\r\n        order: 0,\r\n      },\r\n      {\r\n        id: `field-${Date.now()}-2`,\r\n        type: \"email\",\r\n        label: \"E-mail\",\r\n        placeholder: \"seu@email.com\",\r\n        required: true,\r\n        order: 1,\r\n      },\r\n      {\r\n        id: `field-${Date.now()}-3`,\r\n        type: \"phone\",\r\n        label: \"Telefone\",\r\n        placeholder: \"(00) 00000-0000\",\r\n        required: true,\r\n        order: 2,\r\n        countryCode: \"BR\",\r\n      },\r\n    ]\r\n  }\r\n\r\n  const updateElement = (id: string, updates: Partial<LandingPageElement>) => {\r\n    setElements(elements.map((el) => (el.id === id ? { ...el, ...updates } : el)))\r\n    if (selectedElement?.id === id) {\r\n      setSelectedElement({ ...selectedElement, ...updates })\r\n    }\r\n  }\r\n\r\n  const deleteElement = (id: string) => {\r\n    setElements(elements.filter((el) => el.id !== id))\r\n    if (selectedElement?.id === id) {\r\n      setSelectedElement(null)\r\n    }\r\n  }\r\n\r\n  const handleSave = () => {\r\n    if (!name.trim()) {\r\n      alert(\"Por favor, adicione um nome para a landing page\")\r\n      return\r\n    }\r\n\r\n    if (!funnelId || !stageId) {\r\n      alert(\"Por favor, selecione um funil e uma etapa\")\r\n      return\r\n    }\r\n\r\n    onSave({\r\n      name,\r\n      funnelId,\r\n      stageId,\r\n      tagIds,\r\n      elements,\r\n      backgroundColor,\r\n      leads: landingPage?.leads || [],\r\n    })\r\n  }\r\n\r\n  const selectedFunnel = funnels.find((f) => f.id === funnelId)\r\n  const availableStages = selectedFunnel?.columns || []\r\n\r\n  const toggleTag = (tagId: string) => {\r\n    if (tagIds.includes(tagId)) {\r\n      setTagIds(tagIds.filter((id) => id !== tagId))\r\n    } else {\r\n      setTagIds([...tagIds, tagId])\r\n    }\r\n  }\r\n\r\n  return (\r\n    <Dialog open={true} onOpenChange={onClose}>\r\n      <DialogContent className=\"max-w-[95vw] h-[90vh] p-0\">\r\n        <DialogHeader className=\"p-6 pb-4 border-b\">\r\n          <div className=\"flex items-center justify-between\">\r\n            <DialogTitle>Criar Landing Page</DialogTitle>\r\n            <div className=\"flex items-center gap-2\">\r\n              <Button variant=\"outline\" size=\"sm\" onClick={() => setShowPreview(!showPreview)}>\r\n                <Eye className=\"h-4 w-4 mr-2\" />\r\n                {showPreview ? \"Editor\" : \"Preview\"}\r\n              </Button>\r\n              <Button size=\"sm\" onClick={handleSave}>\r\n                <Save className=\"h-4 w-4 mr-2\" />\r\n                Salvar\r\n              </Button>\r\n            </div>\r\n          </div>\r\n        </DialogHeader>\r\n\r\n        <div className=\"flex-1 overflow-hidden\">\r\n          {showPreview ? (\r\n            <div className=\"h-full overflow-auto p-6\">\r\n              <div className=\"max-w-4xl mx-auto\">\r\n                <PreviewLandingPage elements={elements} backgroundColor={backgroundColor} />\r\n              </div>\r\n            </div>\r\n          ) : (\r\n            <DragDropContext onDragEnd={handleDragEnd}>\r\n              <div className=\"grid grid-cols-[250px_1fr_300px] h-full\">\r\n                {/* Sidebar - Available Elements */}\r\n                <div className=\"border-r p-4 overflow-auto bg-gray-50\">\r\n                  <h3 className=\"font-semibold mb-4\">Elementos</h3>\r\n                  <Droppable droppableId=\"sidebar\" isDropDisabled={true}>\r\n                    {(provided) => (\r\n                      <div {...provided.droppableProps} ref={provided.innerRef} className=\"space-y-2\">\r\n                        {availableElements.map((element, index) => (\r\n                          <Draggable key={element.id} draggableId={`sidebar-${element.type}`} index={index}>\r\n                            {(provided, snapshot) => (\r\n                              <>\r\n                                <Card\r\n                                  ref={provided.innerRef}\r\n                                  {...provided.draggableProps}\r\n                                  {...provided.dragHandleProps}\r\n                                  className={`cursor-move hover:shadow-md transition-shadow ${\r\n                                    snapshot.isDragging ? \"opacity-50\" : \"\"\r\n                                  }`}\r\n                                >\r\n                                  <CardContent className=\"p-3 flex items-center gap-2\">\r\n                                    <element.icon className=\"h-4 w-4\" />\r\n                                    <span className=\"text-sm font-medium\">{element.label}</span>\r\n                                  </CardContent>\r\n                                </Card>\r\n                                {snapshot.isDragging && (\r\n                                  <Card className=\"cursor-move\">\r\n                                    <CardContent className=\"p-3 flex items-center gap-2\">\r\n                                      <element.icon className=\"h-4 w-4\" />\r\n                                      <span className=\"text-sm font-medium\">{element.label}</span>\r\n                                    </CardContent>\r\n                                  </Card>\r\n                                )}\r\n                              </>\r\n                            )}\r\n                          </Draggable>\r\n                        ))}\r\n                        {provided.placeholder}\r\n                      </div>\r\n                    )}\r\n                  </Droppable>\r\n\r\n                  <div className=\"mt-6 space-y-4\">\r\n                    <div>\r\n                      <Label>Nome da Landing Page</Label>\r\n                      <Input\r\n                        value={name}\r\n                        onChange={(e) => setName(e.target.value)}\r\n                        placeholder=\"Ex: Campanha Black Friday\"\r\n                      />\r\n                    </div>\r\n                    <div>\r\n                      <Label>Funil</Label>\r\n                      <Select\r\n                        value={funnelId}\r\n                        onValueChange={(value) => {\r\n                          setFunnelId(value)\r\n                          setStageId(\"\")\r\n                        }}\r\n                      >\r\n                        <SelectTrigger>\r\n                          <SelectValue placeholder=\"Selecione um funil\" />\r\n                        </SelectTrigger>\r\n                        <SelectContent>\r\n                          {funnels.map((funnel) => (\r\n                            <SelectItem key={funnel.id} value={funnel.id}>\r\n                              {funnel.name}\r\n                            </SelectItem>\r\n                          ))}\r\n                        </SelectContent>\r\n                      </Select>\r\n                    </div>\r\n                    <div>\r\n                      <Label>Etapa do Funil</Label>\r\n                      <Select value={stageId} onValueChange={setStageId} disabled={!funnelId}>\r\n                        <SelectTrigger>\r\n                          <SelectValue placeholder=\"Selecione uma etapa\" />\r\n                        </SelectTrigger>\r\n                        <SelectContent>\r\n                          {availableStages.map((stage: any) => (\r\n                            <SelectItem key={stage.id} value={stage.id}>\r\n                              {stage.name}\r\n                            </SelectItem>\r\n                          ))}\r\n                        </SelectContent>\r\n                      </Select>\r\n                    </div>\r\n                    <div>\r\n                      <Label className=\"flex items-center gap-2 mb-2\">\r\n                        <Tag className=\"h-4 w-4\" />\r\n                        Tags Automáticas\r\n                      </Label>\r\n                      <p className=\"text-xs text-muted-foreground mb-2\">\r\n                        Leads desta LP receberão estas tags automaticamente\r\n                      </p>\r\n                      <div className=\"flex flex-wrap gap-2\">\r\n                        {availableTags.length === 0 ? (\r\n                          <p className=\"text-xs text-muted-foreground\">Nenhuma tag disponível</p>\r\n                        ) : (\r\n                          availableTags.map((tag) => (\r\n                            <Badge\r\n                              key={tag.id}\r\n                              variant={tagIds.includes(tag.id) ? \"default\" : \"outline\"}\r\n                              className=\"cursor-pointer\"\r\n                              style={{\r\n                                backgroundColor: tagIds.includes(tag.id) ? tag.color : \"transparent\",\r\n                                borderColor: tag.color,\r\n                                color: tagIds.includes(tag.id) ? \"#ffffff\" : tag.color,\r\n                              }}\r\n                              onClick={() => toggleTag(tag.id)}\r\n                            >\r\n                              {tag.name}\r\n                              {tagIds.includes(tag.id) && <X className=\"h-3 w-3 ml-1\" />}\r\n                            </Badge>\r\n                          ))\r\n                        )}\r\n                      </div>\r\n                    </div>\r\n                    <div>\r\n                      <Label>Cor de Fundo</Label>\r\n                      <div className=\"flex gap-2\">\r\n                        <Input\r\n                          type=\"color\"\r\n                          value={backgroundColor}\r\n                          onChange={(e) => setBackgroundColor(e.target.value)}\r\n                          className=\"w-16 h-10\"\r\n                        />\r\n                        <Input\r\n                          value={backgroundColor}\r\n                          onChange={(e) => setBackgroundColor(e.target.value)}\r\n                          placeholder=\"#ffffff\"\r\n                        />\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n\r\n                {/* Canvas - Drop Zone */}\r\n                <div className=\"p-6 overflow-auto bg-white\">\r\n                  <div className=\"max-w-4xl mx-auto\">\r\n                    <Droppable droppableId=\"canvas\">\r\n                      {(provided, snapshot) => (\r\n                        <div\r\n                          {...provided.droppableProps}\r\n                          ref={provided.innerRef}\r\n                          className={`min-h-[600px] border-2 border-dashed rounded-lg p-6 transition-colors ${\r\n                            snapshot.isDraggingOver ? \"border-teal-500 bg-teal-50\" : \"border-gray-300\"\r\n                          }`}\r\n                          style={{ backgroundColor }}\r\n                        >\r\n                          {elements.length === 0 ? (\r\n                            <div className=\"flex flex-col items-center justify-center h-full text-center text-gray-400\">\r\n                              <Plus className=\"h-12 w-12 mb-4\" />\r\n                              <p className=\"text-lg font-medium\">Arraste elementos aqui</p>\r\n                              <p className=\"text-sm\">Comece arrastando elementos da barra lateral</p>\r\n                            </div>\r\n                          ) : (\r\n                            elements.map((element, index) => (\r\n                              <Draggable key={element.id} draggableId={element.id} index={index}>\r\n                                {(provided) => (\r\n                                  <div\r\n                                    ref={provided.innerRef}\r\n                                    {...provided.draggableProps}\r\n                                    className={`group relative mb-4 ${\r\n                                      selectedElement?.id === element.id ? \"ring-2 ring-teal-500 rounded\" : \"\"\r\n                                    }`}\r\n                                    onClick={() => setSelectedElement(element)}\r\n                                  >\r\n                                    <div\r\n                                      {...provided.dragHandleProps}\r\n                                      className=\"absolute -left-8 top-1/2 -translate-y-1/2 opacity-0 group-hover:opacity-100 transition-opacity cursor-move\"\r\n                                    >\r\n                                      <GripVertical className=\"h-5 w-5 text-gray-400\" />\r\n                                    </div>\r\n                                    {element.type === \"image\" ? (\r\n                                      <ResizableElement\r\n                                        element={element}\r\n                                        isSelected={selectedElement?.id === element.id}\r\n                                        onUpdate={(updates) => updateElement(element.id, updates)}\r\n                                      >\r\n                                        <ElementRenderer element={element} />\r\n                                      </ResizableElement>\r\n                                    ) : (\r\n                                      <ElementRenderer element={element} />\r\n                                    )}\r\n                                  </div>\r\n                                )}\r\n                              </Draggable>\r\n                            ))\r\n                          )}\r\n                          {provided.placeholder}\r\n                        </div>\r\n                      )}\r\n                    </Droppable>\r\n                  </div>\r\n                </div>\r\n\r\n                {/* Properties Panel */}\r\n                <div className=\"border-l p-4 overflow-auto bg-gray-50\">\r\n                  <div className=\"flex items-center justify-between mb-4\">\r\n                    <h3 className=\"font-semibold\">Propriedades</h3>\r\n                    {selectedElement && (\r\n                      <Button\r\n                        variant=\"ghost\"\r\n                        size=\"sm\"\r\n                        onClick={() => deleteElement(selectedElement.id)}\r\n                        className=\"text-red-600 hover:text-red-700 hover:bg-red-50\"\r\n                      >\r\n                        <Trash2 className=\"h-4 w-4\" />\r\n                      </Button>\r\n                    )}\r\n                  </div>\r\n\r\n                  {selectedElement ? (\r\n                    <ElementProperties\r\n                      element={selectedElement}\r\n                      onUpdate={(updates) => updateElement(selectedElement.id, updates)}\r\n                    />\r\n                  ) : (\r\n                    <div className=\"text-center text-gray-400 py-8\">\r\n                      <Settings className=\"h-8 w-8 mx-auto mb-2\" />\r\n                      <p className=\"text-sm\">Selecione um elemento para editar</p>\r\n                    </div>\r\n                  )}\r\n                </div>\r\n              </div>\r\n            </DragDropContext>\r\n          )}\r\n        </div>\r\n      </DialogContent>\r\n    </Dialog>\r\n  )\r\n}\r\n\r\nfunction ElementRenderer({ element }: { element: LandingPageElement }) {\r\n  const commonStyles = {\r\n    ...element.styles,\r\n    margin: \"0 auto\",\r\n  }\r\n\r\n  const [formValues, setFormValues] = useState<Record<string, string>>({})\r\n\r\n  const handleInputChange = (fieldId: string, value: string, fieldType: FieldType) => {\r\n    let formattedValue = value\r\n\r\n    if (fieldType === \"cpf\") {\r\n      formattedValue = formatCPF(value)\r\n    } else if (fieldType === \"cnpj\") {\r\n      formattedValue = formatCNPJ(value)\r\n    }\r\n\r\n    setFormValues({ ...formValues, [fieldId]: formattedValue })\r\n  }\r\n\r\n  const handlePhoneChange = (fieldId: string, value: string) => {\r\n    setFormValues({ ...formValues, [fieldId]: value })\r\n  }\r\n\r\n  const getAlignmentStyles = (textAlign?: string) => {\r\n    switch (textAlign) {\r\n      case \"left\":\r\n        return { display: \"flex\", justifyContent: \"flex-start\" }\r\n      case \"right\":\r\n        return { display: \"flex\", justifyContent: \"flex-end\" }\r\n      case \"center\":\r\n      default:\r\n        return { display: \"flex\", justifyContent: \"center\" }\r\n    }\r\n  }\r\n\r\n  switch (element.type) {\r\n    case \"heading\":\r\n      return <h1 style={commonStyles}>{element.content}</h1>\r\n    case \"text\":\r\n      return <p style={commonStyles}>{element.content}</p>\r\n    case \"button\":\r\n      return (\r\n        <div style={{ textAlign: element.styles.textAlign || \"center\" }}>\r\n          <button style={commonStyles}>{element.content}</button>\r\n        </div>\r\n      )\r\n    case \"image\":\r\n      return (\r\n        <div style={getAlignmentStyles(element.styles.textAlign as string)}>\r\n          <img src={element.content || \"/placeholder.svg\"} alt=\"Landing page\" style={commonStyles} />\r\n        </div>\r\n      )\r\n    case \"form\":\r\n      return (\r\n        <div style={{ ...commonStyles, display: \"flex\", flexDirection: \"column\", gap: \"16px\" }}>\r\n          <h3 style={{ fontSize: \"24px\", fontWeight: \"bold\", marginBottom: \"8px\" }}>{element.content}</h3>\r\n          {element.formFields?.map((field) => (\r\n            <div key={field.id}>\r\n              <label style={{ display: \"block\", marginBottom: \"4px\", fontSize: \"14px\", fontWeight: \"500\" }}>\r\n                {field.label} {field.required && <span style={{ color: \"red\" }}>*</span>}\r\n              </label>\r\n              {field.type === \"phone\" ? (\r\n                <PhoneInputComponent\r\n                  value={formValues[field.id] || \"\"}\r\n                  onChange={(value) => handlePhoneChange(field.id, value)}\r\n                  placeholder={field.placeholder}\r\n                  defaultCountry={(field.countryCode || \"BR\").toLowerCase()}\r\n                  disabled\r\n                />\r\n              ) : field.type === \"cpf\" || field.type === \"cnpj\" ? (\r\n                <input\r\n                  type=\"text\"\r\n                  placeholder={field.placeholder}\r\n                  value={formValues[field.id] || \"\"}\r\n                  onChange={(e) => handleInputChange(field.id, e.target.value, field.type)}\r\n                  style={{\r\n                    width: \"100%\",\r\n                    padding: \"12px\",\r\n                    border: \"1px solid #e2e8f0\",\r\n                    borderRadius: \"6px\",\r\n                    fontSize: \"16px\",\r\n                  }}\r\n                />\r\n              ) : (\r\n                <input\r\n                  type={field.type === \"email\" ? \"email\" : \"text\"}\r\n                  placeholder={field.placeholder}\r\n                  value={formValues[field.id] || \"\"}\r\n                  onChange={(e) => handleInputChange(field.id, e.target.value, field.type)}\r\n                  style={{\r\n                    width: \"100%\",\r\n                    padding: \"12px\",\r\n                    border: \"1px solid #e2e8f0\",\r\n                    borderRadius: \"6px\",\r\n                    fontSize: \"16px\",\r\n                  }}\r\n                />\r\n              )}\r\n            </div>\r\n          ))}\r\n          <button\r\n            style={{\r\n              backgroundColor: \"#14b8a6\",\r\n              color: \"#ffffff\",\r\n              padding: \"12px 24px\",\r\n              borderRadius: \"6px\",\r\n              fontSize: \"16px\",\r\n              fontWeight: \"600\",\r\n              border: \"none\",\r\n              cursor: \"pointer\",\r\n            }}\r\n          >\r\n            Enviar\r\n          </button>\r\n        </div>\r\n      )\r\n    default:\r\n      return null\r\n  }\r\n}\r\n\r\nfunction ElementProperties({\r\n  element,\r\n  onUpdate,\r\n}: {\r\n  element: LandingPageElement\r\n  onUpdate: (updates: Partial<LandingPageElement>) => void\r\n}) {\r\n  const addFormField = () => {\r\n    const newField: FormField = {\r\n      id: `field-${Date.now()}`,\r\n      type: \"text\",\r\n      label: \"Novo Campo\",\r\n      placeholder: \"Digite aqui...\",\r\n      required: false,\r\n      order: element.formFields?.length || 0,\r\n    }\r\n    onUpdate({ formFields: [...(element.formFields || []), newField] })\r\n  }\r\n\r\n  const updateFormField = (fieldId: string, updates: Partial<FormField>) => {\r\n    const updatedFields = element.formFields?.map((field) => (field.id === fieldId ? { ...field, ...updates } : field))\r\n    onUpdate({ formFields: updatedFields })\r\n  }\r\n\r\n  const deleteFormField = (fieldId: string) => {\r\n    const updatedFields = element.formFields?.filter((field) => field.id !== fieldId)\r\n    onUpdate({ formFields: updatedFields })\r\n  }\r\n\r\n  return (\r\n    <Tabs defaultValue=\"content\" className=\"w-full\">\r\n      <TabsList className=\"grid w-full grid-cols-2\">\r\n        <TabsTrigger value=\"content\">Conteúdo</TabsTrigger>\r\n        <TabsTrigger value=\"style\">Estilo</TabsTrigger>\r\n      </TabsList>\r\n\r\n      <TabsContent value=\"content\" className=\"space-y-4\">\r\n        {element.type === \"image\" ? (\r\n          <div>\r\n            <Label>URL da Imagem</Label>\r\n            <Input\r\n              value={element.content}\r\n              onChange={(e) => onUpdate({ content: e.target.value })}\r\n              placeholder=\"https://...\"\r\n            />\r\n          </div>\r\n        ) : element.type === \"form\" ? (\r\n          <div className=\"space-y-4\">\r\n            <div>\r\n              <Label>Título do Formulário</Label>\r\n              <Input value={element.content} onChange={(e) => onUpdate({ content: e.target.value })} />\r\n            </div>\r\n\r\n            <div className=\"space-y-3\">\r\n              <div className=\"flex items-center justify-between\">\r\n                <Label>Campos do Formulário</Label>\r\n                <Button size=\"sm\" variant=\"outline\" onClick={addFormField}>\r\n                  <Plus className=\"h-3 w-3 mr-1\" />\r\n                  Adicionar\r\n                </Button>\r\n              </div>\r\n\r\n              {element.formFields?.map((field, index) => (\r\n                <Card key={field.id} className=\"p-3\">\r\n                  <div className=\"space-y-2\">\r\n                    <div className=\"flex items-center justify-between\">\r\n                      <span className=\"text-sm font-medium\">Campo {index + 1}</span>\r\n                      <Button\r\n                        size=\"sm\"\r\n                        variant=\"ghost\"\r\n                        onClick={() => deleteFormField(field.id)}\r\n                        className=\"h-6 w-6 p-0 text-red-600\"\r\n                      >\r\n                        <Trash2 className=\"h-3 w-3\" />\r\n                      </Button>\r\n                    </div>\r\n\r\n                    <div>\r\n                      <Label className=\"text-xs\">Tipo</Label>\r\n                      <Select\r\n                        value={field.type}\r\n                        onValueChange={(value: FieldType) => updateFormField(field.id, { type: value })}\r\n                      >\r\n                        <SelectTrigger className=\"h-8\">\r\n                          <SelectValue />\r\n                        </SelectTrigger>\r\n                        <SelectContent>\r\n                          <SelectItem value=\"text\">Texto</SelectItem>\r\n                          <SelectItem value=\"email\">E-mail</SelectItem>\r\n                          <SelectItem value=\"phone\">Telefone</SelectItem>\r\n                          <SelectItem value=\"cpf\">CPF</SelectItem>\r\n                          <SelectItem value=\"cnpj\">CNPJ</SelectItem>\r\n                          <SelectItem value=\"custom\">Personalizado</SelectItem>\r\n                        </SelectContent>\r\n                      </Select>\r\n                    </div>\r\n\r\n                    {field.type === \"phone\" && (\r\n                      <div>\r\n                        <Label className=\"text-xs\">País</Label>\r\n                        <Select\r\n                          value={field.countryCode || \"BR\"}\r\n                          onValueChange={(value) => updateFormField(field.id, { countryCode: value })}\r\n                        >\r\n                          <SelectTrigger className=\"h-8\">\r\n                            <SelectValue />\r\n                          </SelectTrigger>\r\n                          <SelectContent>\r\n                            {COUNTRY_CODES.map((country) => (\r\n                              <SelectItem key={country.code} value={country.code}>\r\n                                {country.flag} {country.name} ({country.dialCode})\r\n                              </SelectItem>\r\n                            ))}\r\n                          </SelectContent>\r\n                        </Select>\r\n                      </div>\r\n                    )}\r\n\r\n                    <div>\r\n                      <Label className=\"text-xs\">Label</Label>\r\n                      <Input\r\n                        className=\"h-8\"\r\n                        value={field.label}\r\n                        onChange={(e) => updateFormField(field.id, { label: e.target.value })}\r\n                      />\r\n                    </div>\r\n\r\n                    <div>\r\n                      <Label className=\"text-xs\">Placeholder</Label>\r\n                      <Input\r\n                        className=\"h-8\"\r\n                        value={field.placeholder}\r\n                        onChange={(e) => updateFormField(field.id, { placeholder: e.target.value })}\r\n                      />\r\n                    </div>\r\n\r\n                    <div className=\"flex items-center space-x-2\">\r\n                      <Checkbox\r\n                        id={`required-${field.id}`}\r\n                        checked={field.required}\r\n                        onCheckedChange={(checked) => updateFormField(field.id, { required: checked as boolean })}\r\n                      />\r\n                      <label htmlFor={`required-${field.id}`} className=\"text-xs cursor-pointer\">\r\n                        Campo obrigatório\r\n                      </label>\r\n                    </div>\r\n                  </div>\r\n                </Card>\r\n              ))}\r\n            </div>\r\n          </div>\r\n        ) : (\r\n          <div>\r\n            <Label>Texto</Label>\r\n            {element.type === \"text\" ? (\r\n              <Textarea value={element.content} onChange={(e) => onUpdate({ content: e.target.value })} rows={4} />\r\n            ) : (\r\n              <Input value={element.content} onChange={(e) => onUpdate({ content: e.target.value })} />\r\n            )}\r\n          </div>\r\n        )}\r\n      </TabsContent>\r\n\r\n      <TabsContent value=\"style\" className=\"space-y-4\">\r\n        {element.type === \"image\" && (\r\n          <div className=\"p-3 bg-blue-50 border border-blue-200 rounded-lg\">\r\n            <p className=\"text-xs text-blue-700 mb-2\">\r\n              💡 Dica: Clique na imagem no canvas e arraste as alças azuis para redimensionar manualmente\r\n            </p>\r\n          </div>\r\n        )}\r\n\r\n        <div>\r\n          <Label>Largura</Label>\r\n          <Input\r\n            value={element.styles.width || \"\"}\r\n            onChange={(e) => onUpdate({ styles: { ...element.styles, width: e.target.value } })}\r\n            placeholder=\"Ex: 100%, 500px, auto\"\r\n          />\r\n        </div>\r\n\r\n        <div>\r\n          <Label>Altura</Label>\r\n          <Input\r\n            value={element.styles.height || \"\"}\r\n            onChange={(e) => onUpdate({ styles: { ...element.styles, height: e.target.value } })}\r\n            placeholder=\"Ex: 300px, auto\"\r\n          />\r\n        </div>\r\n\r\n        {element.type !== \"image\" && element.type !== \"form\" && (\r\n          <>\r\n            <div>\r\n              <Label>Tamanho da Fonte</Label>\r\n              <Input\r\n                value={element.styles.fontSize || \"\"}\r\n                onChange={(e) => onUpdate({ styles: { ...element.styles, fontSize: e.target.value } })}\r\n                placeholder=\"16px\"\r\n              />\r\n            </div>\r\n            <div>\r\n              <Label>Cor do Texto</Label>\r\n              <div className=\"flex gap-2\">\r\n                <Input\r\n                  type=\"color\"\r\n                  value={element.styles.color || \"#000000\"}\r\n                  onChange={(e) => onUpdate({ styles: { ...element.styles, color: e.target.value } })}\r\n                  className=\"w-16 h-10\"\r\n                />\r\n                <Input\r\n                  value={element.styles.color || \"\"}\r\n                  onChange={(e) => onUpdate({ styles: { ...element.styles, color: e.target.value } })}\r\n                  placeholder=\"#000000\"\r\n                />\r\n              </div>\r\n            </div>\r\n          </>\r\n        )}\r\n\r\n        {element.type === \"button\" && (\r\n          <>\r\n            <div>\r\n              <Label>Cor de Fundo</Label>\r\n              <div className=\"flex gap-2\">\r\n                <Input\r\n                  type=\"color\"\r\n                  value={element.styles.backgroundColor || \"#14b8a6\"}\r\n                  onChange={(e) => onUpdate({ styles: { ...element.styles, backgroundColor: e.target.value } })}\r\n                  className=\"w-16 h-10\"\r\n                />\r\n                <Input\r\n                  value={element.styles.backgroundColor || \"\"}\r\n                  onChange={(e) => onUpdate({ styles: { ...element.styles, backgroundColor: e.target.value } })}\r\n                  placeholder=\"#14b8a6\"\r\n                />\r\n              </div>\r\n            </div>\r\n            <div>\r\n              <Label>Padding</Label>\r\n              <Input\r\n                value={element.styles.padding || \"\"}\r\n                onChange={(e) => onUpdate({ styles: { ...element.styles, padding: e.target.value } })}\r\n                placeholder=\"16px 32px\"\r\n              />\r\n            </div>\r\n            <div>\r\n              <Label>Border Radius</Label>\r\n              <Input\r\n                value={element.styles.borderRadius || \"\"}\r\n                onChange={(e) => onUpdate({ styles: { ...element.styles, borderRadius: e.target.value } })}\r\n                placeholder=\"8px\"\r\n              />\r\n            </div>\r\n          </>\r\n        )}\r\n\r\n        {element.type === \"form\" && (\r\n          <>\r\n            <div>\r\n              <Label>Cor de Fundo</Label>\r\n              <div className=\"flex gap-2\">\r\n                <Input\r\n                  type=\"color\"\r\n                  value={element.styles.backgroundColor || \"#ffffff\"}\r\n                  onChange={(e) => onUpdate({ styles: { ...element.styles, backgroundColor: e.target.value } })}\r\n                  className=\"w-16 h-10\"\r\n                />\r\n                <Input\r\n                  value={element.styles.backgroundColor || \"\"}\r\n                  onChange={(e) => onUpdate({ styles: { ...element.styles, backgroundColor: e.target.value } })}\r\n                  placeholder=\"#ffffff\"\r\n                />\r\n              </div>\r\n            </div>\r\n            <div>\r\n              <Label>Padding</Label>\r\n              <Input\r\n                value={element.styles.padding || \"\"}\r\n                onChange={(e) => onUpdate({ styles: { ...element.styles, padding: e.target.value } })}\r\n                placeholder=\"32px\"\r\n              />\r\n            </div>\r\n            <div>\r\n              <Label>Border Radius</Label>\r\n              <Input\r\n                value={element.styles.borderRadius || \"\"}\r\n                onChange={(e) => onUpdate({ styles: { ...element.styles, borderRadius: e.target.value } })}\r\n                placeholder=\"12px\"\r\n              />\r\n            </div>\r\n          </>\r\n        )}\r\n\r\n        {element.type !== \"form\" && (\r\n          <div>\r\n            <Label>Alinhamento</Label>\r\n            <div className=\"grid grid-cols-3 gap-2\">\r\n              {[\"left\", \"center\", \"right\"].map((align) => (\r\n                <Button\r\n                  key={align}\r\n                  variant={element.styles.textAlign === align ? \"default\" : \"outline\"}\r\n                  size=\"sm\"\r\n                  onClick={() => onUpdate({ styles: { ...element.styles, textAlign: align } })}\r\n                >\r\n                  {align === \"left\" ? \"←\" : align === \"center\" ? \"↔\" : \"→\"}\r\n                </Button>\r\n              ))}\r\n            </div>\r\n          </div>\r\n        )}\r\n      </TabsContent>\r\n    </Tabs>\r\n  )\r\n}\r\n\r\nfunction PreviewLandingPage({\r\n  elements,\r\n  backgroundColor,\r\n}: {\r\n  elements: LandingPageElement[]\r\n  backgroundColor: string\r\n}) {\r\n  return (\r\n    <div className=\"min-h-screen p-8\" style={{ backgroundColor }}>\r\n      <div className=\"max-w-4xl mx-auto space-y-6\">\r\n        {elements.map((element) => (\r\n          <ElementRenderer key={element.id} element={element} />\r\n        ))}\r\n\r\n        {/* Lead Capture Form */}\r\n        <div className=\"mt-12 p-8 bg-white rounded-lg shadow-lg max-w-md mx-auto\">\r\n          <h3 className=\"text-2xl font-bold mb-6 text-center\">Cadastre-se</h3>\r\n          <div className=\"space-y-4\">\r\n            <Input placeholder=\"Nome completo\" />\r\n            <Input type=\"email\" placeholder=\"E-mail\" />\r\n            <Input type=\"tel\" placeholder=\"Telefone\" />\r\n            <Button className=\"w-full bg-teal-600 hover:bg-teal-700\">Enviar</Button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  )\r\n}\r\n\r\nconst COUNTRY_CODES = [\r\n  { code: \"BR\", name: \"Brazil\", dialCode: \"+55\", flag: \"🇧🇷\" },\r\n  { code: \"US\", name: \"United States\", dialCode: \"+1\", flag: \"🇺🇸\" },\r\n  // Add more country codes as needed\r\n]\r\n\r\nfunction ResizableElement({\r\n  element,\r\n  isSelected,\r\n  onUpdate,\r\n  children,\r\n}: {\r\n  element: LandingPageElement\r\n  isSelected: boolean\r\n  onUpdate: (updates: Partial<LandingPageElement>) => void\r\n  children: React.ReactNode\r\n}) {\r\n  const [isResizing, setIsResizing] = useState(false)\r\n  const [dimensions, setDimensions] = useState({\r\n    width: Number.parseInt(element.styles.width as string) || 600,\r\n    height: Number.parseInt(element.styles.height as string) || 400,\r\n  })\r\n  const [aspectRatio, setAspectRatio] = useState(1)\r\n  const containerRef = useRef<HTMLDivElement>(null)\r\n\r\n  useEffect(() => {\r\n    if (element.type === \"image\" && element.content) {\r\n      const img = new Image()\r\n      img.onload = () => {\r\n        const ratio = img.width / img.height\r\n        setAspectRatio(ratio)\r\n\r\n        // Initialize dimensions if not set\r\n        if (!element.styles.width && !element.styles.height) {\r\n          const maxWidth = 600\r\n          let width = img.width\r\n          let height = img.height\r\n\r\n          if (width > maxWidth) {\r\n            width = maxWidth\r\n            height = width / ratio\r\n          }\r\n\r\n          setDimensions({ width, height })\r\n          onUpdate({\r\n            styles: {\r\n              ...element.styles,\r\n              width: `${width}px`,\r\n              height: `${height}px`,\r\n            },\r\n          })\r\n        }\r\n      }\r\n      img.src = element.content\r\n    }\r\n  }, [element.content])\r\n\r\n  // Update dimensions when styles change\r\n  useEffect(() => {\r\n    const width = Number.parseInt(element.styles.width as string) || 600\r\n    const height = Number.parseInt(element.styles.height as string) || 400\r\n    setDimensions({ width, height })\r\n    if (aspectRatio === 1 && width && height) {\r\n      setAspectRatio(width / height)\r\n    }\r\n  }, [element.styles.width, element.styles.height])\r\n\r\n  const handleResizeStart = (e: React.MouseEvent, corner: \"se\" | \"sw\" | \"ne\" | \"nw\") => {\r\n    e.preventDefault()\r\n    e.stopPropagation()\r\n    setIsResizing(true)\r\n\r\n    const startX = e.clientX\r\n    const startY = e.clientY\r\n    const startWidth = dimensions.width\r\n    const startHeight = dimensions.height\r\n\r\n    const handleMouseMove = (moveEvent: MouseEvent) => {\r\n      let deltaX = moveEvent.clientX - startX\r\n      let deltaY = moveEvent.clientY - startY\r\n\r\n      // Adjust delta based on corner direction\r\n      if (corner === \"sw\" || corner === \"nw\") {\r\n        deltaX = -deltaX\r\n      }\r\n      if (corner === \"nw\" || corner === \"ne\") {\r\n        deltaY = -deltaY\r\n      }\r\n\r\n      // Use the larger delta to maintain aspect ratio smoothly\r\n      const delta = Math.abs(deltaX) > Math.abs(deltaY) ? deltaX : deltaY * aspectRatio\r\n\r\n      const newWidth = Math.max(100, startWidth + delta)\r\n      const newHeight = newWidth / aspectRatio\r\n\r\n      setDimensions({ width: Math.round(newWidth), height: Math.round(newHeight) })\r\n    }\r\n\r\n    const handleMouseUp = () => {\r\n      setIsResizing(false)\r\n      onUpdate({\r\n        styles: {\r\n          ...element.styles,\r\n          width: `${dimensions.width}px`,\r\n          height: `${dimensions.height}px`,\r\n        },\r\n      })\r\n      document.removeEventListener(\"mousemove\", handleMouseMove)\r\n      document.removeEventListener(\"mouseup\", handleMouseUp)\r\n    }\r\n\r\n    document.addEventListener(\"mousemove\", handleMouseMove)\r\n    document.addEventListener(\"mouseup\", handleMouseUp)\r\n  }\r\n\r\n  return (\r\n    <div\r\n      ref={containerRef}\r\n      className=\"relative\"\r\n      style={{\r\n        width: `${dimensions.width}px`,\r\n        height: `${dimensions.height}px`,\r\n        display: \"inline-block\",\r\n      }}\r\n    >\r\n      {children}\r\n\r\n      {isSelected && (\r\n        <>\r\n          {/* Bottom-right corner */}\r\n          <div\r\n            className=\"absolute -bottom-3 -right-3 w-10 h-10 bg-blue-500 border-4 border-white rounded-full cursor-se-resize z-20 shadow-lg hover:scale-125 transition-transform\"\r\n            onMouseDown={(e) => handleResizeStart(e, \"se\")}\r\n            title=\"Arraste para redimensionar\"\r\n          />\r\n          {/* Bottom-left corner */}\r\n          <div\r\n            className=\"absolute -bottom-3 -left-3 w-10 h-10 bg-blue-500 border-4 border-white rounded-full cursor-sw-resize z-20 shadow-lg hover:scale-125 transition-transform\"\r\n            onMouseDown={(e) => handleResizeStart(e, \"sw\")}\r\n            title=\"Arraste para redimensionar\"\r\n          />\r\n          {/* Top-right corner */}\r\n          <div\r\n            className=\"absolute -top-3 -right-3 w-10 h-10 bg-blue-500 border-4 border-white rounded-full cursor-ne-resize z-20 shadow-lg hover:scale-125 transition-transform\"\r\n            onMouseDown={(e) => handleResizeStart(e, \"ne\")}\r\n            title=\"Arraste para redimensionar\"\r\n          />\r\n          {/* Top-left corner */}\r\n          <div\r\n            className=\"absolute -top-3 -left-3 w-10 h-10 bg-blue-500 border-4 border-white rounded-full cursor-nw-resize z-20 shadow-lg hover:scale-125 transition-transform\"\r\n            onMouseDown={(e) => handleResizeStart(e, \"nw\")}\r\n            title=\"Arraste para redimensionar\"\r\n          />\r\n\r\n          {/* Dimension display during resize */}\r\n          {isResizing && (\r\n            <div className=\"absolute -bottom-14 left-1/2 -translate-x-1/2 bg-blue-600 text-white text-sm px-4 py-2 rounded-lg shadow-xl whitespace-nowrap font-semibold z-30\">\r\n              {dimensions.width} × {dimensions.height}px\r\n            </div>\r\n          )}\r\n\r\n          {/* Selection border */}\r\n          <div className=\"absolute inset-0 border-2 border-blue-400 pointer-events-none rounded\" />\r\n        </>\r\n      )}\r\n    </div>\r\n  )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Projetos\\Back_endCrm\\kanbanproject1\\components\\landing-pages\\landing-page-builder.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projetos\\Back_endCrm\\kanbanproject1\\components\\landing-pages\\landing-page-details.tsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'copiedQr' is assigned a value but never used.","line":26,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":26,"endColumn":18,"suggestions":[{"messageId":"removeVar","data":{"varName":"copiedQr"},"fix":{"range":[882,890],"text":""},"desc":"Remove unused variable 'copiedQr'."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'copiedQr' is assigned a value but never used.","line":26,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":26,"endColumn":18}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\"\r\n\r\nimport { useState } from \"react\"\r\nimport { Button } from \"@/components/ui/button\"\r\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\"\r\nimport { Badge } from \"@/components/ui/badge\"\r\nimport { ArrowLeft, ExternalLink, QrCode, Copy, Check } from \"lucide-react\"\r\nimport type { LandingPage } from \"@/lib/types/landing-page\"\r\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from \"@/components/ui/table\"\r\nimport {\r\n  Dialog,\r\n  DialogContent,\r\n  DialogDescription,\r\n  DialogHeader,\r\n  DialogTitle,\r\n  DialogTrigger,\r\n} from \"@/components/ui/dialog\"\r\n\r\ninterface LandingPageDetailsProps {\r\n  landingPage: LandingPage\r\n  onBack: () => void\r\n}\r\n\r\nexport default function LandingPageDetails({ landingPage, onBack }: LandingPageDetailsProps) {\r\n  const [copiedUrl, setCopiedUrl] = useState(false)\r\n  const [copiedQr, setCopiedQr] = useState(false)\r\n\r\n  const landingPageUrl = `${window.location.origin}/lp/${landingPage.id}`\r\n  const qrCodeUrl = `https://api.qrserver.com/v1/create-qr-code/?size=300x300&data=${encodeURIComponent(landingPageUrl)}`\r\n\r\n  const copyToClipboard = (text: string, type: \"url\" | \"qr\") => {\r\n    navigator.clipboard.writeText(text)\r\n    if (type === \"url\") {\r\n      setCopiedUrl(true)\r\n      setTimeout(() => setCopiedUrl(false), 2000)\r\n    } else {\r\n      setCopiedQr(true)\r\n      setTimeout(() => setCopiedQr(false), 2000)\r\n    }\r\n  }\r\n\r\n  const downloadQRCode = () => {\r\n    const link = document.createElement(\"a\")\r\n    link.href = qrCodeUrl\r\n    link.download = `qrcode-${landingPage.name}.png`\r\n    document.body.appendChild(link)\r\n    link.click()\r\n    if (link.parentNode) {\r\n      link.parentNode.removeChild(link)\r\n    }\r\n  }\r\n\r\n  const formElement = landingPage.elements?.find((el) => el.type === \"form\")\r\n  const formFields = formElement?.formFields || []\r\n\r\n  return (\r\n    <div className=\"space-y-6\">\r\n      <div className=\"flex items-center justify-between\">\r\n        <Button variant=\"outline\" onClick={onBack}>\r\n          <ArrowLeft className=\"w-4 h-4 mr-2\" />\r\n          Voltar\r\n        </Button>\r\n        <Button variant=\"outline\" onClick={() => window.open(landingPageUrl, \"_blank\")}>\r\n          <ExternalLink className=\"w-4 h-4 mr-2\" />\r\n          Abrir Landing Page\r\n        </Button>\r\n      </div>\r\n\r\n      <div className=\"grid gap-6 md:grid-cols-2\">\r\n        <Card>\r\n          <CardHeader>\r\n            <CardTitle>{landingPage.name}</CardTitle>\r\n            <CardDescription>\r\n              {landingPage.elements?.find((el) => el.type === \"heading\")?.content || \"Landing Page\"}\r\n            </CardDescription>\r\n          </CardHeader>\r\n          <CardContent className=\"space-y-4\">\r\n            {landingPage.funnelStage && (\r\n              <div>\r\n                <p className=\"text-sm font-medium mb-1\">Etapa do Funil</p>\r\n                <Badge>{landingPage.funnelStage}</Badge>\r\n              </div>\r\n            )}\r\n            <div>\r\n              <p className=\"text-sm font-medium mb-1\">Leads Capturados</p>\r\n              <p className=\"text-2xl font-bold\">{landingPage.leads?.length || 0}</p>\r\n            </div>\r\n            <div>\r\n              <p className=\"text-sm font-medium mb-2\">Link da Landing Page</p>\r\n              <div className=\"flex gap-2\">\r\n                <input\r\n                  type=\"text\"\r\n                  value={landingPageUrl}\r\n                  readOnly\r\n                  className=\"flex-1 px-3 py-2 text-sm border rounded-md bg-muted\"\r\n                />\r\n                <Button size=\"sm\" variant=\"outline\" onClick={() => copyToClipboard(landingPageUrl, \"url\")}>\r\n                  {copiedUrl ? <Check className=\"w-4 h-4\" /> : <Copy className=\"w-4 h-4\" />}\r\n                </Button>\r\n              </div>\r\n            </div>\r\n          </CardContent>\r\n        </Card>\r\n\r\n        <Card>\r\n          <CardHeader>\r\n            <CardTitle>QR Code</CardTitle>\r\n            <CardDescription>Compartilhe sua landing page via QR Code</CardDescription>\r\n          </CardHeader>\r\n          <CardContent className=\"space-y-4\">\r\n            <div className=\"flex justify-center\">\r\n              <img\r\n                src={qrCodeUrl || \"/placeholder.svg\"}\r\n                alt=\"QR Code\"\r\n                className=\"w-48 h-48 border-4 border-white rounded-lg shadow-lg\"\r\n              />\r\n            </div>\r\n            <div className=\"flex gap-2\">\r\n              <Button className=\"flex-1\" onClick={downloadQRCode}>\r\n                <QrCode className=\"w-4 h-4 mr-2\" />\r\n                Baixar QR Code\r\n              </Button>\r\n              <Dialog>\r\n                <DialogTrigger asChild>\r\n                  <Button variant=\"outline\">\r\n                    <ExternalLink className=\"w-4 h-4\" />\r\n                  </Button>\r\n                </DialogTrigger>\r\n                <DialogContent className=\"max-w-md\">\r\n                  <DialogHeader>\r\n                    <DialogTitle>QR Code - {landingPage.name}</DialogTitle>\r\n                    <DialogDescription>Escaneie este QR Code para acessar a landing page</DialogDescription>\r\n                  </DialogHeader>\r\n                  <div className=\"flex justify-center py-4\">\r\n                    <img\r\n                      src={qrCodeUrl || \"/placeholder.svg\"}\r\n                      alt=\"QR Code\"\r\n                      className=\"w-64 h-64 border-4 border-white rounded-lg shadow-lg\"\r\n                    />\r\n                  </div>\r\n                </DialogContent>\r\n              </Dialog>\r\n            </div>\r\n          </CardContent>\r\n        </Card>\r\n      </div>\r\n\r\n      <Card>\r\n        <CardHeader>\r\n          <CardTitle>Leads Capturados</CardTitle>\r\n          <CardDescription>{landingPage.leads?.length || 0} leads capturados nesta landing page</CardDescription>\r\n        </CardHeader>\r\n        <CardContent>\r\n          {!landingPage.leads || landingPage.leads.length === 0 ? (\r\n            <div className=\"text-center py-8 text-muted-foreground\">Nenhum lead capturado ainda</div>\r\n          ) : (\r\n            <div className=\"overflow-x-auto\">\r\n              <Table>\r\n                <TableHeader>\r\n                  <TableRow>\r\n                    {formFields.map((field) => (\r\n                      <TableHead key={field.id}>{field.label}</TableHead>\r\n                    ))}\r\n                    <TableHead>Data</TableHead>\r\n                  </TableRow>\r\n                </TableHeader>\r\n                <TableBody>\r\n                  {landingPage.leads.map((lead) => (\r\n                    <TableRow key={lead.id}>\r\n                      {formFields.map((field) => (\r\n                        <TableCell key={field.id} className=\"font-medium\">\r\n                          {lead.formData[field.id] || \"-\"}\r\n                        </TableCell>\r\n                      ))}\r\n                      <TableCell>{new Date(lead.submittedAt).toLocaleDateString(\"pt-BR\")}</TableCell>\r\n                    </TableRow>\r\n                  ))}\r\n                </TableBody>\r\n              </Table>\r\n            </div>\r\n          )}\r\n        </CardContent>\r\n      </Card>\r\n    </div>\r\n  )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Projetos\\Back_endCrm\\kanbanproject1\\components\\landing-pages\\landing-pages-dashboard.tsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'BuilderElement' is defined but never used.","line":12,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":12,"endColumn":24,"suggestions":[{"messageId":"removeVar","data":{"varName":"BuilderElement"},"fix":{"range":[643,701],"text":""},"desc":"Remove unused variable 'BuilderElement'."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'BuilderElement' is defined but never used.","line":12,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":12,"endColumn":24}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\"\r\n\r\nimport { useState, useEffect } from \"react\"\r\nimport { Button } from \"@/components/ui/button\"\r\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\"\r\nimport { Badge } from \"@/components/ui/badge\"\r\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from \"@/components/ui/dialog\"\r\nimport { Plus, ExternalLink, Trash2, Edit, Users, QrCode } from \"lucide-react\"\r\nimport type { LandingPage } from \"@/lib/types/landing-page\"\r\nimport { getLandingPages, deleteLandingPage, saveLandingPage } from \"@/lib/landing-page-storage\"\r\nimport { BuilderLayout } from \"./builder/builder-layout\"\r\nimport { BuilderElement } from \"@/lib/types/builder-types\"\r\nimport LandingPageDetails from \"./landing-page-details\"\r\n\r\nexport default function LandingPagesDashboard() {\r\n  const [landingPages, setLandingPages] = useState<LandingPage[]>([])\r\n  const [view, setView] = useState<\"list\" | \"create\" | \"edit\" | \"details\">(\"list\")\r\n  const [selectedPage, setSelectedPage] = useState<LandingPage | null>(null)\r\n  const [qrCodeDialog, setQrCodeDialog] = useState<{ open: boolean; url: string; name: string }>({\r\n    open: false,\r\n    url: \"\",\r\n    name: \"\",\r\n  })\r\n\r\n  useEffect(() => {\r\n    loadLandingPages()\r\n  }, [])\r\n\r\n  const loadLandingPages = () => {\r\n    setLandingPages(getLandingPages())\r\n  }\r\n\r\n  const handleDelete = (id: string) => {\r\n    if (confirm(\"Tem certeza que deseja excluir esta landing page?\")) {\r\n      deleteLandingPage(id)\r\n      loadLandingPages()\r\n    }\r\n  }\r\n\r\n  const handleBack = () => {\r\n    setView(\"list\")\r\n    setSelectedPage(null)\r\n    loadLandingPages()\r\n  }\r\n\r\n  const getLandingPageUrl = (id: string) => {\r\n    return `${window.location.origin}/lp/${id}`\r\n  }\r\n\r\n  const handleSave = (landingPageData: Omit<LandingPage, \"id\" | \"createdAt\" | \"updatedAt\">) => {\r\n    const authData = localStorage.getItem(\"unicrm_auth\")\r\n    let companyId: string | undefined\r\n    if (authData) {\r\n      const parsed = JSON.parse(authData)\r\n      companyId = parsed.user?.companyId\r\n    }\r\n\r\n    if (selectedPage) {\r\n      // Editing existing page\r\n      saveLandingPage({\r\n        ...landingPageData,\r\n        id: selectedPage.id,\r\n        companyId: selectedPage.companyId || companyId,\r\n        createdAt: selectedPage.createdAt,\r\n        updatedAt: new Date().toISOString(),\r\n      })\r\n    } else {\r\n      // Creating new page\r\n      saveLandingPage({\r\n        ...landingPageData,\r\n        id: `lp_${Date.now()}`,\r\n        companyId,\r\n        createdAt: new Date().toISOString(),\r\n        updatedAt: new Date().toISOString(),\r\n      })\r\n    }\r\n    handleBack()\r\n  }\r\n\r\n  const showQrCode = (page: LandingPage) => {\r\n    const url = getLandingPageUrl(page.id)\r\n    setQrCodeDialog({ open: true, url, name: page.name })\r\n  }\r\n\r\n  if (view === \"create\") {\r\n    return (\r\n      <BuilderLayout \r\n        onSave={(elements, settings) => handleSave({\r\n          name: \"Nova Landing Page\",\r\n          elements,\r\n          backgroundColor: \"#ffffff\",\r\n          leads: [],\r\n          tagIds: settings?.tagIds,\r\n          funnelId: settings?.funnelId,\r\n          stageId: settings?.stageId\r\n        })} \r\n        onClose={handleBack} \r\n      />\r\n    )\r\n  }\r\n\r\n  if (view === \"edit\" && selectedPage) {\r\n    return (\r\n      <BuilderLayout \r\n        initialElements={selectedPage.elements}\r\n        initialSettings={{\r\n          tagIds: selectedPage.tagIds,\r\n          funnelId: selectedPage.funnelId,\r\n          stageId: selectedPage.stageId\r\n        }}\r\n        onSave={(elements, settings) => handleSave({\r\n          name: selectedPage.name,\r\n          elements,\r\n          backgroundColor: selectedPage.backgroundColor,\r\n          leads: selectedPage.leads,\r\n          companyId: selectedPage.companyId,\r\n          funnelId: settings?.funnelId ?? selectedPage.funnelId,\r\n          stageId: settings?.stageId ?? selectedPage.stageId,\r\n          funnelStage: settings?.funnelStage ?? selectedPage.funnelStage,\r\n          tagIds: settings?.tagIds ?? selectedPage.tagIds,\r\n          title: selectedPage.title,\r\n          subtitle: selectedPage.subtitle,\r\n          description: selectedPage.description,\r\n          buttonText: selectedPage.buttonText,\r\n          buttonColor: selectedPage.buttonColor,\r\n          textColor: selectedPage.textColor\r\n        })} \r\n        onClose={handleBack} \r\n      />\r\n    )\r\n  }\r\n\r\n  if (view === \"details\" && selectedPage) {\r\n    return <LandingPageDetails landingPage={selectedPage} onBack={handleBack} />\r\n  }\r\n\r\n  return (\r\n    <div className=\"space-y-6\">\r\n      <div className=\"flex items-center justify-between\">\r\n        <div>\r\n          <h2 className=\"text-3xl font-bold\">Landing Pages</h2>\r\n          <p className=\"text-muted-foreground\">Gerencie suas páginas de captação de leads</p>\r\n        </div>\r\n        <Button onClick={() => setView(\"create\")}>\r\n          <Plus className=\"w-4 h-4 mr-2\" />\r\n          Nova Landing Page\r\n        </Button>\r\n      </div>\r\n\r\n      {landingPages.length === 0 ? (\r\n        <Card>\r\n          <CardContent className=\"flex flex-col items-center justify-center py-16\">\r\n            <div className=\"w-16 h-16 bg-muted rounded-full flex items-center justify-center mb-4\">\r\n              <Plus className=\"w-8 h-8 text-muted-foreground\" />\r\n            </div>\r\n            <h3 className=\"text-xl font-semibold mb-2\">Nenhuma landing page criada</h3>\r\n            <p className=\"text-muted-foreground mb-4\">Crie sua primeira landing page para começar a capturar leads</p>\r\n            <Button onClick={() => setView(\"create\")}>\r\n              <Plus className=\"w-4 h-4 mr-2\" />\r\n              Criar Landing Page\r\n            </Button>\r\n          </CardContent>\r\n        </Card>\r\n      ) : (\r\n        <div className=\"grid gap-6 md:grid-cols-2 lg:grid-cols-3\">\r\n          {landingPages.map((page) => (\r\n            <Card key={page.id} className=\"hover:shadow-lg transition-shadow\">\r\n              <CardHeader>\r\n                <div className=\"flex items-start justify-between\">\r\n                  <div className=\"flex-1\">\r\n                    <CardTitle className=\"text-lg\">{page.name}</CardTitle>\r\n                    {page.funnelStage && <CardDescription className=\"line-clamp-1\">{page.funnelStage}</CardDescription>}\r\n                  </div>\r\n                  {page.funnelStage && (\r\n                    <Badge variant=\"secondary\" className=\"ml-2\">\r\n                      {page.funnelStage}\r\n                    </Badge>\r\n                  )}\r\n                </div>\r\n              </CardHeader>\r\n              <CardContent className=\"space-y-4\">\r\n                <div className=\"flex items-center gap-2 text-sm text-muted-foreground\">\r\n                  <Users className=\"w-4 h-4\" />\r\n                  <span>{page.leads?.length || 0} leads capturados</span>\r\n                </div>\r\n\r\n                <div className=\"flex flex-wrap gap-2\">\r\n                  <Button\r\n                    variant=\"outline\"\r\n                    size=\"sm\"\r\n                    onClick={() => {\r\n                      setSelectedPage(page)\r\n                      setView(\"details\")\r\n                    }}\r\n                  >\r\n                    <Users className=\"w-4 h-4 mr-1\" />\r\n                    Ver Leads\r\n                  </Button>\r\n                  <Button\r\n                    variant=\"outline\"\r\n                    size=\"sm\"\r\n                    onClick={() => {\r\n                      setSelectedPage(page)\r\n                      setView(\"edit\")\r\n                    }}\r\n                  >\r\n                    <Edit className=\"w-4 h-4 mr-1\" />\r\n                    Editar\r\n                  </Button>\r\n                </div>\r\n\r\n                <div className=\"flex gap-2\">\r\n                  <Button\r\n                    variant=\"secondary\"\r\n                    size=\"sm\"\r\n                    className=\"flex-1\"\r\n                    onClick={() => {\r\n                      const url = getLandingPageUrl(page.id)\r\n                      window.open(url, \"_blank\")\r\n                    }}\r\n                  >\r\n                    <ExternalLink className=\"w-4 h-4 mr-1\" />\r\n                    Abrir\r\n                  </Button>\r\n                  <Button variant=\"secondary\" size=\"sm\" onClick={() => showQrCode(page)}>\r\n                    <QrCode className=\"w-4 h-4\" />\r\n                  </Button>\r\n                  <Button variant=\"destructive\" size=\"sm\" onClick={() => handleDelete(page.id)}>\r\n                    <Trash2 className=\"w-4 h-4\" />\r\n                  </Button>\r\n                </div>\r\n              </CardContent>\r\n            </Card>\r\n          ))}\r\n        </div>\r\n      )}\r\n\r\n      <Dialog open={qrCodeDialog.open} onOpenChange={(open) => setQrCodeDialog({ ...qrCodeDialog, open })}>\r\n        <DialogContent className=\"sm:max-w-md\">\r\n          <DialogHeader>\r\n            <DialogTitle>QR Code - {qrCodeDialog.name}</DialogTitle>\r\n          </DialogHeader>\r\n          <div className=\"flex flex-col items-center gap-4 py-4\">\r\n            <div className=\"bg-white p-4 rounded-lg\">\r\n              <img\r\n                src={`https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=${encodeURIComponent(qrCodeDialog.url)}`}\r\n                alt=\"QR Code\"\r\n                className=\"w-[200px] h-[200px]\"\r\n              />\r\n            </div>\r\n            <div className=\"w-full space-y-2\">\r\n              <p className=\"text-sm text-muted-foreground text-center\">\r\n                Escaneie o QR Code para acessar a landing page\r\n              </p>\r\n              <div className=\"flex gap-2\">\r\n                <input\r\n                  type=\"text\"\r\n                  value={qrCodeDialog.url}\r\n                  readOnly\r\n                  className=\"flex-1 px-3 py-2 text-sm border rounded-md bg-muted\"\r\n                />\r\n                <Button\r\n                  size=\"sm\"\r\n                  onClick={() => {\r\n                    navigator.clipboard.writeText(qrCodeDialog.url)\r\n                  }}\r\n                >\r\n                  Copiar\r\n                </Button>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </DialogContent>\r\n      </Dialog>\r\n    </div>\r\n  )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Projetos\\Back_endCrm\\kanbanproject1\\components\\lead-details-dialog.tsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'getCurrentUser' is defined but never used.","line":52,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":52,"endColumn":24,"suggestions":[{"messageId":"removeVar","data":{"varName":"getCurrentUser"},"fix":{"range":[1427,1473],"text":""},"desc":"Remove unused variable 'getCurrentUser'."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'getCurrentUser' is defined but never used.","line":52,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":52,"endColumn":24},{"ruleId":"no-unused-vars","severity":1,"message":"'leadId' is defined but never used.","line":98,"column":14,"nodeType":"Identifier","messageId":"unusedVar","endLine":98,"endColumn":28,"suggestions":[{"messageId":"removeVar","data":{"varName":"leadId"},"fix":{"range":[2515,2530],"text":""},"desc":"Remove unused variable 'leadId'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'updates' is defined but never used.","line":98,"column":30,"nodeType":"Identifier","messageId":"unusedVar","endLine":98,"endColumn":52,"suggestions":[{"messageId":"removeVar","data":{"varName":"updates"},"fix":{"range":[2529,2553],"text":""},"desc":"Remove unused variable 'updates'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'leadId' is defined but never used.","line":99,"column":14,"nodeType":"Identifier","messageId":"unusedVar","endLine":99,"endColumn":28,"suggestions":[{"messageId":"removeVar","data":{"varName":"leadId"},"fix":{"range":[2577,2591],"text":""},"desc":"Remove unused variable 'leadId'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'e' is defined but never used.","line":214,"column":16,"nodeType":"Identifier","messageId":"unusedVar","endLine":214,"endColumn":17},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'e' is defined but never used.","line":214,"column":16,"nodeType":null,"messageId":"unusedVar","endLine":214,"endColumn":17},{"ruleId":"react-hooks/rules-of-hooks","severity":2,"message":"React Hook \"useEffect\" is called conditionally. React Hooks must be called in the exact same order in every component render.","line":259,"column":3,"nodeType":"Identifier","endLine":259,"endColumn":12},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'userNameCache'. Either include it or remove the dependency array.","line":271,"column":6,"nodeType":"ArrayExpression","endLine":271,"endColumn":12,"suggestions":[{"desc":"Update the dependencies array to be: [lead, userNameCache]","fix":{"range":[8464,8470],"text":"[lead, userNameCache]"}}]},{"ruleId":"no-case-declarations","severity":1,"message":"Unexpected lexical declaration in case block.","line":288,"column":9,"nodeType":"VariableDeclaration","messageId":"unexpected","endLine":288,"endColumn":107,"suggestions":[{"messageId":"addBrackets","fix":{"range":[8967,9118],"text":"{ const FeedbackIcon = feedbackTypes[(feedbackType || \"neutral\") as keyof typeof feedbackTypes].icon\r\n        return <FeedbackIcon className=\"h-4 w-4\" /> }"},"desc":"Add {} brackets around the case block."}]},{"ruleId":"react-hooks/rules-of-hooks","severity":2,"message":"React Hook \"useApiTags\" is called conditionally. React Hooks must be called in the exact same order in every component render.","line":338,"column":46,"nodeType":"Identifier","endLine":338,"endColumn":56},{"ruleId":"react-hooks/rules-of-hooks","severity":2,"message":"React Hook \"useEffect\" is called conditionally. React Hooks must be called in the exact same order in every component render.","line":340,"column":3,"nodeType":"Identifier","endLine":340,"endColumn":12}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":9,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\"\r\n\r\nimport { useState, useEffect } from \"react\"\r\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from \"@/components/ui/dialog\"\r\nimport {\r\n  AlertDialog,\r\n  AlertDialogContent,\r\n  AlertDialogHeader,\r\n  AlertDialogTitle,\r\n  AlertDialogDescription,\r\n  AlertDialogFooter,\r\n  AlertDialogCancel,\r\n  AlertDialogAction,\r\n} from \"@/components/ui/alert-dialog\"\r\nimport { leadsApi } from \"@/lib/api/leads-api\"\r\nimport { usersApi } from \"@/lib/api/users-api\"\r\nimport { authApi } from \"@/lib/api/auth-api\"\r\nimport { Button } from \"@/components/ui/button\"\r\nimport { Input } from \"@/components/ui/input\"\r\nimport { Label } from \"@/components/ui/label\"\r\nimport { Textarea } from \"@/components/ui/textarea\"\r\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\"\r\nimport { Badge } from \"@/components/ui/badge\"\r\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\"\r\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\"\r\nimport { Avatar, AvatarFallback, AvatarImage } from \"@/components/ui/avatar\"\r\nimport {\r\n  User,\r\n  Building,\r\n  Calendar,\r\n  DollarSign,\r\n  Edit,\r\n  Save,\r\n  X,\r\n  Users,\r\n  CheckCircle,\r\n  FileText,\r\n  Activity,\r\n  TrendingUp,\r\n  Plus,\r\n  Star,\r\n  AlertTriangle,\r\n  Info,\r\n  MessageSquare,\r\n  Mail,\r\n  Phone,\r\n  Target,\r\n  Tag,\r\n  Trash2,\r\n} from \"lucide-react\"\r\nimport TagInput from \"./tag-input\"\r\nimport { getCurrentUser } from \"@/lib/storage\"\r\nimport { useApiTags } from \"@/hooks/use-api-tags\"\r\n\r\ntype Lead = {\r\n  id: string\r\n  title: string\r\n  client: string\r\n  clientEmail?: string\r\n  clientPhone?: string\r\n  clientAddress?: string\r\n  source: string\r\n  status: string\r\n  assignedTo?: {\r\n    id: string\r\n    name: string\r\n    avatar: string\r\n    email?: string // Added email for assignedTo\r\n  }\r\n  people: Array<{\r\n    id: string\r\n    name: string\r\n    avatar: string\r\n    email?: string // Added email for people\r\n    phone?: string // Added phone for people\r\n  }>\r\n  priority?: string\r\n  estimatedValue?: number\r\n  expectedCloseDate?: string\r\n  notes?: string\r\n  tags?: string[]\r\n  createdAt: string\r\n  interactions?: Array<{\r\n    id: string\r\n    type: \"call\" | \"email\" | \"meeting\" | \"note\" | \"feedback\"\r\n    description: string\r\n    date: string\r\n    createdBy: string\r\n    feedbackType?: \"positive\" | \"negative\" | \"neutral\" | \"important\"\r\n    rating?: number\r\n  }>\r\n}\r\n\r\ntype LeadDetailsDialogProps = {\r\n  lead: Lead | null\r\n  open: boolean\r\n  onClose: () => void\r\n  onUpdate: (leadId: string, updates: Partial<Lead>) => void\r\n  onDelete: (leadId: string) => void\r\n  columns: Array<{ id: string; name: string; color: string }>\r\n}\r\n\r\nconst priorityColors = {\r\n  low: \"bg-blue-100 text-blue-800\",\r\n  medium: \"bg-yellow-100 text-yellow-800\",\r\n  high: \"bg-orange-100 text-orange-800\",\r\n  urgent: \"bg-red-100 text-red-800\",\r\n}\r\n\r\nconst priorityLabels = {\r\n  low: \"Baixa\",\r\n  medium: \"Média\",\r\n  high: \"Alta\",\r\n  urgent: \"Urgente\",\r\n}\r\n\r\nconst feedbackTypes = {\r\n  positive: { label: \"Positivo\", color: \"bg-green-100 text-green-800\", icon: CheckCircle },\r\n  negative: { label: \"Negativo\", color: \"bg-red-100 text-red-800\", icon: AlertTriangle },\r\n  neutral: { label: \"Neutro\", color: \"bg-gray-100 text-gray-800\", icon: Info },\r\n  important: { label: \"Importante\", color: \"bg-blue-100 text-blue-800\", icon: Star },\r\n}\r\n\r\nexport default function LeadDetailsDialog({\r\n  lead,\r\n  open,\r\n  onClose,\r\n  onUpdate,\r\n  onDelete,\r\n  columns,\r\n}: LeadDetailsDialogProps) {\r\n  const [isEditing, setIsEditing] = useState(false)\r\n  const [confirmDeleteOpen, setConfirmDeleteOpen] = useState(false)\r\n  const [activeTab, setActiveTab] = useState(\"overview\")\r\n  const [editForm, setEditForm] = useState<Partial<Lead>>({})\r\n  const [newInteraction, setNewInteraction] = useState<{\r\n    type: \"call\" | \"email\" | \"meeting\" | \"note\" | \"feedback\"\r\n    description: string\r\n    feedbackType: \"positive\" | \"negative\" | \"neutral\" | \"important\"\r\n    rating: number\r\n  }>({\r\n    type: \"note\",\r\n    description: \"\",\r\n    feedbackType: \"neutral\",\r\n    rating: 5,\r\n  })\r\n  const [editContacts, setEditContacts] = useState<\r\n    Array<{ id: string; name: string; email?: string; phone?: string; isPrimary: boolean }>\r\n  >([])\r\n  const [userNameCache, setUserNameCache] = useState<Record<string, string>>({})\r\n\r\n  const isUuid = (val?: string) => !!val && /^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i.test(val)\r\n\r\n  if (!lead) return null\r\n\r\n  const handleEdit = () => {\r\n    setEditForm({ ...lead, tags: lead.tags || [] })\r\n    const contacts = (lead.people || []).map((person) => ({\r\n      id: person.id,\r\n      name: person.name,\r\n      email: person.email,\r\n      phone: person.phone,\r\n      isPrimary: lead.assignedTo?.id === person.id,\r\n    }))\r\n    setEditContacts(contacts.length > 0 ? contacts : [])\r\n    setIsEditing(true)\r\n  }\r\n\r\n  const handleSave = () => {\r\n    if (editForm.id) {\r\n      const people = editContacts.map((contact) => ({\r\n        id: contact.id,\r\n        name: contact.name,\r\n        email: contact.email,\r\n        phone: contact.phone,\r\n        avatar: lead.people.find((p) => p.id === contact.id)?.avatar || \"/placeholder.svg\",\r\n      }))\r\n\r\n      const primaryContact = editContacts.find((c) => c.isPrimary)\r\n      const assignedTo = primaryContact\r\n        ? {\r\n            id: primaryContact.id,\r\n            name: primaryContact.name,\r\n            avatar: lead.people.find((p) => p.id === primaryContact.id)?.avatar || \"/placeholder.svg\",\r\n          }\r\n        : undefined\r\n\r\n      console.log(\"[v0] Updating lead with tags:\", editForm.tags)\r\n      console.log(\"[v0] Lead update data:\", { ...editForm, people, assignedTo })\r\n\r\n      onUpdate(editForm.id, {\r\n        ...editForm,\r\n        people,\r\n        assignedTo,\r\n      })\r\n      setIsEditing(false)\r\n    }\r\n  }\r\n\r\n  const handleCancel = () => {\r\n    setEditForm({})\r\n    setEditContacts([]) // Clear contacts state on cancel\r\n    setIsEditing(false)\r\n  }\r\n\r\n  const handleAddInteraction = async () => {\r\n    if (!newInteraction.description.trim()) return\r\n\r\n    try {\r\n      // Obtém o usuário atual para incluir no payload (garante createdBy correto no backend)\r\n      let me: { id?: string; name?: string; email?: string } | null = null\r\n      try {\r\n        me = await authApi.me()\r\n      } catch (e) {\r\n        // fallback silencioso\r\n      }\r\n\r\n      const payload = {\r\n        type: newInteraction.type,\r\n        date: new Date().toISOString(),\r\n        notes: newInteraction.description,\r\n        rating: newInteraction.type === \"feedback\" ? newInteraction.rating : undefined,\r\n        feedbackType: newInteraction.type === \"feedback\" ? newInteraction.feedbackType : undefined,\r\n        // Envia o ID do usuário atual para evitar default para assignedToUserId\r\n        user: me?.id,\r\n      }\r\n      const created = await leadsApi.addInteraction(lead.id, payload as any)\r\n\r\n      // Normaliza os campos vindos do backend para o formato esperado pelo UI\r\n      const normalized = {\r\n        id: created.id,\r\n        type: created.type,\r\n        description: created.description ?? created.notes ?? \"\",\r\n        date: created.date,\r\n        createdBy: (() => {\r\n          const raw = created.createdBy ?? created.userName ?? created.user\r\n          if (!raw) return me?.name || me?.email || \"Usuário\"\r\n          return isUuid(raw) ? (me?.name || raw) : raw\r\n        })(),\r\n        feedbackType: created.feedbackType,\r\n        rating: created.rating,\r\n      }\r\n\r\n      const updatedInteractions = [...(lead.interactions || []), normalized]\r\n      onUpdate(lead.id, { interactions: updatedInteractions })\r\n    } catch (err) {\r\n      console.error(\"Falha ao adicionar interação:\", err)\r\n    }\r\n    setNewInteraction({\r\n      type: \"note\",\r\n      description: \"\",\r\n      feedbackType: \"neutral\",\r\n      rating: 5,\r\n    })\r\n  }\r\n\r\n  // Carrega nomes de usuários para interações existentes (IDs -> nomes)\r\n  // Executa quando o lead muda ou o modal abre\r\n  useEffect(() => {\r\n    const creators = Array.from(new Set((lead.interactions || []).map((i) => i.createdBy).filter(Boolean)))\r\n    creators.forEach(async (creator) => {\r\n      if (creator && isUuid(creator) && !userNameCache[creator]) {\r\n        try {\r\n          const user = await usersApi.get(creator)\r\n          setUserNameCache((prev) => ({ ...prev, [creator]: user?.name || creator }))\r\n        } catch {\r\n          // ignore errors; keep ID if name not found\r\n        }\r\n      }\r\n    })\r\n  }, [lead])\r\n\r\n  const getColumnInfo = (statusId: string) => {\r\n    return columns.find((col) => col.id === statusId)\r\n  }\r\n\r\n  const columnInfo = getColumnInfo(lead.status)\r\n\r\n  const getInteractionIcon = (type: string, feedbackType?: string) => {\r\n    switch (type) {\r\n      case \"call\":\r\n        return <Phone className=\"h-4 w-4\" />\r\n      case \"email\":\r\n        return <Mail className=\"h-4 w-4\" />\r\n      case \"meeting\":\r\n        return <Calendar className=\"h-4 w-4\" />\r\n      case \"feedback\":\r\n        const FeedbackIcon = feedbackTypes[(feedbackType || \"neutral\") as keyof typeof feedbackTypes].icon\r\n        return <FeedbackIcon className=\"h-4 w-4\" />\r\n      default:\r\n        return <MessageSquare className=\"h-4 w-4\" />\r\n    }\r\n  }\r\n\r\n  const getInteractionLabel = (type: string) => {\r\n    switch (type) {\r\n      case \"call\":\r\n        return \"Ligação\"\r\n      case \"email\":\r\n        return \"Email\"\r\n      case \"meeting\":\r\n        return \"Reunião\"\r\n      case \"feedback\":\r\n        return \"Feedback\"\r\n      default:\r\n        return \"Anotação\"\r\n    }\r\n  }\r\n\r\n  const addNewContact = () => {\r\n    const newContact = {\r\n      id: `contact_${Date.now()}`,\r\n      name: \"\",\r\n      email: \"\",\r\n      phone: \"\",\r\n      isPrimary: editContacts.length === 0, // First contact is primary by default\r\n    }\r\n    setEditContacts([...editContacts, newContact])\r\n  }\r\n\r\n  const updateContact = (id: string, field: string, value: string | boolean) => {\r\n    setEditContacts(editContacts.map((contact) => (contact.id === id ? { ...contact, [field]: value } : contact)))\r\n  }\r\n\r\n  const togglePrimary = (id: string) => {\r\n    setEditContacts(\r\n      editContacts.map((contact) => ({\r\n        ...contact,\r\n        isPrimary: contact.id === id ? !contact.isPrimary : contact.isPrimary,\r\n      })),\r\n    )\r\n  }\r\n\r\n  const removeContact = (id: string) => {\r\n    setEditContacts(editContacts.filter((contact) => contact.id !== id))\r\n  }\r\n\r\n  const { tags: availableTags, fetchTags } = useApiTags()\r\n\r\n  useEffect(() => {\r\n    if (open) {\r\n      fetchTags()\r\n    }\r\n  }, [open, fetchTags])\r\n\r\n  const selectedTagObjects = Array.isArray(availableTags)\r\n    ? availableTags.filter((tag) => (lead.tags || []).includes(tag.id))\r\n    : []\r\n\r\n  return (\r\n    <Dialog open={open} onOpenChange={(open) => !open && onClose()}>\r\n      <DialogContent className=\"max-w-4xl max-h-[90vh] overflow-y-auto\">\r\n        <DialogHeader>\r\n          <div className=\"flex items-center justify-between\">\r\n            <div className=\"flex items-center gap-3\">\r\n              <div className=\"flex items-center gap-2\">\r\n                <User className=\"h-5 w-5\" />\r\n                <DialogTitle>{isEditing ? \"Editar Lead\" : lead.title}</DialogTitle>\r\n              </div>\r\n              {columnInfo && (\r\n                <Badge className=\"text-white\" style={{ backgroundColor: columnInfo.color }}>\r\n                  {columnInfo.name}\r\n                </Badge>\r\n              )}\r\n            </div>\r\n            <div className=\"flex gap-2\">\r\n              {!isEditing ? (\r\n                <Button variant=\"outline\" size=\"sm\" onClick={handleEdit}>\r\n                  <Edit className=\"h-4 w-4 mr-2\" />\r\n                  Editar\r\n                </Button>\r\n              ) : (\r\n                <>\r\n                  <Button variant=\"outline\" size=\"sm\" onClick={handleCancel}>\r\n                    <X className=\"h-4 w-4 mr-2\" />\r\n                    Cancelar\r\n                  </Button>\r\n                  <Button size=\"sm\" onClick={handleSave}>\r\n                    <Save className=\"h-4 w-4 mr-2\" />\r\n                    Salvar\r\n                  </Button>\r\n                </>\r\n              )}\r\n            </div>\r\n          </div>\r\n        </DialogHeader>\r\n\r\n        <Tabs value={activeTab} onValueChange={setActiveTab} className=\"w-full\">\r\n          <TabsList className=\"grid w-full grid-cols-5\">\r\n            <TabsTrigger value=\"overview\">Visão Geral</TabsTrigger>\r\n            <TabsTrigger value=\"details\">Detalhes</TabsTrigger>\r\n            <TabsTrigger value=\"team\">Equipe</TabsTrigger>\r\n            <TabsTrigger value=\"timeline\">Timeline</TabsTrigger>\r\n            <TabsTrigger value=\"feedback\">Feedbacks</TabsTrigger>\r\n          </TabsList>\r\n\r\n          <div className=\"mt-6\">\r\n            <TabsContent value=\"overview\" className=\"space-y-6\">\r\n              {/* Cards de Status */}\r\n              <div className=\"grid grid-cols-1 md:grid-cols-4 gap-4\">\r\n                <Card>\r\n                  <CardContent className=\"p-4\">\r\n                    <div className=\"flex items-center justify-between\">\r\n                      <div>\r\n                        <p className=\"text-sm font-medium text-muted-foreground\">Valor Estimado</p>\r\n                        <p className=\"text-2xl font-bold\">R$ {lead.estimatedValue?.toLocaleString(\"pt-BR\") || \"0\"}</p>\r\n                      </div>\r\n                      <DollarSign className=\"h-8 w-8 text-green-600\" />\r\n                    </div>\r\n                  </CardContent>\r\n                </Card>\r\n\r\n                <Card>\r\n                  <CardContent className=\"p-4\">\r\n                    <div className=\"flex items-center justify-between\">\r\n                      <div>\r\n                        <p className=\"text-sm font-medium text-muted-foreground\">Origem</p>\r\n                        <p className=\"text-2xl font-bold capitalize\">{lead.source}</p>\r\n                      </div>\r\n                      <TrendingUp className=\"h-8 w-8 text-blue-600\" />\r\n                    </div>\r\n                  </CardContent>\r\n                </Card>\r\n\r\n                <Card>\r\n                  <CardContent className=\"p-4\">\r\n                    <div className=\"flex items-center justify-between\">\r\n                      <div>\r\n                        <p className=\"text-sm font-medium text-muted-foreground\">Data Esperada</p>\r\n                        <p className=\"text-lg font-bold\">\r\n                          {lead.expectedCloseDate\r\n                            ? new Date(lead.expectedCloseDate).toLocaleDateString(\"pt-BR\")\r\n                            : \"N/D\"}\r\n                        </p>\r\n                      </div>\r\n                      <Target className=\"h-8 w-8 text-orange-600\" />\r\n                    </div>\r\n                  </CardContent>\r\n                </Card>\r\n\r\n                <Card>\r\n                  <CardContent className=\"p-4\">\r\n                    <div className=\"flex items-center justify-between\">\r\n                      <div>\r\n                        <p className=\"text-sm font-medium text-muted-foreground\">Interações</p>\r\n                        <p className=\"text-2xl font-bold\">{lead.interactions?.length || 0}</p>\r\n                      </div>\r\n                      <Activity className=\"h-8 w-8 text-purple-600\" />\r\n                    </div>\r\n                  </CardContent>\r\n                </Card>\r\n              </div>\r\n\r\n              {/* Informações Básicas */}\r\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\r\n                <Card>\r\n                  <CardHeader>\r\n                    <CardTitle className=\"flex items-center gap-2\">\r\n                      <Building className=\"h-4 w-4\" />\r\n                      Informações do Cliente\r\n                    </CardTitle>\r\n                  </CardHeader>\r\n                  <CardContent className=\"space-y-2\">\r\n                    <div>\r\n                      <Label className=\"text-sm font-medium\">Cliente</Label>\r\n                      <p className=\"mt-1\">{lead.client}</p>\r\n                    </div>\r\n                    <div>\r\n                      <Label className=\"text-sm font-medium\">Email</Label>\r\n                      <p className=\"mt-1\">{lead.clientEmail || \"Não definido\"}</p>\r\n                    </div>\r\n                    <div>\r\n                      <Label className=\"text-sm font-medium\">Telefone</Label>\r\n                      <p className=\"mt-1\">{lead.clientPhone || \"Não definido\"}</p>\r\n                    </div>\r\n                    <div>\r\n                      <Label className=\"text-sm font-medium\">Endereço</Label>\r\n                      <p className=\"mt-1\">{lead.clientAddress || \"Não definido\"}</p>\r\n                    </div>\r\n                    <div>\r\n                      <Label className=\"text-sm font-medium\">Responsável</Label>\r\n                      <p className=\"mt-1\">{lead.assignedTo?.name || \"Não definido\"}</p>\r\n                    </div>\r\n                    <div>\r\n                      <Label className=\"text-sm font-medium\">Prioridade</Label>\r\n                      <Badge className={`mt-1 ${priorityColors[(lead.priority || \"low\") as keyof typeof priorityColors]}`}>\r\n                        {priorityLabels[(lead.priority || \"low\") as keyof typeof priorityLabels]}\r\n                      </Badge>\r\n                    </div>\r\n                    {selectedTagObjects.length > 0 && (\r\n                      <div>\r\n                        <Label className=\"text-sm font-medium\">Tags</Label>\r\n                        <div className=\"flex flex-wrap gap-2 mt-1\">\r\n                          {selectedTagObjects.map((tag: any) => (\r\n                            <Badge key={tag.id} style={{ backgroundColor: tag.color, color: \"white\" }}>\r\n                              {tag.name}\r\n                            </Badge>\r\n                          ))}\r\n                        </div>\r\n                      </div>\r\n                    )}\r\n                  </CardContent>\r\n                </Card>\r\n\r\n                <Card>\r\n                  <CardHeader>\r\n                    <CardTitle className=\"flex items-center gap-2\">\r\n                      <Calendar className=\"h-4 w-4\" />\r\n                      Cronograma\r\n                    </CardTitle>\r\n                  </CardHeader>\r\n                  <CardContent className=\"space-y-2\">\r\n                    <div>\r\n                      <Label className=\"text-sm font-medium\">Data de Criação</Label>\r\n                      <p className=\"mt-1\">{new Date(lead.createdAt).toLocaleDateString(\"pt-BR\")}</p>\r\n                    </div>\r\n                    <div>\r\n                      <Label className=\"text-sm font-medium\">Data Esperada de Fechamento</Label>\r\n                      <p className=\"mt-1\">\r\n                        {lead.expectedCloseDate\r\n                          ? new Date(lead.expectedCloseDate).toLocaleDateString(\"pt-BR\")\r\n                          : \"Não definido\"}\r\n                      </p>\r\n                    </div>\r\n                    <div>\r\n                      <Label className=\"text-sm font-medium\">Tempo no Pipeline</Label>\r\n                      <p className=\"mt-1\">\r\n                        {Math.ceil((new Date().getTime() - new Date(lead.createdAt).getTime()) / (1000 * 60 * 60 * 24))}{\" \"}\r\n                        dias\r\n                      </p>\r\n                    </div>\r\n                  </CardContent>\r\n                </Card>\r\n              </div>\r\n            </TabsContent>\r\n\r\n            <TabsContent value=\"details\" className=\"space-y-6\">\r\n              <Card>\r\n                <CardHeader>\r\n                  <CardTitle className=\"flex items-center gap-2\">\r\n                    <FileText className=\"h-4 w-4\" />\r\n                    Detalhes do Lead\r\n                  </CardTitle>\r\n                </CardHeader>\r\n                <CardContent className=\"space-y-4\">\r\n                  {isEditing ? (\r\n                    <>\r\n                      <div className=\"grid grid-cols-2 gap-4\">\r\n                        <div>\r\n                          <Label>Título do Lead</Label>\r\n                          <Input\r\n                            value={editForm.title || \"\"}\r\n                            onChange={(e) => setEditForm({ ...editForm, title: e.target.value })}\r\n                          />\r\n                        </div>\r\n                        <div>\r\n                          <Label>Cliente</Label>\r\n                          <Input\r\n                            value={editForm.client || \"\"}\r\n                            onChange={(e) => setEditForm({ ...editForm, client: e.target.value })}\r\n                          />\r\n                        </div>\r\n                      </div>\r\n\r\n                      <div className=\"grid grid-cols-2 gap-4\">\r\n                        <div>\r\n                          <Label>Email do Cliente</Label>\r\n                          <Input\r\n                            value={editForm.clientEmail || \"\"}\r\n                            onChange={(e) => setEditForm({ ...editForm, clientEmail: e.target.value })}\r\n                          />\r\n                        </div>\r\n                        <div>\r\n                          <Label>Telefone do Cliente</Label>\r\n                          <Input\r\n                            value={editForm.clientPhone || \"\"}\r\n                            onChange={(e) => setEditForm({ ...editForm, clientPhone: e.target.value })}\r\n                          />\r\n                        </div>\r\n                      </div>\r\n\r\n                      <div>\r\n                        <Label>Endereço do Cliente</Label>\r\n                        <Input\r\n                          value={editForm.clientAddress || \"\"}\r\n                          onChange={(e) => setEditForm({ ...editForm, clientAddress: e.target.value })}\r\n                        />\r\n                      </div>\r\n\r\n                      <div>\r\n                        <Label className=\"flex items-center gap-2\">\r\n                          <Tag className=\"h-4 w-4\" />\r\n                          Tags\r\n                        </Label>\r\n                        <TagInput\r\n                          selectedTags={editForm.tags || []}\r\n                          onTagsChange={(tags) => setEditForm({ ...editForm, tags })}\r\n                          placeholder=\"Digite para buscar ou criar tags...\"\r\n                        />\r\n                      </div>\r\n\r\n                      <div>\r\n                        <Label>Observações</Label>\r\n                        <Textarea\r\n                          value={editForm.notes || \"\"}\r\n                          onChange={(e) => setEditForm({ ...editForm, notes: e.target.value })}\r\n                          rows={4}\r\n                        />\r\n                      </div>\r\n\r\n                      <div className=\"grid grid-cols-3 gap-4\">\r\n                        <div>\r\n                          <Label>Status</Label>\r\n                          <Select\r\n                            value={editForm.status || \"\"}\r\n                            onValueChange={(value) => setEditForm({ ...editForm, status: value })}\r\n                          >\r\n                            <SelectTrigger>\r\n                              <SelectValue />\r\n                            </SelectTrigger>\r\n                            <SelectContent>\r\n                              {columns.map((column) => (\r\n                                <SelectItem key={column.id} value={column.id}>\r\n                                  <div className=\"flex items-center gap-2\">\r\n                                    <div className=\"w-3 h-3 rounded-full\" style={{ backgroundColor: column.color }} />\r\n                                    {column.name}\r\n                                  </div>\r\n                                </SelectItem>\r\n                              ))}\r\n                            </SelectContent>\r\n                          </Select>\r\n                        </div>\r\n\r\n                        <div>\r\n                          <Label>Prioridade</Label>\r\n                          <Select\r\n                            value={editForm.priority || \"\"}\r\n                            onValueChange={(value: \"low\" | \"medium\" | \"high\" | \"urgent\") =>\r\n                              setEditForm({ ...editForm, priority: value })\r\n                            }\r\n                          >\r\n                            <SelectTrigger>\r\n                              <SelectValue />\r\n                            </SelectTrigger>\r\n                            <SelectContent>\r\n                              <SelectItem value=\"low\">Baixa</SelectItem>\r\n                              <SelectItem value=\"medium\">Média</SelectItem>\r\n                              <SelectItem value=\"high\">Alta</SelectItem>\r\n                              <SelectItem value=\"urgent\">Urgente</SelectItem>\r\n                            </SelectContent>\r\n                          </Select>\r\n                        </div>\r\n\r\n                        <div>\r\n                          <Label>Valor Estimado (R$)</Label>\r\n                          <Input\r\n                            type=\"number\"\r\n                            value={editForm.estimatedValue || 0}\r\n                            onChange={(e) => setEditForm({ ...editForm, estimatedValue: Number(e.target.value) })}\r\n                          />\r\n                        </div>\r\n                      </div>\r\n\r\n                      <div className=\"grid grid-cols-2 gap-4\">\r\n                        <div>\r\n                          <Label>Origem</Label>\r\n                          <Select\r\n                            value={editForm.source || \"\"}\r\n                            onValueChange={(value) => setEditForm({ ...editForm, source: value })}\r\n                          >\r\n                            <SelectTrigger>\r\n                              <SelectValue />\r\n                            </SelectTrigger>\r\n                            <SelectContent>\r\n                              <SelectItem value=\"website\">Website</SelectItem>\r\n                              <SelectItem value=\"google_ads\">Google Ads</SelectItem>\r\n                              <SelectItem value=\"referral\">Indicação</SelectItem>\r\n                              <SelectItem value=\"linkedin\">LinkedIn</SelectItem>\r\n                              <SelectItem value=\"phone\">Telefone</SelectItem>\r\n                              <SelectItem value=\"email\">Email</SelectItem>\r\n                            </SelectContent>\r\n                          </Select>\r\n                        </div>\r\n                        <div>\r\n                          <Label>Data Esperada de Fechamento</Label>\r\n                          <Input\r\n                            type=\"date\"\r\n                            value={editForm.expectedCloseDate || \"\"}\r\n                            onChange={(e) => setEditForm({ ...editForm, expectedCloseDate: e.target.value })}\r\n                          />\r\n                        </div>\r\n                      </div>\r\n                    </>\r\n                  ) : (\r\n                    <>\r\n                      <div>\r\n                        <Label className=\"text-sm font-medium\">Observações</Label>\r\n                        <p className=\"mt-1 text-muted-foreground\">{lead.notes || \"Nenhuma observação registrada.\"}</p>\r\n                      </div>\r\n\r\n                      {selectedTagObjects.length > 0 && (\r\n                        <div>\r\n                          <Label className=\"text-sm font-medium\">Tags</Label>\r\n                          <div className=\"flex flex-wrap gap-2 mt-1\">\r\n                            {selectedTagObjects.map((tag: any) => (\r\n                              <Badge key={tag.id} style={{ backgroundColor: tag.color, color: \"white\" }}>\r\n                                {tag.name}\r\n                              </Badge>\r\n                            ))}\r\n                          </div>\r\n                        </div>\r\n                      )}\r\n\r\n                      <div className=\"grid grid-cols-2 gap-4\">\r\n                        <div>\r\n                          <Label className=\"text-sm font-medium\">Origem do Lead</Label>\r\n                          <p className=\"mt-1 capitalize\">{lead.source}</p>\r\n                        </div>\r\n                        <div>\r\n                          <Label className=\"text-sm font-medium\">Valor Estimado</Label>\r\n                          <p className=\"mt-1\">R$ {lead.estimatedValue?.toLocaleString(\"pt-BR\") || \"0\"}</p>\r\n                        </div>\r\n                      </div>\r\n                    </>\r\n                  )}\r\n                </CardContent>\r\n              </Card>\r\n            </TabsContent>\r\n\r\n            <TabsContent value=\"team\" className=\"space-y-6\">\r\n              <Card>\r\n                <CardHeader>\r\n                  <CardTitle className=\"flex items-center gap-2\">\r\n                    <Users className=\"h-4 w-4\" />\r\n                    Equipe Responsável\r\n                  </CardTitle>\r\n                </CardHeader>\r\n                <CardContent>\r\n                  {isEditing ? (\r\n                    <div className=\"space-y-4\">\r\n                      <div className=\"flex items-center justify-between\">\r\n                        <Label className=\"text-sm font-medium\">Contatos do Lead</Label>\r\n                        <Button onClick={addNewContact} size=\"sm\" variant=\"outline\">\r\n                          <Plus className=\"h-4 w-4 mr-2\" />\r\n                          Adicionar Contato\r\n                        </Button>\r\n                      </div>\r\n\r\n                      {editContacts.length === 0 ? (\r\n                        <div className=\"text-center py-8 text-muted-foreground\">\r\n                          <Users className=\"h-8 w-8 mx-auto mb-2 opacity-50\" />\r\n                          <p className=\"text-sm\">Nenhum contato adicionado</p>\r\n                          <Button onClick={addNewContact} size=\"sm\" variant=\"ghost\" className=\"mt-2\">\r\n                            <Plus className=\"h-4 w-4 mr-2\" />\r\n                            Adicionar Primeiro Contato\r\n                          </Button>\r\n                        </div>\r\n                      ) : (\r\n                        <div className=\"space-y-3\">\r\n                          {editContacts.map((contact, index) => (\r\n                            <div key={contact.id} className=\"p-4 border rounded-lg bg-gray-50 space-y-3\">\r\n                              <div className=\"flex items-center justify-between\">\r\n                                <div className=\"flex items-center gap-2\">\r\n                                  <span className=\"text-sm font-medium\">Contato {index + 1}</span>\r\n                                  <Button\r\n                                    variant=\"ghost\"\r\n                                    size=\"sm\"\r\n                                    onClick={() => togglePrimary(contact.id)}\r\n                                    className={`h-6 w-6 p-0 ${contact.isPrimary ? \"text-yellow-500\" : \"text-gray-300\"}`}\r\n                                    title={contact.isPrimary ? \"Contato principal\" : \"Marcar como principal\"}\r\n                                  >\r\n                                    <Star className={`h-4 w-4 ${contact.isPrimary ? \"fill-yellow-500\" : \"\"}`} />\r\n                                  </Button>\r\n                                  {contact.isPrimary && (\r\n                                    <Badge variant=\"secondary\" className=\"text-xs\">\r\n                                      Principal\r\n                                    </Badge>\r\n                                  )}\r\n                                </div>\r\n                                <Button\r\n                                  variant=\"ghost\"\r\n                                  size=\"sm\"\r\n                                  onClick={() => removeContact(contact.id)}\r\n                                  className=\"h-6 w-6 p-0 text-red-600 hover:text-red-700 hover:bg-red-50\"\r\n                                >\r\n                                  <Trash2 className=\"h-4 w-4\" />\r\n                                </Button>\r\n                              </div>\r\n\r\n                              <div className=\"grid grid-cols-1 md:grid-cols-3 gap-3\">\r\n                                <div>\r\n                                  <Label className=\"text-xs\">Nome *</Label>\r\n                                  <Input\r\n                                    value={contact.name}\r\n                                    onChange={(e) => updateContact(contact.id, \"name\", e.target.value)}\r\n                                    placeholder=\"Nome do contato\"\r\n                                    className=\"h-9\"\r\n                                  />\r\n                                </div>\r\n                                <div>\r\n                                  <Label className=\"text-xs\">Email</Label>\r\n                                  <Input\r\n                                    type=\"email\"\r\n                                    value={contact.email || \"\"}\r\n                                    onChange={(e) => updateContact(contact.id, \"email\", e.target.value)}\r\n                                    placeholder=\"email@exemplo.com\"\r\n                                    className=\"h-9\"\r\n                                  />\r\n                                </div>\r\n                                <div>\r\n                                  <Label className=\"text-xs\">Telefone</Label>\r\n                                  <Input\r\n                                    type=\"tel\"\r\n                                    value={contact.phone || \"\"}\r\n                                    onChange={(e) => updateContact(contact.id, \"phone\", e.target.value)}\r\n                                    placeholder=\"(00) 00000-0000\"\r\n                                    className=\"h-9\"\r\n                                  />\r\n                                </div>\r\n                              </div>\r\n                            </div>\r\n                          ))}\r\n                        </div>\r\n                      )}\r\n\r\n                      <p className=\"text-xs text-muted-foreground\">\r\n                        <Star className=\"h-3 w-3 inline mr-1\" />\r\n                        Clique na estrela para marcar contatos como principais. Você pode ter múltiplos contatos\r\n                        principais.\r\n                      </p>\r\n                    </div>\r\n                  ) : lead.people && lead.people.length > 0 ? (\r\n                    <div className=\"space-y-4\">\r\n                      <div>\r\n                        <Label className=\"text-sm font-medium\">Responsável Principal</Label>\r\n                        <div className=\"flex items-center gap-2 mt-2 p-3 bg-muted rounded-lg\">\r\n                          <Avatar className=\"h-8 w-8\">\r\n                            <AvatarImage\r\n                              src={lead.assignedTo?.avatar || \"/placeholder.svg\"}\r\n                              alt={lead.assignedTo?.name}\r\n                            />\r\n                            <AvatarFallback>{lead.assignedTo?.name?.substring(0, 2) || \"?\"}</AvatarFallback>\r\n                          </Avatar>\r\n                          <div className=\"flex-1\">\r\n                            <p className=\"font-medium\">{lead.assignedTo?.name || \"Não definido\"}</p>\r\n                            {lead.assignedTo?.email && (\r\n                              <p className=\"text-xs text-muted-foreground\">{lead.assignedTo.email}</p>\r\n                            )}\r\n                          </div>\r\n                          <Star className=\"h-4 w-4 text-yellow-500 fill-yellow-500\" />\r\n                        </div>\r\n                      </div>\r\n\r\n                      <div>\r\n                        <Label className=\"text-sm font-medium\">Todos os Contatos</Label>\r\n                        <div className=\"grid grid-cols-1 md:grid-cols-2 gap-2 mt-2\">\r\n                          {lead.people.map((member) => (\r\n                            <div key={member.id} className=\"flex items-center gap-2 p-2 bg-muted rounded\">\r\n                              <Avatar className=\"h-6 w-6\">\r\n                                <AvatarImage src={member.avatar || \"/placeholder.svg\"} alt={member.name} />\r\n                                <AvatarFallback>{member.name.substring(0, 2)}</AvatarFallback>\r\n                              </Avatar>\r\n                              <div className=\"flex-1 min-w-0\">\r\n                                <p className=\"text-sm font-medium truncate\">{member.name}</p>\r\n                                {member.email && (\r\n                                  <p className=\"text-xs text-muted-foreground truncate\">{member.email}</p>\r\n                                )}\r\n                              </div>\r\n                              {lead.assignedTo?.id === member.id && (\r\n                                <Star className=\"h-3 w-3 text-yellow-500 fill-yellow-500 flex-shrink-0\" />\r\n                              )}\r\n                            </div>\r\n                          ))}\r\n                        </div>\r\n                      </div>\r\n                    </div>\r\n                  ) : (\r\n                    <p className=\"text-muted-foreground text-center py-8\">Nenhum contato definido.</p>\r\n                  )}\r\n                </CardContent>\r\n              </Card>\r\n            </TabsContent>\r\n\r\n            <TabsContent value=\"timeline\" className=\"space-y-6\">\r\n              {/* Adicionar Nova Interação */}\r\n              <Card>\r\n                <CardHeader>\r\n                  <CardTitle className=\"flex items-center gap-2\">\r\n                    <Plus className=\"h-4 w-4\" />\r\n                    Registrar Interação\r\n                  </CardTitle>\r\n                </CardHeader>\r\n                <CardContent className=\"space-y-4\">\r\n                  <div className=\"grid grid-cols-1 gap-4\">\r\n                    <div className=\"grid grid-cols-4 gap-4\">\r\n                      <div>\r\n                        <Label>Tipo</Label>\r\n                        <Select\r\n                          value={newInteraction.type}\r\n                          onValueChange={(value: \"call\" | \"email\" | \"meeting\" | \"note\" | \"feedback\") =>\r\n                            setNewInteraction({ ...newInteraction, type: value })\r\n                          }\r\n                        >\r\n                          <SelectTrigger>\r\n                            <SelectValue />\r\n                          </SelectTrigger>\r\n                          <SelectContent>\r\n                            <SelectItem value=\"call\">Ligação</SelectItem>\r\n                            <SelectItem value=\"email\">Email</SelectItem>\r\n                            <SelectItem value=\"meeting\">Reunião</SelectItem>\r\n                            <SelectItem value=\"note\">Anotação</SelectItem>\r\n                            <SelectItem value=\"feedback\">Feedback</SelectItem>\r\n                          </SelectContent>\r\n                        </Select>\r\n                      </div>\r\n\r\n                      {newInteraction.type === \"feedback\" && (\r\n                        <>\r\n                          <div>\r\n                            <Label>Tipo de Feedback</Label>\r\n                            <Select\r\n                              value={newInteraction.feedbackType}\r\n                              onValueChange={(value: \"positive\" | \"negative\" | \"neutral\" | \"important\") =>\r\n                                setNewInteraction({ ...newInteraction, feedbackType: value })\r\n                              }\r\n                            >\r\n                              <SelectTrigger>\r\n                                <SelectValue />\r\n                              </SelectTrigger>\r\n                              <SelectContent>\r\n                                <SelectItem value=\"positive\">Positivo</SelectItem>\r\n                                <SelectItem value=\"negative\">Negativo</SelectItem>\r\n                                <SelectItem value=\"neutral\">Neutro</SelectItem>\r\n                                <SelectItem value=\"important\">Importante</SelectItem>\r\n                              </SelectContent>\r\n                            </Select>\r\n                          </div>\r\n                          <div>\r\n                            <Label>Avaliação (1-10)</Label>\r\n                            <Input\r\n                              type=\"number\"\r\n                              min=\"1\"\r\n                              max=\"10\"\r\n                              value={newInteraction.rating}\r\n                              onChange={(e) => setNewInteraction({ ...newInteraction, rating: Number(e.target.value) })}\r\n                            />\r\n                          </div>\r\n                        </>\r\n                      )}\r\n\r\n                      <div className={newInteraction.type === \"feedback\" ? \"col-span-1\" : \"col-span-3\"}>\r\n                        <Label>Descrição</Label>\r\n                        <Input\r\n                          value={newInteraction.description}\r\n                          onChange={(e) => setNewInteraction({ ...newInteraction, description: e.target.value })}\r\n                          placeholder={\r\n                            newInteraction.type === \"feedback\"\r\n                              ? \"Descreva o feedback recebido...\"\r\n                              : \"Descreva a interação...\"\r\n                          }\r\n                        />\r\n                      </div>\r\n                    </div>\r\n\r\n                    <div className=\"flex justify-end\">\r\n                      <Button onClick={handleAddInteraction} className=\"w-auto\">\r\n                        <Plus className=\"h-4 w-4 mr-2\" />\r\n                        Adicionar {newInteraction.type === \"feedback\" ? \"Feedback\" : \"Interação\"}\r\n                      </Button>\r\n                    </div>\r\n                  </div>\r\n                </CardContent>\r\n              </Card>\r\n\r\n              {/* Timeline de Interações */}\r\n              <Card>\r\n                <CardHeader>\r\n                  <CardTitle>Timeline de Interações</CardTitle>\r\n                </CardHeader>\r\n                <CardContent>\r\n                  {lead.interactions && lead.interactions.length > 0 ? (\r\n                    <div className=\"space-y-4\">\r\n                      {lead.interactions\r\n                        .sort((a, b) => new Date(b.date).getTime() - new Date(a.date).getTime())\r\n                        .map((interaction) => (\r\n                          <div\r\n                            key={interaction.id}\r\n                            className=\"border-l-4 border-blue-200 pl-4 py-3 bg-gray-50 rounded-r-lg\"\r\n                          >\r\n                            <div className=\"flex items-center justify-between mb-2\">\r\n                              <div className=\"flex items-center gap-2\">\r\n                                {getInteractionIcon(interaction.type, interaction.feedbackType)}\r\n                                <Badge\r\n                                  variant=\"outline\"\r\n                                  className={\r\n                                    interaction.type === \"feedback\" && interaction.feedbackType\r\n                                      ? feedbackTypes[interaction.feedbackType].color\r\n                                      : \"\"\r\n                                  }\r\n                                >\r\n                                  {getInteractionLabel(interaction.type)}\r\n                                  {interaction.type === \"feedback\" &&\r\n                                    interaction.feedbackType &&\r\n                                    ` - ${feedbackTypes[interaction.feedbackType].label}`}\r\n                                </Badge>\r\n                                <span className=\"text-sm text-muted-foreground\">\r\n                                  {new Date(interaction.date).toLocaleString(\"pt-BR\")}\r\n                                </span>\r\n                              </div>\r\n                              <span className=\"text-sm text-muted-foreground\">por {userNameCache[interaction.createdBy] || interaction.createdBy}</span>\r\n                            </div>\r\n\r\n                            {interaction.type === \"feedback\" && interaction.rating !== undefined && (\r\n                              <div className=\"flex items-center gap-2 mb-2\">\r\n                                <Star className=\"h-4 w-4 text-yellow-500\" />\r\n                                <span className=\"text-sm font-medium\">Avaliação: {interaction.rating}/10</span>\r\n                                <div className=\"flex gap-1\">\r\n                                  {Array.from({ length: 10 }, (_, i) => (\r\n                                    <div\r\n                                      key={i}\r\n                                      className={`w-2 h-2 rounded-full ${\r\n                                        i < (interaction.rating || 0) ? \"bg-yellow-400\" : \"bg-gray-200\"\r\n                                      }`}\r\n                                    />\r\n                                  ))}\r\n                                </div>\r\n                              </div>\r\n                            )}\r\n\r\n                            <p className=\"text-sm\">{interaction.description}</p>\r\n                          </div>\r\n                        ))}\r\n                    </div>\r\n                  ) : (\r\n                    <p className=\"text-muted-foreground text-center py-8\">Nenhuma interação registrada ainda.</p>\r\n                  )}\r\n                </CardContent>\r\n              </Card>\r\n            </TabsContent>\r\n\r\n            <TabsContent value=\"feedback\" className=\"space-y-6\">\r\n              {/* Resumo de Feedbacks */}\r\n              {lead.interactions && lead.interactions.filter((i) => i.type === \"feedback\").length > 0 && (\r\n                <Card>\r\n                  <CardHeader>\r\n                    <CardTitle className=\"flex items-center gap-2\">\r\n                      <Star className=\"h-4 w-4\" />\r\n                      Resumo de Feedbacks\r\n                    </CardTitle>\r\n                  </CardHeader>\r\n                  <CardContent>\r\n                    <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4\">\r\n                      {Object.entries(feedbackTypes).map(([type, config]) => {\r\n                        const count =\r\n                          lead.interactions?.filter((i) => i.type === \"feedback\" && i.feedbackType === type).length || 0\r\n                        return (\r\n                          <div key={type} className=\"text-center p-3 bg-muted rounded-lg\">\r\n                            <config.icon className=\"h-6 w-6 mx-auto mb-2\" />\r\n                            <p className=\"text-2xl font-bold\">{count}</p>\r\n                            <p className=\"text-sm text-muted-foreground\">{config.label}</p>\r\n                          </div>\r\n                        )\r\n                      })}\r\n                    </div>\r\n\r\n                    {/* Média de Avaliações */}\r\n                    {(() => {\r\n                      const feedbacksWithRating =\r\n                        lead.interactions?.filter((i) => i.type === \"feedback\" && i.rating) || []\r\n                      if (feedbacksWithRating.length > 0) {\r\n                        const averageRating =\r\n                          feedbacksWithRating.reduce((sum, f) => sum + (f.rating || 0), 0) / feedbacksWithRating.length\r\n                        return (\r\n                          <div className=\"mt-4 p-3 bg-blue-50 rounded-lg\">\r\n                            <div className=\"flex items-center justify-center gap-2\">\r\n                              <Star className=\"h-5 w-5 text-yellow-500\" />\r\n                              <span className=\"text-lg font-semibold\">\r\n                                Avaliação Média: {averageRating.toFixed(1)}/10\r\n                              </span>\r\n                            </div>\r\n                            <div className=\"flex justify-center gap-1 mt-2\">\r\n                              {Array.from({ length: 10 }, (_, i) => (\r\n                                <div\r\n                                  key={i}\r\n                                  className={`w-3 h-3 rounded-full ${\r\n                                    i < Math.round(averageRating) ? \"bg-yellow-400\" : \"bg-gray-200\"\r\n                                  }`}\r\n                                />\r\n                              ))}\r\n                            </div>\r\n                          </div>\r\n                        )\r\n                      }\r\n                      return null\r\n                    })()}\r\n                  </CardContent>\r\n                </Card>\r\n              )}\r\n\r\n              {/* Lista Detalhada de Feedbacks */}\r\n              <Card>\r\n                <CardHeader>\r\n                  <CardTitle>Histórico de Feedbacks</CardTitle>\r\n                </CardHeader>\r\n                <CardContent>\r\n                  {lead.interactions && lead.interactions.filter((i) => i.type === \"feedback\").length > 0 ? (\r\n                    <div className=\"space-y-4\">\r\n                      {lead.interactions\r\n                        .filter((i) => i.type === \"feedback\")\r\n                        .sort((a, b) => new Date(b.date).getTime() - new Date(a.date).getTime())\r\n                        .map((feedback) => (\r\n                          <div key={feedback.id} className=\"p-4 border rounded-lg\">\r\n                            <div className=\"flex items-center justify-between mb-3\">\r\n                              <div className=\"flex items-center gap-2\">\r\n                                {getInteractionIcon(feedback.type, feedback.feedbackType)}\r\n                                <Badge className={feedbackTypes[feedback.feedbackType || \"neutral\"].color}>\r\n                                  {feedbackTypes[feedback.feedbackType || \"neutral\"].label}\r\n                                </Badge>\r\n                                <span className=\"text-sm text-muted-foreground\">\r\n                                  {new Date(feedback.date).toLocaleString(\"pt-BR\")}\r\n                                </span>\r\n                              </div>\r\n                              <span className=\"text-sm text-muted-foreground\">por {userNameCache[feedback.createdBy] || feedback.createdBy}</span>\r\n                            </div>\r\n\r\n                            {feedback.rating !== undefined && (\r\n                              <div className=\"flex items-center gap-2 mb-3\">\r\n                                <Star className=\"h-4 w-4 text-yellow-500\" />\r\n                                <span className=\"text-sm font-medium\">Avaliação: {feedback.rating}/10</span>\r\n                                <div className=\"flex gap-1\">\r\n                                  {Array.from({ length: 10 }, (_, i) => (\r\n                                    <div\r\n                                      key={i}\r\n                                      className={`w-2 h-2 rounded-full ${\r\n                                        i < (feedback.rating || 0) ? \"bg-yellow-400\" : \"bg-gray-200\"\r\n                                      }`}\r\n                                    />\r\n                                  ))}\r\n                                </div>\r\n                              </div>\r\n                            )}\r\n\r\n                            <p className=\"text-sm\">{feedback.description}</p>\r\n                          </div>\r\n                        ))}\r\n                    </div>\r\n                  ) : (\r\n                    <p className=\"text-muted-foreground text-center py-8\">Nenhum feedback registrado ainda.</p>\r\n                  )}\r\n                </CardContent>\r\n              </Card>\r\n            </TabsContent>\r\n          </div>\r\n        </Tabs>\r\n\r\n        {/* Ações do Footer */}\r\n        {!isEditing && (\r\n          <div className=\"flex justify-between pt-6 border-t\">\r\n            <Button\r\n              variant=\"destructive\"\r\n              onClick={() => setConfirmDeleteOpen(true)}\r\n            >\r\n              Excluir Lead\r\n            </Button>\r\n            <div className=\"flex gap-2\">\r\n              <Button variant=\"outline\" onClick={onClose}>\r\n                Fechar\r\n              </Button>\r\n              <Button onClick={handleEdit}>\r\n                <Edit className=\"h-4 w-4 mr-2\" />\r\n                Editar Lead\r\n              </Button>\r\n            </div>\r\n          </div>\r\n        )}\r\n\r\n        {/* Diálogo de confirmação de exclusão */}\r\n        <AlertDialog open={confirmDeleteOpen} onOpenChange={setConfirmDeleteOpen}>\r\n          <AlertDialogContent>\r\n            <AlertDialogHeader>\r\n              <AlertDialogTitle>Excluir lead</AlertDialogTitle>\r\n              <AlertDialogDescription>\r\n                Tem certeza que deseja excluir este lead? Esta ação não pode ser desfeita.\r\n              </AlertDialogDescription>\r\n            </AlertDialogHeader>\r\n            <AlertDialogFooter>\r\n              <AlertDialogCancel onClick={() => setConfirmDeleteOpen(false)}>Cancelar</AlertDialogCancel>\r\n              <AlertDialogAction\r\n                onClick={() => {\r\n                  if (lead) {\r\n                    onDelete(lead.id)\r\n                  }\r\n                  setConfirmDeleteOpen(false)\r\n                  onClose()\r\n                }}\r\n              >\r\n                Excluir\r\n              </AlertDialogAction>\r\n            </AlertDialogFooter>\r\n          </AlertDialogContent>\r\n        </AlertDialog>\r\n      </DialogContent>\r\n    </Dialog>\r\n  )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Projetos\\Back_endCrm\\kanbanproject1\\components\\leads-history-dashboard.tsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'period' is defined but never used.","line":39,"column":20,"nodeType":"Identifier","messageId":"unusedVar","endLine":39,"endColumn":55,"suggestions":[{"messageId":"removeVar","data":{"varName":"period"},"fix":{"range":[1035,1070],"text":""},"desc":"Remove unused variable 'period'."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useMemo has a missing dependency: 'leads'. Either include it or remove the dependency array.","line":148,"column":6,"nodeType":"ArrayExpression","endLine":148,"endColumn":41,"suggestions":[{"desc":"Update the dependencies array to be: [period, columns, leadsWithHistory, leads]","fix":{"range":[5207,5242],"text":"[period, columns, leadsWithHistory, leads]"}}]},{"ruleId":"no-unused-vars","severity":1,"message":"'filteredData' is assigned a value but never used.","line":170,"column":9,"nodeType":"Identifier","messageId":"unusedVar","endLine":170,"endColumn":21},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'filteredData' is assigned a value but never used.","line":170,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":170,"endColumn":21}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\"\r\n\r\nimport { useState, useMemo } from \"react\"\r\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\"\r\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\"\r\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\"\r\nimport { Progress } from \"@/components/ui/progress\"\r\nimport { Users, Clock, ArrowRight, Target, Activity, Calendar } from \"lucide-react\"\r\n\r\n// Tipos\r\ntype Lead = {\r\n  id: string\r\n  name: string\r\n  company: string\r\n  status: string\r\n  priority: \"low\" | \"medium\" | \"high\" | \"urgent\"\r\n  source: string\r\n  estimatedValue: number\r\n  expectedCloseDate: string\r\n  createdAt: string\r\n  statusHistory?: Array<{\r\n    status: string\r\n    timestamp: string\r\n    duration?: number // em dias\r\n  }>\r\n}\r\n\r\ntype Column = {\r\n  id: string\r\n  name: string\r\n  color: string\r\n  order: number\r\n}\r\n\r\ntype LeadsHistoryDashboardProps = {\r\n  leads: Lead[]\r\n  columns: Column[]\r\n  period: \"7d\" | \"30d\" | \"90d\" | \"1y\"\r\n  onPeriodChange: (period: \"7d\" | \"30d\" | \"90d\" | \"1y\") => void\r\n}\r\n\r\nexport default function LeadsHistoryDashboard({ leads, columns, period, onPeriodChange }: LeadsHistoryDashboardProps) {\r\n  const [activeTab, setActiveTab] = useState(\"passage\")\r\n  const [selectedColumn, setSelectedColumn] = useState<string>(\"all\")\r\n\r\n  // Simular histórico de status para leads existentes\r\n  const leadsWithHistory = useMemo(() => {\r\n    return leads.map((lead) => {\r\n      if (!lead.statusHistory) {\r\n        // Simular histórico baseado na data de criação e status atual\r\n        const createdDate = new Date(lead.createdAt)\r\n        const now = new Date()\r\n        const daysSinceCreated = Math.floor((now.getTime() - createdDate.getTime()) / (1000 * 60 * 60 * 24))\r\n\r\n        const history = [\r\n          {\r\n            status: \"novo\",\r\n            timestamp: lead.createdAt,\r\n            duration: Math.min(daysSinceCreated, 2),\r\n          },\r\n        ]\r\n\r\n        // Adicionar etapas baseadas no status atual\r\n        if (lead.status !== \"novo\" && lead.status !== \"new\") {\r\n          history.push({\r\n            status: \"qualificado\",\r\n            timestamp: new Date(createdDate.getTime() + 2 * 24 * 60 * 60 * 1000).toISOString(),\r\n            duration: Math.min(daysSinceCreated - 2, 3),\r\n          })\r\n        }\r\n\r\n        if ([\"proposta\", \"negociacao\", \"ganho\", \"perdido\"].includes(lead.status)) {\r\n          history.push({\r\n            status: \"proposta\",\r\n            timestamp: new Date(createdDate.getTime() + 5 * 24 * 60 * 60 * 1000).toISOString(),\r\n            duration: Math.min(daysSinceCreated - 5, 4),\r\n          })\r\n        }\r\n\r\n        if ([\"negociacao\", \"ganho\", \"perdido\"].includes(lead.status)) {\r\n          history.push({\r\n            status: \"negociacao\",\r\n            timestamp: new Date(createdDate.getTime() + 9 * 24 * 60 * 60 * 1000).toISOString(),\r\n            duration: Math.min(daysSinceCreated - 9, 5),\r\n          })\r\n        }\r\n\r\n        if (lead.status === \"ganho\" || lead.status === \"perdido\") {\r\n          history.push({\r\n            status: lead.status,\r\n            timestamp: new Date(createdDate.getTime() + 14 * 24 * 60 * 60 * 1000).toISOString(),\r\n            duration: daysSinceCreated - 14,\r\n          })\r\n        }\r\n\r\n        return { ...lead, statusHistory: history }\r\n      }\r\n      return lead\r\n    })\r\n  }, [leads])\r\n\r\n  // Calcular estatísticas de passagem por etapas\r\n  const passageStats = useMemo(() => {\r\n    const now = new Date()\r\n    const periodDays = period === \"7d\" ? 7 : period === \"30d\" ? 30 : period === \"90d\" ? 90 : 365\r\n    const periodStart = new Date(now.getTime() - periodDays * 24 * 60 * 60 * 1000)\r\n\r\n    const stats: Record<string, any> = {}\r\n\r\n    columns.forEach((column) => {\r\n      const leadsPassedThrough = leadsWithHistory.filter((lead) =>\r\n        lead.statusHistory?.some(\r\n          (history) => history.status === column.id && new Date(history.timestamp) >= periodStart,\r\n        ),\r\n      )\r\n\r\n      const totalLeadsPassedThrough = leadsWithHistory.filter((lead) =>\r\n        lead.statusHistory?.some((history) => history.status === column.id),\r\n      )\r\n\r\n      const avgTimeInStage =\r\n        totalLeadsPassedThrough.length > 0\r\n          ? totalLeadsPassedThrough.reduce((sum, lead) => {\r\n              const stageHistory = lead.statusHistory?.find((h) => h.status === column.id)\r\n              return sum + (stageHistory?.duration || 0)\r\n            }, 0) / totalLeadsPassedThrough.length\r\n          : 0\r\n\r\n      const conversionRate =\r\n        totalLeadsPassedThrough.length > 0\r\n          ? (totalLeadsPassedThrough.filter((lead) => [\"ganho\", \"won\"].includes(lead.status)).length /\r\n              totalLeadsPassedThrough.length) *\r\n            100\r\n          : 0\r\n\r\n      stats[column.id] = {\r\n        name: column.name,\r\n        color: column.color,\r\n        passedThroughPeriod: leadsPassedThrough.length,\r\n        totalPassedThrough: totalLeadsPassedThrough.length,\r\n        avgTimeInStage: Math.round(avgTimeInStage),\r\n        conversionRate: Math.round(conversionRate * 10) / 10,\r\n        currentlyInStage: leads.filter((lead) => lead.status === column.id).length,\r\n      }\r\n    })\r\n\r\n    return stats\r\n  }, [leadsWithHistory, columns, period])\r\n\r\n  // Calcular fluxo entre etapas\r\n  const flowStats = useMemo(() => {\r\n    const flows: Record<string, Record<string, number>> = {}\r\n\r\n    leadsWithHistory.forEach((lead) => {\r\n      if (lead.statusHistory && lead.statusHistory.length > 1) {\r\n        for (let i = 0; i < lead.statusHistory.length - 1; i++) {\r\n          const from = lead.statusHistory[i].status\r\n          const to = lead.statusHistory[i + 1].status\r\n\r\n          if (!flows[from]) flows[from] = {}\r\n          flows[from][to] = (flows[from][to] || 0) + 1\r\n        }\r\n      }\r\n    })\r\n\r\n    return flows\r\n  }, [leadsWithHistory])\r\n\r\n  // Filtrar dados por coluna selecionada\r\n  const filteredData = useMemo(() => {\r\n    if (selectedColumn === \"all\") {\r\n      return Object.values(passageStats)\r\n    }\r\n    return passageStats[selectedColumn] ? [passageStats[selectedColumn]] : []\r\n  }, [passageStats, selectedColumn])\r\n\r\n  return (\r\n    <div className=\"space-y-6\">\r\n      {/* Header */}\r\n      <div className=\"flex justify-between items-center\">\r\n        <div>\r\n          <h1 className=\"text-3xl font-bold\">Histórico de Movimentação</h1>\r\n          <p className=\"text-muted-foreground\">Análise detalhada da passagem de leads pelas etapas</p>\r\n        </div>\r\n        <div className=\"flex items-center space-x-2\">\r\n          <Select value={selectedColumn} onValueChange={setSelectedColumn}>\r\n            <SelectTrigger className=\"w-48\">\r\n              <SelectValue />\r\n            </SelectTrigger>\r\n            <SelectContent>\r\n              <SelectItem value=\"all\">Todas as Etapas</SelectItem>\r\n              {columns.map((column) => (\r\n                <SelectItem key={column.id} value={column.id}>\r\n                  <div className=\"flex items-center gap-2\">\r\n                    <div className=\"w-3 h-3 rounded-full\" style={{ backgroundColor: column.color }} />\r\n                    {column.name}\r\n                  </div>\r\n                </SelectItem>\r\n              ))}\r\n            </SelectContent>\r\n          </Select>\r\n          <Select value={period} onValueChange={onPeriodChange}>\r\n            <SelectTrigger className=\"w-32\">\r\n              <SelectValue />\r\n            </SelectTrigger>\r\n            <SelectContent>\r\n              <SelectItem value=\"7d\">7 dias</SelectItem>\r\n              <SelectItem value=\"30d\">30 dias</SelectItem>\r\n              <SelectItem value=\"90d\">90 dias</SelectItem>\r\n              <SelectItem value=\"1y\">1 ano</SelectItem>\r\n            </SelectContent>\r\n          </Select>\r\n        </div>\r\n      </div>\r\n\r\n      <Tabs value={activeTab} onValueChange={setActiveTab} className=\"w-full\">\r\n        <TabsList className=\"grid w-full grid-cols-3\">\r\n          <TabsTrigger value=\"passage\">Passagem por Etapas</TabsTrigger>\r\n          <TabsTrigger value=\"flow\">Fluxo entre Etapas</TabsTrigger>\r\n          <TabsTrigger value=\"performance\">Performance Temporal</TabsTrigger>\r\n        </TabsList>\r\n\r\n        <TabsContent value=\"passage\" className=\"space-y-6\">\r\n          {/* Cards de estatísticas por etapa */}\r\n          <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4\">\r\n            {Object.values(passageStats).map((stat) => (\r\n              <Card key={stat.name}>\r\n                <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\r\n                  <CardTitle className=\"text-sm font-medium\">{stat.name}</CardTitle>\r\n                  <div className=\"w-4 h-4 rounded-full\" style={{ backgroundColor: stat.color }} />\r\n                </CardHeader>\r\n                <CardContent>\r\n                  <div className=\"text-2xl font-bold\">{stat.totalPassedThrough}</div>\r\n                  <p className=\"text-xs text-muted-foreground\">\r\n                    <span className=\"text-green-600\">+{stat.passedThroughPeriod}</span> no período\r\n                  </p>\r\n                  <div className=\"mt-2 space-y-1\">\r\n                    <div className=\"flex justify-between text-xs\">\r\n                      <span>Atualmente: {stat.currentlyInStage}</span>\r\n                      <span>{stat.conversionRate}% conversão</span>\r\n                    </div>\r\n                    <Progress value={(stat.currentlyInStage / stat.totalPassedThrough) * 100} className=\"h-1\" />\r\n                  </div>\r\n                </CardContent>\r\n              </Card>\r\n            ))}\r\n          </div>\r\n\r\n          {/* Gráfico de tempo médio por etapa */}\r\n          <Card>\r\n            <CardHeader>\r\n              <CardTitle className=\"flex items-center space-x-2\">\r\n                <Clock className=\"h-5 w-5\" />\r\n                <span>Tempo Médio por Etapa</span>\r\n              </CardTitle>\r\n            </CardHeader>\r\n            <CardContent>\r\n              <div className=\"space-y-4\">\r\n                {Object.values(passageStats).map((stat) => (\r\n                  <div key={stat.name} className=\"space-y-2\">\r\n                    <div className=\"flex items-center justify-between\">\r\n                      <div className=\"flex items-center space-x-2\">\r\n                        <div className=\"w-3 h-3 rounded-full\" style={{ backgroundColor: stat.color }} />\r\n                        <span className=\"text-sm font-medium\">{stat.name}</span>\r\n                      </div>\r\n                      <span className=\"text-sm text-muted-foreground\">{stat.avgTimeInStage} dias em média</span>\r\n                    </div>\r\n                    <Progress value={Math.min((stat.avgTimeInStage / 30) * 100, 100)} className=\"h-2\" />\r\n                  </div>\r\n                ))}\r\n              </div>\r\n            </CardContent>\r\n          </Card>\r\n\r\n          {/* Lista detalhada de leads por etapa */}\r\n          {selectedColumn !== \"all\" && passageStats[selectedColumn] && (\r\n            <Card>\r\n              <CardHeader>\r\n                <CardTitle className=\"flex items-center space-x-2\">\r\n                  <Users className=\"h-5 w-5\" />\r\n                  <span>Leads que Passaram por {passageStats[selectedColumn].name}</span>\r\n                </CardTitle>\r\n              </CardHeader>\r\n              <CardContent>\r\n                <div className=\"space-y-2\">\r\n                  {leadsWithHistory\r\n                    .filter((lead) => lead.statusHistory?.some((h) => h.status === selectedColumn))\r\n                    .slice(0, 10)\r\n                    .map((lead) => {\r\n                      const stageHistory = lead.statusHistory?.find((h) => h.status === selectedColumn)\r\n                      return (\r\n                        <div key={lead.id} className=\"flex items-center justify-between p-2 border rounded\">\r\n                          <div>\r\n                            <p className=\"font-medium\">{lead.company}</p>\r\n                            <p className=\"text-sm text-muted-foreground\">{lead.name}</p>\r\n                          </div>\r\n                          <div className=\"text-right\">\r\n                            <p className=\"text-sm font-medium\">{stageHistory?.duration || 0} dias nesta etapa</p>\r\n                            <p className=\"text-xs text-muted-foreground\">Status atual: {lead.status}</p>\r\n                          </div>\r\n                        </div>\r\n                      )\r\n                    })}\r\n                </div>\r\n              </CardContent>\r\n            </Card>\r\n          )}\r\n        </TabsContent>\r\n\r\n        <TabsContent value=\"flow\" className=\"space-y-6\">\r\n          {/* Matriz de fluxo entre etapas */}\r\n          <Card>\r\n            <CardHeader>\r\n              <CardTitle className=\"flex items-center space-x-2\">\r\n                <ArrowRight className=\"h-5 w-5\" />\r\n                <span>Fluxo entre Etapas</span>\r\n              </CardTitle>\r\n            </CardHeader>\r\n            <CardContent>\r\n              <div className=\"space-y-4\">\r\n                {Object.entries(flowStats).map(([fromStage, toStages]) => {\r\n                  const fromColumn = columns.find((c) => c.id === fromStage)\r\n                  if (!fromColumn) return null\r\n\r\n                  return (\r\n                    <div key={fromStage} className=\"space-y-2\">\r\n                      <div className=\"flex items-center space-x-2\">\r\n                        <div className=\"w-3 h-3 rounded-full\" style={{ backgroundColor: fromColumn.color }} />\r\n                        <span className=\"font-medium\">{fromColumn.name}</span>\r\n                      </div>\r\n                      <div className=\"ml-5 space-y-1\">\r\n                        {Object.entries(toStages).map(([toStage, count]) => {\r\n                          const toColumn = columns.find((c) => c.id === toStage)\r\n                          if (!toColumn) return null\r\n\r\n                          const total = Object.values(toStages).reduce((sum, c) => sum + c, 0)\r\n                          const percentage = ((count / total) * 100).toFixed(1)\r\n\r\n                          return (\r\n                            <div key={toStage} className=\"flex items-center justify-between\">\r\n                              <div className=\"flex items-center space-x-2\">\r\n                                <ArrowRight className=\"h-3 w-3 text-muted-foreground\" />\r\n                                <div className=\"w-2 h-2 rounded-full\" style={{ backgroundColor: toColumn.color }} />\r\n                                <span className=\"text-sm\">{toColumn.name}</span>\r\n                              </div>\r\n                              <div className=\"text-sm text-muted-foreground\">\r\n                                {count} leads ({percentage}%)\r\n                              </div>\r\n                            </div>\r\n                          )\r\n                        })}\r\n                      </div>\r\n                    </div>\r\n                  )\r\n                })}\r\n              </div>\r\n            </CardContent>\r\n          </Card>\r\n        </TabsContent>\r\n\r\n        <TabsContent value=\"performance\" className=\"space-y-6\">\r\n          {/* Performance temporal */}\r\n          <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\r\n            <Card>\r\n              <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\r\n                <CardTitle className=\"text-sm font-medium\">Tempo Médio Total</CardTitle>\r\n                <Clock className=\"h-4 w-4 text-muted-foreground\" />\r\n              </CardHeader>\r\n              <CardContent>\r\n                <div className=\"text-2xl font-bold\">\r\n                  {Math.round(Object.values(passageStats).reduce((sum, stat) => sum + stat.avgTimeInStage, 0))} dias\r\n                </div>\r\n                <p className=\"text-xs text-muted-foreground\">Do lead ao fechamento</p>\r\n              </CardContent>\r\n            </Card>\r\n\r\n            <Card>\r\n              <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\r\n                <CardTitle className=\"text-sm font-medium\">Taxa de Conversão Geral</CardTitle>\r\n                <Target className=\"h-4 w-4 text-muted-foreground\" />\r\n              </CardHeader>\r\n              <CardContent>\r\n                <div className=\"text-2xl font-bold\">\r\n                  {(\r\n                    Object.values(passageStats).reduce((sum, stat) => sum + stat.conversionRate, 0) /\r\n                      Object.values(passageStats).length || 0\r\n                  ).toFixed(1)}\r\n                  %\r\n                </div>\r\n                <p className=\"text-xs text-muted-foreground\">Média entre todas as etapas</p>\r\n              </CardContent>\r\n            </Card>\r\n\r\n            <Card>\r\n              <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\r\n                <CardTitle className=\"text-sm font-medium\">Leads em Movimento</CardTitle>\r\n                <Activity className=\"h-4 w-4 text-muted-foreground\" />\r\n              </CardHeader>\r\n              <CardContent>\r\n                <div className=\"text-2xl font-bold\">\r\n                  {Object.values(passageStats).reduce((sum, stat) => sum + stat.currentlyInStage, 0)}\r\n                </div>\r\n                <p className=\"text-xs text-muted-foreground\">Atualmente no pipeline</p>\r\n              </CardContent>\r\n            </Card>\r\n          </div>\r\n\r\n          {/* Gráfico de performance por período */}\r\n          <Card>\r\n            <CardHeader>\r\n              <CardTitle className=\"flex items-center space-x-2\">\r\n                <Calendar className=\"h-5 w-5\" />\r\n                <span>Performance por Etapa no Período</span>\r\n              </CardTitle>\r\n            </CardHeader>\r\n            <CardContent>\r\n              <div className=\"space-y-4\">\r\n                {Object.values(passageStats).map((stat) => (\r\n                  <div key={stat.name} className=\"space-y-2\">\r\n                    <div className=\"flex items-center justify-between\">\r\n                      <div className=\"flex items-center space-x-2\">\r\n                        <div className=\"w-3 h-3 rounded-full\" style={{ backgroundColor: stat.color }} />\r\n                        <span className=\"text-sm font-medium\">{stat.name}</span>\r\n                      </div>\r\n                      <div className=\"text-sm text-muted-foreground\">\r\n                        {stat.passedThroughPeriod} leads • {stat.conversionRate}% conversão\r\n                      </div>\r\n                    </div>\r\n                    <div className=\"grid grid-cols-2 gap-2\">\r\n                      <div>\r\n                        <div className=\"text-xs text-muted-foreground mb-1\">Passaram no período</div>\r\n                        <Progress value={(stat.passedThroughPeriod / stat.totalPassedThrough) * 100} className=\"h-2\" />\r\n                      </div>\r\n                      <div>\r\n                        <div className=\"text-xs text-muted-foreground mb-1\">Taxa de conversão</div>\r\n                        <Progress value={stat.conversionRate} className=\"h-2\" />\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n                ))}\r\n              </div>\r\n            </CardContent>\r\n          </Card>\r\n        </TabsContent>\r\n      </Tabs>\r\n    </div>\r\n  )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Projetos\\Back_endCrm\\kanbanproject1\\components\\leads-movement-dashboard.tsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'period' is defined but never used.","line":29,"column":20,"nodeType":"Identifier","messageId":"unusedVar","endLine":29,"endColumn":55,"suggestions":[{"messageId":"removeVar","data":{"varName":"period"},"fix":{"range":[928,963],"text":""},"desc":"Remove unused variable 'period'."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\"\r\n\r\nimport { useState, useMemo } from \"react\"\r\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\"\r\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\"\r\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\"\r\nimport { Progress } from \"@/components/ui/progress\"\r\nimport PieChart from \"./pie-chart\"\r\nimport DonutChart from \"./donut-chart\"\r\nimport { TrendingUp, Users, DollarSign, Target, ArrowUp, ArrowDown, Minus } from \"lucide-react\"\r\n\r\n// Tipos\r\ntype Lead = {\r\n  id: string\r\n  name: string\r\n  company: string\r\n  status: string\r\n  priority: \"low\" | \"medium\" | \"high\" | \"urgent\"\r\n  source: string\r\n  estimatedValue: number\r\n  expectedCloseDate: string\r\n  createdAt: string\r\n  funnelId?: string\r\n}\r\n\r\ntype LeadsMovementDashboardProps = {\r\n  leads: Lead[]\r\n  period: \"7d\" | \"30d\" | \"90d\" | \"1y\"\r\n  onPeriodChange: (period: \"7d\" | \"30d\" | \"90d\" | \"1y\") => void\r\n}\r\n\r\nconst COLORS = [\"#0088FE\", \"#00C49F\", \"#FFBB28\", \"#FF8042\", \"#8884D8\", \"#FF6B6B\", \"#82CA9D\", \"#FFC658\"]\r\n\r\nexport default function LeadsMovementDashboard({ leads, period, onPeriodChange }: LeadsMovementDashboardProps) {\r\n  const [activeTab, setActiveTab] = useState(\"status\")\r\n  const [chartType, setChartType] = useState<\"pie\" | \"donut\">(\"pie\")\r\n\r\n  // Cálculos gerais\r\n  const stats = useMemo(() => {\r\n    const now = new Date()\r\n    const periodDays = period === \"7d\" ? 7 : period === \"30d\" ? 30 : period === \"90d\" ? 90 : 365\r\n    const periodStart = new Date(now.getTime() - periodDays * 24 * 60 * 60 * 1000)\r\n\r\n    const totalLeads = leads.length\r\n    const newLeads = leads.filter((lead) => new Date(lead.createdAt) >= periodStart).length\r\n    const convertedLeads = leads.filter((lead) => lead.status === \"ganho\" || lead.status === \"won\").length\r\n    const conversionRate = totalLeads > 0 ? (convertedLeads / totalLeads) * 100 : 0\r\n    const totalValue = leads.reduce((sum, lead) => sum + lead.estimatedValue, 0)\r\n    const avgValue = totalLeads > 0 ? totalValue / totalLeads : 0\r\n\r\n    return {\r\n      totalLeads,\r\n      newLeads,\r\n      convertedLeads,\r\n      conversionRate,\r\n      totalValue,\r\n      avgValue,\r\n    }\r\n  }, [leads, period])\r\n\r\n  // Dados para gráficos\r\n  const chartData = useMemo(() => {\r\n    // Leads por status\r\n    const leadsByStatus = leads.reduce(\r\n      (acc, lead) => {\r\n        acc[lead.status] = (acc[lead.status] || 0) + 1\r\n        return acc\r\n      },\r\n      {} as Record<string, number>,\r\n    )\r\n\r\n    const statusData = Object.entries(leadsByStatus).map(([status, count]) => ({\r\n      name:\r\n        status === \"novo\" || status === \"new\"\r\n          ? \"Novos\"\r\n          : status === \"qualificado\" || status === \"qualified\"\r\n            ? \"Qualificados\"\r\n            : status === \"proposta\" || status === \"proposal\"\r\n              ? \"Proposta\"\r\n              : status === \"negociacao\" || status === \"negotiation\"\r\n                ? \"Negociação\"\r\n                : status === \"ganho\" || status === \"won\"\r\n                  ? \"Ganhos\"\r\n                  : status === \"perdido\" || status === \"lost\"\r\n                    ? \"Perdidos\"\r\n                    : status === \"interesse\"\r\n                      ? \"Interesse\"\r\n                      : status === \"contato\"\r\n                        ? \"Contato\"\r\n                        : status === \"demonstracao\"\r\n                          ? \"Demonstração\"\r\n                          : status === \"fechamento\"\r\n                            ? \"Fechamento\"\r\n                            : status === \"prospeccao\"\r\n                              ? \"Prospecção\"\r\n                              : status === \"primeiro_contato\"\r\n                                ? \"Primeiro Contato\"\r\n                                : status === \"avaliacao\"\r\n                                  ? \"Avaliação\"\r\n                                  : status === \"acordo\"\r\n                                    ? \"Acordo\"\r\n                                    : status === \"rejeitado\"\r\n                                      ? \"Rejeitado\"\r\n                                      : status,\r\n      value: count,\r\n      percentage: ((count / leads.length) * 100).toFixed(1),\r\n    }))\r\n\r\n    // Leads por origem\r\n    const leadsBySource = leads.reduce(\r\n      (acc, lead) => {\r\n        acc[lead.source] = (acc[lead.source] || 0) + 1\r\n        return acc\r\n      },\r\n      {} as Record<string, number>,\r\n    )\r\n\r\n    const sourceData = Object.entries(leadsBySource).map(([source, count]) => ({\r\n      name:\r\n        source === \"website\"\r\n          ? \"Website\"\r\n          : source === \"google_ads\"\r\n            ? \"Google Ads\"\r\n            : source === \"referral\"\r\n              ? \"Indicação\"\r\n              : source === \"linkedin\"\r\n                ? \"LinkedIn\"\r\n                : source === \"phone\"\r\n                  ? \"Telefone\"\r\n                  : source,\r\n      value: count,\r\n      percentage: ((count / leads.length) * 100).toFixed(1),\r\n    }))\r\n\r\n    // Leads por prioridade\r\n    const leadsByPriority = leads.reduce(\r\n      (acc, lead) => {\r\n        acc[lead.priority] = (acc[lead.priority] || 0) + 1\r\n        return acc\r\n      },\r\n      {} as Record<string, number>,\r\n    )\r\n\r\n    const priorityData = Object.entries(leadsByPriority).map(([priority, count]) => ({\r\n      name:\r\n        priority === \"urgent\"\r\n          ? \"Urgente\"\r\n          : priority === \"high\"\r\n            ? \"Alta\"\r\n            : priority === \"medium\"\r\n              ? \"Média\"\r\n              : priority === \"low\"\r\n                ? \"Baixa\"\r\n                : priority,\r\n      value: count,\r\n      percentage: ((count / leads.length) * 100).toFixed(1),\r\n    }))\r\n\r\n    // Leads por valor\r\n    const valueRanges = [\r\n      { range: \"0-25k\", min: 0, max: 25000 },\r\n      { range: \"25k-50k\", min: 25000, max: 50000 },\r\n      { range: \"50k-100k\", min: 50000, max: 100000 },\r\n      { range: \"100k+\", min: 100000, max: Number.POSITIVE_INFINITY },\r\n    ]\r\n\r\n    const valueData = valueRanges.map(({ range, min, max }) => {\r\n      const count = leads.filter((lead) => lead.estimatedValue >= min && lead.estimatedValue < max).length\r\n      return {\r\n        name: `R$ ${range}`,\r\n        value: count,\r\n        percentage: leads.length > 0 ? ((count / leads.length) * 100).toFixed(1) : \"0\",\r\n      }\r\n    })\r\n\r\n    return {\r\n      status: statusData,\r\n      source: sourceData,\r\n      priority: priorityData,\r\n      value: valueData,\r\n    }\r\n  }, [leads])\r\n\r\n  const renderChart = (data: any[]) => {\r\n    const chartProps = {\r\n      data,\r\n      colors: COLORS,\r\n      width: 400,\r\n      height: 300,\r\n    }\r\n\r\n    return chartType === \"pie\" ? <PieChart {...chartProps} /> : <DonutChart {...chartProps} />\r\n  }\r\n\r\n  return (\r\n    <div className=\"space-y-6\">\r\n      {/* Header com controles */}\r\n      <div className=\"flex justify-between items-center\">\r\n        <div>\r\n          <h2 className=\"text-2xl font-bold\">Análise de Movimentação de Leads</h2>\r\n          <p className=\"text-muted-foreground\">Visualização detalhada em formato pizza</p>\r\n        </div>\r\n        <div className=\"flex items-center space-x-2\">\r\n          <Select value={chartType} onValueChange={(value: \"pie\" | \"donut\") => setChartType(value)}>\r\n            <SelectTrigger className=\"w-32\">\r\n              <SelectValue />\r\n            </SelectTrigger>\r\n            <SelectContent>\r\n              <SelectItem value=\"pie\">Pizza</SelectItem>\r\n              <SelectItem value=\"donut\">Rosquinha</SelectItem>\r\n            </SelectContent>\r\n          </Select>\r\n          <Select value={period} onValueChange={onPeriodChange}>\r\n            <SelectTrigger className=\"w-32\">\r\n              <SelectValue />\r\n            </SelectTrigger>\r\n            <SelectContent>\r\n              <SelectItem value=\"7d\">7 dias</SelectItem>\r\n              <SelectItem value=\"30d\">30 dias</SelectItem>\r\n              <SelectItem value=\"90d\">90 dias</SelectItem>\r\n              <SelectItem value=\"1y\">1 ano</SelectItem>\r\n            </SelectContent>\r\n          </Select>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Cards de estatísticas principais */}\r\n      <div className=\"grid grid-cols-1 md:grid-cols-4 gap-4\">\r\n        <Card>\r\n          <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\r\n            <CardTitle className=\"text-sm font-medium\">Total de Leads</CardTitle>\r\n            <Users className=\"h-4 w-4 text-muted-foreground\" />\r\n          </CardHeader>\r\n          <CardContent>\r\n            <div className=\"text-2xl font-bold\">{stats.totalLeads}</div>\r\n            <p className=\"text-xs text-muted-foreground flex items-center\">\r\n              <ArrowUp className=\"h-3 w-3 text-green-600 mr-1\" />\r\n              <span className=\"text-green-600\">+{stats.newLeads}</span> novos no período\r\n            </p>\r\n          </CardContent>\r\n        </Card>\r\n\r\n        <Card>\r\n          <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\r\n            <CardTitle className=\"text-sm font-medium\">Taxa de Conversão</CardTitle>\r\n            <Target className=\"h-4 w-4 text-muted-foreground\" />\r\n          </CardHeader>\r\n          <CardContent>\r\n            <div className=\"text-2xl font-bold\">{stats.conversionRate.toFixed(1)}%</div>\r\n            <p className=\"text-xs text-muted-foreground\">{stats.convertedLeads} leads convertidos</p>\r\n            <Progress value={stats.conversionRate} className=\"mt-2\" />\r\n          </CardContent>\r\n        </Card>\r\n\r\n        <Card>\r\n          <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\r\n            <CardTitle className=\"text-sm font-medium\">Valor Total</CardTitle>\r\n            <DollarSign className=\"h-4 w-4 text-muted-foreground\" />\r\n          </CardHeader>\r\n          <CardContent>\r\n            <div className=\"text-2xl font-bold\">R$ {stats.totalValue.toLocaleString(\"pt-BR\")}</div>\r\n            <p className=\"text-xs text-muted-foreground\">Média: R$ {stats.avgValue.toLocaleString(\"pt-BR\")}</p>\r\n          </CardContent>\r\n        </Card>\r\n\r\n        <Card>\r\n          <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\r\n            <CardTitle className=\"text-sm font-medium\">Crescimento</CardTitle>\r\n            <TrendingUp className=\"h-4 w-4 text-muted-foreground\" />\r\n          </CardHeader>\r\n          <CardContent>\r\n            <div className=\"text-2xl font-bold flex items-center\">\r\n              {stats.newLeads > 0 ? (\r\n                <ArrowUp className=\"h-5 w-5 text-green-600 mr-1\" />\r\n              ) : stats.newLeads < 0 ? (\r\n                <ArrowDown className=\"h-5 w-5 text-red-600 mr-1\" />\r\n              ) : (\r\n                <Minus className=\"h-5 w-5 text-gray-600 mr-1\" />\r\n              )}\r\n              {Math.abs(stats.newLeads)}\r\n            </div>\r\n            <p className=\"text-xs text-muted-foreground\">Novos leads no período</p>\r\n          </CardContent>\r\n        </Card>\r\n      </div>\r\n\r\n      <Tabs value={activeTab} onValueChange={setActiveTab} className=\"w-full\">\r\n        <TabsList className=\"grid w-full grid-cols-4\">\r\n          <TabsTrigger value=\"status\">Por Status</TabsTrigger>\r\n          <TabsTrigger value=\"source\">Por Origem</TabsTrigger>\r\n          <TabsTrigger value=\"priority\">Por Prioridade</TabsTrigger>\r\n          <TabsTrigger value=\"value\">Por Valor</TabsTrigger>\r\n        </TabsList>\r\n\r\n        <TabsContent value=\"status\" className=\"space-y-6\">\r\n          <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\r\n            <Card>\r\n              <CardHeader>\r\n                <CardTitle>Distribuição por Status</CardTitle>\r\n                <p className=\"text-sm text-muted-foreground\">\r\n                  Visualização em {chartType === \"pie\" ? \"pizza\" : \"rosquinha\"}\r\n                </p>\r\n              </CardHeader>\r\n              <CardContent className=\"flex justify-center\">{renderChart(chartData.status)}</CardContent>\r\n            </Card>\r\n\r\n            <Card>\r\n              <CardHeader>\r\n                <CardTitle>Detalhamento por Status</CardTitle>\r\n              </CardHeader>\r\n              <CardContent>\r\n                <div className=\"space-y-4\">\r\n                  {chartData.status.map((item, index) => (\r\n                    <div key={item.name} className=\"flex items-center justify-between\">\r\n                      <div className=\"flex items-center space-x-2\">\r\n                        <div\r\n                          className=\"w-3 h-3 rounded-full\"\r\n                          style={{ backgroundColor: COLORS[index % COLORS.length] }}\r\n                        />\r\n                        <span className=\"text-sm font-medium\">{item.name}</span>\r\n                      </div>\r\n                      <div className=\"flex items-center space-x-2\">\r\n                        <span className=\"text-sm text-muted-foreground\">{item.percentage}%</span>\r\n                        <span className=\"text-sm font-bold\">{item.value}</span>\r\n                      </div>\r\n                    </div>\r\n                  ))}\r\n                </div>\r\n              </CardContent>\r\n            </Card>\r\n          </div>\r\n        </TabsContent>\r\n\r\n        <TabsContent value=\"source\" className=\"space-y-6\">\r\n          <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\r\n            <Card>\r\n              <CardHeader>\r\n                <CardTitle>Distribuição por Origem</CardTitle>\r\n                <p className=\"text-sm text-muted-foreground\">\r\n                  Visualização em {chartType === \"pie\" ? \"pizza\" : \"rosquinha\"}\r\n                </p>\r\n              </CardHeader>\r\n              <CardContent className=\"flex justify-center\">{renderChart(chartData.source)}</CardContent>\r\n            </Card>\r\n\r\n            <Card>\r\n              <CardHeader>\r\n                <CardTitle>Detalhamento por Origem</CardTitle>\r\n              </CardHeader>\r\n              <CardContent>\r\n                <div className=\"space-y-4\">\r\n                  {chartData.source.map((item, index) => (\r\n                    <div key={item.name} className=\"flex items-center justify-between\">\r\n                      <div className=\"flex items-center space-x-2\">\r\n                        <div\r\n                          className=\"w-3 h-3 rounded-full\"\r\n                          style={{ backgroundColor: COLORS[index % COLORS.length] }}\r\n                        />\r\n                        <span className=\"text-sm font-medium\">{item.name}</span>\r\n                      </div>\r\n                      <div className=\"flex items-center space-x-2\">\r\n                        <span className=\"text-sm text-muted-foreground\">{item.percentage}%</span>\r\n                        <span className=\"text-sm font-bold\">{item.value}</span>\r\n                      </div>\r\n                    </div>\r\n                  ))}\r\n                </div>\r\n              </CardContent>\r\n            </Card>\r\n          </div>\r\n        </TabsContent>\r\n\r\n        <TabsContent value=\"priority\" className=\"space-y-6\">\r\n          <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\r\n            <Card>\r\n              <CardHeader>\r\n                <CardTitle>Distribuição por Prioridade</CardTitle>\r\n                <p className=\"text-sm text-muted-foreground\">\r\n                  Visualização em {chartType === \"pie\" ? \"pizza\" : \"rosquinha\"}\r\n                </p>\r\n              </CardHeader>\r\n              <CardContent className=\"flex justify-center\">{renderChart(chartData.priority)}</CardContent>\r\n            </Card>\r\n\r\n            <Card>\r\n              <CardHeader>\r\n                <CardTitle>Detalhamento por Prioridade</CardTitle>\r\n              </CardHeader>\r\n              <CardContent>\r\n                <div className=\"space-y-4\">\r\n                  {chartData.priority.map((item, index) => (\r\n                    <div key={item.name} className=\"flex items-center justify-between\">\r\n                      <div className=\"flex items-center space-x-2\">\r\n                        <div\r\n                          className=\"w-3 h-3 rounded-full\"\r\n                          style={{ backgroundColor: COLORS[index % COLORS.length] }}\r\n                        />\r\n                        <span className=\"text-sm font-medium\">{item.name}</span>\r\n                      </div>\r\n                      <div className=\"flex items-center space-x-2\">\r\n                        <span className=\"text-sm text-muted-foreground\">{item.percentage}%</span>\r\n                        <span className=\"text-sm font-bold\">{item.value}</span>\r\n                      </div>\r\n                    </div>\r\n                  ))}\r\n                </div>\r\n              </CardContent>\r\n            </Card>\r\n          </div>\r\n        </TabsContent>\r\n\r\n        <TabsContent value=\"value\" className=\"space-y-6\">\r\n          <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\r\n            <Card>\r\n              <CardHeader>\r\n                <CardTitle>Distribuição por Valor</CardTitle>\r\n                <p className=\"text-sm text-muted-foreground\">\r\n                  Visualização em {chartType === \"pie\" ? \"pizza\" : \"rosquinha\"}\r\n                </p>\r\n              </CardHeader>\r\n              <CardContent className=\"flex justify-center\">{renderChart(chartData.value)}</CardContent>\r\n            </Card>\r\n\r\n            <Card>\r\n              <CardHeader>\r\n                <CardTitle>Detalhamento por Valor</CardTitle>\r\n              </CardHeader>\r\n              <CardContent>\r\n                <div className=\"space-y-4\">\r\n                  {chartData.value.map((item, index) => (\r\n                    <div key={item.name} className=\"flex items-center justify-between\">\r\n                      <div className=\"flex items-center space-x-2\">\r\n                        <div\r\n                          className=\"w-3 h-3 rounded-full\"\r\n                          style={{ backgroundColor: COLORS[index % COLORS.length] }}\r\n                        />\r\n                        <span className=\"text-sm font-medium\">{item.name}</span>\r\n                      </div>\r\n                      <div className=\"flex items-center space-x-2\">\r\n                        <span className=\"text-sm text-muted-foreground\">{item.percentage}%</span>\r\n                        <span className=\"text-sm font-bold\">{item.value}</span>\r\n                      </div>\r\n                    </div>\r\n                  ))}\r\n                </div>\r\n              </CardContent>\r\n            </Card>\r\n          </div>\r\n        </TabsContent>\r\n      </Tabs>\r\n    </div>\r\n  )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Projetos\\Back_endCrm\\kanbanproject1\\components\\mass-action-assistant-dialog.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projetos\\Back_endCrm\\kanbanproject1\\components\\mass-action-logs-dialog.tsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'open' is defined but never used.","line":49,"column":18,"nodeType":"Identifier","messageId":"unusedVar","endLine":49,"endColumn":31,"suggestions":[{"messageId":"removeVar","data":{"varName":"open"},"fix":{"range":[1585,1598],"text":""},"desc":"Remove unused variable 'open'."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'refreshJobs'. Either include it or remove the dependency array.","line":89,"column":6,"nodeType":"ArrayExpression","endLine":89,"endColumn":12,"suggestions":[{"desc":"Update the dependencies array to be: [open, refreshJobs]","fix":{"range":[2821,2827],"text":"[open, refreshJobs]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\"\n\nimport { useEffect, useMemo, useState } from \"react\"\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogDescription } from \"@/components/ui/dialog\"\nimport { Button } from \"@/components/ui/button\"\nimport { Badge } from \"@/components/ui/badge\"\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from \"@/components/ui/table\"\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\"\nimport { ScrollArea } from \"@/components/ui/scroll-area\"\nimport { Loader2, ListChecks } from \"lucide-react\"\n\ntype JobStatus = \"queued\" | \"running\" | \"completed\" | \"failed\"\ntype ItemStatus = \"queued\" | \"sent\" | \"failed\" | \"skipped\"\n\ntype JobRow = {\n  id: string\n  createdBy: any\n  status: JobStatus\n  totalLeads: number\n  totalItems: number\n  sentItems: number\n  failedItems: number\n  templateSnapshot?: any\n  createdAt: string\n}\n\ntype ItemRow = {\n  id: string\n  leadId: string\n  phone: string\n  status: ItemStatus\n  errorMessage: string | null\n  sentAt: string | null\n}\n\nfunction statusBadge(status: string) {\n  if (status === \"completed\") return <Badge className=\"bg-green-100 text-green-800 border-green-200\">Concluído</Badge>\n  if (status === \"running\") return <Badge className=\"bg-blue-100 text-blue-800 border-blue-200\">Em andamento</Badge>\n  if (status === \"failed\") return <Badge className=\"bg-red-100 text-red-800 border-red-200\">Falhou</Badge>\n  return <Badge variant=\"secondary\">Em fila</Badge>\n}\n\nexport default function MassActionLogsDialog({\n  open,\n  onOpenChange,\n  initialJobId,\n}: {\n  open: boolean\n  onOpenChange: (open: boolean) => void\n  initialJobId: string | null\n}) {\n  const [jobs, setJobs] = useState<JobRow[]>([])\n  const [selectedJobId, setSelectedJobId] = useState<string | null>(null)\n  const [items, setItems] = useState<ItemRow[]>([])\n  const [isLoadingJobs, setIsLoadingJobs] = useState(false)\n  const [isLoadingItems, setIsLoadingItems] = useState(false)\n\n  useEffect(() => {\n    if (!open) return\n    setSelectedJobId(initialJobId)\n  }, [open, initialJobId])\n\n  const refreshJobs = async () => {\n    setIsLoadingJobs(true)\n    try {\n      const res = await fetch(\"/api/mass-actions?limit=50\")\n      const data = (await res.json()) as JobRow[]\n      setJobs(Array.isArray(data) ? data : [])\n      if (!selectedJobId && Array.isArray(data) && data[0]?.id) setSelectedJobId(data[0].id)\n    } finally {\n      setIsLoadingJobs(false)\n    }\n  }\n\n  const refreshItems = async (jobId: string) => {\n    setIsLoadingItems(true)\n    try {\n      const res = await fetch(`/api/mass-actions/${jobId}/items?limit=500&offset=0`)\n      const data = (await res.json()) as ItemRow[]\n      setItems(Array.isArray(data) ? data : [])\n    } finally {\n      setIsLoadingItems(false)\n    }\n  }\n\n  useEffect(() => {\n    if (!open) return\n    refreshJobs()\n  }, [open])\n\n  useEffect(() => {\n    if (!open) return\n    if (!selectedJobId) return\n    refreshItems(selectedJobId)\n  }, [open, selectedJobId])\n\n  const selectedJob = useMemo(() => jobs.find((j) => j.id === selectedJobId) || null, [jobs, selectedJobId])\n\n  const itemStats = useMemo(() => {\n    const sent = items.filter((i) => i.status === \"sent\").length\n    const failed = items.filter((i) => i.status === \"failed\").length\n    const queued = items.filter((i) => i.status === \"queued\").length\n    return { sent, failed, queued }\n  }, [items])\n\n  return (\n    <Dialog open={open} onOpenChange={onOpenChange}>\n      <DialogContent className=\"max-w-6xl\">\n        <DialogHeader>\n          <DialogTitle className=\"flex items-center gap-2\">\n            <ListChecks className=\"h-5 w-5\" />\n            Logs de Disparo\n          </DialogTitle>\n          <DialogDescription>Acompanhe o status individual das mensagens e o histórico de execuções.</DialogDescription>\n        </DialogHeader>\n\n        <div className=\"grid grid-cols-1 lg:grid-cols-[380px_1fr] gap-4\">\n          <div className=\"rounded-md border\">\n            <div className=\"flex items-center justify-between p-3 border-b\">\n              <div className=\"text-sm font-medium\">Execuções</div>\n              <Button variant=\"outline\" size=\"sm\" onClick={refreshJobs} disabled={isLoadingJobs}>\n                {isLoadingJobs ? <Loader2 className=\"h-4 w-4 animate-spin\" /> : \"Atualizar\"}\n              </Button>\n            </div>\n            <ScrollArea className=\"h-[520px]\">\n              <div className=\"p-2 space-y-2\">\n                {jobs.length === 0 ? (\n                  <div className=\"text-sm text-muted-foreground p-3\">Nenhum disparo encontrado.</div>\n                ) : (\n                  jobs.map((j) => (\n                    <button\n                      key={j.id}\n                      type=\"button\"\n                      onClick={() => setSelectedJobId(j.id)}\n                      className={`w-full text-left rounded-md border px-3 py-2 hover:bg-muted transition-colors ${\n                        selectedJobId === j.id ? \"bg-muted\" : \"bg-background\"\n                      }`}\n                    >\n                      <div className=\"flex items-center justify-between gap-2\">\n                        <div className=\"text-sm font-medium truncate\">{j.templateSnapshot?.name || \"Template\"}</div>\n                        {statusBadge(j.status)}\n                      </div>\n                      <div className=\"mt-1 text-xs text-muted-foreground truncate\">{new Date(j.createdAt).toLocaleString()}</div>\n                      <div className=\"mt-2 grid grid-cols-3 gap-2\">\n                        <div className=\"rounded border p-2\">\n                          <div className=\"text-[10px] text-muted-foreground\">Leads</div>\n                          <div className=\"text-sm font-semibold\">{j.totalLeads}</div>\n                        </div>\n                        <div className=\"rounded border p-2\">\n                          <div className=\"text-[10px] text-muted-foreground\">Enviadas</div>\n                          <div className=\"text-sm font-semibold\">{j.sentItems}</div>\n                        </div>\n                        <div className=\"rounded border p-2\">\n                          <div className=\"text-[10px] text-muted-foreground\">Falhas</div>\n                          <div className=\"text-sm font-semibold\">{j.failedItems}</div>\n                        </div>\n                      </div>\n                    </button>\n                  ))\n                )}\n              </div>\n            </ScrollArea>\n          </div>\n\n          <div className=\"rounded-md border\">\n            <div className=\"flex items-center justify-between p-3 border-b\">\n              <div className=\"text-sm font-medium\">Detalhes</div>\n              {selectedJobId && (\n                <Button variant=\"outline\" size=\"sm\" onClick={() => refreshItems(selectedJobId)} disabled={isLoadingItems}>\n                  {isLoadingItems ? <Loader2 className=\"h-4 w-4 animate-spin\" /> : \"Atualizar\"}\n                </Button>\n              )}\n            </div>\n\n            {!selectedJob ? (\n              <div className=\"p-4 text-sm text-muted-foreground\">Selecione um disparo para ver os detalhes.</div>\n            ) : (\n              <div className=\"p-4 space-y-4\">\n                <div className=\"flex items-start justify-between gap-3\">\n                  <div>\n                    <div className=\"text-sm font-semibold\">{selectedJob.templateSnapshot?.name || \"Template\"}</div>\n                    <div className=\"text-xs text-muted-foreground\">Job: {selectedJob.id}</div>\n                    <div className=\"text-xs text-muted-foreground\">Autor: {selectedJob.createdBy?.name || \"-\"}</div>\n                  </div>\n                  {statusBadge(selectedJob.status)}\n                </div>\n\n                <div className=\"grid grid-cols-3 gap-3\">\n                  <div className=\"rounded-md border p-3\">\n                    <div className=\"text-xs text-muted-foreground\">Mensagens</div>\n                    <div className=\"text-lg font-semibold\">{selectedJob.totalItems}</div>\n                  </div>\n                  <div className=\"rounded-md border p-3\">\n                    <div className=\"text-xs text-muted-foreground\">Enviadas</div>\n                    <div className=\"text-lg font-semibold\">{itemStats.sent}</div>\n                  </div>\n                  <div className=\"rounded-md border p-3\">\n                    <div className=\"text-xs text-muted-foreground\">Falhas</div>\n                    <div className=\"text-lg font-semibold\">{itemStats.failed}</div>\n                  </div>\n                </div>\n\n                <Tabs defaultValue=\"itens\">\n                  <TabsList>\n                    <TabsTrigger value=\"itens\">Itens</TabsTrigger>\n                    <TabsTrigger value=\"erros\">Erros</TabsTrigger>\n                  </TabsList>\n                  <TabsContent value=\"itens\" className=\"mt-3\">\n                    <ScrollArea className=\"h-[320px] rounded-md border\">\n                      <Table>\n                        <TableHeader>\n                          <TableRow>\n                            <TableHead>Lead</TableHead>\n                            <TableHead>Telefone</TableHead>\n                            <TableHead>Status</TableHead>\n                            <TableHead>Horário</TableHead>\n                          </TableRow>\n                        </TableHeader>\n                        <TableBody>\n                          {items.map((it) => (\n                            <TableRow key={it.id}>\n                              <TableCell className=\"font-mono text-xs\">{it.leadId}</TableCell>\n                              <TableCell className=\"font-mono text-xs\">{it.phone}</TableCell>\n                              <TableCell>{statusBadge(it.status)}</TableCell>\n                              <TableCell className=\"text-xs text-muted-foreground\">\n                                {it.sentAt ? new Date(it.sentAt).toLocaleString() : \"-\"}\n                              </TableCell>\n                            </TableRow>\n                          ))}\n                        </TableBody>\n                      </Table>\n                    </ScrollArea>\n                  </TabsContent>\n                  <TabsContent value=\"erros\" className=\"mt-3\">\n                    <ScrollArea className=\"h-[320px] rounded-md border\">\n                      <Table>\n                        <TableHeader>\n                          <TableRow>\n                            <TableHead>Telefone</TableHead>\n                            <TableHead>Motivo</TableHead>\n                          </TableRow>\n                        </TableHeader>\n                        <TableBody>\n                          {items\n                            .filter((i) => i.status === \"failed\")\n                            .map((it) => (\n                              <TableRow key={it.id}>\n                                <TableCell className=\"font-mono text-xs\">{it.phone}</TableCell>\n                                <TableCell className=\"text-xs\">{it.errorMessage || \"Falha\"}</TableCell>\n                              </TableRow>\n                            ))}\n                        </TableBody>\n                      </Table>\n                    </ScrollArea>\n                  </TabsContent>\n                </Tabs>\n              </div>\n            )}\n          </div>\n        </div>\n      </DialogContent>\n    </Dialog>\n  )\n}\n\n","usedDeprecatedRules":[]},{"filePath":"C:\\Projetos\\Back_endCrm\\kanbanproject1\\components\\mass-action\\mass-action-audience-step.tsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'patch' is defined but never used.","line":36,"column":14,"nodeType":"Identifier","messageId":"unusedVar","endLine":36,"endColumn":43,"suggestions":[{"messageId":"removeVar","data":{"varName":"patch"},"fix":{"range":[1136,1165],"text":""},"desc":"Remove unused variable 'patch'."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\"\n\nimport { Badge } from \"@/components/ui/badge\"\nimport { Button } from \"@/components/ui/button\"\nimport { Card, CardContent } from \"@/components/ui/card\"\nimport { Checkbox } from \"@/components/ui/checkbox\"\nimport { Input } from \"@/components/ui/input\"\nimport { Label } from \"@/components/ui/label\"\nimport { ScrollArea } from \"@/components/ui/scroll-area\"\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\"\nimport { Separator } from \"@/components/ui/separator\"\nimport { Loader2 } from \"lucide-react\"\nimport type { Tag as TagType } from \"@/lib/api/tags-api\"\nimport type { AudienceComputed, AudienceState, Funnel, LeadLimitMode, LeadOrder, TagMode } from \"./mass-action-types\"\n\nconst toggle = (arr: string[], value: string) => {\n  const s = new Set(arr)\n  if (s.has(value)) s.delete(value)\n  else s.add(value)\n  return Array.from(s)\n}\n\nexport function MassActionAudienceStep({\n  funnels,\n  availableTags,\n  state,\n  computed,\n  onChange,\n  onNext,\n  onReset,\n}: {\n  funnels: Funnel[]\n  availableTags: TagType[]\n  state: AudienceState\n  computed: AudienceComputed\n  onChange: (patch: Partial<AudienceState>) => void\n  onNext: () => void\n  onReset: () => void\n}) {\n  return (\n    <div className=\"space-y-4\">\n      <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n        <div className=\"space-y-2\">\n          <Label>Funis</Label>\n          <ScrollArea className=\"h-40 rounded-md border p-2\">\n            <div className=\"space-y-2\">\n              {funnels\n                .filter((f) => f.isActive !== false)\n                .map((f) => (\n                  <label key={f.id} className=\"flex items-center gap-2 text-sm\">\n                    <Checkbox\n                      checked={state.funnelIds.includes(f.id)}\n                      onCheckedChange={() => onChange({ funnelIds: toggle(state.funnelIds, f.id) })}\n                    />\n                    <span>{f.name}</span>\n                  </label>\n                ))}\n            </div>\n          </ScrollArea>\n        </div>\n\n        <div className=\"space-y-2\">\n          <Label>Etapas</Label>\n          <ScrollArea className=\"h-40 rounded-md border p-2\">\n            <div className=\"space-y-2\">\n              {computed.availableStages.length === 0 ? (\n                <div className=\"text-sm text-muted-foreground\">Selecione ao menos 1 funil.</div>\n              ) : (\n                computed.availableStages.map((s) => (\n                  <label key={`${s.id}_${s.funnelName}`} className=\"flex items-center gap-2 text-sm\">\n                    <Checkbox\n                      checked={state.stageIds.includes(s.id)}\n                      onCheckedChange={() => onChange({ stageIds: toggle(state.stageIds, s.id) })}\n                    />\n                    <span className=\"truncate\">{s.title}</span>\n                    <Badge variant=\"secondary\" className=\"ml-auto\">\n                      {s.funnelName}\n                    </Badge>\n                  </label>\n                ))\n              )}\n            </div>\n          </ScrollArea>\n          <div className=\"text-xs text-muted-foreground\">Deixe vazio para considerar todas as etapas.</div>\n        </div>\n      </div>\n\n      <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n        <div className=\"space-y-2\">\n          <Label>Data inicial</Label>\n          <Input type=\"date\" value={state.dateStart} onChange={(e) => onChange({ dateStart: e.target.value })} />\n        </div>\n        <div className=\"space-y-2\">\n          <Label>Data final</Label>\n          <Input type=\"date\" value={state.dateEnd} onChange={(e) => onChange({ dateEnd: e.target.value })} />\n        </div>\n        <div className=\"space-y-2\">\n          <Label>Lógica de tags</Label>\n          <Select value={state.tagMode} onValueChange={(v) => onChange({ tagMode: v as TagMode })}>\n            <SelectTrigger>\n              <SelectValue />\n            </SelectTrigger>\n            <SelectContent>\n              <SelectItem value=\"all\">Contém todas as tags</SelectItem>\n              <SelectItem value=\"any\">Contém pelo menos uma</SelectItem>\n            </SelectContent>\n          </Select>\n        </div>\n      </div>\n\n      <div className=\"space-y-2\">\n        <Label>Tags</Label>\n        <ScrollArea className=\"h-32 rounded-md border p-2\">\n          <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-2\">\n            {availableTags.map((t) => (\n              <label key={t.id} className=\"flex items-center gap-2 text-sm\">\n                <Checkbox checked={state.tagIds.includes(t.id)} onCheckedChange={() => onChange({ tagIds: toggle(state.tagIds, t.id) })} />\n                <span className=\"truncate\">{t.name}</span>\n              </label>\n            ))}\n          </div>\n        </ScrollArea>\n        <div className=\"text-xs text-muted-foreground\">Deixe vazio para considerar todas as tags.</div>\n      </div>\n\n      <Separator />\n\n      <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n        <div className=\"space-y-2\">\n          <Label>Quantidade de leads</Label>\n          <Select value={state.leadLimitMode} onValueChange={(v) => onChange({ leadLimitMode: v as LeadLimitMode })}>\n            <SelectTrigger>\n              <SelectValue />\n            </SelectTrigger>\n            <SelectContent>\n              <SelectItem value=\"all\">Todos os filtrados</SelectItem>\n              <SelectItem value=\"custom\">Quantidade personalizada</SelectItem>\n            </SelectContent>\n          </Select>\n        </div>\n        <div className=\"space-y-2\">\n          <Label>Valor</Label>\n          <Input\n            type=\"number\"\n            min={1}\n            disabled={state.leadLimitMode !== \"custom\"}\n            value={state.customLeadLimit}\n            onChange={(e) => onChange({ customLeadLimit: Number(e.target.value || 0) })}\n          />\n        </div>\n        <div className=\"space-y-2\">\n          <Label>Ordem</Label>\n          <Select value={state.leadOrder} onValueChange={(v) => onChange({ leadOrder: v as LeadOrder })}>\n            <SelectTrigger>\n              <SelectValue />\n            </SelectTrigger>\n            <SelectContent>\n              <SelectItem value=\"oldest\">Mais antigos primeiro</SelectItem>\n              <SelectItem value=\"newest\">Mais recentes primeiro</SelectItem>\n            </SelectContent>\n          </Select>\n        </div>\n      </div>\n\n      <Card>\n        <CardContent className=\"p-3 flex items-center justify-between\">\n          <div className=\"text-sm\">\n            {computed.isLeadsLoading ? (\n              <span className=\"inline-flex items-center gap-2 text-muted-foreground\">\n                <Loader2 className=\"h-4 w-4 animate-spin\" /> Carregando leads…\n              </span>\n            ) : (\n              <span>\n                Total de leads encontrados: <span className=\"font-semibold\">{computed.filteredCount}</span>\n              </span>\n            )}\n          </div>\n          <div className=\"text-sm text-muted-foreground\">\n            Alvo do disparo: <span className=\"font-medium text-foreground\">{computed.targetLeadCount}</span> leads\n          </div>\n        </CardContent>\n      </Card>\n\n      <div className=\"flex justify-end gap-2\">\n        <Button variant=\"outline\" onClick={onReset}>\n          Limpar\n        </Button>\n        <Button onClick={onNext} disabled={state.funnelIds.length === 0 || computed.targetLeadCount === 0}>\n          Próximo\n        </Button>\n      </div>\n    </div>\n  )\n}\n\n","usedDeprecatedRules":[]},{"filePath":"C:\\Projetos\\Back_endCrm\\kanbanproject1\\components\\mass-action\\mass-action-review-step.tsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'jobId' is defined but never used.","line":30,"column":16,"nodeType":"Identifier","messageId":"unusedVar","endLine":30,"endColumn":30,"suggestions":[{"messageId":"removeVar","data":{"varName":"jobId"},"fix":{"range":[823,837],"text":""},"desc":"Remove unused variable 'jobId'."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\"\n\nimport { useEffect, useState } from \"react\"\nimport { Button } from \"@/components/ui/button\"\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\"\nimport { Checkbox } from \"@/components/ui/checkbox\"\nimport { Loader2 } from \"lucide-react\"\nimport type { MessageTemplate } from \"@/lib/api/message-templates-api\"\nimport { renderTemplateAsText, type MassActionLead } from \"@/lib/mass-action-utils\"\n\nexport function MassActionReviewStep({\n  template,\n  sampleLead,\n  totalsLeadCount,\n  totalsItemCount,\n  computedMinDelay,\n  isSending,\n  lastJobId,\n  onOpenLogs,\n  onBack,\n  onConfirm,\n}: {\n  template: MessageTemplate\n  sampleLead: MassActionLead\n  totalsLeadCount: number\n  totalsItemCount: number\n  computedMinDelay: number\n  isSending: boolean\n  lastJobId: string | null\n  onOpenLogs: (jobId?: string) => void\n  onBack: () => void\n  onConfirm: () => void\n}) {\n  const [confirmed, setConfirmed] = useState(false)\n\n  useEffect(() => {\n    if (isSending) return\n    setConfirmed(false)\n  }, [isSending, template.id])\n\n  return (\n    <div className=\"space-y-4\">\n      <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n        <Card className=\"md:col-span-2\">\n          <CardHeader className=\"pb-2\">\n            <CardTitle className=\"text-base\">Confirmação</CardTitle>\n          </CardHeader>\n          <CardContent className=\"space-y-3\">\n            <div className=\"text-sm\">\n              Você está prestes a disparar mensagens para <span className=\"font-semibold\">{totalsLeadCount}</span> leads.\n              Deseja continuar?\n            </div>\n            <div className=\"grid grid-cols-2 gap-3\">\n              <div className=\"rounded-md border p-3\">\n                <div className=\"text-xs text-muted-foreground\">Mensagens estimadas</div>\n                <div className=\"text-lg font-semibold\">{totalsItemCount}</div>\n              </div>\n              <div className=\"rounded-md border p-3\">\n                <div className=\"text-xs text-muted-foreground\">Ritmo</div>\n                <div className=\"text-lg font-semibold\">~{Math.floor(60000 / Math.max(1, computedMinDelay))}/min</div>\n              </div>\n            </div>\n\n            {lastJobId && (\n              <div className=\"rounded-md border p-3 flex items-center justify-between\">\n                <div className=\"text-sm\">\n                  Job: <span className=\"font-mono text-xs\">{lastJobId}</span>\n                </div>\n                <Button variant=\"outline\" onClick={() => onOpenLogs(lastJobId)}>\n                  Ver logs\n                </Button>\n              </div>\n            )}\n\n            <label className=\"flex items-center gap-2 text-sm\">\n              <Checkbox checked={confirmed} onCheckedChange={(v) => setConfirmed(Boolean(v))} />\n              <span>Confirmo que revisei o preview e aceito disparar em lote.</span>\n            </label>\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardHeader className=\"pb-2\">\n            <CardTitle className=\"text-base\">Pré-visualização (exemplo)</CardTitle>\n          </CardHeader>\n          <CardContent className=\"space-y-2\">\n            <div className=\"text-xs text-muted-foreground\">Modelo: {template.name}</div>\n            <div className=\"rounded-md border bg-muted/30 p-3 text-sm whitespace-pre-wrap\">\n              {renderTemplateAsText(template, { lead: sampleLead, stageName: \"Prospecção\", tagsText: \"SaaS, Imobiliário\" })}\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n\n      <div className=\"flex justify-between gap-2\">\n        <Button variant=\"outline\" onClick={onBack} disabled={isSending}>\n          Voltar\n        </Button>\n        <Button onClick={onConfirm} disabled={isSending || totalsItemCount <= 0 || !confirmed}>\n          {isSending ? (\n            <span className=\"inline-flex items-center gap-2\">\n              <Loader2 className=\"h-4 w-4 animate-spin\" /> Disparando…\n            </span>\n          ) : (\n            \"Confirmar disparo\"\n          )}\n        </Button>\n      </div>\n    </div>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Projetos\\Back_endCrm\\kanbanproject1\\components\\mass-action\\mass-action-template-step.tsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'patch' is defined but never used.","line":25,"column":19,"nodeType":"Identifier","messageId":"unusedVar","endLine":25,"endColumn":45,"suggestions":[{"messageId":"removeVar","data":{"varName":"patch"},"fix":{"range":[817,843],"text":""},"desc":"Remove unused variable 'patch'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'patch' is defined but never used.","line":26,"column":24,"nodeType":"Identifier","messageId":"unusedVar","endLine":26,"endColumn":55,"suggestions":[{"messageId":"removeVar","data":{"varName":"patch"},"fix":{"range":[876,907],"text":""},"desc":"Remove unused variable 'patch'."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\"\n\nimport { Alert, AlertDescription, AlertTitle } from \"@/components/ui/alert\"\nimport { Button } from \"@/components/ui/button\"\nimport { Input } from \"@/components/ui/input\"\nimport { Label } from \"@/components/ui/label\"\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\"\nimport { ShieldAlert } from \"lucide-react\"\nimport { MessageTemplatePreview } from \"@/components/message-template-preview\"\nimport type { ModelState, TemplateComputed, ThrottlingState } from \"./mass-action-types\"\n\nexport function MassActionTemplateStep({\n  model,\n  templateComputed,\n  throttling,\n  onChangeModel,\n  onChangeThrottling,\n  onOpenTemplates,\n  onBack,\n  onNext,\n}: {\n  model: ModelState\n  templateComputed: TemplateComputed\n  throttling: ThrottlingState\n  onChangeModel: (patch: Partial<ModelState>) => void\n  onChangeThrottling: (patch: Partial<ThrottlingState>) => void\n  onOpenTemplates: () => void\n  onBack: () => void\n  onNext: () => void\n}) {\n  return (\n    <div className=\"space-y-4\">\n      <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n        <div className=\"space-y-2 md:col-span-2\">\n          <Label>Modelo de mensagem</Label>\n          <Select\n            value={model.templateId}\n            onValueChange={(v) => {\n              onChangeModel({ templateId: v, activeFlowStepId: undefined })\n            }}\n          >\n            <SelectTrigger>\n              <SelectValue placeholder={templateComputed.isTemplatesLoading ? \"Carregando…\" : \"Selecione um modelo\"} />\n            </SelectTrigger>\n            <SelectContent>\n              {templateComputed.templates.map((t) => (\n                <SelectItem key={t.id} value={t.id}>\n                  {t.name}\n                </SelectItem>\n              ))}\n            </SelectContent>\n          </Select>\n          <div className=\"flex gap-2\">\n            <Button variant=\"outline\" onClick={onOpenTemplates}>\n              Criar novo modelo\n            </Button>\n          </div>\n        </div>\n\n        <div className=\"space-y-2\">\n          <Label>Envio seguro</Label>\n          <div className=\"grid grid-cols-3 gap-3\">\n            <div className=\"space-y-1\">\n              <div className=\"text-xs text-muted-foreground\">Delay (ms)</div>\n              <Input\n                type=\"number\"\n                min={0}\n                value={throttling.delayMs}\n                onChange={(e) => onChangeThrottling({ delayMs: Number(e.target.value || 0) })}\n              />\n            </div>\n            <div className=\"space-y-1\">\n              <div className=\"text-xs text-muted-foreground\">Máx./min</div>\n              <Input\n                type=\"number\"\n                min={1}\n                value={throttling.maxPerMinute}\n                onChange={(e) => onChangeThrottling({ maxPerMinute: Math.max(1, Number(e.target.value || 1)) })}\n              />\n            </div>\n            <div className=\"space-y-1\">\n              <div className=\"text-xs text-muted-foreground\">Máx./hora</div>\n              <Input\n                type=\"number\"\n                min={1}\n                value={throttling.maxPerHour}\n                onChange={(e) => onChangeThrottling({ maxPerHour: Math.max(1, Number(e.target.value || 1)) })}\n              />\n            </div>\n          </div>\n          <div className=\"text-xs text-muted-foreground\">\n            Delay efetivo: <span className=\"font-medium text-foreground\">{throttling.computedMinDelay}ms</span>\n          </div>\n        </div>\n      </div>\n\n      {throttling.showRiskWarning && (\n        <Alert variant=\"destructive\">\n          <ShieldAlert className=\"h-4 w-4\" />\n          <AlertTitle>Alerta de risco de bloqueio</AlertTitle>\n          <AlertDescription>\n            Configuração agressiva pode aumentar risco de bloqueio. Reduza o ritmo e valide o conteúdo antes de enviar.\n          </AlertDescription>\n        </Alert>\n      )}\n\n      {model.selectedTemplate && (\n        <div className=\"h-[420px] rounded-md border overflow-hidden\">\n          <MessageTemplatePreview\n            type={model.selectedTemplate.type}\n            content={model.selectedTemplate.content}\n            activeStepId={model.activeFlowStepId}\n            onStepChange={(sid) => onChangeModel({ activeFlowStepId: sid })}\n          />\n        </div>\n      )}\n\n      <div className=\"flex justify-between gap-2\">\n        <Button variant=\"outline\" onClick={onBack}>\n          Voltar\n        </Button>\n        <Button onClick={onNext} disabled={!model.selectedTemplate}>\n          Próximo\n        </Button>\n      </div>\n    </div>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Projetos\\Back_endCrm\\kanbanproject1\\components\\mass-action\\mass-action-types.ts","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'open' is defined but never used.","line":64,"column":18,"nodeType":"Identifier","messageId":"unusedVar","endLine":64,"endColumn":31,"suggestions":[{"messageId":"removeVar","data":{"varName":"open"},"fix":{"range":[1506,1519],"text":""},"desc":"Remove unused variable 'open'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'jobId' is defined but never used.","line":69,"column":16,"nodeType":"Identifier","messageId":"unusedVar","endLine":69,"endColumn":30,"suggestions":[{"messageId":"removeVar","data":{"varName":"jobId"},"fix":{"range":[1647,1661],"text":""},"desc":"Remove unused variable 'jobId'."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import type { Tag as TagType } from \"@/lib/api/tags-api\"\nimport type { MessageTemplate } from \"@/lib/api/message-templates-api\"\nimport type { MassActionLead } from \"@/lib/mass-action-utils\"\n\nexport type Funnel = {\n  id: string\n  name: string\n  isActive?: boolean\n  columns: Array<{ id: string; title: string }>\n}\n\nexport type TagMode = \"all\" | \"any\"\nexport type LeadLimitMode = \"all\" | \"custom\"\nexport type LeadOrder = \"oldest\" | \"newest\"\nexport type StepId = \"publico\" | \"modelo\" | \"revisao\"\n\nexport type AudienceState = {\n  funnelIds: string[]\n  stageIds: string[]\n  dateStart: string\n  dateEnd: string\n  tagIds: string[]\n  tagMode: TagMode\n  leadLimitMode: LeadLimitMode\n  customLeadLimit: number\n  leadOrder: LeadOrder\n}\n\nexport type ThrottlingState = {\n  delayMs: number\n  maxPerMinute: number\n  maxPerHour: number\n  computedMinDelay: number\n  showRiskWarning: boolean\n}\n\nexport type AudienceComputed = {\n  availableStages: Array<{ id: string; title: string; funnelName: string }>\n  isLeadsLoading: boolean\n  filteredCount: number\n  targetLeadCount: number\n  estimatedItemCount: number\n}\n\nexport type ModelState = {\n  templateId: string\n  selectedTemplate: MessageTemplate | null\n  activeFlowStepId?: string\n}\n\nexport type TemplateComputed = {\n  isTemplatesLoading: boolean\n  templates: MessageTemplate[]\n}\n\nexport type ReviewComputed = {\n  sampleLead: MassActionLead\n  totalsLeadCount: number\n  totalsItemCount: number\n}\n\nexport type MassActionAssistantBaseProps = {\n  open: boolean\n  onOpenChange: (open: boolean) => void\n  initialFunnelId: string\n  funnels: Funnel[]\n  availableTags: TagType[]\n  onOpenTemplates: () => void\n  onOpenLogs: (jobId?: string) => void\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Projetos\\Back_endCrm\\kanbanproject1\\components\\message-template-draft.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projetos\\Back_endCrm\\kanbanproject1\\components\\message-template-editor-buttons.tsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'stepId' is defined but never used.","line":25,"column":26,"nodeType":"Identifier","messageId":"unusedVar","endLine":25,"endColumn":52,"suggestions":[{"messageId":"removeVar","data":{"varName":"stepId"},"fix":{"range":[953,979],"text":""},"desc":"Remove unused variable 'stepId'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'next' is defined but never used.","line":26,"column":19,"nodeType":"Identifier","messageId":"unusedVar","endLine":26,"endColumn":30,"suggestions":[{"messageId":"removeVar","data":{"varName":"next"},"fix":{"range":[1007,1018],"text":""},"desc":"Remove unused variable 'next'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'fn' is defined but never used.","line":27,"column":27,"nodeType":"Identifier","messageId":"unusedVar","endLine":27,"endColumn":63,"suggestions":[{"messageId":"removeVar","data":{"varName":"fn"},"fix":{"range":[1054,1090],"text":""},"desc":"Remove unused variable 'fn'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'token' is defined but never used.","line":27,"column":33,"nodeType":"Identifier","messageId":"unusedVar","endLine":27,"endColumn":46,"suggestions":[{"messageId":"removeVar","data":{"varName":"token"},"fix":{"range":[1060,1073],"text":""},"desc":"Remove unused variable 'token'."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"The 'steps' conditional could make the dependencies of useMemo Hook (at line 30) change on every render. To fix this, wrap the initialization of 'steps' in its own useMemo() Hook.","line":29,"column":9,"nodeType":"VariableDeclarator","endLine":29,"endColumn":86},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"The 'steps' conditional could make the dependencies of useMemo Hook (at line 43) change on every render. To fix this, wrap the initialization of 'steps' in its own useMemo() Hook.","line":29,"column":9,"nodeType":"VariableDeclarator","endLine":29,"endColumn":86},{"ruleId":"no-unused-vars","severity":1,"message":"'addStep' is assigned a value but never used.","line":80,"column":9,"nodeType":"Identifier","messageId":"unusedVar","endLine":80,"endColumn":16},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'addStep' is assigned a value but never used.","line":80,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":80,"endColumn":16}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":8,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\"\n\nimport { useMemo, useRef, useState } from \"react\"\nimport { Button } from \"@/components/ui/button\"\nimport { Card } from \"@/components/ui/card\"\nimport { Input } from \"@/components/ui/input\"\nimport { Label } from \"@/components/ui/label\"\nimport { Select, SelectContent, SelectGroup, SelectItem, SelectLabel, SelectTrigger, SelectValue } from \"@/components/ui/select\"\nimport { Textarea } from \"@/components/ui/textarea\"\nimport { ArrowLeft, GitFork, Plus, Trash2, Video } from \"lucide-react\"\nimport type { Draft } from \"@/components/message-template-draft\"\nimport { insertAtCursor } from \"@/components/message-template-draft\"\nimport { Separator } from \"@/components/ui/separator\"\nimport { Badge } from \"@/components/ui/badge\"\n\nexport function MessageTemplateEditorButtons({\n  draft,\n  activeStepId,\n  onActiveStepIdChange,\n  onDraftChange,\n  registerInsertHandler,\n}: {\n  draft: Draft\n  activeStepId: string | undefined\n  onActiveStepIdChange: (stepId: string | undefined) => void\n  onDraftChange: (next: Draft) => void\n  registerInsertHandler: (fn: ((token: string) => void) | null) => void\n}) {\n  const steps: any[] = Array.isArray(draft.content?.steps) ? draft.content.steps : []\n  const activeStep = useMemo(() => steps.find((s) => s.id === activeStepId) || steps[0], [steps, activeStepId])\n  const activeButtons: any[] = Array.isArray(activeStep?.buttons) ? activeStep.buttons : []\n  const textRef = useRef<HTMLTextAreaElement | null>(null)\n  const activeText = String(activeStep?.text || \"\")\n  const fileInputRef = useRef<HTMLInputElement | null>(null)\n  const buttonFileInputRef = useRef<HTMLInputElement | null>(null)\n  const activeInputRef = useRef<HTMLInputElement | HTMLTextAreaElement | null>(null)\n  const [uploadingButtonId, setUploadingButtonId] = useState<string | null>(null)\n\n  // Find parent step (the step that links to the current step) to allow \"Back\" navigation\n  const parentStep = useMemo(() => {\n    if (!activeStep) return undefined\n    return steps.find((s) => Array.isArray(s.buttons) && s.buttons.some((b: any) => b.nextStepId === activeStep.id))\n  }, [steps, activeStep])\n\n  const updateStep = (stepId: string, patch: any) => {\n    const nextSteps = steps.map((s) => (s.id === stepId ? { ...s, ...patch } : s))\n    onDraftChange({ ...draft, content: { ...draft.content, steps: nextSteps } })\n  }\n\n  const handleFileUpload = (e: React.ChangeEvent<HTMLInputElement>) => {\n    const file = e.target.files?.[0]\n    if (!file || !activeStep) return\n\n    const reader = new FileReader()\n    reader.onload = (ev) => {\n      const dataUrl = ev.target?.result as string\n      updateStep(activeStep.id, { mediaDataUrl: dataUrl, mediaUrl: \"\" })\n    }\n    reader.readAsDataURL(file)\n  }\n\n  const handleButtonFileUpload = (e: React.ChangeEvent<HTMLInputElement>) => {\n    const file = e.target.files?.[0]\n    if (!file || !uploadingButtonId) return\n\n    const reader = new FileReader()\n    reader.onload = (ev) => {\n      const dataUrl = ev.target?.result as string\n      updateButton(uploadingButtonId, { feedbackMediaDataUrl: dataUrl, feedbackMediaUrl: \"\" })\n      setUploadingButtonId(null)\n    }\n    reader.readAsDataURL(file)\n  }\n\n  const triggerButtonUpload = (btnId: string) => {\n    setUploadingButtonId(btnId)\n    setTimeout(() => buttonFileInputRef.current?.click(), 0)\n  }\n\n  const addStep = () => {\n    const stepId = `step_${Date.now()}`\n    const nextSteps = [...steps, { id: stepId, title: `Nova etapa ${steps.length + 1}`, text: \"\", buttons: [] }]\n    onDraftChange({ ...draft, content: { ...draft.content, steps: nextSteps } })\n    onActiveStepIdChange(stepId)\n  }\n\n  const removeActiveStep = () => {\n    if (!activeStep) return\n    if (steps.length <= 1) {\n      alert(\"Você não pode remover a única etapa.\")\n      return\n    }\n    const ok = confirm(`Remover a etapa \"${activeStep.title}\" e todos os seus botões?`)\n    if (!ok) return\n\n    // Unlink from parent buttons\n    const nextStepsUnlinked = steps.map(s => ({\n        ...s,\n        buttons: (s.buttons || []).map((b: any) => b.nextStepId === activeStep.id ? { ...b, nextStepId: \"\" } : b)\n    }))\n    \n    const nextSteps = nextStepsUnlinked.filter((s) => s.id !== activeStep.id)\n    \n    // Determine fallback step\n    const fallbackId = parentStep?.id || nextSteps[0]?.id\n\n    onDraftChange({\n      ...draft,\n      content: { ...draft.content, steps: nextSteps, startStepId: draft.content?.startStepId === activeStep.id ? fallbackId : draft.content?.startStepId },\n    })\n    onActiveStepIdChange(fallbackId)\n  }\n\n  const addButton = () => {\n    if (!activeStep) return\n    const buttonId = `btn_${Date.now()}`\n    updateStep(activeStep.id, { buttons: [...activeButtons, { id: buttonId, label: \"\", nextStepId: \"\" }] })\n  }\n\n  const updateButton = (buttonId: string, patch: any) => {\n    if (!activeStep) return\n    updateStep(activeStep.id, { buttons: activeButtons.map((b) => (b.id === buttonId ? { ...b, ...patch } : b)) })\n  }\n\n  const removeButton = (buttonId: string) => {\n    if (!activeStep) return\n    updateStep(activeStep.id, { buttons: activeButtons.filter((b) => b.id !== buttonId) })\n  }\n\n  const handleActionChange = (buttonId: string, value: string, buttonLabel: string) => {\n    if (value === \"create_new_step\") {\n      const newStepId = `step_${Date.now()}`\n      // Create intelligent title based on button label\n      const newTitle = buttonLabel ? `Opção \"${buttonLabel}\"` : `Nova Etapa ${steps.length + 1}`\n      \n      const newStep = {\n        id: newStepId,\n        title: newTitle,\n        text: \"\",\n        buttons: []\n      }\n      \n      // Update buttons first\n      const updatedButtons = activeButtons.map(b => b.id === buttonId ? { ...b, nextStepId: newStepId } : b)\n      \n      // Update steps list: update current step with new button link, AND add the new step\n      const nextSteps = steps.map(s => s.id === activeStep.id ? { ...s, buttons: updatedButtons } : s)\n      const finalSteps = [...nextSteps, newStep]\n\n      onDraftChange({ ...draft, content: { ...draft.content, steps: finalSteps } })\n      \n      // Auto-navigate to the new step to continue flow\n      setTimeout(() => onActiveStepIdChange(newStepId), 50)\n    } else {\n      updateButton(buttonId, { nextStepId: value === \"no_step\" ? \"\" : value })\n    }\n  }\n\n  if (!activeStep) {\n    return <div className=\"text-sm text-muted-foreground\">Crie uma etapa para começar.</div>\n  }\n\n  const isStartStep = draft.content?.startStepId === activeStep.id || steps[0]?.id === activeStep.id\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Header de Navegação */}\n      <div className=\"flex items-center justify-between bg-muted/30 p-3 rounded-lg border\">\n        <div className=\"flex items-center gap-2\">\n            {parentStep && (\n                <Button variant=\"ghost\" size=\"icon\" className=\"h-8 w-8\" onClick={() => onActiveStepIdChange(parentStep.id)} title=\"Voltar para etapa anterior\">\n                    <ArrowLeft className=\"h-4 w-4\" />\n                </Button>\n            )}\n            <div>\n                <div className=\"flex items-center gap-2\">\n                    <span className=\"font-semibold text-sm\">{activeStep.title}</span>\n                    {isStartStep && <Badge variant=\"outline\" className=\"text-[10px] h-5\">Início</Badge>}\n                </div>\n                <div className=\"text-xs text-muted-foreground\">\n                    {parentStep ? `Vindo de: ${parentStep.title}` : \"Ponto de partida do fluxo\"}\n                </div>\n            </div>\n        </div>\n        <div className=\"flex items-center gap-2\">\n             {!isStartStep && (\n                <Button type=\"button\" variant=\"ghost\" size=\"sm\" onClick={removeActiveStep} className=\"text-destructive hover:text-destructive\">\n                    <Trash2 className=\"h-4 w-4 mr-2\" />\n                    Excluir etapa\n                </Button>\n             )}\n             {/* Fallback para navegação manual se necessário */}\n             <Select value={activeStep.id} onValueChange={onActiveStepIdChange}>\n                <SelectTrigger className=\"w-[30px] h-[30px] p-0 border-none shadow-none focus:ring-0\">\n                   <GitFork className=\"h-4 w-4 text-muted-foreground\" />\n                </SelectTrigger>\n                <SelectContent align=\"end\">\n                   <SelectGroup>\n                      <SelectLabel>Navegar para etapa</SelectLabel>\n                      {steps.map(s => (\n                          <SelectItem key={s.id} value={s.id}>{s.title}</SelectItem>\n                      ))}\n                   </SelectGroup>\n                </SelectContent>\n             </Select>\n        </div>\n      </div>\n\n      {/* Editor da Etapa */}\n      <div className=\"space-y-4\">\n        <div className=\"space-y-2\">\n          <Label>Título da Etapa (Interno)</Label>\n          <Input \n            value={String(activeStep.title || \"\")} \n            onChange={(e) => updateStep(activeStep.id, { title: e.target.value })} \n            placeholder=\"Ex: Menu Principal\"\n          />\n        </div>\n\n        <div className=\"space-y-2\">\n            <Label>Mídia (Opcional)</Label>\n            <div className=\"flex flex-col gap-3 p-3 border rounded-md bg-muted/20\">\n                <Select \n                    value={activeStep.mediaType || \"none\"} \n                    onValueChange={(v) => updateStep(activeStep.id, { mediaType: v })}\n                >\n                    <SelectTrigger>\n                        <SelectValue placeholder=\"Tipo de Mídia\" />\n                    </SelectTrigger>\n                    <SelectContent>\n                        <SelectItem value=\"none\">Nenhuma</SelectItem>\n                        <SelectItem value=\"image\">Imagem</SelectItem>\n                        <SelectItem value=\"video\">Vídeo</SelectItem>\n                    </SelectContent>\n                </Select>\n\n                {activeStep.mediaType && activeStep.mediaType !== \"none\" && (\n                    <div className=\"space-y-3\">\n                        <div className=\"flex gap-2\">\n                            <Input \n                                placeholder={activeStep.mediaType === \"image\" ? \"URL da Imagem (https://...)\" : \"URL do Vídeo (https://...)\"}\n                                value={String(activeStep.mediaUrl || \"\")}\n                                onChange={(e) => updateStep(activeStep.id, { mediaUrl: e.target.value, mediaDataUrl: \"\" })}\n                                className=\"flex-1\"\n                            />\n                            <div className=\"relative\">\n                                <Input\n                                    ref={fileInputRef}\n                                    type=\"file\"\n                                    accept={activeStep.mediaType === \"image\" ? \"image/*\" : \"video/*\"}\n                                    className=\"hidden\"\n                                    onChange={handleFileUpload}\n                                />\n                                <Button \n                                    type=\"button\" \n                                    variant=\"outline\" \n                                    onClick={() => fileInputRef.current?.click()}\n                                >\n                                    Upload\n                                </Button>\n                            </div>\n                        </div>\n                        \n                        {(activeStep.mediaUrl || activeStep.mediaDataUrl) && (\n                            <div className=\"relative w-full h-32 bg-black/5 rounded-md overflow-hidden flex items-center justify-center border\">\n                                {activeStep.mediaType === \"image\" ? (\n                                    <img \n                                        src={activeStep.mediaDataUrl || activeStep.mediaUrl} \n                                        alt=\"Preview\" \n                                        className=\"h-full object-contain\"\n                                    />\n                                ) : (\n                                    <video \n                                        src={activeStep.mediaDataUrl || activeStep.mediaUrl} \n                                        controls \n                                        className=\"h-full max-w-full\"\n                                    />\n                                )}\n                                <Button\n                                    type=\"button\"\n                                    variant=\"destructive\"\n                                    size=\"icon\"\n                                    className=\"absolute top-2 right-2 h-6 w-6\"\n                                    onClick={() => updateStep(activeStep.id, { mediaUrl: \"\", mediaDataUrl: \"\" })}\n                                >\n                                    <Trash2 className=\"h-3 w-3\" />\n                                </Button>\n                            </div>\n                        )}\n                    </div>\n                )}\n            </div>\n        </div>\n\n        <div className=\"space-y-2\">\n          <Label>Mensagem para o usuário *</Label>\n          <Textarea\n            ref={(el) => {\n              textRef.current = el\n            }}\n            value={activeText}\n            className=\"min-h-[120px]\"\n            placeholder=\"Ex: Olá! Selecione para onde você quer ser direcionado:\"\n            onFocus={(e) => {\n              activeInputRef.current = e.target\n              registerInsertHandler((token) => {\n                const next = insertAtCursor(activeText, e.target, token)\n                updateStep(activeStep.id, { text: next })\n              })\n            }}\n            onBlur={() => {\n                registerInsertHandler(null)\n                // Don't clear activeInputRef immediately if we want to support click-to-insert without keeping focus, \n                // but usually the handler is nulled on blur so it won't be called anyway.\n            }}\n            onChange={(e) => updateStep(activeStep.id, { text: e.target.value })}\n          />\n        </div>\n      </div>\n\n      <Separator />\n\n      {/* Lista de Botões */}\n      <div className=\"space-y-4\">\n        <div className=\"flex items-center justify-between\">\n          <Label className=\"text-base\">Botões de Opção</Label>\n          <Button type=\"button\" size=\"sm\" onClick={addButton} variant=\"secondary\">\n            <Plus className=\"h-4 w-4 mr-2\" />\n            Adicionar Opção\n          </Button>\n        </div>\n\n        <div className=\"space-y-4\">\n          {activeButtons.length === 0 ? (\n            <div className=\"text-center py-8 border-2 border-dashed rounded-lg text-muted-foreground text-sm\">\n              Esta etapa ainda não tem opções.<br/>\n              Adicione botões para criar caminhos no fluxo.\n            </div>\n          ) : (\n            activeButtons.map((b, index) => (\n              <Card key={b.id} className=\"p-4 relative group\">\n                <Button \n                    type=\"button\" \n                    variant=\"ghost\" \n                    size=\"icon\" \n                    className=\"absolute top-2 right-2 h-6 w-6 opacity-0 group-hover:opacity-100 transition-opacity text-muted-foreground hover:text-destructive\" \n                    onClick={() => removeButton(b.id)}\n                >\n                  <Trash2 className=\"h-3 w-3\" />\n                </Button>\n\n                <div className=\"grid grid-cols-1 gap-4\">\n                    {/* Linha 1: Rótulo e Ação Principal */}\n                    <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                        <div className=\"space-y-2\">\n                            <Label className=\"text-xs text-muted-foreground\">Texto do Botão</Label>\n                            <Input \n                                value={String(b.label || \"\")} \n                                onChange={(e) => updateButton(b.id, { label: e.target.value })} \n                                placeholder={`Opção ${index + 1}`}\n                                onFocus={(e) => {\n                                    activeInputRef.current = e.target\n                                    registerInsertHandler((token) => {\n                                        // Use current value from ref or event target to ensure freshness?\n                                        // b.label comes from closure, might be slightly stale if typing fast and not re-rendered?\n                                        // Actually controlled input updates state -> re-render -> new closure. It should be fine.\n                                        // But safer to read from e.target (which is activeInputRef.current)\n                                        const el = activeInputRef.current\n                                        if (el) {\n                                            const currentVal = el.value\n                                            const next = insertAtCursor(currentVal, el as any, token)\n                                            updateButton(b.id, { label: next })\n                                        }\n                                    })\n                                }}\n                                onBlur={() => registerInsertHandler(null)}\n                            />\n                        </div>\n                        <div className=\"space-y-2\">\n                            <Label className=\"text-xs text-muted-foreground\">Ação ao clicar</Label>\n                            <Select\n                                value={b.nextStepId || \"no_step\"}\n                                onValueChange={(v) => handleActionChange(b.id, v, b.label)}\n                            >\n                                <SelectTrigger className={!b.nextStepId ? \"text-muted-foreground\" : \"font-medium\"}>\n                                    <SelectValue placeholder=\"O que acontece depois?\" />\n                                </SelectTrigger>\n                                <SelectContent>\n                                    <SelectGroup>\n                                        <SelectLabel>Ações Rápidas</SelectLabel>\n                                        <SelectItem value=\"create_new_step\" className=\"text-blue-500 focus:text-blue-600 font-medium\">\n                                            + Nova Etapa (Mensagem ou Menu)\n                                        </SelectItem>\n                                        <SelectItem value=\"no_step\">\n                                            Encerrar fluxo (Nenhuma ação)\n                                        </SelectItem>\n                                    </SelectGroup>\n                                    <Separator className=\"my-1\" />\n                                    <SelectGroup>\n                                        <SelectLabel>Ir para etapa existente...</SelectLabel>\n                                        {steps.filter(s => s.id !== activeStep.id).map((s) => (\n                                            <SelectItem key={s.id} value={s.id}>\n                                                {s.title}\n                                            </SelectItem>\n                                        ))}\n                                        {steps.length <= 1 && (\n                                            <div className=\"px-2 py-1 text-xs text-muted-foreground\">Nenhuma outra etapa criada.</div>\n                                        )}\n                                    </SelectGroup>\n                                </SelectContent>\n                            </Select>\n                        </div>\n                    </div>\n\n                    {/* Linha 2: Mensagem intermediária (Opcional) */}\n                    <div className=\"space-y-3 pt-2 border-t border-dashed\">\n                         <div className=\"flex items-center justify-between\">\n                            <Label className=\"text-xs text-muted-foreground\">\n                                Mensagem de Resposta (Feedback)\n                            </Label>\n                         </div>\n                         \n                         {/* Tipo de Mídia da Resposta */}\n                         <div className=\"space-y-2\">\n                             <div className=\"flex gap-2\">\n                                <Select \n                                    value={b.feedbackMediaType || \"none\"} \n                                    onValueChange={(v) => updateButton(b.id, { feedbackMediaType: v })}\n                                >\n                                    <SelectTrigger className=\"h-8 text-xs w-[140px]\">\n                                        <SelectValue placeholder=\"Tipo Mídia\" />\n                                    </SelectTrigger>\n                                    <SelectContent>\n                                        <SelectItem value=\"none\">Apenas Texto</SelectItem>\n                                        <SelectItem value=\"image\">Com Imagem</SelectItem>\n                                        <SelectItem value=\"video\">Com Vídeo</SelectItem>\n                                    </SelectContent>\n                                </Select>\n\n                                <Input \n                                    value={String(b.feedbackText || \"\")}\n                                    onChange={(e) => updateButton(b.id, { feedbackText: e.target.value })}\n                                    placeholder=\"Ex: Aguarde, estou verificando...\"\n                                    className=\"text-sm h-8 flex-1\"\n                                    onFocus={(e) => {\n                                        activeInputRef.current = e.target\n                                        registerInsertHandler((token) => {\n                                            const el = activeInputRef.current\n                                            if (el) {\n                                                const currentVal = el.value\n                                                const next = insertAtCursor(currentVal, el as any, token)\n                                                updateButton(b.id, { feedbackText: next })\n                                            }\n                                        })\n                                    }}\n                                    onBlur={() => registerInsertHandler(null)}\n                                />\n                             </div>\n\n                             {/* Upload de Mídia se selecionado */}\n                             {b.feedbackMediaType && b.feedbackMediaType !== \"none\" && (\n                                <div className=\"flex gap-2 items-center bg-muted/20 p-2 rounded\">\n                                     <Input \n                                        placeholder={b.feedbackMediaType === \"image\" ? \"URL da Imagem\" : \"URL do Vídeo\"}\n                                        value={String(b.feedbackMediaUrl || \"\")}\n                                        onChange={(e) => updateButton(b.id, { feedbackMediaUrl: e.target.value, feedbackMediaDataUrl: \"\" })}\n                                        className=\"h-8 text-xs flex-1\"\n                                     />\n                                     <Button \n                                        type=\"button\" \n                                        variant=\"outline\" \n                                        size=\"sm\"\n                                        className=\"h-8\"\n                                        onClick={() => triggerButtonUpload(b.id)}\n                                     >\n                                        Upload\n                                     </Button>\n                                     \n                                     {(b.feedbackMediaUrl || b.feedbackMediaDataUrl) && (\n                                         <div className=\"h-8 w-8 relative rounded overflow-hidden border\">\n                                            {b.feedbackMediaType === \"image\" ? (\n                                                <img src={b.feedbackMediaDataUrl || b.feedbackMediaUrl} className=\"w-full h-full object-cover\" />\n                                            ) : (\n                                                <Video className=\"w-4 h-4 m-auto mt-2 text-muted-foreground\" />\n                                            )}\n                                         </div>\n                                     )}\n                                </div>\n                             )}\n                         </div>\n                    </div>\n                </div>\n              </Card>\n            ))\n          )}\n        </div>\n      </div>\n      \n      {/* Hidden inputs for uploads */}\n      <Input\n          ref={buttonFileInputRef}\n          type=\"file\"\n          accept=\"image/*,video/*\"\n          className=\"hidden\"\n          onChange={handleButtonFileUpload}\n      />\n\n      <div className=\"text-xs text-muted-foreground mt-6 bg-blue-500/10 p-3 rounded border border-blue-500/20\">\n        <strong>Dica:</strong> Ao selecionar \"+ Nova lista de botões\", você será levado automaticamente para criar as opções da próxima etapa. Use o botão \"Voltar\" no topo para retornar aqui.\n      </div>\n    </div>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Projetos\\Back_endCrm\\kanbanproject1\\components\\message-template-editor.tsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'stepId' is defined but never used.","line":39,"column":33,"nodeType":"Identifier","messageId":"unusedVar","endLine":39,"endColumn":59,"suggestions":[{"messageId":"removeVar","data":{"varName":"stepId"},"fix":{"range":[1284,1310],"text":""},"desc":"Remove unused variable 'stepId'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'next' is defined but never used.","line":40,"column":19,"nodeType":"Identifier","messageId":"unusedVar","endLine":40,"endColumn":37,"suggestions":[{"messageId":"removeVar","data":{"varName":"next"},"fix":{"range":[1338,1356],"text":""},"desc":"Remove unused variable 'next'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'draft' is defined but never used.","line":41,"column":12,"nodeType":"Identifier","messageId":"unusedVar","endLine":41,"endColumn":24,"suggestions":[{"messageId":"removeVar","data":{"varName":"draft"},"fix":{"range":[1377,1389],"text":""},"desc":"Remove unused variable 'draft'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'message' is defined but never used.","line":43,"column":23,"nodeType":"Identifier","messageId":"unusedVar","endLine":43,"endColumn":38,"suggestions":[{"messageId":"removeVar","data":{"varName":"message"},"fix":{"range":[1444,1459],"text":""},"desc":"Remove unused variable 'message'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'token' is defined but never used.","line":47,"column":37,"nodeType":"Identifier","messageId":"unusedVar","endLine":47,"endColumn":50,"suggestions":[{"messageId":"removeVar","data":{"varName":"token"},"fix":{"range":[1631,1644],"text":""},"desc":"Remove unused variable 'token'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'token' is defined but never used.","line":51,"column":35,"nodeType":"Identifier","messageId":"unusedVar","endLine":51,"endColumn":48,"suggestions":[{"messageId":"removeVar","data":{"varName":"token"},"fix":{"range":[1785,1798],"text":""},"desc":"Remove unused variable 'token'."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":6,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\"\n\nimport { useMemo, useRef } from \"react\"\nimport { Button } from \"@/components/ui/button\"\nimport { Input } from \"@/components/ui/input\"\nimport { Label } from \"@/components/ui/label\"\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\"\nimport { Separator } from \"@/components/ui/separator\"\nimport { Textarea } from \"@/components/ui/textarea\"\nimport type { MessageTemplate, MessageTemplateType } from \"@/lib/api/message-templates-api\"\nimport type { Draft } from \"@/components/message-template-draft\"\nimport { insertAtCursor, isValidDraft, newDraft } from \"@/components/message-template-draft\"\nimport { MessageTemplateEditorButtons } from \"@/components/message-template-editor-buttons\"\nimport { Save, X } from \"lucide-react\"\n\nconst variableTokens = [\n  \"[NOME_LEAD]\",\n  \"[PRIMEIRO_NOME_LEAD]\",\n  \"[RAZAO_SOCIAL]\",\n  \"[NOME_MINHA_EMPRESA]\",\n  \"[TAGS]\",\n] as const\n\nexport function MessageTemplateEditor({\n  draft,\n  selectedTemplate,\n  isLoading,\n  activeButtonsStepId,\n  onActiveButtonsStepIdChange,\n  onDraftChange,\n  onSave,\n  onCancel,\n  onValidationError,\n}: {\n  draft: Draft | null\n  selectedTemplate: MessageTemplate | null\n  isLoading: boolean\n  activeButtonsStepId: string | undefined\n  onActiveButtonsStepIdChange: (stepId: string | undefined) => void\n  onDraftChange: (next: Draft | null) => void\n  onSave: (draft: Draft) => void\n  onCancel: () => void\n  onValidationError: (message: string) => void\n}) {\n  const textRef = useRef<HTMLTextAreaElement | null>(null)\n  const captionRef = useRef<HTMLTextAreaElement | null>(null)\n  const insertHandlerRef = useRef<((token: string) => void) | null>(null)\n\n  const canSave = useMemo(() => (draft ? isValidDraft(draft) : false), [draft])\n\n  const setInsertHandler = (fn: ((token: string) => void) | null) => {\n    insertHandlerRef.current = fn\n  }\n\n  if (!draft) {\n    return (\n      <div className=\"h-full flex items-center justify-center text-sm text-muted-foreground\">\n        Selecione um template na lista ou crie um novo.\n      </div>\n    )\n  }\n\n  const setType = (next: MessageTemplateType) => {\n    const keepName = draft.name\n    const nextDraft = newDraft(next)\n    nextDraft.name = keepName\n    nextDraft.id = draft.id\n    onDraftChange(nextDraft)\n    if (next === \"buttons\") {\n      const stepId = nextDraft.content?.startStepId || nextDraft.content?.steps?.[0]?.id\n      onActiveButtonsStepIdChange(stepId)\n    } else {\n      onActiveButtonsStepIdChange(undefined)\n    }\n  }\n\n  const onInsertToken = (token: string) => {\n    if (insertHandlerRef.current) {\n      insertHandlerRef.current(token)\n      return\n    }\n\n    if (draft.type === \"text\") {\n      onDraftChange({ ...draft, content: { ...draft.content, text: String(draft.content?.text || \"\") + token } })\n    }\n  }\n\n  const validateAndSave = () => {\n    if (!draft.name.trim()) {\n      onValidationError(\"Nome do template é obrigatório\")\n      return\n    }\n    if (!isValidDraft(draft)) {\n      onValidationError(\"Preencha os campos obrigatórios do tipo escolhido\")\n      return\n    }\n    onSave(draft)\n  }\n\n  const renderTypeEditor = () => {\n    if (draft.type === \"text\") {\n      const value = String(draft.content?.text || \"\")\n      return (\n        <div className=\"space-y-2\">\n          <Label>Editor de Mensagem *</Label>\n          <Textarea\n            ref={(el) => {\n              textRef.current = el\n            }}\n            value={value}\n            className=\"min-h-[200px]\"\n            onFocus={() =>\n              setInsertHandler((token) => {\n                const next = insertAtCursor(value, textRef.current, token)\n                onDraftChange({ ...draft, content: { ...draft.content, text: next } })\n              })\n            }\n            onBlur={() => setInsertHandler(null)}\n            onChange={(e) => onDraftChange({ ...draft, content: { ...draft.content, text: e.target.value } })}\n          />\n        </div>\n      )\n    }\n\n    if (draft.type === \"image\" || draft.type === \"video\") {\n      const isImage = draft.type === \"image\"\n      const mediaUrl = String(draft.content?.mediaUrl || \"\")\n      const caption = String(draft.content?.caption || \"\")\n\n      return (\n        <div className=\"space-y-4\">\n          <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n            <div className=\"space-y-2\">\n              <Label>Upload de {isImage ? \"Imagem\" : \"Vídeo\"}</Label>\n              <Input\n                type=\"file\"\n                accept={isImage ? \"image/*\" : \"video/*\"}\n                onChange={async (e) => {\n                  const file = e.target.files?.[0]\n                  if (!file) return\n                  const maxBytes = isImage ? 1_500_000 : 6_000_000\n                  if (file.size > maxBytes) {\n                    onValidationError(`Arquivo muito grande. Limite: ${isImage ? \"1.5MB\" : \"6MB\"}`)\n                    return\n                  }\n                  const reader = new FileReader()\n                  reader.onload = () => {\n                    const dataUrl = String(reader.result || \"\")\n                    onDraftChange({ ...draft, content: { ...draft.content, mediaDataUrl: dataUrl } })\n                  }\n                  reader.readAsDataURL(file)\n                }}\n              />\n              <div className=\"text-xs text-muted-foreground\">Ou informe uma URL para a mídia</div>\n            </div>\n            <div className=\"space-y-2\">\n              <Label>URL da Mídia</Label>\n              <Input\n                value={mediaUrl}\n                placeholder=\"https://...\"\n                onChange={(e) => onDraftChange({ ...draft, content: { ...draft.content, mediaUrl: e.target.value } })}\n              />\n            </div>\n          </div>\n\n          <div className=\"space-y-2\">\n            <Label>Legenda (opcional)</Label>\n            <Textarea\n              ref={(el) => {\n                captionRef.current = el\n              }}\n              value={caption}\n              onFocus={() =>\n                setInsertHandler((token) => {\n                  const next = insertAtCursor(caption, captionRef.current, token)\n                  onDraftChange({ ...draft, content: { ...draft.content, caption: next } })\n                })\n              }\n              onBlur={() => setInsertHandler(null)}\n              onChange={(e) => onDraftChange({ ...draft, content: { ...draft.content, caption: e.target.value } })}\n            />\n          </div>\n\n          <div className=\"flex gap-2\">\n            <Button\n              type=\"button\"\n              variant=\"outline\"\n              size=\"sm\"\n              onClick={() => onDraftChange({ ...draft, content: { ...draft.content, mediaDataUrl: \"\" } })}\n            >\n              <X className=\"h-4 w-4 mr-2\" />\n              Limpar upload\n            </Button>\n          </div>\n\n          <Separator />\n          <div className=\"text-xs text-muted-foreground\">Upload salva a mídia como data URL.</div>\n        </div>\n      )\n    }\n\n    if (draft.type === \"buttons\") {\n      return (\n        <MessageTemplateEditorButtons\n          draft={draft}\n          activeStepId={activeButtonsStepId}\n          onActiveStepIdChange={onActiveButtonsStepIdChange}\n          onDraftChange={(next) => onDraftChange(next)}\n          registerInsertHandler={setInsertHandler}\n        />\n      )\n    }\n\n    return null\n  }\n\n  return (\n    <div className=\"space-y-6\">\n      <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n        <div className=\"space-y-2\">\n          <Label>Nome do Template *</Label>\n          <Input value={draft.name} onChange={(e) => onDraftChange({ ...draft, name: e.target.value })} />\n        </div>\n        <div className=\"space-y-2\">\n          <Label>Tipo do Modelo</Label>\n          <Select value={draft.type} onValueChange={(v) => setType(v as MessageTemplateType)}>\n            <SelectTrigger>\n              <SelectValue />\n            </SelectTrigger>\n            <SelectContent>\n              <SelectItem value=\"text\">Modelo de Texto</SelectItem>\n              <SelectItem value=\"image\">Modelo de Imagem</SelectItem>\n              <SelectItem value=\"video\">Modelo de Vídeo</SelectItem>\n              <SelectItem value=\"buttons\">Modelo de Lista de Botões</SelectItem>\n            </SelectContent>\n          </Select>\n        </div>\n      </div>\n\n      <div className=\"space-y-2\">\n        <Label>Variáveis</Label>\n        <div className=\"flex flex-wrap gap-2\">\n          {variableTokens.map((token) => (\n            <Button key={token} type=\"button\" variant=\"outline\" size=\"sm\" onClick={() => onInsertToken(token)}>\n              {token}\n            </Button>\n          ))}\n        </div>\n      </div>\n\n      {renderTypeEditor()}\n\n      <div className=\"flex gap-2 pt-2\">\n        <Button onClick={validateAndSave} disabled={isLoading || !canSave}>\n          <Save className=\"h-4 w-4 mr-2\" />\n          Salvar Template\n        </Button>\n        <Button\n          type=\"button\"\n          variant=\"outline\"\n          onClick={() => {\n            if (selectedTemplate) {\n              onDraftChange({\n                id: selectedTemplate.id,\n                name: selectedTemplate.name,\n                type: selectedTemplate.type,\n                content: JSON.parse(JSON.stringify(selectedTemplate.content ?? {})),\n              })\n            } else {\n              onDraftChange(null)\n            }\n            onCancel()\n          }}\n        >\n          Cancelar\n        </Button>\n      </div>\n    </div>\n  )\n}\n\n","usedDeprecatedRules":[]},{"filePath":"C:\\Projetos\\Back_endCrm\\kanbanproject1\\components\\message-template-flow-diagram.tsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'Card' is defined but never used.","line":4,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":4,"endColumn":14,"suggestions":[{"messageId":"removeVar","data":{"varName":"Card"},"fix":{"range":[60,103],"text":""},"desc":"Remove unused variable 'Card'."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Card' is defined but never used.","line":4,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":14},{"ruleId":"no-unused-vars","severity":1,"message":"'Separator' is defined but never used.","line":5,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":5,"endColumn":19,"suggestions":[{"messageId":"removeVar","data":{"varName":"Separator"},"fix":{"range":[104,157],"text":""},"desc":"Remove unused variable 'Separator'."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Separator' is defined but never used.","line":5,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":5,"endColumn":19},{"ruleId":"no-unused-vars","severity":1,"message":"'FileText' is defined but never used.","line":6,"column":30,"nodeType":"Identifier","messageId":"unusedVar","endLine":6,"endColumn":38,"suggestions":[{"messageId":"removeVar","data":{"varName":"FileText"},"fix":{"range":[185,195],"text":""},"desc":"Remove unused variable 'FileText'."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'FileText' is defined but never used.","line":6,"column":30,"nodeType":null,"messageId":"unusedVar","endLine":6,"endColumn":38},{"ruleId":"no-unused-vars","severity":1,"message":"'stepId' is defined but never used.","line":12,"column":18,"nodeType":"Identifier","messageId":"unusedVar","endLine":12,"endColumn":32,"suggestions":[{"messageId":"removeVar","data":{"varName":"stepId"},"fix":{"range":[338,352],"text":""},"desc":"Remove unused variable 'stepId'."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":7,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\"\n\nimport { Badge } from \"@/components/ui/badge\"\nimport { Card } from \"@/components/ui/card\"\nimport { Separator } from \"@/components/ui/separator\"\nimport { ArrowRight, Circle, FileText, Image as ImageIcon, Video } from \"lucide-react\"\n\ninterface FlowNodeProps {\n  stepId: string\n  steps: any[]\n  depth?: number\n  onStepClick?: (stepId: string) => void\n  activeStepId?: string\n  visited?: Set<string>\n}\n\nexport function MessageTemplateFlowDiagram({ \n  stepId, \n  steps, \n  depth = 0,\n  onStepClick,\n  activeStepId,\n  visited = new Set()\n}: FlowNodeProps) {\n  const step = steps.find(s => s.id === stepId)\n  if (!step) return null\n\n  // Prevent infinite loops\n  if (visited.has(stepId)) {\n      return (\n        <div className=\"flex items-center gap-2 p-2 rounded-md border border-dashed text-xs text-muted-foreground bg-muted/10\">\n            <div className=\"w-2 h-2 rounded-full bg-yellow-500\" />\n            <span>Retorno para: {step.title}</span>\n        </div>\n      )\n  }\n\n  const newVisited = new Set(visited)\n  newVisited.add(stepId)\n\n  const isSelected = step.id === activeStepId\n\n  return (\n    <div className=\"flex flex-col items-start\">\n      {/* Node Representation */}\n      <div \n        className={`\n          flex items-center gap-2 p-2 rounded-md border text-xs cursor-pointer transition-all\n          ${isSelected ? \"bg-primary/10 border-primary ring-1 ring-primary\" : \"bg-card border-border hover:bg-accent\"}\n          ${depth === 0 ? \"mb-4\" : \"my-2\"}\n        `}\n        onClick={() => onStepClick?.(step.id)}\n        style={{ minWidth: \"200px\" }}\n      >\n        <div className=\"flex-1\">\n          <div className=\"font-semibold truncate max-w-[180px]\">{step.title}</div>\n          <div className=\"text-[10px] text-muted-foreground truncate max-w-[180px]\">{step.text}</div>\n          {step.mediaType && step.mediaType !== \"none\" && (\n             <div className=\"flex items-center gap-1 mt-1 text-[10px] text-blue-500\">\n                {step.mediaType === \"image\" ? <ImageIcon className=\"h-3 w-3\" /> : <Video className=\"h-3 w-3\" />}\n                Mídia anexada\n             </div>\n          )}\n        </div>\n        {isSelected && <Circle className=\"h-2 w-2 text-primary fill-primary\" />}\n      </div>\n\n      {/* Children (Buttons -> Next Steps) */}\n      {Array.isArray(step.buttons) && step.buttons.length > 0 && (\n        <div className=\"pl-6 border-l-2 border-dashed border-muted-foreground/20 ml-4 space-y-2\">\n           {step.buttons.map((btn: any) => {\n             const nextStep = steps.find(s => s.id === btn.nextStepId)\n             return (\n               <div key={btn.id} className=\"relative pt-2\">\n                 {/* Connection Line */}\n                 <div className=\"absolute top-[22px] -left-6 w-6 h-[1px] bg-dashed bg-muted-foreground/20 border-t border-dashed border-muted-foreground/40\" />\n                 \n                 {/* Button Label */}\n                 <div className=\"flex items-center gap-2 mb-1\">\n                    <Badge variant=\"secondary\" className=\"text-[10px] h-5 px-1 font-normal bg-muted/50\">\n                        {btn.label}\n                    </Badge>\n                    <ArrowRight className=\"h-3 w-3 text-muted-foreground/50\" />\n                 </div>\n\n                 {/* Recursive Child or End State */}\n                 {nextStep ? (\n                   <MessageTemplateFlowDiagram \n                      stepId={nextStep.id} \n                      steps={steps} \n                      depth={depth + 1} \n                      onStepClick={onStepClick}\n                      activeStepId={activeStepId}\n                      visited={newVisited}\n                   />\n                 ) : (\n                   <div className=\"p-2 rounded border border-dashed text-[10px] text-muted-foreground bg-muted/10 min-w-[150px]\">\n                      {btn.nextStepId ? \"Etapa não encontrada\" : \"Fim do fluxo\"}\n                   </div>\n                 )}\n               </div>\n             )\n           })}\n        </div>\n      )}\n    </div>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Projetos\\Back_endCrm\\kanbanproject1\\components\\message-template-preview.tsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'stepId' is defined but never used.","line":39,"column":19,"nodeType":"Identifier","messageId":"unusedVar","endLine":39,"endColumn":33,"suggestions":[{"messageId":"removeVar","data":{"varName":"stepId"},"fix":{"range":[1063,1077],"text":""},"desc":"Remove unused variable 'stepId'."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\"\n\nimport { useState } from \"react\"\nimport { Badge } from \"@/components/ui/badge\"\nimport { Button } from \"@/components/ui/button\"\nimport { Smartphone, Workflow } from \"lucide-react\"\nimport type { MessageTemplateType } from \"@/lib/api/message-templates-api\"\nimport { MessageTemplateFlowDiagram } from \"@/components/message-template-flow-diagram\"\n\nconst sampleValues: Record<string, string> = {\n  \"[NOME_LEAD]\": \"João da Silva\",\n  \"[PRIMEIRO_NOME_LEAD]\": \"João\",\n  \"[RAZAO_SOCIAL]\": \"Empresa Exemplo LTDA\",\n  \"[NOME_MINHA_EMPRESA]\": \"UniCRM\",\n  \"[TAGS]\": \"Imobiliário, SaaS\",\n  \"{nome}\": \"João da Silva\",\n  \"{empresa}\": \"Empresa Exemplo LTDA\",\n  \"{etapa_funil}\": \"Prospecção\",\n  \"{vendedor}\": \"Maria Oliveira\",\n}\n\nfunction resolveText(raw: string) {\n  let out = raw\n  for (const [k, v] of Object.entries(sampleValues)) {\n    out = out.split(k).join(v)\n  }\n  return out\n}\n\nexport function MessageTemplatePreview({\n  type,\n  content,\n  activeStepId,\n  onStepChange,\n}: {\n  type: MessageTemplateType\n  content: any\n  activeStepId?: string\n  onStepChange?: (stepId: string) => void\n}) {\n  const [viewMode, setViewMode] = useState<\"preview\" | \"diagram\">(\"preview\")\n\n  const renderBubbleText = (text: string) => (\n    <div className=\"text-sm whitespace-pre-wrap leading-relaxed\">{resolveText(text || \"\")}</div>\n  )\n\n  const renderButtons = (buttons: Array<{ id: string; label: string; nextStepId?: string }>) => (\n    <div className=\"mt-2 space-y-2\">\n      {buttons.map((b) => (\n        <button\n          key={b.id}\n          type=\"button\"\n          className=\"w-full rounded-md border border-white/10 bg-white/5 px-3 py-2 text-sm hover:bg-white/10 transition-colors\"\n          onClick={() => {\n            if (b.nextStepId && onStepChange) onStepChange(b.nextStepId)\n          }}\n        >\n          {b.label}\n        </button>\n      ))}\n    </div>\n  )\n\n  const renderMedia = (mediaType: string, mediaUrl: string) => {\n    if (!mediaType || mediaType === \"none\") return null\n    \n    if (!mediaUrl) {\n       return (\n          <div className=\"w-full rounded-md border border-white/10 bg-white/5 h-40 flex items-center justify-center text-xs text-white/60 mb-2\">\n            Mídia não carregada\n          </div>\n       )\n    }\n\n    if (mediaType === \"image\") {\n        return <img src={mediaUrl} alt=\"Media\" className=\"w-full rounded-md object-cover max-h-56 mb-2\" />\n    }\n    if (mediaType === \"video\") {\n        return <video src={mediaUrl} controls className=\"w-full rounded-md max-h-56 mb-2\" />\n    }\n    return null\n  }\n\n  let bubble: React.ReactNode = null\n  if (type === \"text\") {\n    bubble = renderBubbleText(String(content?.text || \"\"))\n  }\n  if (type === \"image\" || type === \"video\") {\n    const mediaSrc = content?.mediaDataUrl || content?.mediaUrl\n    const caption = String(content?.caption || \"\")\n    bubble = (\n      <div className=\"space-y-2\">\n        {renderMedia(type, mediaSrc)}\n        {caption ? renderBubbleText(caption) : null}\n      </div>\n    )\n  }\n  if (type === \"buttons\") {\n    const steps: Array<any> = Array.isArray(content?.steps) ? content.steps : []\n    const step = steps.find((s) => s.id === activeStepId) || steps[0]\n    const text = String(step?.text || \"\")\n    const buttons = Array.isArray(step?.buttons) ? step.buttons : []\n    const mediaType = step?.mediaType || \"none\"\n    const mediaSrc = step?.mediaDataUrl || step?.mediaUrl || \"\"\n\n    bubble = (\n      <div>\n        {renderMedia(mediaType, mediaSrc)}\n        {renderBubbleText(text)}\n        {renderButtons(buttons)}\n      </div>\n    )\n  }\n\n  return (\n    <div className=\"h-full flex flex-col\">\n      <div className=\"flex items-center justify-between px-4 py-3 border-b\">\n        <div className=\"flex items-center gap-2\">\n           <div className=\"text-sm font-medium\">Preview</div>\n           <Badge variant=\"secondary\" className=\"capitalize\">\n             {type}\n           </Badge>\n        </div>\n        {type === \"buttons\" && (\n            <div className=\"flex items-center gap-1 bg-muted p-1 rounded-md\">\n                <Button \n                    variant={viewMode === \"preview\" ? \"default\" : \"ghost\"} \n                    size=\"icon\" \n                    className=\"h-6 w-6\" \n                    onClick={() => setViewMode(\"preview\")}\n                    title=\"Visualizar no Celular\"\n                >\n                    <Smartphone className=\"h-3 w-3\" />\n                </Button>\n                <Button \n                    variant={viewMode === \"diagram\" ? \"default\" : \"ghost\"} \n                    size=\"icon\" \n                    className=\"h-6 w-6\" \n                    onClick={() => setViewMode(\"diagram\")}\n                    title=\"Visualizar Fluxograma\"\n                >\n                    <Workflow className=\"h-3 w-3\" />\n                </Button>\n            </div>\n        )}\n      </div>\n\n      <div className=\"flex-1 overflow-auto bg-[linear-gradient(180deg,rgba(17,24,39,0.35),rgba(2,6,23,0.35))] p-4 relative\">\n        {viewMode === \"diagram\" && type === \"buttons\" ? (\n             <div className=\"min-w-full min-h-full p-4 bg-background/95 rounded-md shadow-sm overflow-auto\">\n                 <h3 className=\"text-xs font-semibold text-muted-foreground mb-4 uppercase tracking-wider\">Estrutura do Fluxo</h3>\n                 <MessageTemplateFlowDiagram \n                    stepId={content?.startStepId || content?.steps?.[0]?.id}\n                    steps={content?.steps || []}\n                    onStepClick={onStepChange}\n                    activeStepId={activeStepId}\n                 />\n             </div>\n        ) : (\n            <div className=\"max-w-[280px] ml-auto\">\n            <div className=\"rounded-2xl rounded-tr-md bg-emerald-600/90 text-white p-3 shadow\">\n                {bubble}\n            </div>\n            <div className=\"mt-1 text-[10px] text-white/60 text-right\">12:34</div>\n            </div>\n        )}\n      </div>\n\n      <div className=\"px-4 py-3 border-t text-xs text-muted-foreground\">\n        {viewMode === \"diagram\" \n            ? \"Clique em uma etapa para editá-la.\" \n            : \"Variáveis no preview usam valores de exemplo.\"\n        }\n      </div>\n    </div>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Projetos\\Back_endCrm\\kanbanproject1\\components\\message-templates-manager.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projetos\\Back_endCrm\\kanbanproject1\\components\\pie-chart.tsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'index' is defined but never used.","line":105,"column":29,"nodeType":"Identifier","messageId":"unusedVar","endLine":105,"endColumn":34,"suggestions":[{"messageId":"removeVar","data":{"varName":"index"},"fix":{"range":[2676,2683],"text":""},"desc":"Remove unused variable 'index'."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'index' is defined but never used.","line":105,"column":29,"nodeType":null,"messageId":"unusedVar","endLine":105,"endColumn":34}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\"\r\n\r\nimport { useMemo } from \"react\"\r\n\r\ntype PieChartData = {\r\n  name: string\r\n  value: number\r\n  percentage: string\r\n}\r\n\r\ntype PieChartProps = {\r\n  data: PieChartData[]\r\n  colors: string[]\r\n  width?: number\r\n  height?: number\r\n  showLabels?: boolean\r\n  showLegend?: boolean\r\n}\r\n\r\nexport default function PieChart({\r\n  data,\r\n  colors,\r\n  width = 400,\r\n  height = 300,\r\n  showLabels = true,\r\n  showLegend = true,\r\n}: PieChartProps) {\r\n  const { slices, total } = useMemo(() => {\r\n    const total = data.reduce((sum, item) => sum + item.value, 0)\r\n    let currentAngle = 0\r\n\r\n    const slices = data.map((item, index) => {\r\n      const percentage = total > 0 ? (item.value / total) * 100 : 0\r\n      const angle = (percentage / 100) * 360\r\n      const startAngle = currentAngle\r\n      const endAngle = currentAngle + angle\r\n\r\n      currentAngle += angle\r\n\r\n      return {\r\n        ...item,\r\n        percentage,\r\n        angle,\r\n        startAngle,\r\n        endAngle,\r\n        color: colors[index % colors.length],\r\n      }\r\n    })\r\n\r\n    return { slices, total }\r\n  }, [data, colors])\r\n\r\n  const radius = Math.min(width, height) / 2 - 40\r\n  const centerX = width / 2\r\n  const centerY = height / 2\r\n\r\n  const createPath = (startAngle: number, endAngle: number, radius: number) => {\r\n    const start = polarToCartesian(centerX, centerY, radius, endAngle)\r\n    const end = polarToCartesian(centerX, centerY, radius, startAngle)\r\n    const largeArcFlag = endAngle - startAngle <= 180 ? \"0\" : \"1\"\r\n\r\n    return [\r\n      \"M\",\r\n      centerX,\r\n      centerY,\r\n      \"L\",\r\n      start.x,\r\n      start.y,\r\n      \"A\",\r\n      radius,\r\n      radius,\r\n      0,\r\n      largeArcFlag,\r\n      0,\r\n      end.x,\r\n      end.y,\r\n      \"Z\",\r\n    ].join(\" \")\r\n  }\r\n\r\n  const polarToCartesian = (centerX: number, centerY: number, radius: number, angleInDegrees: number) => {\r\n    const angleInRadians = ((angleInDegrees - 90) * Math.PI) / 180.0\r\n    return {\r\n      x: centerX + radius * Math.cos(angleInRadians),\r\n      y: centerY + radius * Math.sin(angleInRadians),\r\n    }\r\n  }\r\n\r\n  const getLabelPosition = (startAngle: number, endAngle: number, radius: number) => {\r\n    const midAngle = (startAngle + endAngle) / 2\r\n    return polarToCartesian(centerX, centerY, radius * 0.7, midAngle)\r\n  }\r\n\r\n  if (total === 0) {\r\n    return (\r\n      <div className=\"flex items-center justify-center\" style={{ width, height }}>\r\n        <p className=\"text-muted-foreground\">Nenhum dado disponível</p>\r\n      </div>\r\n    )\r\n  }\r\n\r\n  return (\r\n    <div className=\"flex flex-col items-center space-y-4\">\r\n      <svg width={width} height={height} className=\"overflow-visible\">\r\n        {slices.map((slice, index) => (\r\n          <g key={slice.name}>\r\n            <path\r\n              d={createPath(slice.startAngle, slice.endAngle, radius)}\r\n              fill={slice.color}\r\n              stroke=\"white\"\r\n              strokeWidth=\"2\"\r\n              className=\"hover:opacity-80 transition-opacity cursor-pointer\"\r\n            />\r\n            {showLabels && slice.percentage > 5 && (\r\n              <text\r\n                x={getLabelPosition(slice.startAngle, slice.endAngle, radius).x}\r\n                y={getLabelPosition(slice.startAngle, slice.endAngle, radius).y}\r\n                textAnchor=\"middle\"\r\n                dominantBaseline=\"middle\"\r\n                className=\"fill-white text-xs font-medium\"\r\n                style={{ textShadow: \"1px 1px 2px rgba(0,0,0,0.7)\" }}\r\n              >\r\n                {slice.percentage.toFixed(1)}%\r\n              </text>\r\n            )}\r\n          </g>\r\n        ))}\r\n      </svg>\r\n\r\n      {showLegend && (\r\n        <div className=\"grid grid-cols-2 gap-2 max-w-md\">\r\n          {slices.map((slice) => (\r\n            <div key={slice.name} className=\"flex items-center space-x-2\">\r\n              <div className=\"w-3 h-3 rounded-full\" style={{ backgroundColor: slice.color }} />\r\n              <span className=\"text-sm truncate\">{slice.name}</span>\r\n              <span className=\"text-xs text-muted-foreground\">({slice.value})</span>\r\n            </div>\r\n          ))}\r\n        </div>\r\n      )}\r\n    </div>\r\n  )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Projetos\\Back_endCrm\\kanbanproject1\\components\\project-details-dialog.tsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'Module' is defined but never used.","line":39,"column":6,"nodeType":"Identifier","messageId":"unusedVar","endLine":39,"endColumn":12,"suggestions":[{"messageId":"removeVar","data":{"varName":"Module"},"fix":{"range":[1010,1016],"text":""},"desc":"Remove unused variable 'Module'."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Module' is defined but never used.","line":39,"column":6,"nodeType":null,"messageId":"unusedVar","endLine":39,"endColumn":12},{"ruleId":"no-unused-vars","severity":1,"message":"'projectId' is defined but never used.","line":96,"column":14,"nodeType":"Identifier","messageId":"unusedVar","endLine":96,"endColumn":31,"suggestions":[{"messageId":"removeVar","data":{"varName":"projectId"},"fix":{"range":[2219,2237],"text":""},"desc":"Remove unused variable 'projectId'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'updates' is defined but never used.","line":96,"column":33,"nodeType":"Identifier","messageId":"unusedVar","endLine":96,"endColumn":58,"suggestions":[{"messageId":"removeVar","data":{"varName":"updates"},"fix":{"range":[2236,2263],"text":""},"desc":"Remove unused variable 'updates'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'projectId' is defined but never used.","line":97,"column":14,"nodeType":"Identifier","messageId":"unusedVar","endLine":97,"endColumn":31,"suggestions":[{"messageId":"removeVar","data":{"varName":"projectId"},"fix":{"range":[2287,2304],"text":""},"desc":"Remove unused variable 'projectId'."}]},{"ruleId":"no-case-declarations","severity":1,"message":"Unexpected lexical declaration in case block.","line":222,"column":9,"nodeType":"VariableDeclaration","messageId":"unexpected","endLine":222,"endColumn":75,"suggestions":[{"messageId":"addBrackets","fix":{"range":[5910,6029],"text":"{ const FeedbackIcon = feedbackTypes[feedbackType || \"neutral\"].icon\r\n        return <FeedbackIcon className=\"h-4 w-4\" /> }"},"desc":"Add {} brackets around the case block."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":6,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\"\r\n\r\nimport { useState } from \"react\"\r\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from \"@/components/ui/dialog\"\r\nimport { Button } from \"@/components/ui/button\"\r\nimport { Input } from \"@/components/ui/input\"\r\nimport { Label } from \"@/components/ui/label\"\r\nimport { Textarea } from \"@/components/ui/textarea\"\r\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\"\r\nimport { Badge } from \"@/components/ui/badge\"\r\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\"\r\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\"\r\nimport { Progress } from \"@/components/ui/progress\"\r\nimport {\r\n  Briefcase,\r\n  Building,\r\n  Calendar,\r\n  DollarSign,\r\n  Edit,\r\n  Save,\r\n  X,\r\n  Users,\r\n  Clock,\r\n  CheckCircle,\r\n  AlertCircle,\r\n  FileText,\r\n  Activity,\r\n  TrendingUp,\r\n  Settings,\r\n  Plus,\r\n  Star,\r\n  AlertTriangle,\r\n  Info,\r\n  MessageSquare,\r\n  Mail,\r\n  Phone,\r\n} from \"lucide-react\"\r\n\r\ntype Module = {\r\n  id: string\r\n  name: string\r\n  description: string\r\n  color: string\r\n  status?: \"not_started\" | \"in_progress\" | \"completed\"\r\n  progress?: number\r\n}\r\n\r\ntype Project = {\r\n  id: string\r\n  title: string\r\n  client: string\r\n  clientEmail?: string\r\n  clientPhone?: string\r\n  clientAddress?: string\r\n  modules: string[]\r\n  status: string\r\n  priority?: string\r\n  deadline?: string\r\n  budget?: number\r\n  description?: string\r\n  leadId?: string\r\n  createdAt: string\r\n  updatedAt?: string\r\n  assignedTo?: {\r\n    id: string\r\n    name: string\r\n    avatar: string\r\n  }\r\n  people: Array<{\r\n    id: string\r\n    name: string\r\n    avatar: string\r\n  }>\r\n  tasks?: Array<{\r\n    id: string\r\n    title: string\r\n    status: \"pending\" | \"in_progress\" | \"completed\"\r\n    assignedTo?: string\r\n    dueDate?: string\r\n  }>\r\n  interactions?: Array<{\r\n    id: string\r\n    type: \"call\" | \"email\" | \"meeting\" | \"note\" | \"feedback\" | \"milestone\"\r\n    description: string\r\n    date: string\r\n    createdBy: string\r\n    feedbackType?: \"positive\" | \"negative\" | \"neutral\" | \"important\"\r\n    rating?: number\r\n  }>\r\n}\r\n\r\ntype ProjectDetailsDialogProps = {\r\n  project: Project | null\r\n  open: boolean\r\n  onClose: () => void\r\n  onUpdate: (projectId: string, updates: Partial<Project>) => void\r\n  onDelete: (projectId: string) => void\r\n  columns: Array<{ id: string; title: string; color: string }>\r\n}\r\n\r\nconst priorityColors = {\r\n  low: \"bg-blue-100 text-blue-800\",\r\n  medium: \"bg-yellow-100 text-yellow-800\",\r\n  high: \"bg-orange-100 text-orange-800\",\r\n  urgent: \"bg-red-100 text-red-800\",\r\n}\r\n\r\nconst priorityLabels = {\r\n  low: \"Baixa\",\r\n  medium: \"Média\",\r\n  high: \"Alta\",\r\n  urgent: \"Urgente\",\r\n}\r\n\r\nconst feedbackTypes = {\r\n  positive: { label: \"Positivo\", color: \"bg-green-100 text-green-800\", icon: CheckCircle },\r\n  negative: { label: \"Negativo\", color: \"bg-red-100 text-red-800\", icon: AlertTriangle },\r\n  neutral: { label: \"Neutro\", color: \"bg-gray-100 text-gray-800\", icon: Info },\r\n  important: { label: \"Importante\", color: \"bg-blue-100 text-blue-800\", icon: Star },\r\n}\r\n\r\nexport default function ProjectDetailsDialog({\r\n  project,\r\n  open,\r\n  onClose,\r\n  onUpdate,\r\n  onDelete,\r\n  columns,\r\n}: ProjectDetailsDialogProps) {\r\n  const [isEditing, setIsEditing] = useState(false)\r\n  const [activeTab, setActiveTab] = useState(\"overview\")\r\n  const [editForm, setEditForm] = useState<Partial<Project>>({})\r\n  const [newInteraction, setNewInteraction] = useState({\r\n    type: \"note\" as const,\r\n    description: \"\",\r\n    feedbackType: \"neutral\" as const,\r\n    rating: 5,\r\n  })\r\n\r\n  if (!project) return null\r\n\r\n  const handleEdit = () => {\r\n    setEditForm(project)\r\n    setIsEditing(true)\r\n  }\r\n\r\n  const handleSave = () => {\r\n    if (editForm.id) {\r\n      onUpdate(editForm.id, editForm)\r\n      setIsEditing(false)\r\n    }\r\n  }\r\n\r\n  const handleCancel = () => {\r\n    setEditForm({})\r\n    setIsEditing(false)\r\n  }\r\n\r\n  const handleAddInteraction = () => {\r\n    if (!newInteraction.description.trim()) return\r\n\r\n    const interaction = {\r\n      id: `int_${Date.now()}`,\r\n      type: newInteraction.type,\r\n      description: newInteraction.description,\r\n      date: new Date().toISOString(),\r\n      createdBy: \"Usuário Atual\",\r\n      ...(newInteraction.type === \"feedback\" && {\r\n        feedbackType: newInteraction.feedbackType,\r\n        rating: newInteraction.rating,\r\n      }),\r\n    }\r\n\r\n    const updatedInteractions = [...(project.interactions || []), interaction]\r\n    onUpdate(project.id, { interactions: updatedInteractions })\r\n    setNewInteraction({\r\n      type: \"note\",\r\n      description: \"\",\r\n      feedbackType: \"neutral\",\r\n      rating: 5,\r\n    })\r\n  }\r\n\r\n  const getColumnInfo = (statusId: string) => {\r\n    return columns.find((col) => col.id === statusId)\r\n  }\r\n\r\n  const columnInfo = getColumnInfo(project.status)\r\n\r\n  const calculateProgress = () => {\r\n    if (project.tasks && project.tasks.length > 0) {\r\n      const completedTasks = project.tasks.filter((task) => task.status === \"completed\").length\r\n      return Math.round((completedTasks / project.tasks.length) * 100)\r\n    }\r\n    return 0\r\n  }\r\n\r\n  const progress = calculateProgress()\r\n\r\n  const getDaysRemaining = () => {\r\n    if (!project.deadline) return null\r\n    const deadline = new Date(project.deadline)\r\n    const today = new Date()\r\n    const diffTime = deadline.getTime() - today.getTime()\r\n    const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24))\r\n    return diffDays\r\n  }\r\n\r\n  const daysRemaining = getDaysRemaining()\r\n\r\n  const getInteractionIcon = (type: string, feedbackType?: string) => {\r\n    switch (type) {\r\n      case \"call\":\r\n        return <Phone className=\"h-4 w-4\" />\r\n      case \"email\":\r\n        return <Mail className=\"h-4 w-4\" />\r\n      case \"meeting\":\r\n        return <Calendar className=\"h-4 w-4\" />\r\n      case \"milestone\":\r\n        return <CheckCircle className=\"h-4 w-4\" />\r\n      case \"feedback\":\r\n        const FeedbackIcon = feedbackTypes[feedbackType || \"neutral\"].icon\r\n        return <FeedbackIcon className=\"h-4 w-4\" />\r\n      default:\r\n        return <MessageSquare className=\"h-4 w-4\" />\r\n    }\r\n  }\r\n\r\n  const getInteractionLabel = (type: string) => {\r\n    switch (type) {\r\n      case \"call\":\r\n        return \"Ligação\"\r\n      case \"email\":\r\n        return \"Email\"\r\n      case \"meeting\":\r\n        return \"Reunião\"\r\n      case \"milestone\":\r\n        return \"Marco\"\r\n      case \"feedback\":\r\n        return \"Feedback\"\r\n      default:\r\n        return \"Anotação\"\r\n    }\r\n  }\r\n\r\n  return (\r\n    <Dialog open={open} onOpenChange={(open) => !open && onClose()}>\r\n      <DialogContent className=\"max-w-5xl max-h-[90vh] overflow-y-auto\">\r\n        <DialogHeader>\r\n          <div className=\"flex items-center justify-between\">\r\n            <div className=\"flex items-center gap-3\">\r\n              <div className=\"flex items-center gap-2\">\r\n                <Briefcase className=\"h-5 w-5\" />\r\n                <DialogTitle>{isEditing ? \"Editar Projeto\" : project.title}</DialogTitle>\r\n              </div>\r\n              {columnInfo && (\r\n                <Badge className=\"text-white\" style={{ backgroundColor: columnInfo.color }}>\r\n                  {columnInfo.title}\r\n                </Badge>\r\n              )}\r\n            </div>\r\n            <div className=\"flex gap-2\">\r\n              {!isEditing ? (\r\n                <Button variant=\"outline\" size=\"sm\" onClick={handleEdit}>\r\n                  <Edit className=\"h-4 w-4 mr-2\" />\r\n                  Editar\r\n                </Button>\r\n              ) : (\r\n                <>\r\n                  <Button variant=\"outline\" size=\"sm\" onClick={handleCancel}>\r\n                    <X className=\"h-4 w-4 mr-2\" />\r\n                    Cancelar\r\n                  </Button>\r\n                  <Button size=\"sm\" onClick={handleSave}>\r\n                    <Save className=\"h-4 w-4 mr-2\" />\r\n                    Salvar\r\n                  </Button>\r\n                </>\r\n              )}\r\n            </div>\r\n          </div>\r\n        </DialogHeader>\r\n\r\n        <Tabs value={activeTab} onValueChange={setActiveTab} className=\"w-full\">\r\n          <TabsList className=\"grid w-full grid-cols-6\">\r\n            <TabsTrigger value=\"overview\">Visão Geral</TabsTrigger>\r\n            <TabsTrigger value=\"details\">Detalhes</TabsTrigger>\r\n            <TabsTrigger value=\"modules\">Módulos</TabsTrigger>\r\n            <TabsTrigger value=\"team\">Equipe</TabsTrigger>\r\n            <TabsTrigger value=\"timeline\">Timeline</TabsTrigger>\r\n            <TabsTrigger value=\"feedback\">Feedbacks</TabsTrigger>\r\n          </TabsList>\r\n\r\n          <div className=\"mt-6\">\r\n            <TabsContent value=\"overview\" className=\"space-y-6\">\r\n              {/* Cards de Status */}\r\n              <div className=\"grid grid-cols-1 md:grid-cols-4 gap-4\">\r\n                <Card>\r\n                  <CardContent className=\"p-4\">\r\n                    <div className=\"flex items-center justify-between\">\r\n                      <div>\r\n                        <p className=\"text-sm font-medium text-muted-foreground\">Progresso</p>\r\n                        <p className=\"text-2xl font-bold\">{progress}%</p>\r\n                      </div>\r\n                      <TrendingUp className=\"h-8 w-8 text-blue-600\" />\r\n                    </div>\r\n                  </CardContent>\r\n                </Card>\r\n\r\n                <Card>\r\n                  <CardContent className=\"p-4\">\r\n                    <div className=\"flex items-center justify-between\">\r\n                      <div>\r\n                        <p className=\"text-sm font-medium text-muted-foreground\">Orçamento</p>\r\n                        <p className=\"text-2xl font-bold\">R$ {project.budget?.toLocaleString(\"pt-BR\") || \"0\"}</p>\r\n                      </div>\r\n                      <DollarSign className=\"h-8 w-8 text-green-600\" />\r\n                    </div>\r\n                  </CardContent>\r\n                </Card>\r\n\r\n                <Card>\r\n                  <CardContent className=\"p-4\">\r\n                    <div className=\"flex items-center justify-between\">\r\n                      <div>\r\n                        <p className=\"text-sm font-medium text-muted-foreground\">Dias Restantes</p>\r\n                        <p\r\n                          className={`text-2xl font-bold ${\r\n                            daysRemaining === null\r\n                              ? \"text-gray-600\"\r\n                              : daysRemaining < 0\r\n                                ? \"text-red-600\"\r\n                                : daysRemaining < 7\r\n                                  ? \"text-orange-600\"\r\n                                  : \"text-green-600\"\r\n                          }`}\r\n                        >\r\n                          {daysRemaining === null\r\n                            ? \"N/D\"\r\n                            : daysRemaining < 0\r\n                              ? `${Math.abs(daysRemaining)} atrasado`\r\n                              : daysRemaining}\r\n                        </p>\r\n                      </div>\r\n                      <Clock className=\"h-8 w-8 text-orange-600\" />\r\n                    </div>\r\n                  </CardContent>\r\n                </Card>\r\n\r\n                <Card>\r\n                  <CardContent className=\"p-4\">\r\n                    <div className=\"flex items-center justify-between\">\r\n                      <div>\r\n                        <p className=\"text-sm font-medium text-muted-foreground\">Tarefas</p>\r\n                        <p className=\"text-2xl font-bold\">\r\n                          {project.tasks?.filter((t) => t.status === \"completed\").length || 0}/\r\n                          {project.tasks?.length || 0}\r\n                        </p>\r\n                      </div>\r\n                      <CheckCircle className=\"h-8 w-8 text-green-600\" />\r\n                    </div>\r\n                  </CardContent>\r\n                </Card>\r\n              </div>\r\n\r\n              {/* Progresso Visual */}\r\n              <Card>\r\n                <CardHeader>\r\n                  <CardTitle className=\"flex items-center gap-2\">\r\n                    <Activity className=\"h-4 w-4\" />\r\n                    Progresso do Projeto\r\n                  </CardTitle>\r\n                </CardHeader>\r\n                <CardContent>\r\n                  <div className=\"space-y-4\">\r\n                    <div className=\"flex items-center justify-between\">\r\n                      <span className=\"text-sm font-medium\">Conclusão Geral</span>\r\n                      <span className=\"text-sm text-muted-foreground\">{progress}%</span>\r\n                    </div>\r\n                    <Progress value={progress} className=\"w-full\" />\r\n                  </div>\r\n                </CardContent>\r\n              </Card>\r\n\r\n              {/* Informações Básicas */}\r\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\r\n                <Card>\r\n                  <CardHeader>\r\n                    <CardTitle className=\"flex items-center gap-2\">\r\n                      <Building className=\"h-4 w-4\" />\r\n                      Informações do Cliente\r\n                    </CardTitle>\r\n                  </CardHeader>\r\n                  <CardContent className=\"space-y-2\">\r\n                    <div>\r\n                      <Label className=\"text-sm font-medium\">Cliente</Label>\r\n                      <p className=\"mt-1\">{project.client}</p>\r\n                    </div>\r\n                    <div>\r\n                      <Label className=\"text-sm font-medium\">Email</Label>\r\n                      <p className=\"mt-1\">{project.clientEmail || \"Não definido\"}</p>\r\n                    </div>\r\n                    <div>\r\n                      <Label className=\"text-sm font-medium\">Telefone</Label>\r\n                      <p className=\"mt-1\">{project.clientPhone || \"Não definido\"}</p>\r\n                    </div>\r\n                    <div>\r\n                      <Label className=\"text-sm font-medium\">Endereço</Label>\r\n                      <p className=\"mt-1\">{project.clientAddress || \"Não definido\"}</p>\r\n                    </div>\r\n                    <div>\r\n                      <Label className=\"text-sm font-medium\">Responsável</Label>\r\n                      <p className=\"mt-1\">{project.assignedTo?.name || \"Não definido\"}</p>\r\n                    </div>\r\n                    <div>\r\n                      <Label className=\"text-sm font-medium\">Prioridade</Label>\r\n                      <Badge className={`mt-1 ${priorityColors[project.priority || \"low\"]}`}>\r\n                        {priorityLabels[project.priority || \"low\"]}\r\n                      </Badge>\r\n                    </div>\r\n                  </CardContent>\r\n                </Card>\r\n\r\n                <Card>\r\n                  <CardHeader>\r\n                    <CardTitle className=\"flex items-center gap-2\">\r\n                      <Calendar className=\"h-4 w-4\" />\r\n                      Cronograma\r\n                    </CardTitle>\r\n                  </CardHeader>\r\n                  <CardContent className=\"space-y-2\">\r\n                    <div>\r\n                      <Label className=\"text-sm font-medium\">Data de Início</Label>\r\n                      <p className=\"mt-1\">{new Date(project.createdAt).toLocaleDateString(\"pt-BR\")}</p>\r\n                    </div>\r\n                    <div>\r\n                      <Label className=\"text-sm font-medium\">Data de Término</Label>\r\n                      <p className=\"mt-1\">\r\n                        {project.deadline ? new Date(project.deadline).toLocaleDateString(\"pt-BR\") : \"Não definido\"}\r\n                      </p>\r\n                    </div>\r\n                    <div>\r\n                      <Label className=\"text-sm font-medium\">Duração</Label>\r\n                      <p className=\"mt-1\">\r\n                        {project.deadline\r\n                          ? Math.ceil(\r\n                              (new Date(project.deadline).getTime() - new Date(project.createdAt).getTime()) /\r\n                                (1000 * 60 * 60 * 24),\r\n                            )\r\n                          : \"Não definido\"}{\" \"}\r\n                        dias\r\n                      </p>\r\n                    </div>\r\n                  </CardContent>\r\n                </Card>\r\n              </div>\r\n            </TabsContent>\r\n\r\n            <TabsContent value=\"details\" className=\"space-y-6\">\r\n              <Card>\r\n                <CardHeader>\r\n                  <CardTitle className=\"flex items-center gap-2\">\r\n                    <FileText className=\"h-4 w-4\" />\r\n                    Detalhes do Projeto\r\n                  </CardTitle>\r\n                </CardHeader>\r\n                <CardContent className=\"space-y-4\">\r\n                  {isEditing ? (\r\n                    <>\r\n                      <div className=\"grid grid-cols-2 gap-4\">\r\n                        <div>\r\n                          <Label>Título do Projeto</Label>\r\n                          <Input\r\n                            value={editForm.title || \"\"}\r\n                            onChange={(e) => setEditForm({ ...editForm, title: e.target.value })}\r\n                          />\r\n                        </div>\r\n                        <div>\r\n                          <Label>Cliente</Label>\r\n                          <Input\r\n                            value={editForm.client || \"\"}\r\n                            onChange={(e) => setEditForm({ ...editForm, client: e.target.value })}\r\n                          />\r\n                        </div>\r\n                      </div>\r\n\r\n                      <div>\r\n                        <Label>Descrição</Label>\r\n                        <Textarea\r\n                          value={editForm.description || \"\"}\r\n                          onChange={(e) => setEditForm({ ...editForm, description: e.target.value })}\r\n                          rows={4}\r\n                        />\r\n                      </div>\r\n\r\n                      <div className=\"grid grid-cols-3 gap-4\">\r\n                        <div>\r\n                          <Label>Status</Label>\r\n                          <Select\r\n                            value={editForm.status || \"\"}\r\n                            onValueChange={(value) => setEditForm({ ...editForm, status: value })}\r\n                          >\r\n                            <SelectTrigger>\r\n                              <SelectValue />\r\n                            </SelectTrigger>\r\n                            <SelectContent>\r\n                              {columns.map((column) => (\r\n                                <SelectItem key={column.id} value={column.id}>\r\n                                  <div className=\"flex items-center gap-2\">\r\n                                    <div className=\"w-3 h-3 rounded-full\" style={{ backgroundColor: column.color }} />\r\n                                    {column.title}\r\n                                  </div>\r\n                                </SelectItem>\r\n                              ))}\r\n                            </SelectContent>\r\n                          </Select>\r\n                        </div>\r\n\r\n                        <div>\r\n                          <Label>Prioridade</Label>\r\n                          <Select\r\n                            value={editForm.priority || \"\"}\r\n                            onValueChange={(value: \"low\" | \"medium\" | \"high\" | \"urgent\") =>\r\n                              setEditForm({ ...editForm, priority: value })\r\n                            }\r\n                          >\r\n                            <SelectTrigger>\r\n                              <SelectValue />\r\n                            </SelectTrigger>\r\n                            <SelectContent>\r\n                              <SelectItem value=\"low\">Baixa</SelectItem>\r\n                              <SelectItem value=\"medium\">Média</SelectItem>\r\n                              <SelectItem value=\"high\">Alta</SelectItem>\r\n                              <SelectItem value=\"urgent\">Urgente</SelectItem>\r\n                            </SelectContent>\r\n                          </Select>\r\n                        </div>\r\n\r\n                        <div>\r\n                          <Label>Orçamento (R$)</Label>\r\n                          <Input\r\n                            type=\"number\"\r\n                            value={editForm.budget || 0}\r\n                            onChange={(e) => setEditForm({ ...editForm, budget: Number(e.target.value) })}\r\n                          />\r\n                        </div>\r\n                      </div>\r\n\r\n                      <div className=\"grid grid-cols-2 gap-4\">\r\n                        <div>\r\n                          <Label>Data de Início</Label>\r\n                          <Input\r\n                            type=\"date\"\r\n                            value={editForm.createdAt || \"\"}\r\n                            onChange={(e) => setEditForm({ ...editForm, createdAt: e.target.value })}\r\n                          />\r\n                        </div>\r\n                        <div>\r\n                          <Label>Data de Término</Label>\r\n                          <Input\r\n                            type=\"date\"\r\n                            value={editForm.deadline || \"\"}\r\n                            onChange={(e) => setEditForm({ ...editForm, deadline: e.target.value })}\r\n                          />\r\n                        </div>\r\n                      </div>\r\n\r\n                      <div>\r\n                        <Label>Responsável</Label>\r\n                        <Input\r\n                          value={editForm.assignedTo?.name || \"\"}\r\n                          onChange={(e) =>\r\n                            setEditForm({ ...editForm, assignedTo: { ...editForm.assignedTo, name: e.target.value } })\r\n                          }\r\n                          placeholder=\"Nome do responsável\"\r\n                        />\r\n                      </div>\r\n                    </>\r\n                  ) : (\r\n                    <>\r\n                      <div>\r\n                        <Label className=\"text-sm font-medium\">Descrição</Label>\r\n                        <p className=\"mt-1 text-muted-foreground\">\r\n                          {project.description || \"Nenhuma descrição fornecida.\"}\r\n                        </p>\r\n                      </div>\r\n\r\n                      <div className=\"grid grid-cols-2 gap-4\">\r\n                        <div>\r\n                          <Label className=\"text-sm font-medium\">Criado em</Label>\r\n                          <p className=\"mt-1\">{new Date(project.createdAt).toLocaleDateString(\"pt-BR\")}</p>\r\n                        </div>\r\n                        {project.updatedAt && (\r\n                          <div>\r\n                            <Label className=\"text-sm font-medium\">Última atualização</Label>\r\n                            <p className=\"mt-1\">{new Date(project.updatedAt).toLocaleDateString(\"pt-BR\")}</p>\r\n                          </div>\r\n                        )}\r\n                      </div>\r\n\r\n                      {project.leadId && (\r\n                        <div>\r\n                          <Label className=\"text-sm font-medium\">Convertido do Lead</Label>\r\n                          <p className=\"mt-1\">ID: {project.leadId}</p>\r\n                        </div>\r\n                      )}\r\n                    </>\r\n                  )}\r\n                </CardContent>\r\n              </Card>\r\n            </TabsContent>\r\n\r\n            <TabsContent value=\"modules\" className=\"space-y-6\">\r\n              <Card>\r\n                <CardHeader>\r\n                  <CardTitle className=\"flex items-center gap-2\">\r\n                    <Settings className=\"h-4 w-4\" />\r\n                    Módulos do Projeto\r\n                  </CardTitle>\r\n                </CardHeader>\r\n                <CardContent>\r\n                  <p className=\"text-muted-foreground text-center py-8\">Nenhum módulo definido para este projeto.</p>\r\n                </CardContent>\r\n              </Card>\r\n            </TabsContent>\r\n\r\n            <TabsContent value=\"team\" className=\"space-y-6\">\r\n              <Card>\r\n                <CardHeader>\r\n                  <CardTitle className=\"flex items-center gap-2\">\r\n                    <Users className=\"h-4 w-4\" />\r\n                    Equipe do Projeto\r\n                  </CardTitle>\r\n                </CardHeader>\r\n                <CardContent>\r\n                  {project.people && project.people.length > 0 ? (\r\n                    <div className=\"space-y-4\">\r\n                      <div>\r\n                        <Label className=\"text-sm font-medium\">Responsável Principal</Label>\r\n                        <div className=\"flex items-center gap-2 mt-2 p-3 bg-muted rounded-lg\">\r\n                          <Users className=\"h-4 w-4\" />\r\n                          <span>{project.assignedTo?.name || \"Não definido\"}</span>\r\n                        </div>\r\n                      </div>\r\n\r\n                      <div>\r\n                        <Label className=\"text-sm font-medium\">Membros da Equipe</Label>\r\n                        <div className=\"grid grid-cols-1 md:grid-cols-2 gap-2 mt-2\">\r\n                          {project.people.map((member) => (\r\n                            <div key={member.id} className=\"flex items-center gap-2 p-2 bg-muted rounded\">\r\n                              <Users className=\"h-4 w-4\" />\r\n                              <span>{member.name}</span>\r\n                            </div>\r\n                          ))}\r\n                        </div>\r\n                      </div>\r\n                    </div>\r\n                  ) : (\r\n                    <p className=\"text-muted-foreground text-center py-8\">Nenhum membro da equipe definido.</p>\r\n                  )}\r\n                </CardContent>\r\n              </Card>\r\n            </TabsContent>\r\n\r\n            <TabsContent value=\"timeline\" className=\"space-y-6\">\r\n              <Card>\r\n                <CardHeader>\r\n                  <CardTitle className=\"flex items-center gap-2\">\r\n                    <Calendar className=\"h-4 w-4\" />\r\n                    Timeline do Projeto\r\n                  </CardTitle>\r\n                </CardHeader>\r\n                <CardContent>\r\n                  <div className=\"space-y-4\">\r\n                    {project.tasks && project.tasks.length > 0 ? (\r\n                      project.tasks.map((task) => (\r\n                        <div key={task.id} className=\"flex items-start gap-4\">\r\n                          <div\r\n                            className={`w-4 h-4 rounded-full mt-1 ${task.status === \"completed\" ? \"bg-green-500\" : \"bg-gray-300\"}`}\r\n                          />\r\n                          <div className=\"flex-1\">\r\n                            <div className=\"flex items-center justify-between\">\r\n                              <h4 className=\"font-medium\">{task.title}</h4>\r\n                              <span className=\"text-sm text-muted-foreground\">\r\n                                {task.dueDate ? new Date(task.dueDate).toLocaleDateString(\"pt-BR\") : \"Não definido\"}\r\n                              </span>\r\n                            </div>\r\n                          </div>\r\n                        </div>\r\n                      ))\r\n                    ) : (\r\n                      <div className=\"space-y-4\">\r\n                        <div className=\"flex items-start gap-4\">\r\n                          <div className=\"w-4 h-4 rounded-full bg-green-500 mt-1\" />\r\n                          <div className=\"flex-1\">\r\n                            <div className=\"flex items-center justify-between\">\r\n                              <h4 className=\"font-medium\">Projeto Iniciado</h4>\r\n                              <span className=\"text-sm text-muted-foreground\">\r\n                                {new Date(project.createdAt).toLocaleDateString(\"pt-BR\")}\r\n                              </span>\r\n                            </div>\r\n                          </div>\r\n                        </div>\r\n\r\n                        <div className=\"flex items-start gap-4\">\r\n                          <div\r\n                            className={`w-4 h-4 rounded-full mt-1 ${project.deadline && new Date() > new Date(project.deadline) ? \"bg-red-500\" : \"bg-gray-300\"}`}\r\n                          />\r\n                          <div className=\"flex-1\">\r\n                            <div className=\"flex items-center justify-between\">\r\n                              <h4 className=\"font-medium\">Entrega Prevista</h4>\r\n                              <span className=\"text-sm text-muted-foreground\">\r\n                                {project.deadline\r\n                                  ? new Date(project.deadline).toLocaleDateString(\"pt-BR\")\r\n                                  : \"Não definido\"}\r\n                              </span>\r\n                            </div>\r\n                          </div>\r\n                        </div>\r\n                      </div>\r\n                    )}\r\n                  </div>\r\n                </CardContent>\r\n              </Card>\r\n\r\n              {project.tasks && project.tasks.length > 0 && (\r\n                <Card>\r\n                  <CardHeader>\r\n                    <CardTitle>Tarefas Recentes</CardTitle>\r\n                  </CardHeader>\r\n                  <CardContent>\r\n                    <div className=\"space-y-3\">\r\n                      {project.tasks.slice(0, 5).map((task) => (\r\n                        <div key={task.id} className=\"flex items-center justify-between p-2 border rounded\">\r\n                          <div className=\"flex items-center gap-2\">\r\n                            {task.status === \"completed\" ? (\r\n                              <CheckCircle className=\"h-4 w-4 text-green-600\" />\r\n                            ) : task.status === \"in_progress\" ? (\r\n                              <Clock className=\"h-4 w-4 text-blue-600\" />\r\n                            ) : (\r\n                              <AlertCircle className=\"h-4 w-4 text-gray-400\" />\r\n                            )}\r\n                            <span className=\"text-sm\">{task.title}</span>\r\n                          </div>\r\n                          <div className=\"flex items-center gap-2\">\r\n                            {task.assignedTo && (\r\n                              <span className=\"text-xs text-muted-foreground\">{task.assignedTo}</span>\r\n                            )}\r\n                            {task.dueDate && (\r\n                              <span className=\"text-xs text-muted-foreground\">\r\n                                {new Date(task.dueDate).toLocaleDateString(\"pt-BR\")}\r\n                              </span>\r\n                            )}\r\n                          </div>\r\n                        </div>\r\n                      ))}\r\n                    </div>\r\n                  </CardContent>\r\n                </Card>\r\n              )}\r\n            </TabsContent>\r\n\r\n            <TabsContent value=\"feedback\" className=\"space-y-6\">\r\n              {/* Adicionar Novo Feedback */}\r\n              <Card>\r\n                <CardHeader>\r\n                  <CardTitle className=\"flex items-center gap-2\">\r\n                    <Plus className=\"h-4 w-4\" />\r\n                    Registrar Feedback\r\n                  </CardTitle>\r\n                </CardHeader>\r\n                <CardContent className=\"space-y-4\">\r\n                  <div className=\"grid grid-cols-1 gap-4\">\r\n                    <div className=\"grid grid-cols-4 gap-4\">\r\n                      <div>\r\n                        <Label>Tipo</Label>\r\n                        <Select\r\n                          value={newInteraction.type}\r\n                          onValueChange={(value: \"call\" | \"email\" | \"meeting\" | \"note\" | \"feedback\" | \"milestone\") =>\r\n                            setNewInteraction({ ...newInteraction, type: value })\r\n                          }\r\n                        >\r\n                          <SelectTrigger>\r\n                            <SelectValue />\r\n                          </SelectTrigger>\r\n                          <SelectContent>\r\n                            <SelectItem value=\"call\">Ligação</SelectItem>\r\n                            <SelectItem value=\"email\">Email</SelectItem>\r\n                            <SelectItem value=\"meeting\">Reunião</SelectItem>\r\n                            <SelectItem value=\"note\">Anotação</SelectItem>\r\n                            <SelectItem value=\"feedback\">Feedback</SelectItem>\r\n                            <SelectItem value=\"milestone\">Marco</SelectItem>\r\n                          </SelectContent>\r\n                        </Select>\r\n                      </div>\r\n\r\n                      {newInteraction.type === \"feedback\" && (\r\n                        <>\r\n                          <div>\r\n                            <Label>Tipo de Feedback</Label>\r\n                            <Select\r\n                              value={newInteraction.feedbackType}\r\n                              onValueChange={(value: \"positive\" | \"negative\" | \"neutral\" | \"important\") =>\r\n                                setNewInteraction({ ...newInteraction, feedbackType: value })\r\n                              }\r\n                            >\r\n                              <SelectTrigger>\r\n                                <SelectValue />\r\n                              </SelectTrigger>\r\n                              <SelectContent>\r\n                                <SelectItem value=\"positive\">Positivo</SelectItem>\r\n                                <SelectItem value=\"negative\">Negativo</SelectItem>\r\n                                <SelectItem value=\"neutral\">Neutro</SelectItem>\r\n                                <SelectItem value=\"important\">Importante</SelectItem>\r\n                              </SelectContent>\r\n                            </Select>\r\n                          </div>\r\n                          <div>\r\n                            <Label>Avaliação (1-10)</Label>\r\n                            <Input\r\n                              type=\"number\"\r\n                              min=\"1\"\r\n                              max=\"10\"\r\n                              value={newInteraction.rating}\r\n                              onChange={(e) => setNewInteraction({ ...newInteraction, rating: Number(e.target.value) })}\r\n                            />\r\n                          </div>\r\n                        </>\r\n                      )}\r\n\r\n                      <div className={newInteraction.type === \"feedback\" ? \"col-span-1\" : \"col-span-3\"}>\r\n                        <Label>Descrição</Label>\r\n                        <Input\r\n                          value={newInteraction.description}\r\n                          onChange={(e) => setNewInteraction({ ...newInteraction, description: e.target.value })}\r\n                          placeholder={\r\n                            newInteraction.type === \"feedback\"\r\n                              ? \"Descreva o feedback recebido...\"\r\n                              : newInteraction.type === \"milestone\"\r\n                                ? \"Descreva o marco alcançado...\"\r\n                                : \"Descreva a interação...\"\r\n                          }\r\n                        />\r\n                      </div>\r\n                    </div>\r\n\r\n                    <div className=\"flex justify-end\">\r\n                      <Button onClick={handleAddInteraction} className=\"w-auto\">\r\n                        <Plus className=\"h-4 w-4 mr-2\" />\r\n                        Adicionar{\" \"}\r\n                        {newInteraction.type === \"feedback\"\r\n                          ? \"Feedback\"\r\n                          : newInteraction.type === \"milestone\"\r\n                            ? \"Marco\"\r\n                            : \"Interação\"}\r\n                      </Button>\r\n                    </div>\r\n                  </div>\r\n                </CardContent>\r\n              </Card>\r\n\r\n              {/* Timeline de Feedbacks e Interações */}\r\n              <Card>\r\n                <CardHeader>\r\n                  <CardTitle>Timeline de Feedbacks e Interações</CardTitle>\r\n                </CardHeader>\r\n                <CardContent>\r\n                  {project.interactions && project.interactions.length > 0 ? (\r\n                    <div className=\"space-y-4\">\r\n                      {project.interactions\r\n                        .sort((a, b) => new Date(b.date).getTime() - new Date(a.date).getTime())\r\n                        .map((interaction) => (\r\n                          <div\r\n                            key={interaction.id}\r\n                            className=\"border-l-4 border-blue-200 pl-4 py-3 bg-gray-50 rounded-r-lg\"\r\n                          >\r\n                            <div className=\"flex items-center justify-between mb-2\">\r\n                              <div className=\"flex items-center gap-2\">\r\n                                {getInteractionIcon(interaction.type, interaction.feedbackType)}\r\n                                <Badge\r\n                                  variant=\"outline\"\r\n                                  className={\r\n                                    interaction.type === \"feedback\" && interaction.feedbackType\r\n                                      ? feedbackTypes[interaction.feedbackType].color\r\n                                      : interaction.type === \"milestone\"\r\n                                        ? \"bg-purple-100 text-purple-800\"\r\n                                        : \"\"\r\n                                  }\r\n                                >\r\n                                  {getInteractionLabel(interaction.type)}\r\n                                  {interaction.type === \"feedback\" &&\r\n                                    interaction.feedbackType &&\r\n                                    ` - ${feedbackTypes[interaction.feedbackType].label}`}\r\n                                </Badge>\r\n                                <span className=\"text-sm text-muted-foreground\">\r\n                                  {new Date(interaction.date).toLocaleString(\"pt-BR\")}\r\n                                </span>\r\n                              </div>\r\n                              <span className=\"text-sm text-muted-foreground\">por {interaction.createdBy}</span>\r\n                            </div>\r\n\r\n                            {interaction.type === \"feedback\" && interaction.rating && (\r\n                              <div className=\"flex items-center gap-2 mb-2\">\r\n                                <Star className=\"h-4 w-4 text-yellow-500\" />\r\n                                <span className=\"text-sm font-medium\">Avaliação: {interaction.rating}/10</span>\r\n                                <div className=\"flex gap-1\">\r\n                                  {Array.from({ length: 10 }, (_, i) => (\r\n                                    <div\r\n                                      key={i}\r\n                                      className={`w-2 h-2 rounded-full ${\r\n                                        i < interaction.rating ? \"bg-yellow-400\" : \"bg-gray-200\"\r\n                                      }`}\r\n                                    />\r\n                                  ))}\r\n                                </div>\r\n                              </div>\r\n                            )}\r\n\r\n                            <p className=\"text-sm\">{interaction.description}</p>\r\n                          </div>\r\n                        ))}\r\n                    </div>\r\n                  ) : (\r\n                    <p className=\"text-muted-foreground text-center py-8\">Nenhum feedback registrado ainda.</p>\r\n                  )}\r\n                </CardContent>\r\n              </Card>\r\n\r\n              {/* Resumo de Feedbacks */}\r\n              {project.interactions && project.interactions.filter((i) => i.type === \"feedback\").length > 0 && (\r\n                <Card>\r\n                  <CardHeader>\r\n                    <CardTitle className=\"flex items-center gap-2\">\r\n                      <Star className=\"h-4 w-4\" />\r\n                      Resumo de Feedbacks\r\n                    </CardTitle>\r\n                  </CardHeader>\r\n                  <CardContent>\r\n                    <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4\">\r\n                      {Object.entries(feedbackTypes).map(([type, config]) => {\r\n                        const count =\r\n                          project.interactions?.filter((i) => i.type === \"feedback\" && i.feedbackType === type)\r\n                            .length || 0\r\n                        return (\r\n                          <div key={type} className=\"text-center p-3 bg-muted rounded-lg\">\r\n                            <config.icon className=\"h-6 w-6 mx-auto mb-2\" />\r\n                            <p className=\"text-2xl font-bold\">{count}</p>\r\n                            <p className=\"text-sm text-muted-foreground\">{config.label}</p>\r\n                          </div>\r\n                        )\r\n                      })}\r\n                    </div>\r\n\r\n                    {/* Média de Avaliações */}\r\n                    {(() => {\r\n                      const feedbacksWithRating =\r\n                        project.interactions?.filter((i) => i.type === \"feedback\" && i.rating) || []\r\n                      if (feedbacksWithRating.length > 0) {\r\n                        const averageRating =\r\n                          feedbacksWithRating.reduce((sum, f) => sum + (f.rating || 0), 0) / feedbacksWithRating.length\r\n                        return (\r\n                          <div className=\"mt-4 p-3 bg-blue-50 rounded-lg\">\r\n                            <div className=\"flex items-center justify-center gap-2\">\r\n                              <Star className=\"h-5 w-5 text-yellow-500\" />\r\n                              <span className=\"text-lg font-semibold\">\r\n                                Avaliação Média: {averageRating.toFixed(1)}/10\r\n                              </span>\r\n                            </div>\r\n                            <div className=\"flex justify-center gap-1 mt-2\">\r\n                              {Array.from({ length: 10 }, (_, i) => (\r\n                                <div\r\n                                  key={i}\r\n                                  className={`w-3 h-3 rounded-full ${\r\n                                    i < Math.round(averageRating) ? \"bg-yellow-400\" : \"bg-gray-200\"\r\n                                  }`}\r\n                                />\r\n                              ))}\r\n                            </div>\r\n                          </div>\r\n                        )\r\n                      }\r\n                      return null\r\n                    })()}\r\n                  </CardContent>\r\n                </Card>\r\n              )}\r\n            </TabsContent>\r\n          </div>\r\n        </Tabs>\r\n\r\n        {/* Ações do Footer */}\r\n        {!isEditing && (\r\n          <div className=\"flex justify-between pt-6 border-t\">\r\n            <Button\r\n              variant=\"destructive\"\r\n              onClick={() => {\r\n                if (confirm(\"Tem certeza que deseja excluir este projeto?\")) {\r\n                  onDelete(project.id)\r\n                  onClose()\r\n                }\r\n              }}\r\n            >\r\n              Excluir Projeto\r\n            </Button>\r\n            <div className=\"flex gap-2\">\r\n              <Button variant=\"outline\" onClick={onClose}>\r\n                Fechar\r\n              </Button>\r\n              <Button onClick={handleEdit}>\r\n                <Edit className=\"h-4 w-4 mr-2\" />\r\n                Editar Projeto\r\n              </Button>\r\n            </div>\r\n          </div>\r\n        )}\r\n      </DialogContent>\r\n    </Dialog>\r\n  )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Projetos\\Back_endCrm\\kanbanproject1\\components\\project-kanban.tsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'getIcon' is assigned a value but never used.","line":331,"column":7,"nodeType":"Identifier","messageId":"unusedVar","endLine":331,"endColumn":14},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'getIcon' is assigned a value but never used.","line":331,"column":7,"nodeType":null,"messageId":"unusedVar","endLine":331,"endColumn":14},{"ruleId":"no-unused-vars","severity":1,"message":"'selectedColumn' is assigned a value but never used.","line":394,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":394,"endColumn":24,"suggestions":[{"messageId":"removeVar","data":{"varName":"selectedColumn"},"fix":{"range":[12416,12430],"text":""},"desc":"Remove unused variable 'selectedColumn'."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'selectedColumn' is assigned a value but never used.","line":394,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":394,"endColumn":24},{"ruleId":"no-unused-vars","severity":1,"message":"'setSelectedColumn' is assigned a value but never used.","line":394,"column":26,"nodeType":"Identifier","messageId":"unusedVar","endLine":394,"endColumn":43,"suggestions":[{"messageId":"removeVar","data":{"varName":"setSelectedColumn"},"fix":{"range":[12430,12449],"text":""},"desc":"Remove unused variable 'setSelectedColumn'."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'setSelectedColumn' is assigned a value but never used.","line":394,"column":26,"nodeType":null,"messageId":"unusedVar","endLine":394,"endColumn":43},{"ruleId":"no-unused-vars","severity":1,"message":"'viewMode' is assigned a value but never used.","line":395,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":395,"endColumn":18,"suggestions":[{"messageId":"removeVar","data":{"varName":"viewMode"},"fix":{"range":[12507,12515],"text":""},"desc":"Remove unused variable 'viewMode'."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'viewMode' is assigned a value but never used.","line":395,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":395,"endColumn":18},{"ruleId":"no-unused-vars","severity":1,"message":"'setViewMode' is assigned a value but never used.","line":395,"column":20,"nodeType":"Identifier","messageId":"unusedVar","endLine":395,"endColumn":31,"suggestions":[{"messageId":"removeVar","data":{"varName":"setViewMode"},"fix":{"range":[12515,12528],"text":""},"desc":"Remove unused variable 'setViewMode'."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'setViewMode' is assigned a value but never used.","line":395,"column":20,"nodeType":null,"messageId":"unusedVar","endLine":395,"endColumn":31},{"ruleId":"no-unused-vars","severity":1,"message":"'e' is defined but never used.","line":482,"column":16,"nodeType":"Identifier","messageId":"unusedVar","endLine":482,"endColumn":17},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'e' is defined but never used.","line":482,"column":16,"nodeType":null,"messageId":"unusedVar","endLine":482,"endColumn":17},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'router'. Either include it or remove the dependency array.","line":569,"column":6,"nodeType":"ArrayExpression","endLine":569,"endColumn":56,"suggestions":[{"desc":"Update the dependencies array to be: [selectedFunnelId, isAuthenticated, isAuthLoading, router]","fix":{"range":[18653,18703],"text":"[selectedFunnelId, isAuthenticated, isAuthLoading, router]"}}]},{"ruleId":"no-unused-vars","severity":1,"message":"'saveLeadsTimeoutRef' is assigned a value but never used.","line":571,"column":9,"nodeType":"Identifier","messageId":"unusedVar","endLine":571,"endColumn":28},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'saveLeadsTimeoutRef' is assigned a value but never used.","line":571,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":571,"endColumn":28},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'executeBatchTransfer'. Either include it or remove the dependency array.","line":599,"column":6,"nodeType":"ArrayExpression","endLine":599,"endColumn":34,"suggestions":[{"desc":"Update the dependencies array to be: [batchTransferStates, executeBatchTransfer, leads]","fix":{"range":[19697,19725],"text":"[batchTransferStates, executeBatchTransfer, leads]"}}]},{"ruleId":"no-unused-vars","severity":1,"message":"'getAutomationIcon' is assigned a value but never used.","line":660,"column":9,"nodeType":"Identifier","messageId":"unusedVar","endLine":660,"endColumn":26},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'getAutomationIcon' is assigned a value but never used.","line":660,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":660,"endColumn":26},{"ruleId":"no-unused-vars","severity":1,"message":"'convertIntervalToMs' is assigned a value but never used.","line":680,"column":9,"nodeType":"Identifier","messageId":"unusedVar","endLine":680,"endColumn":28},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'convertIntervalToMs' is assigned a value but never used.","line":680,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":680,"endColumn":28},{"ruleId":"no-unused-vars","severity":1,"message":"'userTransferOption' is assigned a value but never used.","line":801,"column":19,"nodeType":"Identifier","messageId":"unusedVar","endLine":801,"endColumn":37},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'userTransferOption' is assigned a value but never used.","line":801,"column":19,"nodeType":null,"messageId":"unusedVar","endLine":801,"endColumn":37},{"ruleId":"no-duplicate-case","severity":2,"message":"Duplicate case label.","line":881,"column":9,"nodeType":"SwitchCase","messageId":"unexpected","endLine":881,"endColumn":25},{"ruleId":"no-unexpected-multiline","severity":2,"message":"Unexpected newline between function and ( of function call.","line":985,"column":7,"nodeType":"CallExpression","messageId":"function","endLine":985,"endColumn":8},{"ruleId":"no-unused-vars","severity":1,"message":"'updated' is assigned a value but never used.","line":988,"column":19,"nodeType":"Identifier","messageId":"unusedVar","endLine":988,"endColumn":26,"suggestions":[{"messageId":"removeVar","data":{"varName":"updated"},"fix":{"range":[35916,36001],"text":""},"desc":"Remove unused variable 'updated'."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'updated' is assigned a value but never used.","line":988,"column":19,"nodeType":null,"messageId":"unusedVar","endLine":988,"endColumn":26},{"ruleId":"no-unused-vars","severity":1,"message":"'updated' is assigned a value but never used.","line":1044,"column":19,"nodeType":"Identifier","messageId":"unusedVar","endLine":1044,"endColumn":26,"suggestions":[{"messageId":"removeVar","data":{"varName":"updated"},"fix":{"range":[37957,38117],"text":""},"desc":"Remove unused variable 'updated'."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'updated' is assigned a value but never used.","line":1044,"column":19,"nodeType":null,"messageId":"unusedVar","endLine":1044,"endColumn":26},{"ruleId":"no-unused-vars","severity":1,"message":"'index' is defined but never used.","line":2031,"column":45,"nodeType":"Identifier","messageId":"unusedVar","endLine":2031,"endColumn":50,"suggestions":[{"messageId":"removeVar","data":{"varName":"index"},"fix":{"range":[71700,71707],"text":""},"desc":"Remove unused variable 'index'."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'index' is defined but never used.","line":2031,"column":45,"nodeType":null,"messageId":"unusedVar","endLine":2031,"endColumn":50}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":28,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\"\r\n\r\nimport {\r\n  AlertDialog,\r\n  AlertDialogContent,\r\n  AlertDialogHeader,\r\n  AlertDialogFooter,\r\n  AlertDialogTitle,\r\n  AlertDialogDescription,\r\n  AlertDialogAction,\r\n  AlertDialogCancel,\r\n} from \"@/components/ui/alert-dialog\"\r\n\r\n// Removed duplicate imports for AlertDialog components\r\n// import {\r\n//   AlertDialogAction,\r\n//   AlertDialogCancel,\r\n//   AlertDialogContent,\r\n//   AlertDialogDescription,\r\n//   AlertDialogFooter,\r\n//   AlertDialogHeader,\r\n//   AlertDialogTitle,\r\n// } from \"@/components/ui/alert-dialog\"\r\n\r\nimport type React from \"react\"\r\nimport { useState, useEffect, useMemo, useRef } from \"react\" // Added useRef\r\nimport { DragDropContext, Droppable, Draggable } from \"@hello-pangea/dnd\"\r\nimport { Button } from \"@/components/ui/button\"\r\nimport { Card, CardContent } from \"@/components/ui/card\"\r\nimport { Badge } from \"@/components/ui/badge\"\r\nimport {\r\n  Dialog,\r\n  DialogContent,\r\n  DialogHeader,\r\n  DialogTitle,\r\n  DialogDescription,\r\n  DialogFooter,\r\n} from \"@/components/ui/dialog\"\r\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\"\r\nimport {\r\n  DropdownMenu,\r\n  DropdownMenuContent,\r\n  DropdownMenuItem,\r\n  DropdownMenuTrigger,\r\n  DropdownMenuSeparator,\r\n} from \"@/components/ui/dropdown-menu\"\r\nimport { Popover, PopoverContent, PopoverTrigger } from \"@/components/ui/popover\"\r\nimport { useToast } from \"@/hooks/use-toast\"\r\nimport { RadioGroup, RadioGroupItem } from \"@/components/ui/radio-group\"\r\nimport { Label } from \"@/components/ui/label\"\r\nimport {\r\n  Plus,\r\n  Trash2,\r\n  CheckSquare,\r\n  History,\r\n  Zap,\r\n  Download,\r\n  Layers,\r\n  MoreVertical,\r\n  Users,\r\n  Tag,\r\n  Filter,\r\n  X,\r\n  FileSpreadsheet,\r\n  ArrowRightLeft,\r\n  Megaphone,\r\n  ListChecks,\r\n} from \"lucide-react\"\r\nimport { Target, Briefcase, Heart, Star, TrendingUp, Building, Handshake } from \"lucide-react\"\r\n\r\nimport { loadFromStorage, saveToStorage, getCurrentUser } from \"@/lib/storage\"\r\nimport { checkPermissionWithToast } from \"@/lib/permissions\"\r\nimport { getAllUsers } from \"@/lib/auth\"\r\nimport { loadSavedFilters, addSavedFilter, deleteSavedFilter, type SavedFilter } from \"@/lib/saved-filters\"\r\nimport { leadsApi, type CreateLeadRequest } from \"@/lib/api/leads-api\"\r\n\r\n// Import components\r\nimport CreateLeadDialog from \"./create-lead-dialog\"\r\nimport LeadDetailsDialog from \"./lead-details-dialog\"\r\nimport KanbanSettings from \"./kanban-settings\"\r\nimport KanbanTemplates from \"./kanban-templates\"\r\nimport TemplatesHubDialog from \"./templates-hub-dialog\"\r\nimport MessageTemplatesManager from \"./message-templates-manager\"\r\nimport KanbanAutomations from \"./kanban-automations\"\r\nimport { automationsApi } from \"@/lib/api/automations-api\"\r\nimport { apiClient } from \"@/lib/api-client\"\r\nimport TaskCenter from \"./task-center\"\r\nimport LeadsHistoryDashboard from \"./leads-history-dashboard\"\r\nimport FunnelManager from \"./funnel-manager\"\r\nimport UserManagement from \"./user-management\"\r\nimport TagManager from \"./tag-manager\"\r\nimport QueueManagement from \"./queue-management\" // Added import for QueueManagement\r\nimport MassActionAssistantDialog from \"./mass-action-assistant-dialog\"\r\nimport MassActionLogsDialog from \"./mass-action-logs-dialog\"\r\nimport LandingPagesDashboard from \"./landing-pages/landing-pages-dashboard\" // Fixed import path to include landing-pages directory\r\nimport ImportLeadsDialog from \"./import-leads-dialog\"\r\nimport SavedFilterManager from \"./saved-filter-manager\"\r\nimport { Checkbox } from \"@/components/ui/checkbox\" // Import Checkbox component\r\nimport { useRouter } from \"next/navigation\"\r\nimport { useApiAuth } from \"@/hooks/use-api-auth\"\r\nimport { useApiTags } from \"@/hooks/use-api-tags\"\r\nimport type { Tag as TagType } from \"@/lib/api/tags-api\"\r\n\r\n// Tipos\r\ntype Person = {\r\n  id: string\r\n  name: string\r\n  avatar: string\r\n  phone?: string\r\n  email?: string\r\n}\r\n\r\ntype Lead = {\r\n  id: string\r\n  title: string\r\n  client: string\r\n  clientEmail?: string\r\n  clientPhone?: string\r\n  clientAddress?: string\r\n  source: string\r\n  status: string\r\n  assignedTo?: Person\r\n  people: Person[]\r\n  priority?: string\r\n  estimatedValue?: number\r\n  expectedCloseDate?: string\r\n  notes?: string\r\n  createdAt: string\r\n  funnelId?: string\r\n  tags?: string[] // Added tags field to Lead type\r\n  statusHistory?: Array<{\r\n    status: string\r\n    timestamp: string\r\n    duration?: number\r\n    previousStatus?: string // Added for bulk transfer logging\r\n  }>\r\n  interactions?: Array<{\r\n    id: string\r\n    type: \"call\" | \"email\" | \"meeting\" | \"note\" | \"feedback\"\r\n    description: string\r\n    date: string\r\n    createdBy: string\r\n    feedbackType?: \"positive\" | \"negative\" | \"neutral\" | \"important\"\r\n    rating?: number\r\n  }>\r\n}\r\n\r\ntype Task = {\r\n  id: string\r\n  title: string\r\n  description: string\r\n  status: \"pending\" | \"in_progress\" | \"completed\" | \"cancelled\"\r\n  priority: \"low\" | \"medium\" | \"high\" | \"urgent\"\r\n  assignedTo?: {\r\n    id: string\r\n    name: string\r\n    avatar: string\r\n  }\r\n  leadId?: string\r\n  clientName?: string\r\n  dueDate?: string\r\n  createdAt: string\r\n  createdBy: \"automation\" | \"manual\"\r\n  automationId?: string\r\n  completedAt?: string\r\n  tags?: string[]\r\n  relatedConversations?: string[]\r\n}\r\n\r\ntype AutomationTrigger = \"on_enter\" | \"on_exit\" | \"on_time_spent\" | \"on_deadline\" | \"on_response\" | \"on_no_response\"\r\n\r\ntype AutomationAction =\r\n  | {\r\n      type: \"whatsapp\"\r\n      template: string\r\n      recipients: \"assigned\" | \"all_members\" | \"custom\" | \"lead_contact\"\r\n      customRecipients?: string[]\r\n      variables: Record<string, string>\r\n      waitForResponse?: boolean\r\n      responseTimeout?: number\r\n    }\r\n  | {\r\n      type: \"task\"\r\n      title: string\r\n      description: string\r\n      assignTo: \"project_owner\" | \"column_responsible\" | \"custom\"\r\n      customAssignee?: string\r\n      dueDate?: string\r\n      priority: \"low\" | \"medium\" | \"high\"\r\n    }\r\n  | {\r\n      type: \"email\"\r\n      subject: string\r\n      template: string\r\n      recipients: \"assigned\" | \"all_members\" | \"custom\"\r\n      customRecipients?: string[]\r\n      waitForResponse?: boolean\r\n      responseTimeout?: number\r\n    }\r\n  | {\r\n      type: \"notification\"\r\n      title: string\r\n      message: string\r\n      recipients: \"assigned\" | \"all_members\" | \"custom\"\r\n      customRecipients?: string[]\r\n    }\r\n  | {\r\n      type: \"move_lead\"\r\n      targetColumnId: string\r\n      delay?: number\r\n    }\r\n  | {\r\n      type: \"transfer_command\"\r\n      transferType: \"funnel_and_stage\" | \"user_only\"\r\n      targetFunnelId?: string\r\n      targetStageId?: string\r\n      userTransferOption: \"keep_same\" | \"transfer_to_specific\" | \"transfer_to_user\"\r\n      targetUserId?: string\r\n    }\r\n  | {\r\n      type: \"batch_transfer\"\r\n      targetFunnelId?: string\r\n      targetStageId?: string\r\n      batchSize: number\r\n      intervalValue: number\r\n      intervalUnit: \"minutes\" | \"hours\" | \"days\"\r\n      totalLeads?: number\r\n      userTransferOption: \"keep_same\" | \"transfer_to_specific\"\r\n      targetUserId?: string\r\n    }\r\n\r\ntype Automation = {\r\n  id: string\r\n  name: string\r\n  columnId: string\r\n  trigger: AutomationTrigger\r\n  conditions?: {\r\n    leadSource?: string[]\r\n    priority?: string[]\r\n    clientType?: string[]\r\n    leadValue?: { min?: number; max?: number }\r\n  }\r\n  actions: AutomationAction[]\r\n  active: boolean\r\n  delay?: number\r\n}\r\n\r\ntype Funnel = {\r\n  id: string\r\n  name: string\r\n  description: string\r\n  category: string\r\n  icon: string\r\n  columns: Array<{\r\n    id: string\r\n    name: string\r\n    color: string\r\n    order: number\r\n    description?: string\r\n    visible?: boolean\r\n    limit?: number\r\n  }>\r\n  isActive: boolean\r\n  createdAt: string\r\n}\r\n\r\ntype KanbanTemplate = {\r\n  id: string\r\n  name: string\r\n  description: string\r\n  icon: React.ReactNode\r\n  category: string\r\n  columns: Array<{\r\n    id: string\r\n    name: string\r\n    color: string\r\n    order: number\r\n  }>\r\n}\r\n\r\ntype FilterRule = {\r\n  id: string\r\n  field: \"user\" | \"tag\" | \"priority\" | \"source\"\r\n  value: string\r\n}\r\n\r\ntype BatchTransferState = {\r\n  automationId: string\r\n  sourceColumnId: string\r\n  sourceFunnelId: string\r\n  targetFunnelId: string\r\n  targetStageId: string\r\n  batchSize: number\r\n  intervalMs: number\r\n  totalLeads?: number\r\n  processedCount: number\r\n  lastExecutionTime: string\r\n  isActive: boolean\r\n  nextExecutionTime?: string // Added to track when next execution should happen\r\n}\r\n\r\nconst defaultFunnel: Funnel = {\r\n  id: \"default-funnel\",\r\n  name: \"Pipeline de Vendas\",\r\n  description: \"Funil padrão para gerenciamento de leads\",\r\n  category: \"Vendas\",\r\n  icon: \"briefcase\",\r\n  columns: [\r\n    { id: \"novo\", name: \"Novos Leads\", color: \"#64748b\", order: 0, visible: true },\r\n    { id: \"qualificado\", name: \"Qualificados\", color: \"#3b82f6\", order: 1, visible: true },\r\n    { id: \"proposta\", name: \"Proposta\", color: \"#f59e0b\", order: 2, visible: true },\r\n    { id: \"negociacao\", name: \"Negociação\", color: \"#8b5cf6\", order: 3, visible: true },\r\n    { id: \"ganho\", name: \"Ganhos\", color: \"#10b981\", order: 4, visible: true },\r\n    { id: \"perdido\", name: \"Perdidos\", color: \"#ef4444\", order: 5, visible: true },\r\n  ],\r\n  isActive: true,\r\n  createdAt: new Date().toISOString(),\r\n}\r\n\r\nconst people: Person[] = [\r\n  {\r\n    id: \"p1\",\r\n    name: \"Usuário Padrão\",\r\n    avatar: \"/placeholder.svg?height=32&width=32\",\r\n    phone: \"+55 11 99999-0000\",\r\n    email: \"usuario@empresa.com\",\r\n  },\r\n]\r\n\r\n// Função para obter ícone\r\nconst getIcon = (iconId: string) => {\r\n  const icons: Record<string, React.ComponentType<any>> = {\r\n    target: Target,\r\n    users: Users,\r\n    briefcase: Briefcase,\r\n    heart: Heart,\r\n    star: Star,\r\n    \"trending-up\": TrendingUp,\r\n    building: Building,\r\n    handshake: Handshake,\r\n  }\r\n  return icons[iconId] || Target\r\n}\r\n\r\n// Componente principal\r\nexport default function LeadKanban() {\r\n  const { toast } = useToast()\r\n  const router = useRouter()\r\n  const { isAuthenticated, isLoading: isAuthLoading } = useApiAuth()\r\n\r\n  const [leads, setLeads] = useState<Lead[]>([])\r\n  const [tasks, setTasks] = useState<Task[]>([])\r\n  const [funnels, setFunnels] = useState<Funnel[]>([])\r\n  const [selectedFunnelId, setSelectedFunnelId] = useState<string>(\"\")\r\n  const [currentUser, setCurrentUser] = useState<any>(null)\r\n\r\n  const [filterRules, setFilterRules] = useState<FilterRule[]>([])\r\n  const [availableUsers, setAvailableUsers] = useState<any[]>([])\r\n  const { tags: availableTags, fetchTags } = useApiTags()\r\n  const [showFilterPopover, setShowFilterPopover] = useState(false)\r\n  const [savedFilters, setSavedFilters] = useState<SavedFilter[]>([])\r\n\r\n  const [showSettings, setShowSettings] = useState(false)\r\n  const [templatesDialog, setTemplatesDialog] = useState<null | \"hub\" | \"funnel\" | \"messages\">(null)\r\n  const [showAutomations, setShowAutomations] = useState(false)\r\n  const [showTaskCenter, setShowTaskCenter] = useState(false)\r\n  const [showCreateLead, setShowCreateLead] = useState(false)\r\n  const [showHistory, setShowHistory] = useState(false)\r\n  const [showFunnelManager, setShowFunnelManager] = useState(false)\r\n  const [showUserManagement, setShowUserManagement] = useState(false)\r\n  const [showTagManager, setShowTagManager] = useState(false)\r\n  const [showQueueManagement, setShowQueueManagement] = useState(false)\r\n  const [showLandingPages, setShowLandingPages] = useState(false)\r\n  const [showImportLeads, setShowImportLeads] = useState(false)\r\n  const [itemToDelete, setItemToDelete] = useState<Lead | null>(null)\r\n\r\n  const [showMassAction, setShowMassAction] = useState(false)\r\n  const [showMassActionLogs, setShowMassActionLogs] = useState(false)\r\n  const [massActionLogsJobId, setMassActionLogsJobId] = useState<string | null>(null)\r\n\r\n  const [selectedLead, setSelectedLead] = useState<Lead | null>(null)\r\n  const [showLeadDetails, setShowLeadDetails] = useState(false)\r\n  const [historyPeriod, setHistoryPeriod] = useState<\"7d\" | \"30d\" | \"90d\" | \"1y\">(\"30d\")\r\n\r\n  const [automations, setAutomations] = useState<Automation[]>([])\r\n  const [batchTransferStates, setBatchTransferStates] = useState<BatchTransferState[]>([])\r\n\r\n  const [showExportDialog, setShowExportDialog] = useState(false)\r\n  const [exportFilterType, setExportFilterType] = useState<\"complete\" | \"user\" | \"tag\" | \"stage\">(\"complete\")\r\n  const [exportFilterValue, setExportFilterValue] = useState<string>(\"\")\r\n  // Added state for SavedFilterManager visibility\r\n  const [showSavedFilterManager, setShowSavedFilterManager] = useState(false)\r\n\r\n  const [selectedColumn, setSelectedColumn] = useState<Funnel[\"columns\"][0] | null>(null)\r\n  const [viewMode, setViewMode] = useState<\"kanban\" | \"table\">(\"kanban\")\r\n\r\n  const [selectedLeads, setSelectedLeads] = useState<Set<string>>(new Set())\r\n  const [showBulkDeleteDialog, setShowBulkDeleteDialog] = useState(false)\r\n  const [showBulkTransferDialog, setShowBulkTransferDialog] = useState(false)\r\n  const [bulkTransferTargetStage, setBulkTransferTargetStage] = useState<string>(\"\")\r\n\r\n  const handleImportLeads = (importedLeads: any[], funnelId: string, stageId: string) => {\r\n    const now = new Date().toISOString()\r\n    console.log(\r\n      `[v0] handleImportLeads called with ${importedLeads.length} leads for funnel ${funnelId}, stage ${stageId}`,\r\n    )\r\n    console.log(`[v0] Current leads in state:`, leads.length)\r\n\r\n    const newLeads: Lead[] = importedLeads.map((lead, index) => ({\r\n      ...lead,\r\n      id: `lead_${Date.now()}_${index}`,\r\n      createdAt: now,\r\n      funnelId: funnelId,\r\n      status: stageId,\r\n      statusHistory: [\r\n        {\r\n          status: stageId,\r\n          timestamp: now,\r\n          duration: 0,\r\n        },\r\n      ],\r\n      people: lead.people || [],\r\n      tags: lead.tags || [],\r\n    }))\r\n\r\n    console.log(`[v0] Created ${newLeads.length} new lead objects`)\r\n    const updatedLeads = [...leads, ...newLeads]\r\n    console.log(`[v0] Updated leads array length: ${updatedLeads.length}`)\r\n\r\n    // Save to storage FIRST before updating state\r\n    const storageKey = `leads_${funnelId}`\r\n    saveToStorage(updatedLeads, storageKey)\r\n    console.log(`[v0] Saved to storage with key: ${storageKey}`)\r\n\r\n    // Verify it was saved\r\n    const verifyLoad = loadFromStorage(storageKey, [])\r\n    console.log(\r\n      `[v0] Verification load from storage: ${Array.isArray(verifyLoad) ? verifyLoad.length : \"not an array\"} leads`,\r\n    )\r\n\r\n    // Then update state\r\n    setLeads(updatedLeads)\r\n    console.log(`[v0] State updated with ${updatedLeads.length} leads`)\r\n\r\n    setShowImportLeads(false)\r\n    toast({\r\n      title: \"Leads importados\",\r\n      description: `${newLeads.length} leads foram importados com sucesso.`,\r\n    })\r\n  }\r\n\r\n  useEffect(() => {\r\n    const user = getCurrentUser()\r\n    setCurrentUser(user)\r\n\r\n    const storedUsers = loadFromStorage(\"users\", [])\r\n    setAvailableUsers(Array.isArray(storedUsers) ? storedUsers : [])\r\n\r\n    // Load funnels\r\n    const storedFunnels = loadFromStorage(\"funnels\", [])\r\n    console.log(\"[v0] Loading funnels:\", storedFunnels)\r\n\r\n    if (Array.isArray(storedFunnels) && storedFunnels.length > 0) {\r\n      setFunnels(storedFunnels)\r\n      const activeFunnel = storedFunnels.find((f) => f.isActive) || storedFunnels[0]\r\n      setSelectedFunnelId(activeFunnel?.id || \"\")\r\n    } else {\r\n      // First time user - create default funnel\r\n      setFunnels([defaultFunnel])\r\n      setSelectedFunnelId(defaultFunnel.id)\r\n      saveToStorage([defaultFunnel], \"funnels\")\r\n    }\r\n\r\n    // Load tasks\r\n    const storedTasks = loadFromStorage(\"tasks\", [])\r\n    setTasks(Array.isArray(storedTasks) ? storedTasks : [])\r\n\r\n    ;(async () => {\r\n      try {\r\n        const apiAutos = await automationsApi.getAutomations()\r\n        setAutomations(Array.isArray(apiAutos) ? apiAutos as any : [])\r\n      } catch (e) {\r\n        const storedAutomations = loadFromStorage(\"automations\", [])\r\n        setAutomations(Array.isArray(storedAutomations) ? storedAutomations : [])\r\n      }\r\n    })()\r\n\r\n    const storedStates = loadFromStorage(\"batch_transfer_states\", [])\r\n    setBatchTransferStates(Array.isArray(storedStates) ? storedStates : [])\r\n  }, [])\r\n\r\n  useEffect(() => {\r\n    const user = getCurrentUser()\r\n    if (user) {\r\n      setCurrentUser(user)\r\n      const loadedFilters = loadSavedFilters(user.companyId)\r\n      setSavedFilters(loadedFilters)\r\n    }\r\n  }, [])\r\n\r\n  useEffect(() => {\r\n    // Load users for the responsible user filter\r\n    const users = getAllUsers()\r\n    console.log(\"[v0] Loading users for filters:\", users)\r\n    setAvailableUsers(users)\r\n\r\n    fetchTags()\r\n  }, [fetchTags])\r\n\r\n  useEffect(() => {\r\n    if (funnels.length > 0) {\r\n      console.log(\"[v0] Saving funnels:\", funnels.length)\r\n      saveToStorage(funnels, \"funnels\")\r\n    }\r\n\r\n    if (tasks.length >= 0) {\r\n      console.log(\"[v0] Saving tasks:\", tasks.length)\r\n      saveToStorage(tasks, \"tasks\")\r\n    }\r\n\r\n    if (automations.length >= 0) {\r\n      console.log(\"[v0] Saving automations:\", automations.length)\r\n      saveToStorage(automations, \"automations\")\r\n    }\r\n  }, [funnels, tasks, automations])\r\n\r\n  useEffect(() => {\r\n    if (selectedFunnelId && !isAuthLoading) {\r\n      // Verificar autenticação antes de carregar leads\r\n      if (!isAuthenticated) {\r\n        console.warn(\"[v0] Usuário não autenticado, redirecionando para login\")\r\n        router.push(\"/login\")\r\n        return\r\n      }\r\n      \r\n      // Carrega leads da API ao invés do storage legado\r\n      ;(async () => {\r\n        try {\r\n          const apiLeads = await leadsApi.getLeads({ funnelId: selectedFunnelId })\r\n          console.log(`[v0] Loading leads from API for funnel ${selectedFunnelId}:`, apiLeads)\r\n          const convertedLeads: Lead[] = (Array.isArray(apiLeads) ? apiLeads : []).map(apiLead => ({\r\n            ...apiLead,\r\n            source: apiLead.source || '',\r\n            assignedTo: apiLead.assignedTo ? {\r\n              ...apiLead.assignedTo,\r\n              avatar: apiLead.assignedTo.avatar || ''\r\n            } : undefined,\r\n            people: (apiLead.people || []).map(person => ({\r\n              ...person,\r\n              avatar: person.avatar || ''\r\n            })),\r\n            statusHistory: apiLead.statusHistory?.map(history => ({\r\n              status: history.status,\r\n              timestamp: history.changedAt\r\n            })),\r\n            interactions: apiLead.interactions?.map(interaction => ({\r\n              ...interaction,\r\n              description: interaction.notes,\r\n              createdBy: interaction.user\r\n            }))\r\n          }))\r\n          setLeads(convertedLeads)\r\n        } catch (err) {\r\n          console.error(`[v0] Failed to load leads from API for funnel ${selectedFunnelId}:`, err)\r\n          setLeads([])\r\n        }\r\n      })()\r\n    }\r\n  }, [selectedFunnelId, isAuthenticated, isAuthLoading])\r\n\r\n  const saveLeadsTimeoutRef = useRef<NodeJS.Timeout>()\r\n  // Remove o salvamento em storage legado para evitar avisos depreciação\r\n  // Leads agora são carregados e persistidos via API\r\n\r\n  useEffect(() => {\r\n    if (batchTransferStates.length >= 0) {\r\n      saveToStorage(batchTransferStates, \"batch_transfer_states\")\r\n    }\r\n  }, [batchTransferStates])\r\n\r\n  useEffect(() => {\r\n    const checkInterval = setInterval(() => {\r\n      const now = new Date().getTime()\r\n\r\n      batchTransferStates.forEach((state) => {\r\n        if (!state.isActive) return\r\n\r\n        // Check if it's time to execute\r\n        const nextExecution = state.nextExecutionTime ? new Date(state.nextExecutionTime).getTime() : 0\r\n\r\n        if (now >= nextExecution) {\r\n          console.log(\"[v0] Time to execute batch transfer for automation:\", state.automationId)\r\n          executeBatchTransfer(state)\r\n        }\r\n      })\r\n    }, 1000) // Check every second\r\n\r\n    return () => clearInterval(checkInterval)\r\n  }, [batchTransferStates, leads]) // Depend on both states and leads\r\n\r\n  useEffect(() => {\r\n    const executeImmediatelyIfNeeded = () => {\r\n      automations.forEach((automation) => {\r\n        const batchAction = automation.actions.find((a) => a.type === \"batch_transfer\")\r\n        if (batchAction && automation.active) {\r\n          // Assuming 'automation.columnId' refers to the source column within its own funnel\r\n          // and the batch transfer moves leads to a different funnel/stage.\r\n          const sourceLeads = leads.filter((l) => l.status === automation.columnId)\r\n\r\n          // If there are leads in the source column and no batch transfer is active for this automation\r\n          if (sourceLeads.length > 0) {\r\n            const existingState = batchTransferStates.find((s) => s.automationId === automation.id)\r\n            if (!existingState) {\r\n              // Calculate interval in milliseconds\r\n              let intervalMs = batchAction.intervalValue * 1000\r\n              if (batchAction.intervalUnit === \"minutes\") {\r\n                intervalMs *= 60\r\n              } else if (batchAction.intervalUnit === \"hours\") {\r\n                intervalMs *= 60 * 60\r\n              } else if (batchAction.intervalUnit === \"days\") {\r\n                intervalMs *= 60 * 60 * 24\r\n              }\r\n\r\n              const now = new Date()\r\n              const newState: BatchTransferState = {\r\n                automationId: automation.id,\r\n                sourceColumnId: automation.columnId,\r\n                sourceFunnelId: selectedFunnelId, // Set the current funnel as source funnel\r\n                targetFunnelId: batchAction.targetFunnelId || selectedFunnelId,\r\n                targetStageId: batchAction.targetStageId || automation.columnId,\r\n                batchSize: batchAction.batchSize,\r\n                intervalMs,\r\n                totalLeads: batchAction.totalLeads,\r\n                processedCount: 0,\r\n                lastExecutionTime: now.toISOString(),\r\n                isActive: true,\r\n                nextExecutionTime: now.toISOString(), // Execute immediately on first run\r\n              }\r\n\r\n              setBatchTransferStates((prev) => [...prev, newState])\r\n            }\r\n          }\r\n        }\r\n      })\r\n    }\r\n\r\n    executeImmediatelyIfNeeded()\r\n  }, [automations, leads, selectedFunnelId, batchTransferStates])\r\n\r\n  // Funil selecionado\r\n  const selectedFunnel = funnels.find((f) => f.id === selectedFunnelId) || funnels[0]\r\n  const currentColumns = selectedFunnel?.columns || []\r\n\r\n  // Helper to check if a column has an active automation\r\n  const hasColumnAutomation = (columnId: string): boolean => {\r\n    return automations.some((auto) => auto.columnId === columnId && auto.active)\r\n  }\r\n\r\n  // Função para obter ícone de automação\r\n  const getAutomationIcon = (type: Automation[\"actions\"][number][\"type\"]) => {\r\n    switch (type) {\r\n      case \"whatsapp\":\r\n        return \"💬\" // WhatsApp icon\r\n      case \"email\":\r\n        return \"📧\" // Email icon\r\n      case \"task\":\r\n        return \"✅\" // Task icon\r\n      case \"notification\":\r\n        return \"🔔\" // Notification icon\r\n      case \"transfer_command\":\r\n        return \"➡️\" // Transfer icon\r\n      case \"batch_transfer\":\r\n        return \"⏳\" // Batch transfer icon\r\n      default:\r\n        return \"❓\" // Unknown icon\r\n    }\r\n  }\r\n\r\n  // Helper function to convert interval to milliseconds\r\n  const convertIntervalToMs = (intervalValue: number, intervalUnit: string): number => {\r\n    let ms = intervalValue * 1000\r\n    if (intervalUnit === \"minutes\") {\r\n      ms *= 60\r\n    } else if (intervalUnit === \"hours\") {\r\n      ms *= 60 * 60\r\n    } else if (intervalUnit === \"days\") {\r\n      ms *= 60 * 60 * 24\r\n    }\r\n    return ms\r\n  }\r\n\r\n  // Função para executar automações\r\n  const executeAutomationActions = async (automation: Automation, lead: Lead) => {\r\n    const normalizePhone = (raw?: string) => (raw || \"\").replace(/[^0-9]/g, \"\")\r\n    const formatTemplate = (template: string, vars: Record<string, string> = {}) => {\r\n      const defaults: Record<string, string> = {\r\n        client_name: lead.client || \"\",\r\n        company_name: lead.title || \"\",\r\n        deadline: lead.expectedCloseDate || \"\",\r\n      }\r\n      const merged = { ...defaults, ...vars }\r\n      return Object.keys(merged).reduce((msg, key) => msg.replace(new RegExp(`\\\\{${key}\\\\}`, \"g\"), merged[key] || \"\"), template)\r\n    }\r\n    for (const action of automation.actions) {\r\n      switch (action.type) {\r\n        case \"whatsapp\": {\r\n          const tpl = formatTemplate((action as any).template || \"\", (action as any).variables || {})\r\n          if (!tpl || !tpl.trim()) { break }\r\n          const recType = (action as any).recipients || \"lead_contact\"\r\n          const recipients: string[] = []\r\n          if (recType === \"lead_contact\") {\r\n            if (lead.clientPhone) recipients.push(normalizePhone(lead.clientPhone))\r\n          } else if (recType === \"assigned\") {\r\n            if (lead.assignedTo?.phone) recipients.push(normalizePhone(lead.assignedTo.phone))\r\n          } else if (recType === \"custom\") {\r\n            const list = (action as any).customRecipients || []\r\n            list.forEach((p: string) => recipients.push(normalizePhone(p)))\r\n          } else if (recType === \"all_members\") {\r\n            (availableUsers || []).forEach((u: any) => { if (u?.phone) recipients.push(normalizePhone(u.phone)) })\r\n          }\r\n\r\n          const uniqueRecipients = Array.from(new Set(recipients.filter(Boolean)))\r\n          for (const phone of uniqueRecipients) {\r\n            if (!phone || phone.length < 10) { continue }\r\n            try {\r\n              await apiClient.post(\"/whatsapp/send-message\", { contactId: phone, message: tpl, timestamp: new Date().toISOString() })\r\n              const nowISO = new Date().toISOString()\r\n              void leadsApi.addInteraction(lead.id, { type: \"note\", date: nowISO, notes: `WhatsApp enviado para ${phone}` })\r\n            } catch (err) {\r\n              console.error(\"[v0] Falha ao enviar WhatsApp via API\", err)\r\n              const nowISO = new Date().toISOString()\r\n              void leadsApi.addInteraction(lead.id, { type: \"note\", date: nowISO, notes: `Falha ao enviar WhatsApp para ${phone}` })\r\n            }\r\n          }\r\n          break\r\n        }\r\n        case \"batch_transfer\":\r\n          if (action.targetFunnelId && action.targetStageId) {\r\n            // Calculate interval in milliseconds\r\n            let intervalMs = action.intervalValue * 1000\r\n            if (action.intervalUnit === \"minutes\") {\r\n              intervalMs *= 60\r\n            } else if (action.intervalUnit === \"hours\") {\r\n              intervalMs *= 60 * 60\r\n            } else if (action.intervalUnit === \"days\") {\r\n              intervalMs *= 60 * 60 * 24\r\n            }\r\n\r\n            // Create or update batch transfer state\r\n            const existingState = batchTransferStates.find((s) => s.automationId === automation.id)\r\n\r\n            if (!existingState) {\r\n              const now = new Date()\r\n              const newState: BatchTransferState = {\r\n                automationId: automation.id,\r\n                sourceColumnId: automation.columnId,\r\n                sourceFunnelId: selectedFunnelId, // Capture the current funnel ID\r\n                targetFunnelId: action.targetFunnelId,\r\n                targetStageId: action.targetStageId,\r\n                batchSize: action.batchSize,\r\n                intervalMs,\r\n                totalLeads: action.totalLeads,\r\n                processedCount: 0,\r\n                lastExecutionTime: now.toISOString(),\r\n                isActive: true,\r\n                nextExecutionTime: now.toISOString(), // Execute immediately\r\n              }\r\n\r\n              setBatchTransferStates((prev) => [...prev, newState])\r\n\r\n              toast({\r\n                title: \"Disparo em lote iniciado\",\r\n                description: `Processando ${action.batchSize} leads a cada ${action.intervalValue} ${action.intervalUnit === \"minutes\" ? \"minutos\" : action.intervalUnit === \"hours\" ? \"horas\" : \"dias\"}`,\r\n              })\r\n            } else {\r\n              // Reactivate existing state\r\n              setBatchTransferStates((prev) =>\r\n                prev.map((s) =>\r\n                  s.automationId === automation.id\r\n                    ? { ...s, isActive: true, nextExecutionTime: new Date().toISOString() }\r\n                    : s,\r\n                ),\r\n              )\r\n\r\n              toast({\r\n                title: \"Disparo em lote reativado\",\r\n                description: \"O processamento em lote foi retomado\",\r\n              })\r\n            }\r\n          }\r\n          break\r\n\r\n        case \"transfer_command\":\r\n          await new Promise((resolve) => setTimeout(resolve, 3000))\r\n\r\n          // Handle transfer command action\r\n          if (action.transferType === \"funnel_and_stage\") {\r\n            // Transfer to another funnel and stage\r\n            const targetFunnelId = action.targetFunnelId\r\n            const targetStageId = action.targetStageId\r\n            const userTransferOption = action.userTransferOption\r\n\r\n          if (targetFunnelId && targetStageId) {\r\n            try {\r\n              // Persistir transferência de funil/etapa via API\r\n              const updated = await leadsApi.updateLead(lead.id, { funnelId: targetFunnelId, status: targetStageId })\r\n\r\n              // Atualiza estado local\r\n              setLeads((prev) => prev.map((l) => (l.id === lead.id ? { ...l, funnelId: updated.funnelId, status: updated.status } : l)))\r\n\r\n              const targetFunnel = funnels.find((f) => f.id === targetFunnelId)\r\n              const targetStage = targetFunnel?.columns.find((c) => c.id === targetStageId)\r\n\r\n              // Registrar interação da transferência\r\n              const now = new Date().toISOString()\r\n              const notes = `Transferência de funil/etapa: ${lead.funnelId || \"?\"} → ${targetFunnelId} | ${lead.status} → ${targetStageId}`\r\n              void leadsApi.addInteraction(lead.id, { type: \"note\", date: now, notes })\r\n\r\n              toast({\r\n                title: \"Lead transferido\",\r\n                description: `\"${lead.title}\" foi transferido para ${targetFunnel?.name} - ${targetStage?.name}`,\r\n              })\r\n            } catch (err) {\r\n              console.error(\"[v0] Falha ao transferir lead via API\", err)\r\n              toast({\r\n                title: \"Falha na transferência\",\r\n                description: \"Não foi possível salvar a transferência de funil/etapa no servidor.\",\r\n              })\r\n            }\r\n          }\r\n        } else if (action.transferType === \"user_only\") {\r\n            // Transfer only the user\r\n            if (action.targetUserId) {\r\n              const targetUser = availableUsers.find((u) => u.id === action.targetUserId)\r\n              if (targetUser) {\r\n                setLeads((prev) =>\r\n                  prev.map((l) =>\r\n                    l.id === lead.id\r\n                      ? {\r\n                          ...l,\r\n                          assignedTo: targetUser,\r\n                        }\r\n                      : l,\r\n                  ),\r\n                )\r\n\r\n                toast({\r\n                  title: \"Responsável alterado\",\r\n                  description: `\"${lead.title}\" foi transferido para ${targetUser.name}`,\r\n                })\r\n              }\r\n            }\r\n          }\r\n          break\r\n\r\n        case \"task\":\r\n          // Create task action\r\n          if (action.title) {\r\n            const newTask: Task = {\r\n              id: `task_${Date.now()}`,\r\n              title: action.title,\r\n              description: action.description || \"\",\r\n              status: \"pending\",\r\n              priority: action.priority || \"medium\",\r\n              assignedTo: action.assignTo === 'custom' && lead.assignedTo ? {\r\n                id: lead.assignedTo.id,\r\n                name: lead.assignedTo.name,\r\n                avatar: lead.assignedTo.avatar || ''\r\n              } : undefined,\r\n              leadId: lead.id,\r\n              clientName: lead.client,\r\n              dueDate: action.dueDate,\r\n              createdAt: new Date().toISOString(),\r\n              createdBy: \"automation\",\r\n              automationId: automation.id,\r\n            }\r\n            setTasks((prev) => [...prev, newTask])\r\n          }\r\n          break\r\n\r\n        case \"whatsapp\":\r\n        case \"email\":\r\n        case \"notification\":\r\n          // These would require external integrations\r\n          // For now, just show a toast\r\n          toast({\r\n            title: `Ação ${action.type} executada`,\r\n            description: `Ação de ${action.type} foi acionada para o lead \"${lead.title}\"`,\r\n          })\r\n          break\r\n      }\r\n    }\r\n  }\r\n\r\n  const executeBatchTransfer = (state: BatchTransferState) => {\r\n    console.log(\"[v0] Executing batch transfer:\", state)\r\n\r\n    // Fechar modais/abertos antes de operações críticas para evitar erro de reconciliação\r\n    setShowBulkTransferDialog(false)\r\n    setShowBulkDeleteDialog(false)\r\n    setShowFilterPopover(false)\r\n    setShowExportDialog(false)\r\n    setItemToDelete(null)\r\n\r\n    // Buscar leads do estado atual (carregados via API)\r\n    const allLeadsFromState: Lead[] = leads.filter((l: Lead) => l.funnelId === state.sourceFunnelId)\r\n    console.log(\"[v0] Loaded leads from state:\", allLeadsFromState.length, \"for funnel:\", state.sourceFunnelId)\r\n\r\n    const sourceLeads = allLeadsFromState.filter((l: Lead) => l.status === state.sourceColumnId)\r\n    console.log(\"[v0] Found source leads in column:\", sourceLeads.length, \"Column ID:\", state.sourceColumnId)\r\n\r\n    // Calculate how many leads to process\r\n    const remainingLeads = state.totalLeads ? state.totalLeads - state.processedCount : sourceLeads.length\r\n    const leadsToProcess = Math.min(state.batchSize, remainingLeads, sourceLeads.length)\r\n\r\n    console.log(\r\n      \"[v0] Leads to process:\",\r\n      leadsToProcess,\r\n      \"Remaining:\",\r\n      remainingLeads,\r\n      \"Processed so far:\",\r\n      state.processedCount,\r\n    )\r\n\r\n    if (leadsToProcess === 0) {\r\n      // No more leads to process - stop automation\r\n      console.log(\"[v0] Batch transfer complete - no more leads to process\")\r\n      setBatchTransferStates((prev) =>\r\n        prev.map((s) => (s.automationId === state.automationId ? { ...s, isActive: false } : s)),\r\n      )\r\n      toast({\r\n        title: \"Disparo em lote concluído\",\r\n        description: `Todos os leads foram processados (${state.processedCount} leads movidos)`,\r\n      })\r\n      return\r\n    }\r\n\r\n    // Get the leads to move\r\n    const leadsToMove: Lead[] = (sourceLeads as Lead[]).slice(0, leadsToProcess)\r\n\r\n    console.log(\r\n      \"[v0] Moving leads:\",\r\n      leadsToMove.map((l: Lead) => l.id),\r\n    )\r\n\r\n    // Check if moving within the same funnel or to a different funnel\r\n    if (state.sourceFunnelId === state.targetFunnelId) {\r\n      const updatedLeads: Lead[] = allLeadsFromState.map((lead: Lead) => {\r\n        const leadToMove = leadsToMove.find((ltm: any) => ltm.id === lead.id)\r\n        if (leadToMove) {\r\n          // Update status history\r\n          const now = new Date().toISOString()\r\n          const currentHistory = lead.statusHistory || []\r\n\r\n          const updatedHistory = currentHistory.map((history: any, index: number) => {\r\n            if (index === currentHistory.length - 1) {\r\n              const duration = Math.floor(\r\n                (new Date(now).getTime() - new Date(history.timestamp).getTime()) / (1000 * 60 * 60 * 24),\r\n              )\r\n              return { ...history, duration: Math.max(duration, 0) }\r\n            }\r\n            return history\r\n          })\r\n\r\n          const newHistory = [\r\n            ...updatedHistory,\r\n            {\r\n              status: state.targetStageId,\r\n              timestamp: now,\r\n              duration: 0,\r\n            },\r\n          ]\r\n\r\n          const updated = {\r\n            ...lead,\r\n            status: state.targetStageId,\r\n            statusHistory: newHistory,\r\n          }\r\n          return updated\r\n        }\r\n        return lead\r\n      })\r\n\r\n      // Persistir via API e registrar interação\r\n      (async () => {\r\n        for (const lead of leadsToMove) {\r\n          try {\r\n            const updated = await leadsApi.updateStatus(lead.id, { status: state.targetStageId })\r\n            const fromStage = currentColumns.find((c) => c.id === state.sourceColumnId)?.name || state.sourceColumnId\r\n            const toStage = currentColumns.find((c) => c.id === state.targetStageId)?.name || state.targetStageId\r\n            const nowISO = new Date().toISOString()\r\n            void leadsApi.addInteraction(lead.id, {\r\n              type: \"note\",\r\n              date: nowISO,\r\n              notes: `Transferência de fase: ${fromStage} → ${toStage}`,\r\n            })\r\n          } catch (e) {\r\n            console.warn(\"[v0] Falha ao atualizar status no backend\", e)\r\n          }\r\n        }\r\n      })()\r\n\r\n      // Atualiza estado local\r\n      if (selectedFunnelId === state.sourceFunnelId) {\r\n        setLeads(updatedLeads)\r\n      }\r\n    } else {\r\n      // Moving to a different funnel\r\n      const updatedLeads: Lead[] = leadsToMove.map((lead: Lead) => {\r\n        const now = new Date().toISOString()\r\n        const currentHistory = lead.statusHistory || []\r\n\r\n        const updatedHistory = currentHistory.map((history: any, index: number) => {\r\n          if (index === currentHistory.length - 1) {\r\n            const duration = Math.floor(\r\n              (new Date(now).getTime() - new Date(history.timestamp).getTime()) / (1000 * 60 * 60 * 24),\r\n            )\r\n            return { ...history, duration: Math.max(duration, 0) }\r\n          }\r\n          return history\r\n        })\r\n\r\n        const newHistory = [\r\n          ...updatedHistory,\r\n          {\r\n            status: state.targetStageId,\r\n            timestamp: now,\r\n            duration: 0,\r\n          },\r\n        ]\r\n\r\n        return {\r\n          ...lead,\r\n          funnelId: state.targetFunnelId,\r\n          status: state.targetStageId,\r\n          statusHistory: newHistory,\r\n        }\r\n      });\r\n\r\n      // Persistir via API cada lead transferido e registrar interação\r\n      (async () => {\r\n        for (const moved of updatedLeads) {\r\n          try {\r\n            const updated = await leadsApi.updateLead(moved.id, {\r\n              funnelId: state.targetFunnelId,\r\n              status: state.targetStageId,\r\n            })\r\n            const nowISO = new Date().toISOString()\r\n            void leadsApi.addInteraction(moved.id, {\r\n              type: \"note\",\r\n              date: nowISO,\r\n              notes: `Transferência de funil/etapa: ${state.sourceFunnelId} → ${state.targetFunnelId} | ${moved.status} → ${state.targetStageId}`,\r\n            })\r\n          } catch (e) {\r\n            console.warn(\"[v0] Falha ao transferir lead via API\", e)\r\n          }\r\n        }\r\n      })()\r\n\r\n      // Atualizar estado local\r\n      if (selectedFunnelId === state.sourceFunnelId) {\r\n        setLeads((prev) => prev.filter((l) => !updatedLeads.find((m: any) => m.id === l.id)))\r\n      }\r\n      if (selectedFunnelId === state.targetFunnelId) {\r\n        setLeads((prev) => {\r\n          const remaining = prev.filter((l) => !updatedLeads.find((m: any) => m.id === l.id))\r\n          return [...remaining, ...updatedLeads]\r\n        })\r\n      }\r\n    }\r\n\r\n    const newProcessedCount = state.processedCount + leadsToProcess\r\n    const now = new Date()\r\n    const nextExecution = new Date(now.getTime() + state.intervalMs)\r\n\r\n    console.log(\"[v0] Scheduling next execution for:\", nextExecution.toISOString())\r\n\r\n    setBatchTransferStates((prev) =>\r\n      prev.map((s) =>\r\n        s.automationId === state.automationId\r\n          ? {\r\n              ...s,\r\n              processedCount: newProcessedCount,\r\n              lastExecutionTime: now.toISOString(),\r\n              nextExecutionTime: nextExecution.toISOString(), // Schedule next execution\r\n              isActive: true, // Keep active to continue processing\r\n            }\r\n          : s,\r\n      ),\r\n    )\r\n\r\n    toast({\r\n      title: \"Lote processado\",\r\n      description: `${leadsToProcess} leads movidos. Próximo lote em ${state.intervalMs / 1000 / 60} minutos.`,\r\n    })\r\n  }\r\n\r\n  // Função para atualizar histórico de status\r\n  const updateLeadStatusHistory = (leadId: string, newStatus: string) => {\r\n    setLeads((prev) =>\r\n      prev.map((lead) => {\r\n        if (lead.id === leadId) {\r\n          const now = new Date().toISOString()\r\n          const currentHistory = lead.statusHistory || []\r\n\r\n          // Calcular duração da etapa anterior\r\n          const updatedHistory = currentHistory.map((history, index) => {\r\n            if (index === currentHistory.length - 1) {\r\n              const duration = Math.floor(\r\n                (new Date(now).getTime() - new Date(history.timestamp).getTime()) / (1000 * 60 * 60 * 24),\r\n              )\r\n              return { ...history, duration: Math.max(duration, 0) }\r\n            }\r\n            return history\r\n          })\r\n\r\n          // Adicionar nova entrada no histórico\r\n          const newHistory = [\r\n            ...updatedHistory,\r\n            {\r\n              status: newStatus,\r\n              timestamp: now,\r\n              duration: 0,\r\n            },\r\n          ]\r\n\r\n          return {\r\n            ...lead,\r\n            status: newStatus,\r\n            statusHistory: newHistory,\r\n          }\r\n        }\r\n        return lead\r\n      }),\r\n    )\r\n  }\r\n\r\n  // Funções para gerenciar leads\r\n  const handleCreateLead = async (leadData: Omit<Lead, \"id\" | \"createdAt\">) => {\r\n    const payload: CreateLeadRequest = {\r\n      title: leadData.title,\r\n      client: leadData.client,\r\n      clientEmail: leadData.clientEmail,\r\n      clientPhone: leadData.clientPhone,\r\n      clientAddress: leadData.clientAddress,\r\n      clientType: (leadData as any).clientType,\r\n      clientCNPJ: (leadData as any).clientCNPJ,\r\n      source: leadData.source,\r\n      status: leadData.status,\r\n      priority: (leadData.priority as any) || undefined,\r\n      assignedTo: leadData.assignedTo\r\n        ? { id: leadData.assignedTo.id, name: leadData.assignedTo.name, email: leadData.assignedTo.email }\r\n        : undefined,\r\n      people: Array.isArray((leadData as any).people) ? (leadData as any).people : undefined,\r\n      funnelId: selectedFunnelId,\r\n      estimatedValue: leadData.estimatedValue,\r\n      expectedCloseDate: leadData.expectedCloseDate,\r\n      notes: leadData.notes,\r\n      tags: leadData.tags,\r\n      contacts: Array.isArray((leadData as any).contacts)\r\n        ? (leadData as any).contacts.map((c: any) => ({\r\n            id: c.id,\r\n            name: c.name,\r\n            email: c.email,\r\n            phone: c.phone,\r\n            isPrincipal: !!c.isPrincipal,\r\n          }))\r\n        : undefined,\r\n    }\r\n\r\n    try {\r\n      const created = await leadsApi.createLead(payload)\r\n      console.log(\"[v0] Lead created via API:\", created)\r\n      const convertedLead: Lead = {\r\n        ...created,\r\n        source: created.source || '',\r\n        assignedTo: created.assignedTo ? {\r\n          ...created.assignedTo,\r\n          avatar: created.assignedTo.avatar || ''\r\n        } : undefined,\r\n        people: (created.people || []).map(person => ({\r\n          ...person,\r\n          avatar: person.avatar || ''\r\n        })),\r\n        statusHistory: created.statusHistory?.map(history => ({\r\n          status: history.status,\r\n          timestamp: history.changedAt\r\n        })),\r\n        interactions: created.interactions?.map(interaction => ({\r\n          ...interaction,\r\n          description: interaction.notes,\r\n          createdBy: interaction.user\r\n        }))\r\n      }\r\n      setLeads((prev) => [...prev, convertedLead])\r\n      toast({\r\n        title: \"Lead criado com sucesso!\",\r\n        description: `O lead \"${created.title}\" foi adicionado ao pipeline.`,\r\n      })\r\n    } catch (err) {\r\n      console.error(\"[v0] Failed to create lead via API:\", err)\r\n      toast({\r\n        title: \"Erro ao criar lead\",\r\n        description: \"Não foi possível salvar o lead no servidor.\",\r\n        variant: \"destructive\",\r\n      })\r\n    }\r\n  }\r\n\r\n  const handleDeleteLead = async (leadId: string) => {\r\n    try {\r\n      await leadsApi.deleteLead(leadId)\r\n      setLeads((prev) => prev.filter((lead) => lead.id !== leadId))\r\n      setItemToDelete(null)\r\n      toast({\r\n        title: \"Lead excluído\",\r\n        description: \"O lead foi removido com sucesso\",\r\n      })\r\n    } catch (err) {\r\n      console.error(\"[v0] Failed to delete lead via API:\", err)\r\n      toast({\r\n        title: \"Erro ao excluir lead\",\r\n        description: \"Não foi possível remover o lead no servidor.\",\r\n        variant: \"destructive\",\r\n      })\r\n    }\r\n  }\r\n\r\n  const toggleLeadSelection = (leadId: string) => {\r\n    setSelectedLeads((prev) => {\r\n      const newSet = new Set(prev)\r\n      if (newSet.has(leadId)) {\r\n        newSet.delete(leadId)\r\n      } else {\r\n        // Limit to 100 leads\r\n        if (newSet.size < 100) {\r\n          newSet.add(leadId)\r\n        } else {\r\n          toast({\r\n            title: \"Limite atingido\",\r\n            description: \"Você pode selecionar no máximo 100 leads por vez\",\r\n            variant: \"destructive\",\r\n          })\r\n        }\r\n      }\r\n      return newSet\r\n    })\r\n  }\r\n\r\n  const handleBulkDelete = () => {\r\n    // Fechar modais/abertos antes de operações críticas para evitar erro de reconciliação\r\n    setShowBulkTransferDialog(false)\r\n    setShowBulkDeleteDialog(false)\r\n    setShowFilterPopover(false)\r\n    setShowExportDialog(false)\r\n    setItemToDelete(null)\r\n\r\n    const count = selectedLeads.size\r\n    setLeads((prev) => prev.filter((lead) => !selectedLeads.has(lead.id)))\r\n    setSelectedLeads(new Set())\r\n    toast({\r\n      title: \"Leads excluídos\",\r\n      description: `${count} leads foram removidos com sucesso`,\r\n    })\r\n  }\r\n\r\n  const handleBulkTransfer = () => {\r\n    if (!bulkTransferTargetStage) {\r\n      toast({\r\n        title: \"Selecione uma etapa\",\r\n        description: \"Escolha a etapa de destino para transferir os leads\",\r\n        variant: \"destructive\",\r\n      })\r\n      return\r\n    }\r\n\r\n    const count = selectedLeads.size\r\n    const now = new Date().toISOString()\r\n\r\n    setLeads((prev) =>\r\n      prev.map((lead) => {\r\n        if (selectedLeads.has(lead.id)) {\r\n          const previousStatus = lead.status\r\n          const previousStatusEntry = lead.statusHistory?.[lead.statusHistory.length - 1]\r\n          const duration = previousStatusEntry\r\n            ? new Date(now).getTime() - new Date(previousStatusEntry.timestamp).getTime()\r\n            : 0\r\n\r\n          return {\r\n            ...lead,\r\n            status: bulkTransferTargetStage,\r\n            statusHistory: [\r\n              ...(lead.statusHistory || []),\r\n              {\r\n                status: bulkTransferTargetStage,\r\n                timestamp: now,\r\n                duration,\r\n                previousStatus,\r\n              },\r\n            ],\r\n          }\r\n        }\r\n        return lead\r\n      }),\r\n    )\r\n\r\n    setSelectedLeads(new Set())\r\n    setShowBulkTransferDialog(false)\r\n    setBulkTransferTargetStage(\"\")\r\n\r\n    const targetColumn = currentColumns.find((col) => col.id === bulkTransferTargetStage)\r\n    toast({\r\n      title: \"Leads transferidos\",\r\n      description: `${count} leads foram movidos para ${targetColumn?.name || \"a etapa selecionada\"}`,\r\n    })\r\n  }\r\n\r\n  const selectAllLeadsInColumn = (columnId: string) => {\r\n    const columnLeads = getFilteredLeads().filter((lead) => lead.status === columnId)\r\n\r\n    const allSelected = columnLeads.every((lead) => selectedLeads.has(lead.id))\r\n\r\n    if (allSelected) {\r\n      // Deselect all leads in this column\r\n      setSelectedLeads((prev) => {\r\n        const newSet = new Set(prev)\r\n        columnLeads.forEach((lead) => newSet.delete(lead.id))\r\n        return newSet\r\n      })\r\n      return\r\n    }\r\n\r\n    // Select all leads in column (existing logic)\r\n    const leadsToAdd = columnLeads.slice(0, 100 - selectedLeads.size)\r\n\r\n    if (columnLeads.length > leadsToAdd.length) {\r\n      toast({\r\n        title: \"Limite atingido\",\r\n        description: `Apenas ${leadsToAdd.length} leads foram selecionados devido ao limite de 100`,\r\n        variant: \"destructive\",\r\n      })\r\n    }\r\n\r\n    setSelectedLeads((prev) => {\r\n      const newSet = new Set(prev)\r\n      leadsToAdd.forEach((lead) => newSet.add(lead.id))\r\n      return newSet\r\n    })\r\n  }\r\n\r\n  const getFilteredLeads = () => {\r\n    return applyFilters(leads)\r\n  }\r\n\r\n  const handleCreateTask = (taskData: Omit<Task, \"id\" | \"createdAt\">) => {\r\n    const newTask: Task = {\r\n      ...taskData,\r\n      id: `task_${Date.now()}`,\r\n      createdAt: new Date().toISOString(),\r\n    }\r\n    setTasks((prev) => [...prev, newTask])\r\n\r\n    toast({\r\n      title: \"Tarefa criada\",\r\n      description: `A tarefa \"${newTask.title}\" foi criada.`,\r\n    })\r\n  }\r\n\r\n  const handleUpdateTask = (taskId: string, updates: Partial<Task>) => {\r\n    setTasks((prev) =>\r\n      prev.map((task) =>\r\n        task.id === taskId\r\n          ? {\r\n              ...task,\r\n              ...updates,\r\n              completedAt: updates.status === \"completed\" ? new Date().toISOString() : task.completedAt,\r\n            }\r\n          : task,\r\n      ),\r\n    )\r\n\r\n    toast({\r\n      title: \"Tarefa atualizada\",\r\n      description: \"A tarefa foi atualizada com sucesso.\",\r\n    })\r\n  }\r\n\r\n  const handleDeleteTask = (taskId: string) => {\r\n    const task = tasks.find((t) => t.id === taskId)\r\n    setTasks((prev) => prev.filter((t) => t.id !== taskId))\r\n\r\n    if (task) {\r\n      toast({\r\n        title: \"Tarefa excluída\",\r\n        description: `A tarefa \"${task.title}\" foi removida.`,\r\n      })\r\n    }\r\n  }\r\n\r\n  // Função para aplicar template\r\n  const handleApplyTemplate = (template: KanbanTemplate) => {\r\n    // Atualizar as colunas do funil atual\r\n    if (selectedFunnel) {\r\n      const updatedFunnel = {\r\n        ...selectedFunnel,\r\n        columns: template.columns.map((col) => ({\r\n          ...col,\r\n          visible: true,\r\n        })),\r\n      }\r\n      setFunnels((prev) => prev.map((f) => (f.id === selectedFunnelId ? updatedFunnel : f)))\r\n\r\n      toast({\r\n        title: \"Template aplicado\",\r\n        description: `O template \"${template.name}\" foi aplicado ao funil atual.`,\r\n      })\r\n    }\r\n    setShowTemplates(false)\r\n  }\r\n\r\n  // Função para abrir detalhes do lead\r\n  const handleOpenLeadDetails = (leadId: string) => {\r\n    const lead = leads.find((l) => l.id === leadId)\r\n    if (lead) {\r\n      setSelectedLead(lead)\r\n      setShowLeadDetails(true)\r\n    }\r\n  }\r\n\r\n  const handleUserChange = (user: any) => {\r\n    setCurrentUser(user)\r\n    // Optionally refresh data when user changes\r\n    if (user) {\r\n      toast({\r\n        title: \"Usuário alterado\",\r\n        description: `Logado como ${user.name}`,\r\n      })\r\n    }\r\n  }\r\n\r\n  const addFilterRule = () => {\r\n    const newRule: FilterRule = {\r\n      id: `filter_${Date.now()}`,\r\n      field: \"user\",\r\n      value: \"\",\r\n    }\r\n    setFilterRules([...filterRules, newRule])\r\n  }\r\n\r\n  const updateFilterRule = (id: string, field: \"field\" | \"value\", newValue: string) => {\r\n    setFilterRules(filterRules.map((rule) => (rule.id === id ? { ...rule, [field]: newValue } : rule)))\r\n  }\r\n\r\n  const removeFilterRule = (id: string) => {\r\n    setFilterRules(filterRules.filter((rule) => rule.id !== id))\r\n  }\r\n\r\n  const handleSaveFilter = (name: string) => {\r\n    if (!currentUser) return\r\n    const newFilter = addSavedFilter(name, filterRules, currentUser.companyId, currentUser.id)\r\n    setSavedFilters([...savedFilters, newFilter])\r\n    toast({\r\n      title: \"Filtro salvo\",\r\n      description: `O filtro \"${name}\" foi salvo com sucesso.`,\r\n    })\r\n  }\r\n\r\n  const handleDeleteSavedFilter = (filterId: string) => {\r\n    if (!currentUser) return\r\n    deleteSavedFilter(filterId, currentUser.companyId)\r\n    setSavedFilters(savedFilters.filter((f) => f.id !== filterId))\r\n    toast({\r\n      title: \"Filtro excluído\",\r\n      description: \"O filtro foi removido com sucesso.\",\r\n    })\r\n  }\r\n\r\n  const handleApplySavedFilter = (rules: FilterRule[]) => {\r\n    setFilterRules(rules)\r\n    setShowSavedFilterManager(false)\r\n    toast({\r\n      title: \"Filtro aplicado\",\r\n      description: \"O filtro foi aplicado com sucesso.\",\r\n    })\r\n  }\r\n\r\n  // Manipular o arrastar e soltar\r\n  const onDragEnd = async (result: any) => {\r\n    const { destination, source, draggableId } = result\r\n\r\n    if (!destination) return\r\n    if (destination.droppableId === source.droppableId && destination.index === source.index) return\r\n\r\n    const lead = leads.find((l) => l.id === draggableId)\r\n    if (!lead) return\r\n\r\n    // Atualizar status e histórico\r\n    updateLeadStatusHistory(draggableId, destination.droppableId)\r\n\r\n    // Persistir mudança de status no backend\r\n    try {\r\n      const updated = await leadsApi.updateStatus(draggableId, { status: destination.droppableId })\r\n      // Atualiza estado local com retorno da API\r\n      setLeads((prev) => prev.map((l) => (l.id === draggableId ? { ...l, status: updated.status } : l)))\r\n\r\n      // Registrar interação de movimentação de fase\r\n      const fromColumn = currentColumns.find((col) => col.id === source.droppableId)\r\n      const toColumn = currentColumns.find((col) => col.id === destination.droppableId)\r\n      const now = new Date().toISOString()\r\n      const notes = fromColumn && toColumn\r\n        ? `Transferência de fase: ${fromColumn.name} → ${toColumn.name}`\r\n        : `Transferência de fase para ${destination.droppableId}`\r\n      void leadsApi.addInteraction(draggableId, { type: \"note\", date: now, notes })\r\n    } catch (err) {\r\n      console.error(\"[v0] Falha ao persistir status do lead\", err)\r\n      toast({\r\n        title: \"Falha ao atualizar\",\r\n        description: \"Não foi possível salvar a mudança de fase no servidor.\",\r\n      })\r\n    }\r\n\r\n    // Executar automações se houver\r\n    const automation = automations.find((auto) => auto.columnId === destination.droppableId && auto.active && auto.trigger === \"on_enter\")\r\n    if (automation) {\r\n      const delayMin = automation.delay || 0\r\n      if (delayMin > 0) {\r\n        setTimeout(() => { void executeAutomationActions(automation, lead) }, delayMin * 60 * 1000)\r\n      } else {\r\n        await executeAutomationActions(automation, lead)\r\n      }\r\n\r\n      toast({\r\n        title: \"Automação executada\",\r\n        description: `Automação \"${automation.name}\" foi executada para o lead \"${lead.title}\".`,\r\n      })\r\n    }\r\n\r\n    // Toast de movimentação\r\n    const fromColumn = currentColumns.find((col) => col.id === source.droppableId)\r\n    const toColumn = currentColumns.find((col) => col.id === destination.droppableId)\r\n\r\n    if (fromColumn && toColumn) {\r\n      toast({\r\n        title: \"Lead movimentado\",\r\n        description: `\"${lead.title}\" foi movido de \"${fromColumn.name}\" para \"${toColumn.name}\".`,\r\n      })\r\n    }\r\n  }\r\n\r\n  // Contar tarefas por lead\r\n  const getLeadTaskCount = (leadId: string) => {\r\n    return tasks.filter((task) => task.leadId === leadId && task.status !== \"completed\").length\r\n  }\r\n\r\n  const applyFilters = (leads: Lead[]) => {\r\n    let filtered = leads\r\n\r\n    console.log(\"[v0] Filtering leads with rules:\", filterRules)\r\n    console.log(\"[v0] Total leads before filtering:\", leads.length)\r\n\r\n    filterRules.forEach((rule) => {\r\n      if (!rule.value) return\r\n\r\n      switch (rule.field) {\r\n        case \"user\":\r\n          filtered = filtered.filter((lead) => lead.assignedTo?.id === rule.value)\r\n          console.log(\"[v0] After user filter:\", filtered.length)\r\n          break\r\n        case \"tag\":\r\n          filtered = filtered.filter((lead) => {\r\n            const hasTag = lead.tags && Array.isArray(lead.tags) && lead.tags.includes(rule.value)\r\n            console.log(\"[v0] Lead:\", lead.title, \"Tags:\", lead.tags, \"Looking for:\", rule.value, \"Has tag:\", hasTag)\r\n            return hasTag\r\n          })\r\n          console.log(\"[v0] After tag filter:\", filtered.length)\r\n          break\r\n        case \"priority\":\r\n          filtered = filtered.filter((lead) => lead.priority === rule.value)\r\n          console.log(\"[v0] After priority filter:\", filtered.length)\r\n          break\r\n        case \"source\":\r\n          filtered = filtered.filter((lead) => {\r\n            const normalizeSource = (str: string) =>\r\n              str\r\n                .toLowerCase()\r\n                .replace(/[_\\s-]/g, \"\")\r\n                .trim()\r\n\r\n            const leadSource = normalizeSource(lead.source || \"\")\r\n            const filterSource = normalizeSource(rule.value || \"\")\r\n\r\n            const matches = leadSource.includes(filterSource)\r\n\r\n            console.log(\r\n              \"[v0] Lead:\",\r\n              lead.title,\r\n              \"Source:\",\r\n              `\"${lead.source}\"`,\r\n              \"Normalized:\",\r\n              `\"${leadSource}\"`,\r\n              \"Filter:\",\r\n              `\"${rule.value}\"`,\r\n              \"Normalized:\",\r\n              `\"${filterSource}\"`,\r\n              \"Matches:\",\r\n              matches,\r\n            )\r\n\r\n            return matches\r\n          })\r\n          console.log(\"[v0] After source filter:\", filtered.length)\r\n          break\r\n      }\r\n    })\r\n\r\n    console.log(\"[v0] Filtered leads count:\", filtered.length)\r\n    return filtered\r\n  }\r\n\r\n  const clearFilters = () => {\r\n    setFilterRules([])\r\n    setShowFilterPopover(false)\r\n    toast({\r\n      title: \"Filtros limpos\",\r\n      description: \"Todos os filtros foram removidos\",\r\n    })\r\n  }\r\n\r\n  const hasActiveFilters = filterRules.some((rule) => rule.value !== \"\")\r\n\r\n  const availableSources = useMemo(() => {\r\n    const predefinedSources = [\r\n      \"Website\",\r\n      \"Google Ads\",\r\n      \"Facebook Ads\",\r\n      \"LinkedIn\",\r\n      \"Indicação\",\r\n      \"Telefone\",\r\n      \"E-mail\",\r\n      \"Evento\",\r\n      \"Outros\",\r\n    ]\r\n\r\n    // Get unique sources from existing leads\r\n    const leadSources = [...new Set(leads.map((lead) => lead.source).filter(Boolean))]\r\n\r\n    // Combine and deduplicate\r\n    const allSources = [...new Set([...predefinedSources, ...leadSources])]\r\n\r\n    return allSources.sort()\r\n  }, [leads])\r\n\r\n  const handleExportToExcel = (filterType: string, filterValue: string) => {\r\n    try {\r\n      // Dynamically import xlsx library\r\n      import(\"xlsx\").then((XLSX) => {\r\n        const wb = XLSX.utils.book_new()\r\n\r\n        let filteredLeads = leads\r\n        let exportTitle = selectedFunnel?.name || \"Pipeline\"\r\n\r\n        if (filterType === \"user\" && filterValue) {\r\n          filteredLeads = leads.filter((lead) => lead.assignedTo?.id === filterValue)\r\n          const user = availableUsers.find((u) => u.id === filterValue)\r\n          exportTitle += ` - ${user?.name || \"Usuário\"}`\r\n        } else if (filterType === \"tag\" && filterValue) {\r\n          filteredLeads = leads.filter((lead) => lead.tags && lead.tags.includes(filterValue))\r\n          const tag = availableTags.find((t) => t.id === filterValue)\r\n          exportTitle += ` - Tag ${tag?.name || \"\"}`\r\n        } else if (filterType === \"stage\" && filterValue) {\r\n          filteredLeads = leads.filter((lead) => lead.status === filterValue)\r\n          const stage = currentColumns.find((c) => c.id === filterValue)\r\n          exportTitle += ` - ${stage?.name || \"Etapa\"}`\r\n        }\r\n\r\n        // Sheet 1: Leads por Etapa\r\n        const leadsData: any[] = []\r\n        leadsData.push([\r\n          \"Etapa\",\r\n          \"Nome do Lead\",\r\n          \"Cliente\",\r\n          \"Email\",\r\n          \"Telefone\",\r\n          \"Responsável\",\r\n          \"Prioridade\",\r\n          \"Valor Estimado\",\r\n          \"Data Esperada\",\r\n          \"Origem\",\r\n          \"Tags\",\r\n          \"Data de Criação\",\r\n        ])\r\n\r\n        currentColumns.forEach((column) => {\r\n          const columnLeads = filteredLeads.filter((lead) => lead.status === column.id)\r\n          columnLeads.forEach((lead) => {\r\n            const leadTags = lead.tags\r\n              ? availableTags\r\n                  .filter((tag) => lead.tags?.includes(tag.id))\r\n                  .map((t) => t.name)\r\n                  .join(\", \")\r\n              : \"\"\r\n            leadsData.push([\r\n              column.name,\r\n              lead.title,\r\n              lead.client,\r\n              lead.clientEmail || \"\",\r\n              lead.clientPhone || \"\",\r\n              lead.assignedTo?.name || \"\",\r\n              lead.priority === \"urgent\"\r\n                ? \"Urgente\"\r\n                : lead.priority === \"high\"\r\n                  ? \"Alta\"\r\n                  : lead.priority === \"medium\"\r\n                    ? \"Média\"\r\n                    : lead.priority === \"low\"\r\n                      ? \"Baixa\"\r\n                      : \"\",\r\n              lead.estimatedValue || 0,\r\n              lead.expectedCloseDate ? new Date(lead.expectedCloseDate).toLocaleDateString(\"pt-BR\") : \"\",\r\n              lead.source,\r\n              leadTags,\r\n              new Date(lead.createdAt).toLocaleDateString(\"pt-BR\"),\r\n            ])\r\n          })\r\n        })\r\n\r\n        const ws1 = XLSX.utils.aoa_to_sheet(leadsData)\r\n        ws1[\"!cols\"] = [\r\n          { wch: 15 },\r\n          { wch: 25 },\r\n          { wch: 25 },\r\n          { wch: 30 },\r\n          { wch: 15 },\r\n          { wch: 20 },\r\n          { wch: 12 },\r\n          { wch: 15 },\r\n          { wch: 15 },\r\n          { wch: 15 },\r\n          { wch: 30 },\r\n          { wch: 15 },\r\n        ]\r\n        XLSX.utils.book_append_sheet(wb, ws1, \"Leads por Etapa\")\r\n\r\n        // Sheet 2: Estatísticas do Funil\r\n        const statsData: any[] = []\r\n        statsData.push([\"Estatísticas do Funil - \" + exportTitle])\r\n        statsData.push([])\r\n        statsData.push([\"Etapa\", \"Quantidade de Leads\", \"Valor Total (R$)\", \"Valor Médio (R$)\"])\r\n\r\n        currentColumns.forEach((column) => {\r\n          const columnLeads = filteredLeads.filter((lead) => lead.status === column.id)\r\n          const totalValue = columnLeads.reduce((sum, lead) => sum + (lead.estimatedValue || 0), 0)\r\n          const avgValue = columnLeads.length > 0 ? totalValue / columnLeads.length : 0\r\n\r\n          statsData.push([column.name, columnLeads.length, totalValue, avgValue.toFixed(2)])\r\n        })\r\n\r\n        statsData.push([])\r\n        statsData.push([\r\n          \"Total Geral\",\r\n          filteredLeads.length,\r\n          filteredLeads.reduce((sum, lead) => sum + (lead.estimatedValue || 0), 0),\r\n          \"\",\r\n        ])\r\n\r\n        const ws2 = XLSX.utils.aoa_to_sheet(statsData)\r\n        ws2[\"!cols\"] = [{ wch: 20 }, { wch: 20 }, { wch: 20 }, { wch: 20 }]\r\n        XLSX.utils.book_append_sheet(wb, ws2, \"Estatísticas\")\r\n\r\n        // Sheet 3: Resumo por Responsável\r\n        const userStats: any[] = []\r\n        userStats.push([\"Resumo por Responsável\"])\r\n        userStats.push([])\r\n        userStats.push([\"Responsável\", \"Quantidade de Leads\", \"Valor Total (R$)\"])\r\n\r\n        const userMap = new Map<string, { count: number; value: number }>()\r\n        filteredLeads.forEach((lead) => {\r\n          const userName = lead.assignedTo?.name || \"Sem responsável\"\r\n          const current = userMap.get(userName) || { count: 0, value: 0 }\r\n          userMap.set(userName, {\r\n            count: current.count + 1,\r\n            value: current.value + (lead.estimatedValue || 0),\r\n          })\r\n        })\r\n\r\n        userMap.forEach((stats, userName) => {\r\n          userStats.push([userName, stats.count, stats.value])\r\n        })\r\n\r\n        const ws3 = XLSX.utils.aoa_to_sheet(userStats)\r\n        ws3[\"!cols\"] = [{ wch: 25 }, { wch: 20 }, { wch: 20 }]\r\n        XLSX.utils.book_append_sheet(wb, ws3, \"Por Responsável\")\r\n\r\n        // Generate file\r\n        const fileName = `Relatorio_${exportTitle.replace(/\\s+/g, \"_\")}_${new Date().toISOString().split(\"T\")[0]}.xlsx`\r\n        XLSX.writeFile(wb, fileName)\r\n\r\n        toast({\r\n          title: \"Relatório exportado\",\r\n          description: `O arquivo ${fileName} foi baixado com sucesso.`,\r\n        })\r\n\r\n        setShowExportDialog(false)\r\n      })\r\n    } catch (error) {\r\n      console.error(\"[v0] Error exporting to Excel:\", error)\r\n      toast({\r\n        title: \"Erro ao exportar\",\r\n        description: \"Ocorreu um erro ao gerar o arquivo Excel.\",\r\n        variant: \"destructive\",\r\n      })\r\n    }\r\n  }\r\n\r\n  \r\n\r\n  if (funnels.length === 0) {\r\n    return (\r\n      <div className=\"flex items-center justify-center min-h-[400px]\">\r\n        <div className=\"text-center space-y-4\">\r\n          <div className=\"text-6xl\">🎯</div>\r\n          <h2 className=\"text-2xl font-bold\">Bem-vindo ao seu Pipeline de Leads!</h2>\r\n          <p className=\"text-muted-foreground max-w-md\">\r\n            Comece criando seu primeiro funil de vendas para organizar e gerenciar seus leads de forma eficiente.\r\n          </p>\r\n          <Button onClick={() => setShowFunnelManager(true)}>\r\n            <Plus className=\"h-4 w-4 mr-2\" />\r\n            Criar Primeiro Funil\r\n          </Button>\r\n        </div>\r\n      </div>\r\n    )\r\n  }\r\n\r\n  if (showTaskCenter) {\r\n    return (\r\n      <div className=\"space-y-6\">\r\n        <div className=\"flex justify-between items-center\">\r\n          <h1 className=\"text-3xl font-bold\">Central de Tarefas</h1>\r\n          <Button variant=\"outline\" onClick={() => setShowTaskCenter(false)}>\r\n            Voltar ao Pipeline\r\n          </Button>\r\n        </div>\r\n\r\n        <TaskCenter\r\n          tasks={tasks}\r\n          projects={leads.map((l) => ({\r\n            id: l.id,\r\n            title: l.title,\r\n            client: l.client,\r\n            status: l.status,\r\n          }))}\r\n          onUpdateTask={handleUpdateTask as any}\r\n          onCreateTask={handleCreateTask as any}\r\n          onDeleteTask={handleDeleteTask as any}\r\n        />\r\n      </div>\r\n    )\r\n  }\r\n\r\n  if (showHistory) {\r\n    return (\r\n      <div className=\"space-y-6\">\r\n        <div className=\"flex justify-between items-center\">\r\n          <h1 className=\"text-3xl font-bold\">Histórico de Movimentação</h1>\r\n          <Button variant=\"outline\" onClick={() => setShowHistory(false)}>\r\n            Voltar ao Pipeline\r\n          </Button>\r\n        </div>\r\n\r\n        <LeadsHistoryDashboard\r\n          leads={leads.map((l) => ({\r\n            id: l.id,\r\n            name: l.client,\r\n            company: l.title,\r\n            status: l.status,\r\n            priority: l.priority as \"low\" | \"medium\" | \"high\" | \"urgent\",\r\n            source: l.source,\r\n            estimatedValue: l.estimatedValue || 0,\r\n            expectedCloseDate: l.expectedCloseDate || \"\",\r\n            createdAt: l.createdAt,\r\n            statusHistory: l.statusHistory,\r\n          })) as any}\r\n          columns={currentColumns}\r\n          period={historyPeriod}\r\n          onPeriodChange={setHistoryPeriod}\r\n        />\r\n      </div>\r\n    )\r\n  }\r\n\r\n  if (showUserManagement) {\r\n    return (\r\n      <div className=\"space-y-6\">\r\n        <div className=\"flex justify-end\">\r\n          <Button variant=\"outline\" onClick={() => setShowUserManagement(false)}>\r\n            Voltar ao Pipeline\r\n          </Button>\r\n        </div>\r\n        <UserManagement onUserChange={handleUserChange} />\r\n      </div>\r\n    )\r\n  }\r\n\r\n  if (showTagManager) {\r\n    return (\r\n      <div className=\"space-y-6\">\r\n        <div className=\"flex justify-between items-center\">\r\n          <h1 className=\"text-3xl font-bold\">Gerenciamento de Tags</h1>\r\n          <Button variant=\"outline\" onClick={() => setShowTagManager(false)}>\r\n            Voltar ao Pipeline\r\n          </Button>\r\n        </div>\r\n        <TagManager open={showTagManager} onClose={() => setShowTagManager(false)} />\r\n      </div>\r\n    )\r\n  }\r\n\r\n  if (showQueueManagement) {\r\n    return (\r\n      <div className=\"space-y-6\">\r\n        <div className=\"flex justify-between items-center\">\r\n          <h1 className=\"text-3xl font-bold\">Gestão de Filas</h1>\r\n          <Button variant=\"outline\" onClick={() => setShowQueueManagement(false)}>\r\n            Voltar ao Pipeline\r\n          </Button>\r\n        </div>\r\n        <QueueManagement />\r\n      </div>\r\n    )\r\n  }\r\n\r\n  // Added condition for showLandingPages\r\n  if (showLandingPages) {\r\n    return (\r\n      <div className=\"space-y-6\">\r\n        <div className=\"flex justify-between items-center\">\r\n          <h1 className=\"text-3xl font-bold\">Landing Pages</h1>\r\n          <Button variant=\"outline\" onClick={() => setShowLandingPages(false)}>\r\n            Voltar ao Pipeline\r\n          </Button>\r\n        </div>\r\n        <LandingPagesDashboard />\r\n      </div>\r\n    )\r\n  }\r\n\r\n  return (\r\n    <div className=\"space-y-6\">\r\n      {/* Header */}\r\n      <div className=\"flex justify-between items-center\">\r\n        <div className=\"flex items-center gap-4\">\r\n          <h1 className=\"text-3xl font-bold\">Pipeline de Leads</h1>\r\n\r\n          {/* Seletor de Funil */}\r\n          <Select value={selectedFunnelId} onValueChange={setSelectedFunnelId}>\r\n            <SelectTrigger className=\"w-[200px]\">\r\n              <SelectValue placeholder=\"Selecionar funil\" />\r\n            </SelectTrigger>\r\n            <SelectContent>\r\n              {funnels\r\n                .filter((f) => f.isActive)\r\n                .map((funnel) => (\r\n                  <SelectItem key={funnel.id} value={funnel.id}>\r\n                    {funnel.name}\r\n                  </SelectItem>\r\n                ))}\r\n            </SelectContent>\r\n          </Select>\r\n        </div>\r\n\r\n        <div className=\"flex items-center gap-2\">\r\n          {selectedLeads.size > 0 && (\r\n            <>\r\n              <Button variant=\"ghost\" size=\"sm\" onClick={() => setSelectedLeads(new Set())} className=\"gap-2\">\r\n                <X className=\"h-4 w-4\" />\r\n                Desmarcar todos\r\n              </Button>\r\n              <Button\r\n                variant=\"outline\"\r\n                size=\"sm\"\r\n                onClick={() => setShowBulkTransferDialog(true)}\r\n                className=\"gap-2 bg-transparent\"\r\n              >\r\n                <ArrowRightLeft className=\"h-4 w-4\" />\r\n                Transferir {selectedLeads.size}\r\n              </Button>\r\n              <Button variant=\"destructive\" size=\"sm\" onClick={() => setShowBulkDeleteDialog(true)} className=\"gap-2\">\r\n                <Trash2 className=\"h-4 w-4\" />\r\n                Excluir {selectedLeads.size}\r\n              </Button>\r\n            </>\r\n          )}\r\n          <Button variant=\"outline\" size=\"sm\" onClick={() => setShowExportDialog(true)} className=\"bg-transparent\">\r\n            <FileSpreadsheet className=\"h-4 w-4 mr-2\" />\r\n            Exportar\r\n          </Button>\r\n\r\n          <Popover open={showFilterPopover} onOpenChange={setShowFilterPopover}>\r\n            <PopoverTrigger asChild>\r\n              <Button variant=\"outline\" size=\"sm\" className=\"relative bg-transparent\">\r\n                <Filter className=\"h-4 w-4 mr-2\" />\r\n                Filtros\r\n                {hasActiveFilters && (\r\n                  <Badge className=\"ml-2 h-5 w-5 rounded-full p-0 flex items-center justify-center bg-blue-600\">\r\n                    {filterRules.filter((r) => r.value).length}\r\n                  </Badge>\r\n                )}\r\n              </Button>\r\n            </PopoverTrigger>\r\n            <PopoverContent className=\"w-[400px]\" align=\"end\">\r\n              <div className=\"space-y-4\">\r\n                <div className=\"flex items-center justify-between\">\r\n                  <h4 className=\"font-semibold\">Filtros</h4>\r\n                  {hasActiveFilters && (\r\n                    <Button variant=\"ghost\" size=\"sm\" onClick={clearFilters}>\r\n                      <X className=\"h-4 w-4 mr-1\" />\r\n                      Limpar tudo\r\n                    </Button>\r\n                  )}\r\n                </div>\r\n\r\n                {filterRules.length === 0 ? (\r\n                  <div className=\"text-center py-6 text-muted-foreground\">\r\n                    <Filter className=\"h-8 w-8 mx-auto mb-2 opacity-50\" />\r\n                    <p className=\"text-sm\">Nenhum filtro adicionado</p>\r\n                    <p className=\"text-xs mt-1\">Clique em \"Adicionar Filtro\" para começar</p>\r\n                  </div>\r\n                ) : (\r\n                  <div className=\"space-y-3\">\r\n                    {filterRules.map((rule, index) => (\r\n                      <div key={rule.id} className=\"flex items-center gap-2 p-3 border rounded-lg bg-gray-50\">\r\n                        <div className=\"flex-1 space-y-2\">\r\n                          <Select\r\n                            value={rule.field}\r\n                            onValueChange={(value) => updateFilterRule(rule.id, \"field\", value)}\r\n                          >\r\n                            <SelectTrigger className=\"h-9\">\r\n                              <SelectValue />\r\n                            </SelectTrigger>\r\n                            <SelectContent>\r\n                              <SelectItem value=\"user\">\r\n                                <div className=\"flex items-center gap-2\">\r\n                                  <Users className=\"h-4 w-4\" />\r\n                                  Usuário Responsável\r\n                                </div>\r\n                              </SelectItem>\r\n                              <SelectItem value=\"tag\">\r\n                                <div className=\"flex items-center gap-2\">\r\n                                  <Tag className=\"h-4 w-4\" />\r\n                                  Tag\r\n                                </div>\r\n                              </SelectItem>\r\n                              <SelectItem value=\"priority\">\r\n                                <div className=\"flex items-center gap-2\">\r\n                                  <Star className=\"h-4 w-4\" />\r\n                                  Prioridade\r\n                                </div>\r\n                              </SelectItem>\r\n                              <SelectItem value=\"source\">\r\n                                <div className=\"flex items-center gap-2\">\r\n                                  <Target className=\"h-4 w-4\" />\r\n                                  Origem\r\n                                </div>\r\n                              </SelectItem>\r\n                            </SelectContent>\r\n                          </Select>\r\n\r\n                          <Select\r\n                            value={rule.value}\r\n                            onValueChange={(value) => updateFilterRule(rule.id, \"value\", value)}\r\n                          >\r\n                            <SelectTrigger className=\"h-9\">\r\n                              <SelectValue placeholder=\"Selecione um valor...\" />\r\n                            </SelectTrigger>\r\n                            <SelectContent>\r\n                              {rule.field === \"user\" && (\r\n                                <>\r\n                                  {availableUsers.map((user) => (\r\n                                    <SelectItem key={user.id} value={user.id}>\r\n                                      {user.name}\r\n                                    </SelectItem>\r\n                                  ))}\r\n                                </>\r\n                              )}\r\n                              {rule.field === \"tag\" && (\r\n                                <>\r\n                                  {availableTags.map((tag) => (\r\n                                    <SelectItem key={tag.id} value={tag.id}>\r\n                                      <div className=\"flex items-center gap-2\">\r\n                                        <div className=\"w-3 h-3 rounded-full\" style={{ backgroundColor: tag.color }} />\r\n                                        {tag.name}\r\n                                      </div>\r\n                                    </SelectItem>\r\n                                  ))}\r\n                                </>\r\n                              )}\r\n                              {rule.field === \"priority\" && (\r\n                                <>\r\n                                  <SelectItem value=\"urgent\">Urgente</SelectItem>\r\n                                  <SelectItem value=\"high\">Alta</SelectItem>\r\n                                  <SelectItem value=\"medium\">Média</SelectItem>\r\n                                  <SelectItem value=\"low\">Baixa</SelectItem>\r\n                                </>\r\n                              )}\r\n                              {rule.field === \"source\" && (\r\n                                <>\r\n                                  {availableSources.map((source) => (\r\n                                    <SelectItem key={source} value={source}>\r\n                                      {source}\r\n                                    </SelectItem>\r\n                                  ))}\r\n                                </>\r\n                              )}\r\n                            </SelectContent>\r\n                          </Select>\r\n                        </div>\r\n\r\n                        <Button\r\n                          variant=\"ghost\"\r\n                          size=\"sm\"\r\n                          onClick={() => removeFilterRule(rule.id)}\r\n                          className=\"h-9 w-9 p-0 text-red-600 hover:text-red-700 hover:bg-red-50\"\r\n                        >\r\n                          <Trash2 className=\"h-4 w-4\" />\r\n                        </Button>\r\n                      </div>\r\n                    ))}\r\n                  </div>\r\n                )}\r\n\r\n                <Button onClick={addFilterRule} variant=\"outline\" className=\"w-full bg-transparent\">\r\n                  <Plus className=\"h-4 w-4 mr-2\" />\r\n                  Adicionar Filtro\r\n                </Button>\r\n\r\n                {/* Added SavedFilterManager component and related buttons */}\r\n                <Button onClick={() => setShowSavedFilterManager(true)} variant=\"outline\" className=\"w-full\">\r\n                  <Layers className=\"h-4 w-4 mr-2\" />\r\n                  Gerenciar Filtros Salvos\r\n                </Button>\r\n\r\n                {hasActiveFilters && (\r\n                  <div className=\"pt-3 border-t\">\r\n                    <div className=\"text-sm text-muted-foreground\">\r\n                      Mostrando <span className=\"font-semibold text-foreground\">{applyFilters(leads).length}</span> de{\" \"}\r\n                      <span className=\"font-semibold text-foreground\">{leads.length}</span> leads\r\n                    </div>\r\n                  </div>\r\n                )}\r\n              </div>\r\n            </PopoverContent>\r\n          </Popover>\r\n\r\n          {/* Dropdown menu for actions */}\r\n          <DropdownMenu>\r\n            <DropdownMenuTrigger asChild>\r\n              <Button variant=\"outline\" size=\"sm\">\r\n                <MoreVertical className=\"h-4 w-4\" />\r\n              </Button>\r\n            </DropdownMenuTrigger>\r\n            <DropdownMenuContent align=\"end\" className=\"w-48\">\r\n              <DropdownMenuItem onClick={() => setShowHistory(true)}>\r\n                <History className=\"h-4 w-4 mr-2\" />\r\n                Histórico\r\n              </DropdownMenuItem>\r\n              <DropdownMenuItem onClick={() => setShowTaskCenter(true)}>\r\n                <CheckSquare className=\"h-4 w-4 mr-2\" />\r\n                Tarefas\r\n              </DropdownMenuItem>\r\n              <DropdownMenuItem onClick={() => setShowFunnelManager(true)}>\r\n                <Layers className=\"h-4 w-4 mr-2\" />\r\n                Funis\r\n              </DropdownMenuItem>\r\n              <DropdownMenuItem onClick={() => setShowTagManager(true)}>\r\n                <Tag className=\"h-4 w-4 mr-2\" />\r\n                Tags\r\n              </DropdownMenuItem>\r\n              <DropdownMenuItem onClick={() => setShowQueueManagement(true)}>\r\n                <Users className=\"h-4 w-4 mr-2\" />\r\n                Filas\r\n              </DropdownMenuItem>\r\n              <DropdownMenuItem onClick={() => setShowLandingPages(true)}>\r\n                <Layers className=\"h-4 w-4 mr-2\" />\r\n                Landing Pages\r\n              </DropdownMenuItem>\r\n              <DropdownMenuItem onClick={() => setShowImportLeads(true)}>\r\n                <Download className=\"h-4 w-4 mr-2\" />\r\n                Importar Leads\r\n              </DropdownMenuItem>\r\n              <DropdownMenuSeparator />\r\n              <DropdownMenuItem\r\n                onClick={() => {\r\n                  setMassActionLogsJobId(null)\r\n                  setShowMassAction(true)\r\n                }}\r\n              >\r\n                <Megaphone className=\"h-4 w-4 mr-2\" />\r\n                Ação em Massa\r\n              </DropdownMenuItem>\r\n              <DropdownMenuItem\r\n                onClick={() => {\r\n                  setMassActionLogsJobId(null)\r\n                  setShowMassActionLogs(true)\r\n                }}\r\n              >\r\n                <ListChecks className=\"h-4 w-4 mr-2\" />\r\n                Logs de Disparo\r\n              </DropdownMenuItem>\r\n              <DropdownMenuSeparator />\r\n              <DropdownMenuItem onClick={() => setShowAutomations(true)}>\r\n                <Zap className=\"h-4 w-4 mr-2\" />\r\n                Automações\r\n              </DropdownMenuItem>\r\n              <DropdownMenuItem onClick={() => setTemplatesDialog(\"hub\")}>\r\n                <Download className=\"h-4 w-4 mr-2\" />\r\n                Templates\r\n              </DropdownMenuItem>\r\n              <DropdownMenuSeparator />\r\n              <DropdownMenuItem\r\n                onClick={() => {\r\n                  if (checkPermissionWithToast(\"usuarios\", \"Gerenciamento de Usuários\")) {\r\n                    setShowUserManagement(true)\r\n                  }\r\n                }}\r\n              >\r\n                <Users className=\"h-4 w-4 mr-2\" />\r\n                Configurações\r\n              </DropdownMenuItem>\r\n            </DropdownMenuContent>\r\n          </DropdownMenu>\r\n\r\n          <Button onClick={() => setShowCreateLead(true)}>\r\n            <Plus className=\"h-4 w-4 mr-2\" />\r\n            Novo Lead\r\n          </Button>\r\n        </div>\r\n      </div>\r\n\r\n      {hasActiveFilters && (\r\n        <div className=\"flex items-center gap-2 p-3 bg-blue-50 border border-blue-200 rounded-lg\">\r\n          <Filter className=\"h-4 w-4 text-blue-600\" />\r\n          <span className=\"text-sm text-blue-900 font-medium\">Filtros ativos:</span>\r\n          <div className=\"flex flex-wrap gap-2\">\r\n            {filterRules\r\n              .filter((r) => r.value)\r\n              .map((rule) => {\r\n                let displayValue = rule.value\r\n                if (rule.field === \"user\") {\r\n                  displayValue = availableUsers.find((u) => u.id === rule.value)?.name || rule.value\r\n                } else if (rule.field === \"tag\") {\r\n                  displayValue = availableTags.find((t) => t.id === rule.value)?.name || rule.value\r\n                } else if (rule.field === \"priority\") {\r\n                  const priorityMap: Record<string, string> = {\r\n                    urgent: \"Urgente\",\r\n                    high: \"Alta\",\r\n                    medium: \"Média\",\r\n                    low: \"Baixa\",\r\n                  }\r\n                  displayValue = priorityMap[rule.value] || rule.value\r\n                }\r\n\r\n                const fieldMap: Record<string, string> = {\r\n                  user: \"Usuário\",\r\n                  tag: \"Tag\",\r\n                  priority: \"Prioridade\",\r\n                  source: \"Origem\",\r\n                }\r\n\r\n                return (\r\n                  <Badge key={rule.id} variant=\"secondary\" className=\"bg-blue-100 text-blue-800\">\r\n                    {fieldMap[rule.field]}: {displayValue}\r\n                  </Badge>\r\n                )\r\n              })}\r\n          </div>\r\n          <span className=\"text-sm text-blue-700 ml-auto\">\r\n            ({applyFilters(leads).length} de {leads.length} leads)\r\n          </span>\r\n        </div>\r\n      )}\r\n\r\n      {/* Estatísticas rápidas */}\r\n      <div className=\"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-4\">\r\n        {currentColumns.map((column) => {\r\n          const filteredLeads = applyFilters(leads)\r\n          const count = filteredLeads.filter((lead) => lead.status === column.id).length\r\n          const totalValue = filteredLeads\r\n            .filter((lead) => lead.status === column.id)\r\n            .reduce((sum, lead) => sum + (lead.estimatedValue || 0), 0)\r\n\r\n          return (\r\n            <Card key={column.id}>\r\n              <CardContent className=\"p-3\">\r\n                <div className=\"text-center\">\r\n                  <div className=\"w-3 h-3 rounded-full mx-auto mb-2\" style={{ backgroundColor: column.color }} />\r\n                  <p className=\"text-sm font-medium\">{column.name}</p>\r\n                  <p className=\"text-2xl font-bold\">{count}</p>\r\n                  <p className=\"text-xs text-muted-foreground\">R$ {totalValue.toLocaleString(\"pt-BR\")}</p>\r\n                </div>\r\n              </CardContent>\r\n            </Card>\r\n          )\r\n        })}\r\n      </div>\r\n\r\n      {/* Kanban Board */}\r\n      <DragDropContext onDragEnd={onDragEnd}>\r\n        <div\r\n          className=\"grid grid-cols-1 gap-4\"\r\n          style={{ gridTemplateColumns: `repeat(${currentColumns.length}, minmax(0, 1fr))` }}\r\n        >\r\n          {currentColumns\r\n            .sort((a, b) => a.order - b.order)\r\n            .map((column) => {\r\n              const filteredLeads = applyFilters(leads)\r\n              const columnLeads = filteredLeads.filter((lead) => lead.status === column.id)\r\n              const hasAutomation = hasColumnAutomation(column.id)\r\n\r\n              return (\r\n                <div key={column.id} className=\"bg-white rounded-lg shadow flex flex-col h-full\">\r\n                  <div\r\n                    className=\"p-4 rounded-t-lg relative flex-shrink-0\"\r\n                    style={{ backgroundColor: `${column.color}20`, borderTop: `3px solid ${column.color}` }}\r\n                  >\r\n                    <div className=\"flex justify-between items-start gap-2\">\r\n                      <div className=\"flex-1 min-w-0\">\r\n                        <div className=\"flex items-center gap-2 flex-wrap\">\r\n                          <h3 className=\"font-medium truncate\" style={{ color: column.color }}>\r\n                            {column.name}\r\n                          </h3>\r\n                          {hasAutomation && (\r\n                            <div className=\"flex-shrink-0\">\r\n                              <Zap className=\"h-4 w-4 text-yellow-500 fill-yellow-500\" />\r\n                            </div>\r\n                          )}\r\n                        </div>\r\n                        <span className=\"text-sm text-gray-500 block mt-1\">{columnLeads.length} leads</span>\r\n                      </div>\r\n                      {/* Added select all button to column header */}\r\n                      <div className=\"flex items-center gap-1 flex-shrink-0\">\r\n                        {columnLeads.length > 0 && (\r\n                          <Button\r\n                            variant=\"ghost\"\r\n                            size=\"sm\"\r\n                            onClick={() => selectAllLeadsInColumn(column.id)}\r\n                            className=\"h-6 px-2 text-xs\"\r\n                            title=\"Selecionar todos\"\r\n                          >\r\n                            <CheckSquare className=\"h-3 w-3\" />\r\n                          </Button>\r\n                        )}\r\n                        <Button\r\n                          variant=\"ghost\"\r\n                          size=\"sm\"\r\n                          onClick={() => setShowCreateLead(true)}\r\n                          className=\"h-6 w-6 p-0\"\r\n                        >\r\n                          <Plus className=\"h-3 w-3\" />\r\n                        </Button>\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n                  <Droppable droppableId={column.id}>\r\n                    {(provided) => (\r\n                      <div\r\n                        {...provided.droppableProps}\r\n                        ref={provided.innerRef}\r\n                        className=\"p-2 min-h-[200px] max-h-[calc(100vh-400px)] overflow-y-auto flex-1\"\r\n                      >\r\n                        {columnLeads.length === 0 ? (\r\n                          <div className=\"text-center py-8 text-muted-foreground\">\r\n                            <div className=\"text-4xl mb-2\">📋</div>\r\n                            <p className=\"text-sm\">Nenhum lead nesta etapa</p>\r\n                            <Button variant=\"ghost\" size=\"sm\" onClick={() => setShowCreateLead(true)} className=\"mt-2\">\r\n                              <Plus className=\"h-4 w-4 mr-1\" />\r\n                              Adicionar Lead\r\n                            </Button>\r\n                          </div>\r\n                        ) : (\r\n                          columnLeads.map((lead, index) => (\r\n                            <LeadCard\r\n                              key={lead.id}\r\n                              lead={lead}\r\n                              index={index}\r\n                              onClick={() => handleOpenLeadDetails(lead.id)}\r\n                              onDelete={() => setItemToDelete(lead)}\r\n                              taskCount={getLeadTaskCount(lead.id)}\r\n                              isSelected={selectedLeads.has(lead.id)}\r\n                              onToggleSelect={() => toggleLeadSelection(lead.id)}\r\n                              availableTags={availableTags}\r\n                            />\r\n                          ))\r\n                        )}\r\n                        {provided.placeholder}\r\n                      </div>\r\n                    )}\r\n                  </Droppable>\r\n                </div>\r\n              )\r\n            })}\r\n        </div>\r\n      </DragDropContext>\r\n\r\n      {/* Modais */}\r\n      {showCreateLead && (\r\n        <CreateLeadDialog\r\n          open={showCreateLead}\r\n          people={people}\r\n          columns={currentColumns}\r\n          onClose={() => setShowCreateLead(false)}\r\n          onCreate={handleCreateLead}\r\n        />\r\n      )}\r\n\r\n      {showImportLeads && (\r\n        <ImportLeadsDialog\r\n          open={showImportLeads}\r\n          onClose={() => setShowImportLeads(false)}\r\n          onImport={handleImportLeads}\r\n          columns={currentColumns}\r\n          funnels={funnels}\r\n        />\r\n      )}\r\n\r\n      <MassActionAssistantDialog\r\n        open={showMassAction}\r\n        onOpenChange={setShowMassAction}\r\n        initialFunnelId={selectedFunnelId}\r\n        funnels={funnels}\r\n        availableTags={availableTags}\r\n        onOpenTemplates={() => setTemplatesDialog(\"messages\")}\r\n        onOpenLogs={(jobId) => {\r\n          setMassActionLogsJobId(jobId || null)\r\n          setShowMassActionLogs(true)\r\n        }}\r\n      />\r\n\r\n      <MassActionLogsDialog\r\n        open={showMassActionLogs}\r\n        onOpenChange={setShowMassActionLogs}\r\n        initialJobId={massActionLogsJobId}\r\n      />\r\n\r\n      {/* Modal de confirmação de exclusão */}\r\n      {itemToDelete && (\r\n        <Dialog open={true} onOpenChange={() => setItemToDelete(null)}>\r\n          <DialogContent className=\"max-w-md\">\r\n            <DialogHeader>\r\n              <DialogTitle>Confirmar Exclusão</DialogTitle>\r\n            </DialogHeader>\r\n            <div className=\"space-y-4\">\r\n              <p>\r\n                Tem certeza que deseja excluir o lead <strong>\"{itemToDelete.title}\"</strong>?\r\n              </p>\r\n              <p className=\"text-sm text-muted-foreground\">\r\n                Esta ação também removerá todas as tarefas relacionadas e não pode ser desfeita.\r\n              </p>\r\n              <div className=\"flex justify-end gap-2\">\r\n                <Button variant=\"outline\" onClick={() => setItemToDelete(null)}>\r\n                  Cancelar\r\n                </Button>\r\n                <Button variant=\"destructive\" onClick={() => handleDeleteLead(itemToDelete.id)}>\r\n                  <Trash2 className=\"h-4 w-4 mr-2\" />\r\n                  Excluir Lead\r\n                </Button>\r\n              </div>\r\n            </div>\r\n          </DialogContent>\r\n        </Dialog>\r\n      )}\r\n\r\n      {/* Modal de detalhes do lead */}\r\n      {showLeadDetails && (\r\n        <LeadDetailsDialog\r\n          lead={selectedLead}\r\n          open={showLeadDetails}\r\n          onClose={() => {\r\n            setShowLeadDetails(false)\r\n            setSelectedLead(null)\r\n          }}\r\n          onUpdate={(leadId, updates) => {\r\n            // Atualiza a lista geral de leads\r\n            setLeads((prev) => prev.map((l) => (l.id === leadId ? { ...l, ...updates } : l)))\r\n\r\n            // Mantém o modal em sincronia com as mudanças imediatas\r\n            setSelectedLead((prev) => (prev && prev.id === leadId ? { ...prev, ...updates } : prev))\r\n            toast({\r\n              title: \"Lead atualizado\",\r\n              description: \"As informações do lead foram atualizadas com sucesso.\",\r\n            })\r\n          }}\r\n          onDelete={(leadId) => {\r\n            handleDeleteLead(leadId)\r\n            setShowLeadDetails(false)\r\n            setSelectedLead(null)\r\n          }}\r\n          columns={currentColumns}\r\n        />\r\n      )}\r\n\r\n      {/* Modal do Gerenciador de Funis */}\r\n      {showFunnelManager && (\r\n        <FunnelManager\r\n          funnels={funnels}\r\n          onSave={(newFunnels) => {\r\n            setFunnels(newFunnels)\r\n\r\n            // Se o funil selecionado foi removido, selecionar o primeiro ativo\r\n            if (!newFunnels.find((f) => f.id === selectedFunnelId && f.isActive)) {\r\n              const firstActiveFunnel = newFunnels.find((f) => f.isActive)\r\n              if (firstActiveFunnel) {\r\n                setSelectedFunnelId(firstActiveFunnel.id)\r\n              }\r\n            }\r\n\r\n            setShowFunnelManager(false)\r\n            toast({\r\n              title: \"Funis atualizados\",\r\n              description: \"As configurações dos funis foram salvas com sucesso.\",\r\n            })\r\n          }}\r\n          onClose={() => setShowFunnelManager(false)}\r\n        />\r\n      )}\r\n\r\n      {/* Outros modais existentes */}\r\n      {showSettings && (\r\n        <KanbanSettings\r\n          config={{\r\n            columns: currentColumns,\r\n            customFields: [],\r\n          }}\r\n          onSave={(newConfig) => {\r\n            if (selectedFunnel) {\r\n              const updatedFunnel = {\r\n                ...selectedFunnel,\r\n                columns: newConfig.columns,\r\n              }\r\n              setFunnels((prev) => prev.map((f) => (f.id === selectedFunnelId ? updatedFunnel : f)))\r\n            }\r\n            setShowSettings(false)\r\n          }}\r\n          onClose={() => setShowSettings(false)}\r\n        />\r\n      )}\r\n\r\n      {templatesDialog === \"hub\" && (\r\n        <TemplatesHubDialog\r\n          onClose={() => setTemplatesDialog(null)}\r\n          onChoose={(choice) => setTemplatesDialog(choice === \"funnel\" ? \"funnel\" : \"messages\")}\r\n        />\r\n      )}\r\n\r\n      {templatesDialog === \"funnel\" && (\r\n        <KanbanTemplates onApplyTemplate={handleApplyTemplate} onClose={() => setTemplatesDialog(null)} />\r\n      )}\r\n\r\n      {templatesDialog === \"messages\" && (\r\n        <MessageTemplatesManager open={true} onClose={() => setTemplatesDialog(null)} />\r\n      )}\r\n\r\n      {showAutomations && (\r\n        <KanbanAutomations\r\n          columns={currentColumns}\r\n          automations={automations}\r\n          onSave={async (newAutomations) => {\r\n            try {\r\n              // Upsert via API\r\n              for (const a of newAutomations) {\r\n                const payload = {\r\n                  name: a.name,\r\n                  columnId: a.columnId,\r\n                  trigger: a.trigger as any,\r\n                  actions: a.actions as any,\r\n                  active: a.active,\r\n                  delay: a.delay,\r\n                }\r\n                if (a.id) {\r\n                  await automationsApi.updateAutomation(a.id, payload)\r\n                } else {\r\n                  const created = await automationsApi.createAutomation(payload)\r\n                  a.id = created.id\r\n                }\r\n              }\r\n              const latest = await automationsApi.getAutomations()\r\n              setAutomations(latest as any)\r\n            } catch (e) {\r\n              console.error(\"[v0] Falha ao salvar automações via API\", e)\r\n            }\r\n            setShowAutomations(false)\r\n          }}\r\n          onClose={() => setShowAutomations(false)}\r\n        />\r\n      )}\r\n\r\n      <Dialog open={showExportDialog} onOpenChange={setShowExportDialog}>\r\n        <DialogContent className=\"max-w-md\">\r\n          <DialogHeader>\r\n            <DialogTitle>Exportar Relatório</DialogTitle>\r\n          </DialogHeader>\r\n          <div className=\"space-y-4\">\r\n            <div className=\"space-y-3\">\r\n              <Label>Tipo de Exportação</Label>\r\n              <RadioGroup\r\n                value={exportFilterType}\r\n                onValueChange={(value: any) => {\r\n                  setExportFilterType(value)\r\n                  setExportFilterValue(\"\")\r\n                }}\r\n              >\r\n                <div className=\"flex items-center space-x-2\">\r\n                  <RadioGroupItem value=\"complete\" id=\"complete\" />\r\n                  <Label htmlFor=\"complete\" className=\"font-normal cursor-pointer\">\r\n                    Funil Completo\r\n                  </Label>\r\n                </div>\r\n                <div className=\"flex items-center space-x-2\">\r\n                  <RadioGroupItem value=\"user\" id=\"user\" />\r\n                  <Label htmlFor=\"user\" className=\"font-normal cursor-pointer\">\r\n                    Leads por Usuário\r\n                  </Label>\r\n                </div>\r\n                <div className=\"flex items-center space-x-2\">\r\n                  <RadioGroupItem value=\"tag\" id=\"tag\" />\r\n                  <Label htmlFor=\"tag\" className=\"font-normal cursor-pointer\">\r\n                    Leads por Tag\r\n                  </Label>\r\n                </div>\r\n                <div className=\"flex items-center space-x-2\">\r\n                  <RadioGroupItem value=\"stage\" id=\"stage\" />\r\n                  <Label htmlFor=\"stage\" className=\"font-normal cursor-pointer\">\r\n                    Leads por Etapa\r\n                  </Label>\r\n                </div>\r\n              </RadioGroup>\r\n            </div>\r\n\r\n            {exportFilterType === \"user\" && (\r\n              <div className=\"space-y-2\">\r\n                <Label>Selecionar Usuário</Label>\r\n                <Select value={exportFilterValue} onValueChange={setExportFilterValue}>\r\n                  <SelectTrigger>\r\n                    <SelectValue placeholder=\"Escolha um usuário...\" />\r\n                  </SelectTrigger>\r\n                  <SelectContent>\r\n                    {availableUsers.map((user) => (\r\n                      <SelectItem key={user.id} value={user.id}>\r\n                        {user.name}\r\n                      </SelectItem>\r\n                    ))}\r\n                  </SelectContent>\r\n                </Select>\r\n              </div>\r\n            )}\r\n\r\n            {exportFilterType === \"tag\" && (\r\n              <div className=\"space-y-2\">\r\n                <Label>Selecionar Tag</Label>\r\n                <Select value={exportFilterValue} onValueChange={setExportFilterValue}>\r\n                  <SelectTrigger>\r\n                    <SelectValue placeholder=\"Escolha uma tag...\" />\r\n                  </SelectTrigger>\r\n                  <SelectContent>\r\n                    {availableTags.map((tag) => (\r\n                      <SelectItem key={tag.id} value={tag.id}>\r\n                        <div className=\"flex items-center gap-2\">\r\n                          <div className=\"w-3 h-3 rounded-full\" style={{ backgroundColor: tag.color }} />\r\n                          {tag.name}\r\n                        </div>\r\n                      </SelectItem>\r\n                    ))}\r\n                  </SelectContent>\r\n                </Select>\r\n              </div>\r\n            )}\r\n\r\n            {exportFilterType === \"stage\" && (\r\n              <div className=\"space-y-2\">\r\n                <Label>Selecionar Etapa</Label>\r\n                <Select value={exportFilterValue} onValueChange={setExportFilterValue}>\r\n                  <SelectTrigger>\r\n                    <SelectValue placeholder=\"Escolha uma etapa...\" />\r\n                  </SelectTrigger>\r\n                  <SelectContent>\r\n                    {currentColumns.map((column) => (\r\n                      <SelectItem key={column.id} value={column.id}>\r\n                        <div className=\"flex items-center gap-2\">\r\n                          <div className=\"w-3 h-3 rounded-full\" style={{ backgroundColor: column.color }} />\r\n                          {column.name}\r\n                        </div>\r\n                      </SelectItem>\r\n                    ))}\r\n                  </SelectContent>\r\n                </Select>\r\n              </div>\r\n            )}\r\n\r\n            <div className=\"flex justify-end gap-2 pt-4\">\r\n              <Button variant=\"outline\" onClick={() => setShowExportDialog(false)}>\r\n                Cancelar\r\n              </Button>\r\n              <Button\r\n                onClick={() => handleExportToExcel(exportFilterType, exportFilterValue)}\r\n                disabled={exportFilterType !== \"complete\" && !exportFilterValue}\r\n              >\r\n                <FileSpreadsheet className=\"h-4 w-4 mr-2\" />\r\n                Exportar\r\n              </Button>\r\n            </div>\r\n          </div>\r\n        </DialogContent>\r\n      </Dialog>\r\n\r\n      <SavedFilterManager\r\n        open={showSavedFilterManager}\r\n        onClose={() => setShowSavedFilterManager(false)}\r\n        savedFilters={savedFilters}\r\n        currentFilterRules={filterRules}\r\n        onSaveFilter={handleSaveFilter}\r\n        onDeleteFilter={handleDeleteSavedFilter}\r\n        onApplyFilter={handleApplySavedFilter}\r\n        getFieldLabel={(field) => {\r\n          switch (field) {\r\n            case \"user\":\r\n              return \"Usuário\"\r\n            case \"tag\":\r\n              return \"Tag\"\r\n            case \"priority\":\r\n              return \"Prioridade\"\r\n            case \"source\":\r\n              return \"Origem\"\r\n            default:\r\n              return field\r\n          }\r\n        }}\r\n        getValueLabel={(field, value) => {\r\n          if (field === \"user\") {\r\n            const user = availableUsers.find((u) => u.id === value)\r\n            return user?.name || value\r\n          }\r\n          if (field === \"tag\") {\r\n            const tag = availableTags.find((t) => t.id === value)\r\n            return tag?.name || value\r\n          }\r\n          return value\r\n        }}\r\n      />\r\n\r\n      {/* Bulk Delete Confirmation Dialog */}\r\n      <AlertDialog open={showBulkDeleteDialog} onOpenChange={setShowBulkDeleteDialog}>\r\n        <AlertDialogContent>\r\n          <AlertDialogHeader>\r\n            <AlertDialogTitle>Confirmar exclusão em massa</AlertDialogTitle>\r\n            <AlertDialogDescription>\r\n              Você está prestes a excluir {selectedLeads.size} leads. Esta ação não pode ser desfeita.\r\n            </AlertDialogDescription>\r\n          </AlertDialogHeader>\r\n          <AlertDialogFooter>\r\n            <AlertDialogCancel>Cancelar</AlertDialogCancel>\r\n            <AlertDialogAction onClick={handleBulkDelete} className=\"bg-destructive text-destructive-foreground\">\r\n              Excluir {selectedLeads.size} leads\r\n            </AlertDialogAction>\r\n          </AlertDialogFooter>\r\n        </AlertDialogContent>\r\n      </AlertDialog>\r\n\r\n      {/* Bulk Transfer Dialog */}\r\n      <Dialog open={showBulkTransferDialog} onOpenChange={setShowBulkTransferDialog}>\r\n        <DialogContent>\r\n          <DialogHeader>\r\n            <DialogTitle>Transferir leads em massa</DialogTitle>\r\n            <DialogDescription>\r\n              Selecione a etapa de destino para mover {selectedLeads.size} leads selecionados.\r\n            </DialogDescription>\r\n          </DialogHeader>\r\n          <div className=\"space-y-4 py-4\">\r\n            <div className=\"space-y-2\">\r\n              <label className=\"text-sm font-medium\">Etapa de destino</label>\r\n              <Select value={bulkTransferTargetStage} onValueChange={setBulkTransferTargetStage}>\r\n                <SelectTrigger>\r\n                  <SelectValue placeholder=\"Selecione uma etapa\" />\r\n                </SelectTrigger>\r\n                <SelectContent>\r\n                  {currentColumns\r\n                    .filter((col) => col.visible !== false)\r\n                    .map((column) => (\r\n                      <SelectItem key={column.id} value={column.id}>\r\n                        <div className=\"flex items-center gap-2\">\r\n                          <div className=\"w-3 h-3 rounded-full\" style={{ backgroundColor: column.color }} />\r\n                          {column.name}\r\n                        </div>\r\n                      </SelectItem>\r\n                    ))}\r\n                </SelectContent>\r\n              </Select>\r\n            </div>\r\n          </div>\r\n          <DialogFooter>\r\n            <Button variant=\"outline\" onClick={() => setShowBulkTransferDialog(false)}>\r\n              Cancelar\r\n            </Button>\r\n            <Button onClick={handleBulkTransfer}>Transferir {selectedLeads.size} leads</Button>\r\n          </DialogFooter>\r\n        </DialogContent>\r\n      </Dialog>\r\n    </div>\r\n  )\r\n}\r\n\r\n// Define the LeadCard component\r\nfunction LeadCard({\r\n  lead,\r\n  index,\r\n  onClick,\r\n  onDelete,\r\n  taskCount,\r\n  isSelected,\r\n  onToggleSelect,\r\n  availableTags,\r\n}: {\r\n  lead: Lead\r\n  index: number\r\n  onClick: () => void\r\n  onDelete: () => void\r\n  taskCount: number\r\n  isSelected: boolean\r\n  onToggleSelect: () => void\r\n  availableTags: TagType[]\r\n}) {\r\n  const priorityColorMap = {\r\n    urgent: \"text-red-600\",\r\n    high: \"text-orange-600\",\r\n    medium: \"text-yellow-600\",\r\n    low: \"text-green-600\",\r\n  }\r\n\r\n  const assignedUser = lead?.assignedTo\r\n  const leadTags = lead?.tags || []\r\n  const MAX_DISPLAY_TAGS = 2\r\n\r\n  const daysSinceCreation = Math.max(0, Math.floor((new Date().getTime() - new Date(lead.createdAt).getTime()) / (1000 * 60 * 60 * 24)))\r\n\r\n  return (\r\n    <Draggable draggableId={lead.id} index={index}>\r\n      {(provided) => (\r\n        <div\r\n          ref={provided.innerRef}\r\n          {...provided.draggableProps}\r\n          {...provided.dragHandleProps}\r\n          className={`bg-white p-3 mb-2 rounded-lg shadow hover:shadow-md transition-shadow duration-200 cursor-grab ${\r\n            isSelected ? \"ring-2 ring-blue-500\" : \"\"\r\n          }`}\r\n          onClick={onClick}\r\n        >\r\n          <div className=\"flex justify-between items-start mb-2\">\r\n            <div className=\"flex-1 min-w-0 mr-2\">\r\n              <h4 className=\"font-medium truncate text-lg\" title={lead.title}>\r\n                {lead.title}\r\n              </h4>\r\n              <p className=\"text-xs text-muted-foreground truncate\" title={lead.client}>\r\n                {lead.client}\r\n              </p>\r\n            </div>\r\n            <div className=\"flex items-center gap-1 flex-shrink-0\">\r\n              {taskCount > 0 && (\r\n                <Badge variant=\"outline\" className=\"gap-1\">\r\n                  <CheckSquare className=\"h-3 w-3\" />\r\n                  {taskCount}\r\n                </Badge>\r\n              )}\r\n              <Checkbox checked={isSelected} onCheckedChange={onToggleSelect} className=\"h-4 w-4\" />\r\n              <Button\r\n                variant=\"ghost\"\r\n                size=\"icon\"\r\n                onClick={onDelete}\r\n                className=\"text-red-500 hover:bg-red-100 hover:text-red-600\"\r\n              >\r\n                <Trash2 className=\"h-3 w-3\" />\r\n              </Button>\r\n            </div>\r\n          </div>\r\n          <div className=\"flex justify-between items-center mt-2 text-xs text-muted-foreground\">\r\n            <div className=\"flex items-center gap-2\">\r\n              {lead.estimatedValue != null && (\r\n                <span className=\"font-semibold text-foreground\">R$ {lead.estimatedValue.toLocaleString(\"pt-BR\")}</span>\r\n              )}\r\n              {lead.priority && (\r\n                <span className={`${priorityColorMap[lead.priority as keyof typeof priorityColorMap]} font-medium`}>\r\n                  {lead.priority.charAt(0).toUpperCase() + lead.priority.slice(1)}\r\n                </span>\r\n              )}\r\n              {daysSinceCreation === 0 ? (\r\n                <Badge\r\n                  variant=\"outline\"\r\n                  className=\"text-green-600 border-green-600 bg-green-50 text-[10px] px-1 py-0 h-5 ml-2\"\r\n                >\r\n                  Novo\r\n                </Badge>\r\n              ) : (\r\n                <span className=\"text-xs text-muted-foreground ml-2\">{daysSinceCreation}d</span>\r\n              )}\r\n            </div>\r\n            <div className=\"flex items-center gap-1\">\r\n              {assignedUser && (\r\n                <img\r\n                  src={assignedUser.avatar || \"/placeholder.svg\"}\r\n                  alt={assignedUser.name}\r\n                  className=\"w-6 h-6 rounded-full\"\r\n                  title={assignedUser.name}\r\n                />\r\n              )}\r\n              {leadTags.length > 0 && (\r\n                <>\r\n                  {leadTags.slice(0, MAX_DISPLAY_TAGS).map((tagId) => {\r\n                    const tag = availableTags.find((t: any) => t.id === tagId)\r\n                    if (!tag) return null\r\n                    return (\r\n                      <Badge\r\n                        key={tag.id}\r\n                        variant=\"outline\"\r\n                        className=\"rounded-full text-xs px-2 py-0.5\"\r\n                        style={{ borderColor: tag.color, color: tag.color }}\r\n                      >\r\n                        {tag.name}\r\n                      </Badge>\r\n                    )\r\n                  })}\r\n                  {leadTags.length > MAX_DISPLAY_TAGS && (\r\n                    <Badge variant=\"outline\" className=\"rounded-full text-xs px-2 py-0.5\">\r\n                      +{leadTags.length - MAX_DISPLAY_TAGS}\r\n                    </Badge>\r\n                  )}\r\n                </>\r\n              )}\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n    </Draggable>\r\n  )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Projetos\\Back_endCrm\\kanbanproject1\\components\\queue-management.tsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'systemUsers' is assigned a value but never used.","line":52,"column":7,"nodeType":"Identifier","messageId":"unusedVar","endLine":52,"endColumn":25},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'systemUsers' is assigned a value but never used.","line":52,"column":7,"nodeType":null,"messageId":"unusedVar","endLine":52,"endColumn":18},{"ruleId":"no-unused-vars","severity":1,"message":"'getNextUserInQueue' is assigned a value but never used.","line":152,"column":9,"nodeType":"Identifier","messageId":"unusedVar","endLine":152,"endColumn":27},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'getNextUserInQueue' is assigned a value but never used.","line":152,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":152,"endColumn":27},{"ruleId":"no-unused-vars","severity":1,"message":"'reorderDistribution' is assigned a value but never used.","line":169,"column":9,"nodeType":"Identifier","messageId":"unusedVar","endLine":169,"endColumn":28},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'reorderDistribution' is assigned a value but never used.","line":169,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":169,"endColumn":28},{"ruleId":"no-unused-vars","severity":1,"message":"'index' is defined but never used.","line":586,"column":65,"nodeType":"Identifier","messageId":"unusedVar","endLine":586,"endColumn":70,"suggestions":[{"messageId":"removeVar","data":{"varName":"index"},"fix":{"range":[25149,25156],"text":""},"desc":"Remove unused variable 'index'."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'index' is defined but never used.","line":586,"column":65,"nodeType":null,"messageId":"unusedVar","endLine":586,"endColumn":70}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":8,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\"\r\n\r\nimport { useState, useEffect } from \"react\"\r\nimport { Button } from \"@/components/ui/button\"\r\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\"\r\nimport { Badge } from \"@/components/ui/badge\"\r\nimport { Input } from \"@/components/ui/input\"\r\nimport { Label } from \"@/components/ui/label\"\r\nimport { Textarea } from \"@/components/ui/textarea\"\r\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\"\r\nimport { RadioGroup, RadioGroupItem } from \"@/components/ui/radio-group\"\r\nimport {\r\n  Dialog,\r\n  DialogContent,\r\n  DialogDescription,\r\n  DialogFooter,\r\n  DialogHeader,\r\n  DialogTitle,\r\n  DialogTrigger,\r\n} from \"@/components/ui/dialog\"\r\nimport { Avatar, AvatarFallback } from \"@/components/ui/avatar\"\r\nimport {\r\n  Users,\r\n  Plus,\r\n  Settings,\r\n  MoreVertical,\r\n  User,\r\n  Power,\r\n  PowerOff,\r\n  UserPlus,\r\n  Trash2,\r\n  ArrowUpDown,\r\n  Shuffle,\r\n} from \"lucide-react\"\r\nimport { DropdownMenu, DropdownMenuContent, DropdownMenuItem, DropdownMenuTrigger } from \"@/components/ui/dropdown-menu\"\r\nimport { loadFromStorage } from \"@/lib/storage\"\r\n\r\ninterface Queue {\r\n  id: string\r\n  name: string\r\n  description: string\r\n  color: string\r\n  department: string\r\n  members: any[]\r\n  status: \"active\" | \"inactive\"\r\n  createdAt: string\r\n  queueType: \"free_access\" | \"ordered_distribution\"\r\n  distributionOrder?: string[] // Array of user IDs in order\r\n  currentIndex?: number // Current position in the distribution cycle\r\n}\r\n\r\nconst systemUsers: any[] = []\r\n\r\nconst initialQueues: Queue[] = []\r\n\r\nexport default function QueueManagement() {\r\n  const [queues, setQueues] = useState<Queue[]>(initialQueues)\r\n  const [isCreateQueueOpen, setIsCreateQueueOpen] = useState(false)\r\n  const [isManageMembersOpen, setIsManageMembersOpen] = useState(false)\r\n  const [selectedQueueForMembers, setSelectedQueueForMembers] = useState<Queue | null>(null)\r\n  const [systemUsers, setSystemUsers] = useState<any[]>([])\r\n  const [newQueue, setNewQueue] = useState({\r\n    name: \"\",\r\n    description: \"\",\r\n    color: \"bg-teal-500\",\r\n    department: \"\",\r\n    queueType: \"free_access\" as \"free_access\" | \"ordered_distribution\",\r\n  })\r\n\r\n  useEffect(() => {\r\n    const loadUsers = () => {\r\n      const storedUsers = loadFromStorage(\"users\", [])\r\n      // Filter only active users for queue assignment\r\n      const activeUsers = Array.isArray(storedUsers) ? storedUsers.filter((user) => user.status === \"active\") : []\r\n      setSystemUsers(activeUsers)\r\n    }\r\n\r\n    loadUsers()\r\n\r\n    // Listen for storage changes to update users list\r\n    const handleStorageChange = () => {\r\n      loadUsers()\r\n    }\r\n\r\n    window.addEventListener(\"storage\", handleStorageChange)\r\n    return () => window.removeEventListener(\"storage\", handleStorageChange)\r\n  }, [])\r\n\r\n  const handleCreateQueue = () => {\r\n    const queue: Queue = {\r\n      id: Date.now().toString(),\r\n      ...newQueue,\r\n      members: [],\r\n      status: \"active\",\r\n      createdAt: new Date().toISOString(),\r\n      distributionOrder: [],\r\n      currentIndex: 0,\r\n    }\r\n    setQueues([...queues, queue])\r\n    setNewQueue({ name: \"\", description: \"\", color: \"bg-teal-500\", department: \"\", queueType: \"free_access\" })\r\n    setIsCreateQueueOpen(false)\r\n  }\r\n\r\n  const toggleQueueStatus = (queueId: string) => {\r\n    setQueues(\r\n      queues.map((q) => (q.id === queueId ? { ...q, status: q.status === \"active\" ? \"inactive\" : \"active\" } : q)),\r\n    )\r\n  }\r\n\r\n  const addMemberToQueue = (queueId: string, user: any) => {\r\n    setQueues(\r\n      queues.map((q) => {\r\n        if (q.id === queueId) {\r\n          const updatedMembers = [...q.members.filter((m) => m.id !== user.id), user]\r\n          const updatedDistributionOrder =\r\n            q.queueType === \"ordered_distribution\"\r\n              ? [...(q.distributionOrder || []).filter((id) => id !== user.id), user.id]\r\n              : q.distributionOrder\r\n\r\n          return {\r\n            ...q,\r\n            members: updatedMembers,\r\n            distributionOrder: updatedDistributionOrder,\r\n          }\r\n        }\r\n        return q\r\n      }),\r\n    )\r\n  }\r\n\r\n  const removeMemberFromQueue = (queueId: string, userId: string) => {\r\n    setQueues(\r\n      queues.map((q) => {\r\n        if (q.id === queueId) {\r\n          const updatedMembers = q.members.filter((m) => m.id !== userId)\r\n          const updatedDistributionOrder = q.distributionOrder?.filter((id) => id !== userId) || []\r\n          const updatedCurrentIndex =\r\n            q.currentIndex && q.currentIndex >= updatedDistributionOrder.length ? 0 : q.currentIndex\r\n\r\n          return {\r\n            ...q,\r\n            members: updatedMembers,\r\n            distributionOrder: updatedDistributionOrder,\r\n            currentIndex: updatedCurrentIndex,\r\n          }\r\n        }\r\n        return q\r\n      }),\r\n    )\r\n  }\r\n\r\n  const getNextUserInQueue = (queueId: string) => {\r\n    const queue = queues.find((q) => q.id === queueId)\r\n    if (!queue || queue.queueType !== \"ordered_distribution\" || !queue.distributionOrder?.length) {\r\n      return null\r\n    }\r\n\r\n    const currentIndex = queue.currentIndex || 0\r\n    const nextUserId = queue.distributionOrder[currentIndex]\r\n    const nextUser = queue.members.find((m) => m.id === nextUserId)\r\n\r\n    // Update the current index for next assignment\r\n    const nextIndex = (currentIndex + 1) % queue.distributionOrder.length\r\n    setQueues(queues.map((q) => (q.id === queueId ? { ...q, currentIndex: nextIndex } : q)))\r\n\r\n    return nextUser\r\n  }\r\n\r\n  const reorderDistribution = (queueId: string, newOrder: string[]) => {\r\n    setQueues(queues.map((q) => (q.id === queueId ? { ...q, distributionOrder: newOrder, currentIndex: 0 } : q)))\r\n  }\r\n\r\n  const openMembersDialog = (queue: Queue) => {\r\n    setSelectedQueueForMembers(queue)\r\n    setIsManageMembersOpen(true)\r\n  }\r\n\r\n  const getRoleColor = (role: string) => {\r\n    switch (role) {\r\n      case \"admin\":\r\n        return \"bg-yellow-100 text-yellow-800 border-yellow-200\"\r\n      case \"manager\":\r\n        return \"bg-teal-100 text-teal-800 border-teal-200\"\r\n      case \"employee\":\r\n        return \"bg-green-100 text-green-800 border-green-200\"\r\n      default:\r\n        return \"bg-gray-100 text-gray-800 border-gray-200\"\r\n    }\r\n  }\r\n\r\n  const getRoleLabel = (role: string) => {\r\n    switch (role) {\r\n      case \"admin\":\r\n        return \"Admin\"\r\n      case \"manager\":\r\n        return \"Gerente\"\r\n      case \"employee\":\r\n        return \"Funcionário\"\r\n      default:\r\n        return \"Usuário\"\r\n    }\r\n  }\r\n\r\n  const getQueueTypeInfo = (queueType: \"free_access\" | \"ordered_distribution\") => {\r\n    switch (queueType) {\r\n      case \"free_access\":\r\n        return {\r\n          label: \"Acesso Livre\",\r\n          description: \"Todos podem pegar qualquer atendimento\",\r\n          icon: <Shuffle className=\"h-4 w-4\" />,\r\n          color: \"bg-green-100 text-green-800\",\r\n        }\r\n      case \"ordered_distribution\":\r\n        return {\r\n          label: \"Distribuição Ordenada\",\r\n          description: \"Atendimentos distribuídos sequencialmente\",\r\n          icon: <ArrowUpDown className=\"h-4 w-4\" />,\r\n          color: \"bg-teal-100 text-teal-800\",\r\n        }\r\n    }\r\n  }\r\n\r\n  return (\r\n    <div className=\"space-y-6\">\r\n      {/* Header */}\r\n      <div className=\"flex items-center justify-between\">\r\n        <div>\r\n          <h1 className=\"text-3xl font-bold tracking-tight\">Gestão de Filas</h1>\r\n          <p className=\"text-muted-foreground\">\r\n            Organize sua equipe em filas departamentais para melhor distribuição de trabalho\r\n          </p>\r\n        </div>\r\n        <div className=\"flex gap-2\">\r\n          <Dialog open={isCreateQueueOpen} onOpenChange={setIsCreateQueueOpen}>\r\n            <DialogTrigger asChild>\r\n              <Button>\r\n                <Plus className=\"h-4 w-4 mr-2\" />\r\n                Nova Fila\r\n              </Button>\r\n            </DialogTrigger>\r\n            <DialogContent className=\"max-w-lg\">\r\n              <DialogHeader>\r\n                <DialogTitle>Criar Nova Fila Departamental</DialogTitle>\r\n                <DialogDescription>\r\n                  Configure uma nova fila para organizar sua equipe por departamento\r\n                </DialogDescription>\r\n              </DialogHeader>\r\n              <div className=\"space-y-4\">\r\n                <div>\r\n                  <Label htmlFor=\"name\">Nome da Fila</Label>\r\n                  <Input\r\n                    id=\"name\"\r\n                    value={newQueue.name}\r\n                    onChange={(e) => setNewQueue({ ...newQueue, name: e.target.value })}\r\n                    placeholder=\"Ex: Suporte, Financeiro, Prospecção\"\r\n                  />\r\n                </div>\r\n                <div>\r\n                  <Label htmlFor=\"department\">Departamento</Label>\r\n                  <Input\r\n                    id=\"department\"\r\n                    value={newQueue.department}\r\n                    onChange={(e) => setNewQueue({ ...newQueue, department: e.target.value })}\r\n                    placeholder=\"Ex: Atendimento ao Cliente, Vendas, Pós-vendas\"\r\n                  />\r\n                </div>\r\n                <div>\r\n                  <Label htmlFor=\"description\">Descrição</Label>\r\n                  <Textarea\r\n                    id=\"description\"\r\n                    value={newQueue.description}\r\n                    onChange={(e) => setNewQueue({ ...newQueue, description: e.target.value })}\r\n                    placeholder=\"Descreva as responsabilidades desta fila\"\r\n                  />\r\n                </div>\r\n\r\n                <div>\r\n                  <Label>Tipo de Funcionamento</Label>\r\n                  <RadioGroup\r\n                    value={newQueue.queueType}\r\n                    onValueChange={(value: \"free_access\" | \"ordered_distribution\") =>\r\n                      setNewQueue({ ...newQueue, queueType: value })\r\n                    }\r\n                    className=\"mt-2\"\r\n                  >\r\n                    <div className=\"flex items-center space-x-2 p-3 border rounded-lg\">\r\n                      <RadioGroupItem value=\"free_access\" id=\"free_access\" />\r\n                      <div className=\"flex-1\">\r\n                        <Label htmlFor=\"free_access\" className=\"font-medium cursor-pointer\">\r\n                          <div className=\"flex items-center gap-2\">\r\n                            <Shuffle className=\"h-4 w-4\" />\r\n                            Acesso Livre\r\n                          </div>\r\n                        </Label>\r\n                        <p className=\"text-sm text-muted-foreground mt-1\">\r\n                          Todos os usuários podem visualizar e assumir qualquer atendimento disponível\r\n                        </p>\r\n                      </div>\r\n                    </div>\r\n                    <div className=\"flex items-center space-x-2 p-3 border rounded-lg\">\r\n                      <RadioGroupItem value=\"ordered_distribution\" id=\"ordered_distribution\" />\r\n                      <div className=\"flex-1\">\r\n                        <Label htmlFor=\"ordered_distribution\" className=\"font-medium cursor-pointer\">\r\n                          <div className=\"flex items-center gap-2\">\r\n                            <ArrowUpDown className=\"h-4 w-4\" />\r\n                            Distribuição Ordenada\r\n                          </div>\r\n                        </Label>\r\n                        <p className=\"text-sm text-muted-foreground mt-1\">\r\n                          Atendimentos são distribuídos automaticamente seguindo uma ordem fixa de usuários\r\n                        </p>\r\n                      </div>\r\n                    </div>\r\n                  </RadioGroup>\r\n                </div>\r\n\r\n                <div>\r\n                  <Label htmlFor=\"color\">Cor</Label>\r\n                  <Select value={newQueue.color} onValueChange={(value) => setNewQueue({ ...newQueue, color: value })}>\r\n                    <SelectTrigger>\r\n                      <SelectValue />\r\n                    </SelectTrigger>\r\n                    <SelectContent>\r\n                      <SelectItem value=\"bg-teal-500\">\r\n                        <div className=\"flex items-center gap-2\">\r\n                          <div className=\"w-4 h-4 rounded-full bg-teal-500\" />\r\n                          Teal\r\n                        </div>\r\n                      </SelectItem>\r\n                      <SelectItem value=\"bg-green-500\">\r\n                        <div className=\"flex items-center gap-2\">\r\n                          <div className=\"w-4 h-4 rounded-full bg-green-500\" />\r\n                          Verde\r\n                        </div>\r\n                      </SelectItem>\r\n                      <SelectItem value=\"bg-purple-500\">\r\n                        <div className=\"flex items-center gap-2\">\r\n                          <div className=\"w-4 h-4 rounded-full bg-purple-500\" />\r\n                          Roxo\r\n                        </div>\r\n                      </SelectItem>\r\n                      <SelectItem value=\"bg-red-500\">\r\n                        <div className=\"flex items-center gap-2\">\r\n                          <div className=\"w-4 h-4 rounded-full bg-red-500\" />\r\n                          Vermelho\r\n                        </div>\r\n                      </SelectItem>\r\n                      <SelectItem value=\"bg-orange-500\">\r\n                        <div className=\"flex items-center gap-2\">\r\n                          <div className=\"w-4 h-4 rounded-full bg-orange-500\" />\r\n                          Laranja\r\n                        </div>\r\n                      </SelectItem>\r\n                      <SelectItem value=\"bg-blue-500\">\r\n                        <div className=\"flex items-center gap-2\">\r\n                          <div className=\"w-4 h-4 rounded-full bg-blue-500\" />\r\n                          Azul\r\n                        </div>\r\n                      </SelectItem>\r\n                    </SelectContent>\r\n                  </Select>\r\n                </div>\r\n              </div>\r\n              <DialogFooter>\r\n                <Button variant=\"outline\" onClick={() => setIsCreateQueueOpen(false)}>\r\n                  Cancelar\r\n                </Button>\r\n                <Button onClick={handleCreateQueue} disabled={!newQueue.name || !newQueue.department}>\r\n                  Criar Fila\r\n                </Button>\r\n              </DialogFooter>\r\n            </DialogContent>\r\n          </Dialog>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Queue Overview Cards */}\r\n      {queues.length === 0 ? (\r\n        <Card>\r\n          <CardContent className=\"flex flex-col items-center justify-center py-16\">\r\n            <Users className=\"h-16 w-16 text-muted-foreground/50 mb-4\" />\r\n            <h3 className=\"text-lg font-semibold mb-2\">Nenhuma fila criada</h3>\r\n            <p className=\"text-muted-foreground text-center mb-6\">\r\n              Comece criando filas departamentais para organizar sua equipe por áreas de atuação.\r\n            </p>\r\n            <Dialog open={isCreateQueueOpen} onOpenChange={setIsCreateQueueOpen}>\r\n              <DialogTrigger asChild>\r\n                <Button>\r\n                  <Plus className=\"h-4 w-4 mr-2\" />\r\n                  Criar Primeira Fila\r\n                </Button>\r\n              </DialogTrigger>\r\n            </Dialog>\r\n          </CardContent>\r\n        </Card>\r\n      ) : (\r\n        <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\r\n          {queues.map((queue) => {\r\n            const queueTypeInfo = getQueueTypeInfo(queue.queueType)\r\n\r\n            return (\r\n              <Card\r\n                key={queue.id}\r\n                className={`relative overflow-hidden ${queue.status === \"inactive\" ? \"opacity-60\" : \"\"}`}\r\n              >\r\n                <div className={`absolute top-0 left-0 w-full h-1 ${queue.color}`} />\r\n                <CardHeader className=\"pb-3\">\r\n                  <div className=\"flex items-center justify-between\">\r\n                    <div className=\"flex items-center gap-3\">\r\n                      <div className={`w-3 h-3 rounded-full ${queue.color}`} />\r\n                      <CardTitle className=\"text-lg\">{queue.name}</CardTitle>\r\n                      {queue.status === \"inactive\" && (\r\n                        <Badge variant=\"secondary\" className=\"text-xs\">\r\n                          Inativa\r\n                        </Badge>\r\n                      )}\r\n                    </div>\r\n                    <DropdownMenu>\r\n                      <DropdownMenuTrigger asChild>\r\n                        <Button variant=\"ghost\" size=\"sm\">\r\n                          <MoreVertical className=\"h-4 w-4\" />\r\n                        </Button>\r\n                      </DropdownMenuTrigger>\r\n                      <DropdownMenuContent align=\"end\">\r\n                        <DropdownMenuItem>\r\n                          <Settings className=\"h-4 w-4 mr-2\" />\r\n                          Configurar\r\n                        </DropdownMenuItem>\r\n                        <DropdownMenuItem onClick={() => openMembersDialog(queue)}>\r\n                          <Users className=\"h-4 w-4 mr-2\" />\r\n                          Gerenciar Membros\r\n                        </DropdownMenuItem>\r\n                        <DropdownMenuItem onClick={() => toggleQueueStatus(queue.id)}>\r\n                          {queue.status === \"active\" ? (\r\n                            <>\r\n                              <PowerOff className=\"h-4 w-4 mr-2\" />\r\n                              Desativar Fila\r\n                            </>\r\n                          ) : (\r\n                            <>\r\n                              <Power className=\"h-4 w-4 mr-2\" />\r\n                              Ativar Fila\r\n                            </>\r\n                          )}\r\n                        </DropdownMenuItem>\r\n                      </DropdownMenuContent>\r\n                    </DropdownMenu>\r\n                  </div>\r\n                  <CardDescription className=\"text-sm\">{queue.description}</CardDescription>\r\n                  <div className=\"flex gap-2 flex-wrap\">\r\n                    <Badge variant=\"outline\" className=\"w-fit text-xs\">\r\n                      {queue.department}\r\n                    </Badge>\r\n                    <Badge variant=\"outline\" className={`w-fit text-xs ${queueTypeInfo.color}`}>\r\n                      <div className=\"flex items-center gap-1\">\r\n                        {queueTypeInfo.icon}\r\n                        {queueTypeInfo.label}\r\n                      </div>\r\n                    </Badge>\r\n                  </div>\r\n                </CardHeader>\r\n                <CardContent>\r\n                  <div className=\"space-y-4\">\r\n                    <div className=\"flex items-center justify-between text-sm\">\r\n                      <div className=\"flex items-center gap-2\">\r\n                        <Users className=\"h-4 w-4 text-muted-foreground\" />\r\n                        <span>{queue.members.length} membros</span>\r\n                      </div>\r\n                      <div className=\"flex items-center gap-2\">\r\n                        <User className=\"h-4 w-4 text-muted-foreground\" />\r\n                        <span>{queue.members.filter((m) => m.role === \"supervisor\").length} supervisores</span>\r\n                      </div>\r\n                    </div>\r\n\r\n                    {queue.queueType === \"ordered_distribution\" && queue.members.length > 0 && (\r\n                      <div className=\"p-2 bg-teal-50 rounded-lg\">\r\n                        <div className=\"text-xs text-teal-600 font-medium mb-1\">Próximo na fila:</div>\r\n                        {queue.distributionOrder && queue.distributionOrder.length > 0 ? (\r\n                          <div className=\"flex items-center gap-2\">\r\n                            <Avatar className=\"h-6 w-6\">\r\n                              <AvatarFallback className=\"text-xs\">\r\n                                {queue.members\r\n                                  .find((m) => m.id === queue.distributionOrder![queue.currentIndex || 0])\r\n                                  ?.name.split(\" \")\r\n                                  .map((n: string) => n[0])\r\n                                  .join(\"\") || \"?\"}\r\n                              </AvatarFallback>\r\n                            </Avatar>\r\n                            <span className=\"text-sm font-medium\">\r\n                              {queue.members.find((m) => m.id === queue.distributionOrder![queue.currentIndex || 0])\r\n                                ?.name || \"Não definido\"}\r\n                            </span>\r\n                          </div>\r\n                        ) : (\r\n                          <span className=\"text-sm text-muted-foreground\">Configure a ordem dos membros</span>\r\n                        )}\r\n                      </div>\r\n                    )}\r\n\r\n                    {queue.members.length > 0 && (\r\n                      <div className=\"space-y-2\">\r\n                        <div className=\"flex items-center gap-2\">\r\n                          <div className=\"flex -space-x-2\">\r\n                            {queue.members.slice(0, 4).map((member) => (\r\n                              <Avatar key={member.id} className=\"h-6 w-6 border-2 border-background\">\r\n                                <AvatarFallback className=\"text-xs\">\r\n                                  {member.name\r\n                                    .split(\" \")\r\n                                    .map((n: string) => n[0])\r\n                                    .join(\"\")}\r\n                                </AvatarFallback>\r\n                              </Avatar>\r\n                            ))}\r\n                            {queue.members.length > 4 && (\r\n                              <div className=\"h-6 w-6 rounded-full bg-muted border-2 border-background flex items-center justify-center\">\r\n                                <span className=\"text-xs text-muted-foreground\">+{queue.members.length - 4}</span>\r\n                              </div>\r\n                            )}\r\n                          </div>\r\n                        </div>\r\n                        <div className=\"flex gap-1 flex-wrap\">\r\n                          {[\"admin\", \"manager\", \"employee\"].map((role) => {\r\n                            const count = queue.members.filter((m) => m.role === role).length\r\n                            if (count > 0) {\r\n                              return (\r\n                                <Badge key={role} variant=\"outline\" className={`text-xs ${getRoleColor(role)}`}>\r\n                                  {count} {getRoleLabel(role)}\r\n                                  {count > 1 ? \"s\" : \"\"}\r\n                                </Badge>\r\n                              )\r\n                            }\r\n                            return null\r\n                          })}\r\n                        </div>\r\n                      </div>\r\n                    )}\r\n\r\n                    {queue.members.length === 0 && (\r\n                      <div className=\"text-center py-4 text-muted-foreground\">\r\n                        <Users className=\"h-8 w-8 mx-auto mb-2 opacity-50\" />\r\n                        <p className=\"text-sm\">Nenhum membro atribuído</p>\r\n                        <Button\r\n                          variant=\"outline\"\r\n                          size=\"sm\"\r\n                          className=\"mt-2 bg-transparent\"\r\n                          onClick={() => openMembersDialog(queue)}\r\n                        >\r\n                          <UserPlus className=\"h-3 w-3 mr-1\" />\r\n                          Adicionar Membros\r\n                        </Button>\r\n                      </div>\r\n                    )}\r\n                  </div>\r\n                </CardContent>\r\n              </Card>\r\n            )\r\n          })}\r\n        </div>\r\n      )}\r\n\r\n      <Dialog open={isManageMembersOpen} onOpenChange={setIsManageMembersOpen}>\r\n        <DialogContent className=\"max-w-2xl\">\r\n          <DialogHeader>\r\n            <DialogTitle>Gerenciar Membros - {selectedQueueForMembers?.name}</DialogTitle>\r\n            <DialogDescription>Adicione ou remova membros desta fila departamental</DialogDescription>\r\n          </DialogHeader>\r\n\r\n          <div className=\"space-y-6\">\r\n            {selectedQueueForMembers && (\r\n              <div className=\"p-3 bg-muted rounded-lg\">\r\n                <div className=\"flex items-center gap-2 mb-2\">\r\n                  {getQueueTypeInfo(selectedQueueForMembers.queueType).icon}\r\n                  <span className=\"font-medium\">{getQueueTypeInfo(selectedQueueForMembers.queueType).label}</span>\r\n                </div>\r\n                <p className=\"text-sm text-muted-foreground\">\r\n                  {getQueueTypeInfo(selectedQueueForMembers.queueType).description}\r\n                </p>\r\n              </div>\r\n            )}\r\n\r\n            {/* Current Members */}\r\n            {selectedQueueForMembers && selectedQueueForMembers.members.length > 0 && (\r\n              <div>\r\n                <h4 className=\"font-medium mb-3\">Membros Atuais ({selectedQueueForMembers.members.length})</h4>\r\n                <div className=\"space-y-2 max-h-40 overflow-y-auto\">\r\n                  {selectedQueueForMembers.members.map((member, index) => (\r\n                    <div key={member.id} className=\"flex items-center justify-between p-2 border rounded-lg\">\r\n                      <div className=\"flex items-center gap-3\">\r\n                        {selectedQueueForMembers.queueType === \"ordered_distribution\" && (\r\n                          <div className=\"w-6 h-6 rounded-full bg-teal-100 text-teal-800 flex items-center justify-center text-xs font-medium\">\r\n                            {(selectedQueueForMembers.distributionOrder?.indexOf(member.id) ?? -1) + 1 || \"?\"}\r\n                          </div>\r\n                        )}\r\n                        <Avatar className=\"h-8 w-8\">\r\n                          <AvatarFallback className=\"text-sm\">\r\n                            {member.name\r\n                              .split(\" \")\r\n                              .map((n: string) => n[0])\r\n                              .join(\"\")}\r\n                          </AvatarFallback>\r\n                        </Avatar>\r\n                        <div>\r\n                          <p className=\"font-medium text-sm\">{member.name}</p>\r\n                          <p className=\"text-xs text-muted-foreground\">{member.email}</p>\r\n                        </div>\r\n                        <Badge variant=\"outline\" className={`text-xs ${getRoleColor(member.role)}`}>\r\n                          {getRoleLabel(member.role)}\r\n                        </Badge>\r\n                      </div>\r\n                      <Button\r\n                        variant=\"ghost\"\r\n                        size=\"sm\"\r\n                        onClick={() => removeMemberFromQueue(selectedQueueForMembers.id, member.id)}\r\n                      >\r\n                        <Trash2 className=\"h-4 w-4 text-red-500\" />\r\n                      </Button>\r\n                    </div>\r\n                  ))}\r\n                </div>\r\n              </div>\r\n            )}\r\n\r\n            {/* Available Users */}\r\n            <div>\r\n              <h4 className=\"font-medium mb-3\">Usuários Disponíveis</h4>\r\n              {systemUsers.length === 0 ? (\r\n                <div className=\"text-center py-8 text-muted-foreground\">\r\n                  <User className=\"h-12 w-12 mx-auto mb-3 opacity-50\" />\r\n                  <p className=\"text-sm\">Nenhum usuário cadastrado no sistema</p>\r\n                  <p className=\"text-xs mt-1\">\r\n                    Os usuários cadastrados no sistema aparecerão aqui para serem adicionados às filas\r\n                  </p>\r\n                </div>\r\n              ) : (\r\n                <div className=\"space-y-2 max-h-60 overflow-y-auto\">\r\n                  {systemUsers\r\n                    .filter((user) => !selectedQueueForMembers?.members.some((m) => m.id === user.id))\r\n                    .map((user) => (\r\n                      <div key={user.id} className=\"flex items-center justify-between p-2 border rounded-lg\">\r\n                        <div className=\"flex items-center gap-3\">\r\n                          <Avatar className=\"h-8 w-8\">\r\n                            <AvatarFallback className=\"text-sm\">\r\n                              {user.name\r\n                                .split(\" \")\r\n                                .map((n: string) => n[0])\r\n                                .join(\"\")}\r\n                            </AvatarFallback>\r\n                          </Avatar>\r\n                          <div>\r\n                            <p className=\"font-medium text-sm\">{user.name}</p>\r\n                            <p className=\"text-xs text-muted-foreground\">{user.email}</p>\r\n                          </div>\r\n                          <Badge variant=\"outline\" className={`text-xs ${getRoleColor(user.role)}`}>\r\n                            {getRoleLabel(user.role)}\r\n                          </Badge>\r\n                        </div>\r\n                        <Button\r\n                          variant=\"outline\"\r\n                          size=\"sm\"\r\n                          onClick={() => selectedQueueForMembers && addMemberToQueue(selectedQueueForMembers.id, user)}\r\n                        >\r\n                          <UserPlus className=\"h-4 w-4 mr-1\" />\r\n                          Adicionar\r\n                        </Button>\r\n                      </div>\r\n                    ))}\r\n                  {systemUsers.filter((user) => !selectedQueueForMembers?.members.some((m) => m.id === user.id))\r\n                    .length === 0 &&\r\n                    systemUsers.length > 0 && (\r\n                      <div className=\"text-center py-4 text-muted-foreground\">\r\n                        <p className=\"text-sm\">Todos os usuários já foram adicionados a esta fila</p>\r\n                      </div>\r\n                    )}\r\n                </div>\r\n              )}\r\n            </div>\r\n          </div>\r\n\r\n          <DialogFooter>\r\n            <Button variant=\"outline\" onClick={() => setIsManageMembersOpen(false)}>\r\n              Fechar\r\n            </Button>\r\n          </DialogFooter>\r\n        </DialogContent>\r\n      </Dialog>\r\n    </div>\r\n  )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Projetos\\Back_endCrm\\kanbanproject1\\components\\saved-filter-manager.tsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'rules' is defined but never used.","line":31,"column":19,"nodeType":"Identifier","messageId":"unusedVar","endLine":31,"endColumn":38,"suggestions":[{"messageId":"removeVar","data":{"varName":"rules"},"fix":{"range":[831,850],"text":""},"desc":"Remove unused variable 'rules'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'name' is defined but never used.","line":32,"column":18,"nodeType":"Identifier","messageId":"unusedVar","endLine":32,"endColumn":30,"suggestions":[{"messageId":"removeVar","data":{"varName":"name"},"fix":{"range":[878,890],"text":""},"desc":"Remove unused variable 'name'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'filterId' is defined but never used.","line":33,"column":20,"nodeType":"Identifier","messageId":"unusedVar","endLine":33,"endColumn":36,"suggestions":[{"messageId":"removeVar","data":{"varName":"filterId"},"fix":{"range":[920,936],"text":""},"desc":"Remove unused variable 'filterId'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'field' is defined but never used.","line":34,"column":19,"nodeType":"Identifier","messageId":"unusedVar","endLine":34,"endColumn":32,"suggestions":[{"messageId":"removeVar","data":{"varName":"field"},"fix":{"range":[965,978],"text":""},"desc":"Remove unused variable 'field'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'field' is defined but never used.","line":35,"column":19,"nodeType":"Identifier","messageId":"unusedVar","endLine":35,"endColumn":32,"suggestions":[{"messageId":"removeVar","data":{"varName":"field"},"fix":{"range":[1009,1023],"text":""},"desc":"Remove unused variable 'field'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'value' is defined but never used.","line":35,"column":34,"nodeType":"Identifier","messageId":"unusedVar","endLine":35,"endColumn":47,"suggestions":[{"messageId":"removeVar","data":{"varName":"value"},"fix":{"range":[1022,1037],"text":""},"desc":"Remove unused variable 'value'."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":6,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\"\r\n\r\nimport { useState } from \"react\"\r\nimport { Button } from \"@/components/ui/button\"\r\nimport { Input } from \"@/components/ui/input\"\r\nimport { Label } from \"@/components/ui/label\"\r\nimport { Badge } from \"@/components/ui/badge\"\r\nimport {\r\n  Dialog,\r\n  DialogContent,\r\n  DialogDescription,\r\n  DialogHeader,\r\n  DialogTitle,\r\n  DialogFooter,\r\n} from \"@/components/ui/dialog\"\r\nimport { ScrollArea } from \"@/components/ui/scroll-area\"\r\nimport { Save, Trash2, Check, Star, Filter } from \"lucide-react\"\r\nimport type { SavedFilter } from \"@/lib/saved-filters\"\r\n\r\ntype FilterRule = {\r\n  id: string\r\n  field: \"user\" | \"tag\" | \"priority\" | \"source\"\r\n  value: string\r\n}\r\n\r\ntype SavedFilterManagerProps = {\r\n  open: boolean\r\n  onClose: () => void\r\n  savedFilters: SavedFilter[]\r\n  currentFilterRules: FilterRule[]\r\n  onApplyFilter: (rules: FilterRule[]) => void\r\n  onSaveFilter: (name: string) => void\r\n  onDeleteFilter: (filterId: string) => void\r\n  getFieldLabel: (field: string) => string\r\n  getValueLabel: (field: string, value: string) => string\r\n}\r\n\r\nexport default function SavedFilterManager({\r\n  open,\r\n  onClose,\r\n  savedFilters,\r\n  currentFilterRules,\r\n  onApplyFilter,\r\n  onSaveFilter,\r\n  onDeleteFilter,\r\n  getFieldLabel,\r\n  getValueLabel,\r\n}: SavedFilterManagerProps) {\r\n  const [isSaveDialogOpen, setIsSaveDialogOpen] = useState(false)\r\n  const [filterName, setFilterName] = useState(\"\")\r\n\r\n  const handleSaveFilter = () => {\r\n    if (!filterName.trim()) {\r\n      alert(\"Por favor, insira um nome para o filtro\")\r\n      return\r\n    }\r\n    onSaveFilter(filterName)\r\n    setFilterName(\"\")\r\n    setIsSaveDialogOpen(false)\r\n  }\r\n\r\n  const handleApplyFilter = (filter: SavedFilter) => {\r\n    onApplyFilter(filter.rules as FilterRule[])\r\n    onClose()\r\n  }\r\n\r\n  return (\r\n    <>\r\n      <Dialog open={open} onOpenChange={onClose}>\r\n        <DialogContent className=\"max-w-2xl\">\r\n          <DialogHeader>\r\n            <DialogTitle className=\"flex items-center gap-2\">\r\n              <Star className=\"h-5 w-5\" />\r\n              Filtros Salvos\r\n            </DialogTitle>\r\n            <DialogDescription>Gerencie seus filtros personalizados salvos</DialogDescription>\r\n          </DialogHeader>\r\n\r\n          <div className=\"space-y-4\">\r\n            {/* Save current filter button */}\r\n            {currentFilterRules.length > 0 && (\r\n              <div className=\"p-4 bg-muted rounded-lg\">\r\n                <div className=\"flex items-center justify-between\">\r\n                  <div>\r\n                    <p className=\"font-medium\">Filtro Atual</p>\r\n                    <p className=\"text-sm text-muted-foreground\">{currentFilterRules.length} regra(s) ativa(s)</p>\r\n                  </div>\r\n                  <Button onClick={() => setIsSaveDialogOpen(true)} size=\"sm\">\r\n                    <Save className=\"h-4 w-4 mr-2\" />\r\n                    Salvar Filtro Atual\r\n                  </Button>\r\n                </div>\r\n              </div>\r\n            )}\r\n\r\n            {/* List of saved filters */}\r\n            <ScrollArea className=\"h-[400px] pr-4\">\r\n              {savedFilters.length === 0 ? (\r\n                <div className=\"text-center py-12 text-muted-foreground\">\r\n                  <Filter className=\"h-12 w-12 mx-auto mb-4 opacity-50\" />\r\n                  <p>Nenhum filtro salvo ainda</p>\r\n                  <p className=\"text-sm mt-2\">Crie filtros personalizados e salve-os para acesso rápido</p>\r\n                </div>\r\n              ) : (\r\n                <div className=\"space-y-3\">\r\n                  {savedFilters.map((filter) => (\r\n                    <div key={filter.id} className=\"p-4 border rounded-lg hover:bg-muted/50 transition-colors\">\r\n                      <div className=\"flex items-start justify-between mb-2\">\r\n                        <div className=\"flex-1\">\r\n                          <h4 className=\"font-medium flex items-center gap-2\">\r\n                            <Star className=\"h-4 w-4 text-yellow-500 fill-yellow-500\" />\r\n                            {filter.name}\r\n                          </h4>\r\n                          <p className=\"text-xs text-muted-foreground mt-1\">\r\n                            Criado em {new Date(filter.createdAt).toLocaleDateString(\"pt-BR\")}\r\n                          </p>\r\n                        </div>\r\n                        <div className=\"flex gap-2\">\r\n                          <Button size=\"sm\" variant=\"outline\" onClick={() => handleApplyFilter(filter)}>\r\n                            <Check className=\"h-4 w-4 mr-1\" />\r\n                            Aplicar\r\n                          </Button>\r\n                          <Button size=\"sm\" variant=\"ghost\" onClick={() => onDeleteFilter(filter.id)}>\r\n                            <Trash2 className=\"h-4 w-4 text-destructive\" />\r\n                          </Button>\r\n                        </div>\r\n                      </div>\r\n\r\n                      {/* Display filter rules */}\r\n                      <div className=\"flex flex-wrap gap-2 mt-3\">\r\n                        {(filter.rules as FilterRule[]).map((rule) => (\r\n                          <Badge key={rule.id} variant=\"secondary\" className=\"text-xs\">\r\n                            {getFieldLabel(rule.field)}: {getValueLabel(rule.field, rule.value)}\r\n                          </Badge>\r\n                        ))}\r\n                      </div>\r\n                    </div>\r\n                  ))}\r\n                </div>\r\n              )}\r\n            </ScrollArea>\r\n          </div>\r\n\r\n          <DialogFooter>\r\n            <Button variant=\"outline\" onClick={onClose}>\r\n              Fechar\r\n            </Button>\r\n          </DialogFooter>\r\n        </DialogContent>\r\n      </Dialog>\r\n\r\n      {/* Save filter dialog */}\r\n      <Dialog open={isSaveDialogOpen} onOpenChange={setIsSaveDialogOpen}>\r\n        <DialogContent>\r\n          <DialogHeader>\r\n            <DialogTitle>Salvar Filtro</DialogTitle>\r\n            <DialogDescription>Dê um nome para este filtro para acessá-lo rapidamente no futuro</DialogDescription>\r\n          </DialogHeader>\r\n\r\n          <div className=\"space-y-4 py-4\">\r\n            <div className=\"space-y-2\">\r\n              <Label htmlFor=\"filter-name\">Nome do Filtro</Label>\r\n              <Input\r\n                id=\"filter-name\"\r\n                placeholder=\"Ex: Leads do João com tag Urgente\"\r\n                value={filterName}\r\n                onChange={(e) => setFilterName(e.target.value)}\r\n                onKeyDown={(e) => {\r\n                  if (e.key === \"Enter\") {\r\n                    handleSaveFilter()\r\n                  }\r\n                }}\r\n              />\r\n            </div>\r\n\r\n            {/* Preview of current rules */}\r\n            <div className=\"space-y-2\">\r\n              <Label>Regras do Filtro</Label>\r\n              <div className=\"flex flex-wrap gap-2 p-3 bg-muted rounded-md\">\r\n                {currentFilterRules.map((rule) => (\r\n                  <Badge key={rule.id} variant=\"secondary\">\r\n                    {getFieldLabel(rule.field)}: {getValueLabel(rule.field, rule.value)}\r\n                  </Badge>\r\n                ))}\r\n              </div>\r\n            </div>\r\n          </div>\r\n\r\n          <DialogFooter>\r\n            <Button variant=\"outline\" onClick={() => setIsSaveDialogOpen(false)}>\r\n              Cancelar\r\n            </Button>\r\n            <Button onClick={handleSaveFilter}>\r\n              <Save className=\"h-4 w-4 mr-2\" />\r\n              Salvar\r\n            </Button>\r\n          </DialogFooter>\r\n        </DialogContent>\r\n      </Dialog>\r\n    </>\r\n  )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Projetos\\Back_endCrm\\kanbanproject1\\components\\tag-input.tsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'tags' is defined but never used.","line":14,"column":18,"nodeType":"Identifier","messageId":"unusedVar","endLine":14,"endColumn":32,"suggestions":[{"messageId":"removeVar","data":{"varName":"tags"},"fix":{"range":[399,413],"text":""},"desc":"Remove unused variable 'tags'."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\"\r\n\r\nimport type React from \"react\"\r\n\r\nimport { useState, useRef, useEffect } from \"react\"\r\nimport { Input } from \"@/components/ui/input\"\r\nimport { Badge } from \"@/components/ui/badge\"\r\nimport { X, Plus } from \"lucide-react\"\r\nimport { useApiTags } from \"@/hooks/use-api-tags\"\r\nimport { Tag } from \"@/lib/api/tags-api\"\r\n\r\ntype TagInputProps = {\r\n  selectedTags: string[]\r\n  onTagsChange: (tags: string[]) => void\r\n  placeholder?: string\r\n}\r\n\r\nexport default function TagInput({\r\n  selectedTags,\r\n  onTagsChange,\r\n  placeholder = \"Digite para buscar ou criar tags...\",\r\n}: TagInputProps) {\r\n  const [inputValue, setInputValue] = useState(\"\")\r\n  const [suggestions, setSuggestions] = useState<Tag[]>([])\r\n  const [showSuggestions, setShowSuggestions] = useState(false)\r\n  const inputRef = useRef<HTMLInputElement>(null)\r\n  \r\n  const { tags: availableTags, fetchTags, createTag } = useApiTags()\r\n\r\n  useEffect(() => {\r\n    fetchTags()\r\n  }, [fetchTags])\r\n\r\n  useEffect(() => {\r\n    if (inputValue.trim()) {\r\n      const filtered = availableTags.filter(\r\n        (tag) => tag.name.toLowerCase().includes(inputValue.toLowerCase()) && !selectedTags.includes(tag.id),\r\n      )\r\n      setSuggestions(filtered)\r\n      setShowSuggestions(true)\r\n    } else {\r\n      setSuggestions([])\r\n      setShowSuggestions(false)\r\n    }\r\n  }, [inputValue, availableTags, selectedTags])\r\n\r\n  const handleInputChange = (value: string) => {\r\n    setInputValue(value)\r\n  }\r\n\r\n  const handleTagSelect = (tag: Tag) => {\r\n    if (!selectedTags.includes(tag.id)) {\r\n      onTagsChange([...selectedTags, tag.id])\r\n    }\r\n    setInputValue(\"\")\r\n    setShowSuggestions(false)\r\n    inputRef.current?.focus()\r\n  }\r\n\r\n  const handleCreateTag = async () => {\r\n    if (!inputValue.trim()) return\r\n\r\n    const existingTag = availableTags.find((tag) => tag.name.toLowerCase() === inputValue.toLowerCase())\r\n\r\n    if (existingTag) {\r\n      handleTagSelect(existingTag)\r\n      return\r\n    }\r\n\r\n    try {\r\n      const newTag = await createTag({\r\n        name: inputValue.trim(),\r\n      })\r\n\r\n      onTagsChange([...selectedTags, newTag.id])\r\n      setInputValue(\"\")\r\n      setShowSuggestions(false)\r\n      inputRef.current?.focus()\r\n    } catch (error) {\r\n      console.error(\"Failed to create tag\", error)\r\n    }\r\n  }\r\n\r\n  const handleRemoveTag = (tagId: string) => {\r\n    onTagsChange(selectedTags.filter((id) => id !== tagId))\r\n  }\r\n\r\n  const handleKeyDown = (e: React.KeyboardEvent) => {\r\n    if (e.key === \"Enter\" && inputValue.trim()) {\r\n      e.preventDefault()\r\n      if (suggestions.length > 0) {\r\n        handleTagSelect(suggestions[0])\r\n      } else {\r\n        handleCreateTag()\r\n      }\r\n    }\r\n  }\r\n\r\n  const selectedTagObjects = availableTags.filter((tag) => selectedTags.includes(tag.id))\r\n\r\n  return (\r\n    <div className=\"space-y-2\">\r\n      <div className=\"relative\">\r\n        <Input\r\n          ref={inputRef}\r\n          value={inputValue}\r\n          onChange={(e) => handleInputChange(e.target.value)}\r\n          onKeyDown={handleKeyDown}\r\n          placeholder={placeholder}\r\n          onFocus={() => inputValue.trim() && setShowSuggestions(true)}\r\n          onBlur={() => setTimeout(() => setShowSuggestions(false), 200)}\r\n        />\r\n\r\n        {showSuggestions && (suggestions.length > 0 || inputValue.trim()) && (\r\n          <div className=\"absolute z-10 w-full mt-1 bg-white border border-gray-200 rounded-md shadow-lg max-h-40 overflow-y-auto\">\r\n            {suggestions.map((tag) => (\r\n              <button\r\n                key={tag.id}\r\n                type=\"button\"\r\n                className=\"w-full px-3 py-2 text-left hover:bg-gray-50 flex items-center gap-2\"\r\n                onClick={() => handleTagSelect(tag)}\r\n              >\r\n                <div className=\"w-3 h-3 rounded-full\" style={{ backgroundColor: tag.color }} />\r\n                {tag.name}\r\n              </button>\r\n            ))}\r\n\r\n            {inputValue.trim() && !suggestions.some((tag) => tag.name.toLowerCase() === inputValue.toLowerCase()) && (\r\n              <button\r\n                type=\"button\"\r\n                className=\"w-full px-3 py-2 text-left hover:bg-gray-50 flex items-center gap-2 text-blue-600\"\r\n                onClick={handleCreateTag}\r\n              >\r\n                <Plus className=\"w-3 h-3\" />\r\n                Criar \"{inputValue}\"\r\n              </button>\r\n            )}\r\n          </div>\r\n        )}\r\n      </div>\r\n\r\n      {selectedTagObjects.length > 0 && (\r\n        <div className=\"flex flex-wrap gap-2\">\r\n          {selectedTagObjects.map((tag) => (\r\n            <Badge\r\n              key={tag.id}\r\n              style={{ backgroundColor: tag.color, color: \"white\" }}\r\n              className=\"flex items-center gap-1\"\r\n            >\r\n              {tag.name}\r\n              <button\r\n                type=\"button\"\r\n                onClick={() => handleRemoveTag(tag.id)}\r\n                className=\"ml-1 hover:bg-black/20 rounded-full p-0.5\"\r\n              >\r\n                <X className=\"w-3 h-3\" />\r\n              </button>\r\n            </Badge>\r\n          ))}\r\n        </div>\r\n      )}\r\n    </div>\r\n  )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Projetos\\Back_endCrm\\kanbanproject1\\components\\tag-manager.tsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":78,"column":14,"nodeType":"Identifier","messageId":"unusedVar","endLine":78,"endColumn":19},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":78,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":78,"endColumn":19},{"ruleId":"no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":87,"column":14,"nodeType":"Identifier","messageId":"unusedVar","endLine":87,"endColumn":19},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":87,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":87,"endColumn":19},{"ruleId":"no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":96,"column":14,"nodeType":"Identifier","messageId":"unusedVar","endLine":96,"endColumn":19},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":96,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":96,"endColumn":19},{"ruleId":"no-unused-vars","severity":1,"message":"'updates' is defined but never used.","line":252,"column":12,"nodeType":"Identifier","messageId":"unusedVar","endLine":252,"endColumn":37,"suggestions":[{"messageId":"removeVar","data":{"varName":"updates"},"fix":{"range":[8403,8428],"text":""},"desc":"Remove unused variable 'updates'."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":7,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\"\r\n\r\nimport { useState, useEffect } from \"react\"\r\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from \"@/components/ui/dialog\"\r\nimport { Button } from \"@/components/ui/button\"\r\nimport { Input } from \"@/components/ui/input\"\r\nimport { Label } from \"@/components/ui/label\"\r\nimport { Badge } from \"@/components/ui/badge\"\r\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\"\r\nimport { useToast } from \"@/hooks/use-toast\"\r\nimport { Plus, Trash2, Edit2, Save, X, Tag as TagIcon } from \"lucide-react\"\r\nimport { useApiTags } from \"@/hooks/use-api-tags\"\r\nimport type { Tag } from \"@/lib/api/tags-api\"\r\n\r\nexport type { Tag } from \"@/lib/api/tags-api\"\r\nexport type TagType = Tag\r\n\r\ntype TagManagerProps = {\r\n  open: boolean\r\n  onClose: () => void\r\n}\r\n\r\nconst predefinedColors = [\r\n  \"#ef4444\", // red\r\n  \"#f97316\", // orange\r\n  \"#f59e0b\", // amber\r\n  \"#eab308\", // yellow\r\n  \"#84cc16\", // lime\r\n  \"#22c55e\", // green\r\n  \"#10b981\", // emerald\r\n  \"#06b6d4\", // cyan\r\n  \"#3b82f6\", // blue\r\n  \"#6366f1\", // indigo\r\n  \"#8b5cf6\", // violet\r\n  \"#a855f7\", // purple\r\n  \"#d946ef\", // fuchsia\r\n  \"#ec4899\", // pink\r\n  \"#6b7280\", // gray\r\n  \"#374151\", // dark gray\r\n]\r\n\r\nexport default function TagManager({ open, onClose }: TagManagerProps) {\r\n  const { toast } = useToast()\r\n  const { tags, fetchTags, createTag, updateTag, deleteTag } = useApiTags()\r\n  const [isCreating, setIsCreating] = useState(false)\r\n  const [editingTag, setEditingTag] = useState<string | null>(null)\r\n  const [newTag, setNewTag] = useState({\r\n    name: \"\",\r\n    color: predefinedColors[0],\r\n    description: \"\",\r\n  })\r\n\r\n  useEffect(() => {\r\n    if (open) {\r\n      fetchTags()\r\n    }\r\n  }, [open, fetchTags])\r\n\r\n  const handleCreateTag = async () => {\r\n    if (!newTag.name.trim()) {\r\n      toast({\r\n        title: \"Erro\",\r\n        description: \"Nome da tag é obrigatório\",\r\n        variant: \"destructive\",\r\n      })\r\n      return\r\n    }\r\n\r\n    try {\r\n      await createTag({\r\n        name: newTag.name.trim(),\r\n        color: newTag.color,\r\n        description: newTag.description.trim() || undefined,\r\n      })\r\n\r\n      setNewTag({ name: \"\", color: predefinedColors[0], description: \"\" })\r\n      setIsCreating(false)\r\n    } catch (error) {\r\n      // Error handling is done in the hook\r\n    }\r\n  }\r\n\r\n  const handleUpdateTag = async (tagId: string, updates: Partial<Tag>) => {\r\n    try {\r\n      await updateTag(tagId, updates)\r\n      setEditingTag(null)\r\n    } catch (error) {\r\n       // Error handling is done in the hook\r\n    }\r\n  }\r\n\r\n  const handleDeleteTag = async (tagId: string) => {\r\n    if (!confirm(\"Tem certeza que deseja excluir esta tag?\")) return\r\n    try {\r\n      await deleteTag(tagId)\r\n    } catch (error) {\r\n       // Error handling is done in the hook\r\n    }\r\n  }\r\n\r\n  const handleClose = () => {\r\n    setIsCreating(false)\r\n    setEditingTag(null)\r\n    setNewTag({ name: \"\", color: predefinedColors[0], description: \"\" })\r\n    onClose()\r\n  }\r\n\r\n  return (\r\n    <Dialog open={open} onOpenChange={handleClose}>\r\n      <DialogContent className=\"max-w-4xl max-h-[90vh] overflow-y-auto\">\r\n        <DialogHeader>\r\n          <DialogTitle className=\"flex items-center gap-2\">\r\n            <TagIcon className=\"h-5 w-5\" />\r\n            Central de Tags\r\n          </DialogTitle>\r\n        </DialogHeader>\r\n\r\n        <div className=\"space-y-6\">\r\n          {/* Create new tag section */}\r\n          <Card>\r\n            <CardHeader>\r\n              <CardTitle className=\"text-lg\">{isCreating ? \"Nova Tag\" : \"Criar Tag\"}</CardTitle>\r\n            </CardHeader>\r\n            <CardContent>\r\n              {!isCreating ? (\r\n                <Button onClick={() => setIsCreating(true)}>\r\n                  <Plus className=\"h-4 w-4 mr-2\" />\r\n                  Criar Nova Tag\r\n                </Button>\r\n              ) : (\r\n                <div className=\"space-y-4\">\r\n                  <div className=\"grid grid-cols-2 gap-4\">\r\n                    <div className=\"space-y-2\">\r\n                      <Label htmlFor=\"tagName\">Nome da Tag *</Label>\r\n                      <Input\r\n                        id=\"tagName\"\r\n                        placeholder=\"Nome da tag\"\r\n                        value={newTag.name}\r\n                        onChange={(e) => setNewTag((prev) => ({ ...prev, name: e.target.value }))}\r\n                      />\r\n                    </div>\r\n                    <div className=\"space-y-2\">\r\n                      <Label>Cor</Label>\r\n                      <div className=\"flex flex-wrap gap-2\">\r\n                        {predefinedColors.map((color) => (\r\n                          <button\r\n                            key={color}\r\n                            type=\"button\"\r\n                            className={`w-8 h-8 rounded-full border-2 ${\r\n                              newTag.color === color ? \"border-gray-900\" : \"border-gray-300\"\r\n                            }`}\r\n                            style={{ backgroundColor: color }}\r\n                            onClick={() => setNewTag((prev) => ({ ...prev, color }))}\r\n                          />\r\n                        ))}\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n\r\n                  <div className=\"space-y-2\">\r\n                    <Label htmlFor=\"tagDescription\">Descrição (opcional)</Label>\r\n                    <Input\r\n                      id=\"tagDescription\"\r\n                      placeholder=\"Descrição da tag\"\r\n                      value={newTag.description}\r\n                      onChange={(e) => setNewTag((prev) => ({ ...prev, description: e.target.value }))}\r\n                    />\r\n                  </div>\r\n\r\n                  <div className=\"space-y-2\">\r\n                    <Label>Preview</Label>\r\n                    <div>\r\n                      <Badge style={{ backgroundColor: newTag.color, color: \"white\" }}>\r\n                        {newTag.name || \"Nome da tag\"}\r\n                      </Badge>\r\n                    </div>\r\n                  </div>\r\n\r\n                  <div className=\"flex gap-2\">\r\n                    <Button onClick={handleCreateTag}>\r\n                      <Save className=\"h-4 w-4 mr-2\" />\r\n                      Salvar Tag\r\n                    </Button>\r\n                    <Button\r\n                      variant=\"outline\"\r\n                      onClick={() => {\r\n                        setIsCreating(false)\r\n                        setNewTag({ name: \"\", color: predefinedColors[0], description: \"\" })\r\n                      }}\r\n                    >\r\n                      <X className=\"h-4 w-4 mr-2\" />\r\n                      Cancelar\r\n                    </Button>\r\n                  </div>\r\n                </div>\r\n              )}\r\n            </CardContent>\r\n          </Card>\r\n\r\n          {/* Tags list */}\r\n          <Card>\r\n            <CardHeader>\r\n              <CardTitle className=\"text-lg\">Tags Existentes ({tags.length})</CardTitle>\r\n            </CardHeader>\r\n            <CardContent>\r\n              {tags.length === 0 ? (\r\n                <div className=\"text-center py-8 text-muted-foreground\">\r\n                  <TagIcon className=\"h-12 w-12 mx-auto mb-4 opacity-50\" />\r\n                  <p>Nenhuma tag criada ainda</p>\r\n                  <p className=\"text-sm\">Crie sua primeira tag para organizar seus leads</p>\r\n                </div>\r\n              ) : (\r\n                <div className=\"space-y-4\">\r\n                  {tags.map((tag) => (\r\n                    <TagItem\r\n                      key={tag.id}\r\n                      tag={tag}\r\n                      isEditing={editingTag === tag.id}\r\n                      onEdit={() => setEditingTag(tag.id)}\r\n                      onSave={(updates) => handleUpdateTag(tag.id, updates)}\r\n                      onCancel={() => setEditingTag(null)}\r\n                      onDelete={() => handleDeleteTag(tag.id)}\r\n                    />\r\n                  ))}\r\n                </div>\r\n              )}\r\n            </CardContent>\r\n          </Card>\r\n        </div>\r\n\r\n        <div className=\"flex justify-end pt-4\">\r\n          <Button variant=\"outline\" onClick={handleClose}>\r\n            Fechar\r\n          </Button>\r\n        </div>\r\n      </DialogContent>\r\n    </Dialog>\r\n  )\r\n}\r\n\r\nfunction TagItem({\r\n  tag,\r\n  isEditing,\r\n  onEdit,\r\n  onSave,\r\n  onCancel,\r\n  onDelete,\r\n}: {\r\n  tag: TagType\r\n  isEditing: boolean\r\n  onEdit: () => void\r\n  onSave: (updates: Partial<TagType>) => void\r\n  onCancel: () => void\r\n  onDelete: () => void\r\n}) {\r\n  const [editData, setEditData] = useState({\r\n    name: tag.name,\r\n    color: tag.color,\r\n    description: tag.description || \"\",\r\n  })\r\n\r\n  const handleSave = () => {\r\n    if (!editData.name.trim()) return\r\n    onSave({\r\n      name: editData.name.trim(),\r\n      color: editData.color,\r\n      description: editData.description.trim() || undefined,\r\n    })\r\n  }\r\n\r\n  if (isEditing) {\r\n    return (\r\n      <div className=\"border rounded-lg p-4 space-y-4\">\r\n        <div className=\"grid grid-cols-2 gap-4\">\r\n          <div className=\"space-y-2\">\r\n            <Label>Nome</Label>\r\n            <Input value={editData.name} onChange={(e) => setEditData((prev) => ({ ...prev, name: e.target.value }))} />\r\n          </div>\r\n          <div className=\"space-y-2\">\r\n            <Label>Cor</Label>\r\n            <div className=\"flex flex-wrap gap-2\">\r\n              {predefinedColors.map((color) => (\r\n                <button\r\n                  key={color}\r\n                  type=\"button\"\r\n                  className={`w-6 h-6 rounded-full border-2 ${\r\n                    editData.color === color ? \"border-gray-900\" : \"border-gray-300\"\r\n                  }`}\r\n                  style={{ backgroundColor: color }}\r\n                  onClick={() => setEditData((prev) => ({ ...prev, color }))}\r\n                />\r\n              ))}\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        <div className=\"space-y-2\">\r\n          <Label>Descrição</Label>\r\n          <Input\r\n            value={editData.description}\r\n            onChange={(e) => setEditData((prev) => ({ ...prev, description: e.target.value }))}\r\n            placeholder=\"Descrição da tag\"\r\n          />\r\n        </div>\r\n\r\n        <div className=\"flex items-center justify-between\">\r\n          <Badge style={{ backgroundColor: editData.color, color: \"white\" }}>{editData.name}</Badge>\r\n          <div className=\"flex gap-2\">\r\n            <Button size=\"sm\" onClick={handleSave}>\r\n              <Save className=\"h-4 w-4 mr-1\" />\r\n              Salvar\r\n            </Button>\r\n            <Button size=\"sm\" variant=\"outline\" onClick={onCancel}>\r\n              <X className=\"h-4 w-4 mr-1\" />\r\n              Cancelar\r\n            </Button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    )\r\n  }\r\n\r\n  return (\r\n    <div className=\"flex items-center justify-between p-4 border rounded-lg\">\r\n      <div className=\"flex items-center gap-3\">\r\n        <Badge style={{ backgroundColor: tag.color, color: \"white\" }}>{tag.name}</Badge>\r\n        {tag.description && <span className=\"text-sm text-muted-foreground\">{tag.description}</span>}\r\n        <span className=\"text-xs text-muted-foreground\">\r\n          Criada em {new Date(tag.createdAt).toLocaleDateString(\"pt-BR\")}\r\n        </span>\r\n      </div>\r\n      <div className=\"flex gap-2\">\r\n        <Button size=\"sm\" variant=\"outline\" onClick={onEdit}>\r\n          <Edit2 className=\"h-4 w-4\" />\r\n        </Button>\r\n        <Button size=\"sm\" variant=\"outline\" onClick={onDelete}>\r\n          <Trash2 className=\"h-4 w-4\" />\r\n        </Button>\r\n      </div>\r\n    </div>\r\n  )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Projetos\\Back_endCrm\\kanbanproject1\\components\\task-center.tsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'taskId' is defined but never used.","line":75,"column":18,"nodeType":"Identifier","messageId":"unusedVar","endLine":75,"endColumn":32,"suggestions":[{"messageId":"removeVar","data":{"varName":"taskId"},"fix":{"range":[2135,2150],"text":""},"desc":"Remove unused variable 'taskId'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'updates' is defined but never used.","line":75,"column":34,"nodeType":"Identifier","messageId":"unusedVar","endLine":75,"endColumn":56,"suggestions":[{"messageId":"removeVar","data":{"varName":"updates"},"fix":{"range":[2149,2173],"text":""},"desc":"Remove unused variable 'updates'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'task' is defined but never used.","line":76,"column":18,"nodeType":"Identifier","messageId":"unusedVar","endLine":76,"endColumn":54,"suggestions":[{"messageId":"removeVar","data":{"varName":"task"},"fix":{"range":[2201,2237],"text":""},"desc":"Remove unused variable 'task'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'taskId' is defined but never used.","line":77,"column":18,"nodeType":"Identifier","messageId":"unusedVar","endLine":77,"endColumn":32,"suggestions":[{"messageId":"removeVar","data":{"varName":"taskId"},"fix":{"range":[2265,2279],"text":""},"desc":"Remove unused variable 'taskId'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'getStatusColor' is defined but never used.","line":520,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":520,"endColumn":17,"suggestions":[{"messageId":"removeVar","data":{"varName":"getStatusColor"},"fix":{"range":[18996,19015],"text":""},"desc":"Remove unused variable 'getStatusColor'."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'getStatusColor' is defined but never used.","line":520,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":520,"endColumn":17},{"ruleId":"no-unused-vars","severity":1,"message":"'priority' is defined but never used.","line":524,"column":22,"nodeType":"Identifier","messageId":"unusedVar","endLine":524,"endColumn":44,"suggestions":[{"messageId":"removeVar","data":{"varName":"priority"},"fix":{"range":[19082,19104],"text":""},"desc":"Remove unused variable 'priority'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'status' is defined but never used.","line":525,"column":20,"nodeType":"Identifier","messageId":"unusedVar","endLine":525,"endColumn":38,"suggestions":[{"messageId":"removeVar","data":{"varName":"status"},"fix":{"range":[19136,19154],"text":""},"desc":"Remove unused variable 'status'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'taskId' is defined but never used.","line":601,"column":18,"nodeType":"Identifier","messageId":"unusedVar","endLine":601,"endColumn":32,"suggestions":[{"messageId":"removeVar","data":{"varName":"taskId"},"fix":{"range":[21885,21900],"text":""},"desc":"Remove unused variable 'taskId'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'updates' is defined but never used.","line":601,"column":34,"nodeType":"Identifier","messageId":"unusedVar","endLine":601,"endColumn":56,"suggestions":[{"messageId":"removeVar","data":{"varName":"updates"},"fix":{"range":[21899,21923],"text":""},"desc":"Remove unused variable 'updates'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'priority' is defined but never used.","line":602,"column":22,"nodeType":"Identifier","messageId":"unusedVar","endLine":602,"endColumn":44,"suggestions":[{"messageId":"removeVar","data":{"varName":"priority"},"fix":{"range":[21955,21977],"text":""},"desc":"Remove unused variable 'priority'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'status' is defined but never used.","line":603,"column":20,"nodeType":"Identifier","messageId":"unusedVar","endLine":603,"endColumn":38,"suggestions":[{"messageId":"removeVar","data":{"varName":"status"},"fix":{"range":[22009,22027],"text":""},"desc":"Remove unused variable 'status'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'status' is defined but never used.","line":604,"column":20,"nodeType":"Identifier","messageId":"unusedVar","endLine":604,"endColumn":38,"suggestions":[{"messageId":"removeVar","data":{"varName":"status"},"fix":{"range":[22059,22077],"text":""},"desc":"Remove unused variable 'status'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'priority' is defined but never used.","line":605,"column":22,"nodeType":"Identifier","messageId":"unusedVar","endLine":605,"endColumn":44,"suggestions":[{"messageId":"removeVar","data":{"varName":"priority"},"fix":{"range":[22111,22133],"text":""},"desc":"Remove unused variable 'priority'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'updates' is defined but never used.","line":712,"column":14,"nodeType":"Identifier","messageId":"unusedVar","endLine":712,"endColumn":36,"suggestions":[{"messageId":"removeVar","data":{"varName":"updates"},"fix":{"range":[26234,26256],"text":""},"desc":"Remove unused variable 'updates'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'status' is defined but never used.","line":714,"column":20,"nodeType":"Identifier","messageId":"unusedVar","endLine":714,"endColumn":38,"suggestions":[{"messageId":"removeVar","data":{"varName":"status"},"fix":{"range":[26310,26328],"text":""},"desc":"Remove unused variable 'status'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'priority' is defined but never used.","line":715,"column":22,"nodeType":"Identifier","messageId":"unusedVar","endLine":715,"endColumn":44,"suggestions":[{"messageId":"removeVar","data":{"varName":"priority"},"fix":{"range":[26362,26384],"text":""},"desc":"Remove unused variable 'priority'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'task' is defined but never used.","line":921,"column":14,"nodeType":"Identifier","messageId":"unusedVar","endLine":921,"endColumn":50,"suggestions":[{"messageId":"removeVar","data":{"varName":"task"},"fix":{"range":[34662,34698],"text":""},"desc":"Remove unused variable 'task'."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":18,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\"\r\n\r\nimport type React from \"react\"\r\nimport { useState } from \"react\"\r\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\"\r\nimport { Button } from \"@/components/ui/button\"\r\nimport { Input } from \"@/components/ui/input\"\r\nimport { Badge } from \"@/components/ui/badge\"\r\nimport { Avatar, AvatarFallback, AvatarImage } from \"@/components/ui/avatar\"\r\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\"\r\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\"\r\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from \"@/components/ui/dialog\"\r\nimport { Label } from \"@/components/ui/label\"\r\nimport { Textarea } from \"@/components/ui/textarea\"\r\nimport { Checkbox } from \"@/components/ui/checkbox\"\r\nimport { Command, CommandEmpty, CommandGroup, CommandInput, CommandItem, CommandList } from \"@/components/ui/command\"\r\nimport { Popover, PopoverContent, PopoverTrigger } from \"@/components/ui/popover\"\r\nimport {\r\n  CheckSquare,\r\n  Clock,\r\n  AlertCircle,\r\n  User,\r\n  Calendar,\r\n  MessageSquare,\r\n  Plus,\r\n  Filter,\r\n  Search,\r\n  Eye,\r\n  Edit,\r\n  Trash2,\r\n  Link,\r\n  ExternalLink,\r\n  Check,\r\n  ChevronsUpDown,\r\n} from \"lucide-react\"\r\nimport { cn } from \"@/lib/utils\"\r\nimport { useApiTasks } from \"@/hooks/use-api-tasks\"\r\nimport { useApiLeads } from \"@/hooks/use-api-leads\"\r\n\r\n// Tipos\r\ntype TaskStatus = \"pending\" | \"in_progress\" | \"completed\" | \"cancelled\"\r\ntype TaskPriority = \"low\" | \"medium\" | \"high\" | \"urgent\"\r\n\r\ntype Task = {\r\n  id: string\r\n  title: string\r\n  description: string\r\n  status: TaskStatus\r\n  priority: TaskPriority\r\n  assignedTo?: {\r\n    id: string\r\n    name: string\r\n    avatar: string\r\n  }\r\n  leadId?: string\r\n  leadName?: string\r\n  clientName?: string\r\n  dueDate?: string\r\n  createdAt: string\r\n  createdBy: \"automation\" | \"manual\"\r\n  automationId?: string\r\n  completedAt?: string\r\n  tags?: string[]\r\n  relatedConversations?: string[]\r\n}\r\n\r\ntype TaskCenterProps = {\r\n  tasks: Task[]\r\n  projects: Array<{\r\n    id: string\r\n    title: string\r\n    client: string\r\n    status: string\r\n  }>\r\n  onUpdateTask: (taskId: string, updates: Partial<Task>) => void\r\n  onCreateTask: (task: Omit<Task, \"id\" | \"createdAt\">) => void\r\n  onDeleteTask: (taskId: string) => void\r\n}\r\n\r\nexport default function TaskCenter({\r\n  tasks: initialTasks,\r\n  projects: initialProjects,\r\n  onUpdateTask,\r\n  onCreateTask,\r\n  onDeleteTask,\r\n}: TaskCenterProps) {\r\n  const [selectedTask, setSelectedTask] = useState<Task | null>(null)\r\n  const [showCreateDialog, setShowCreateDialog] = useState(false)\r\n  const [filters, setFilters] = useState({\r\n    status: \"all_status\",\r\n    priority: \"all_priority\",\r\n    project: \"all_projects\",\r\n    assignee: \"all_assignee\",\r\n    search: \"\",\r\n  })\r\n\r\n  const { tasks, isLoading: tasksLoading, createTask, updateTask, updateStatus, deleteTask } = useApiTasks()\r\n  const { leads, isLoading: leadsLoading } = useApiLeads()\r\n\r\n  // Use API data if available, otherwise fall back to props\r\n  const displayTasks = tasks.length > 0 ? tasks : initialTasks\r\n  const displayLeads = leads.length > 0 ? leads : initialProjects\r\n\r\n  const filteredTasks = displayTasks.filter((task: any) => {\r\n    if (filters.status !== \"all_status\" && task.status !== filters.status) return false\r\n    if (filters.priority !== \"all_priority\" && task.priority !== filters.priority) return false\r\n    if (filters.project !== \"all_projects\" && task.leadId !== filters.project) return false\r\n    if (filters.assignee !== \"all_assignee\" && task.assignedTo?.id !== filters.assignee) return false\r\n    if (\r\n      filters.search &&\r\n      !task.title.toLowerCase().includes(filters.search.toLowerCase()) &&\r\n      !task.description.toLowerCase().includes(filters.search.toLowerCase())\r\n    )\r\n      return false\r\n    return true\r\n  })\r\n\r\n  const tasksByStatus = {\r\n    pending: filteredTasks.filter((t: any) => t.status === \"pending\"),\r\n    in_progress: filteredTasks.filter((t: any) => t.status === \"in_progress\"),\r\n    completed: filteredTasks.filter((t: any) => t.status === \"completed\"),\r\n    cancelled: filteredTasks.filter((t: any) => t.status === \"cancelled\"),\r\n  }\r\n\r\n  const stats = {\r\n    total: displayTasks.length,\r\n    pending: displayTasks.filter((t: any) => t.status === \"pending\").length,\r\n    in_progress: displayTasks.filter((t: any) => t.status === \"in_progress\").length,\r\n    completed: displayTasks.filter((t: any) => t.status === \"completed\").length,\r\n    overdue: displayTasks.filter((t: any) => t.dueDate && new Date(t.dueDate) < new Date() && t.status !== \"completed\")\r\n      .length,\r\n  }\r\n\r\n  const getPriorityColor = (priority: TaskPriority) => {\r\n    const colors = {\r\n      low: \"bg-blue-100 text-blue-800\",\r\n      medium: \"bg-yellow-100 text-yellow-800\",\r\n      high: \"bg-orange-100 text-orange-800\",\r\n      urgent: \"bg-red-100 text-red-800\",\r\n    }\r\n    return colors[priority]\r\n  }\r\n\r\n  const getStatusColor = (status: TaskStatus) => {\r\n    const colors = {\r\n      pending: \"bg-gray-100 text-gray-800\",\r\n      in_progress: \"bg-blue-100 text-blue-800\",\r\n      completed: \"bg-green-100 text-green-800\",\r\n      cancelled: \"bg-red-100 text-red-800\",\r\n    }\r\n    return colors[status]\r\n  }\r\n\r\n  const getStatusLabel = (status: TaskStatus) => {\r\n    const labels = {\r\n      pending: \"Pendente\",\r\n      in_progress: \"Em Andamento\",\r\n      completed: \"Concluída\",\r\n      cancelled: \"Cancelada\",\r\n    }\r\n    return labels[status]\r\n  }\r\n\r\n  const getPriorityLabel = (priority: TaskPriority) => {\r\n    const labels = {\r\n      low: \"Baixa\",\r\n      medium: \"Média\",\r\n      high: \"Alta\",\r\n      urgent: \"Urgente\",\r\n    }\r\n    return labels[priority]\r\n  }\r\n\r\n  const handleUpdateTask = async (taskId: string, updates: Partial<Task>) => {\r\n    try {\r\n      if (typeof updates.status !== \"undefined\") {\r\n        await updateStatus(taskId, updates.status as any)\r\n      } else {\r\n        await updateTask(taskId, updates)\r\n      }\r\n      onUpdateTask(taskId, updates)\r\n    } catch (error) {\r\n      console.error(\"[v0] Error updating task:\", error)\r\n    }\r\n  }\r\n\r\n  const handleCreateTask = async (task: Omit<Task, \"id\" | \"createdAt\">) => {\r\n    try {\r\n      await createTask(task)\r\n      onCreateTask(task)\r\n    } catch (error) {\r\n      console.error(\"[v0] Error creating task:\", error)\r\n    }\r\n  }\r\n\r\n  const handleDeleteTask = async (taskId: string) => {\r\n    try {\r\n      await deleteTask(taskId)\r\n      onDeleteTask(taskId)\r\n    } catch (error) {\r\n      console.error(\"[v0] Error deleting task:\", error)\r\n    }\r\n  }\r\n\r\n  if (tasksLoading || leadsLoading) {\r\n    return (\r\n      <div className=\"flex items-center justify-center py-12\">\r\n        <p className=\"text-gray-600\">Carregando tarefas...</p>\r\n      </div>\r\n    )\r\n  }\r\n\r\n  return (\r\n    <div className=\"space-y-6\">\r\n      <div className=\"grid grid-cols-2 md:grid-cols-5 gap-4\">\r\n        <Card>\r\n          <CardContent className=\"p-4\">\r\n            <div className=\"flex items-center\">\r\n              <CheckSquare className=\"h-8 w-8 text-blue-600\" />\r\n              <div className=\"ml-3\">\r\n                <p className=\"text-sm font-medium text-gray-600\">Total</p>\r\n                <p className=\"text-2xl font-bold\">{stats.total}</p>\r\n              </div>\r\n            </div>\r\n          </CardContent>\r\n        </Card>\r\n\r\n        <Card>\r\n          <CardContent className=\"p-4\">\r\n            <div className=\"flex items-center\">\r\n              <Clock className=\"h-8 w-8 text-yellow-600\" />\r\n              <div className=\"ml-3\">\r\n                <p className=\"text-sm font-medium text-gray-600\">Pendentes</p>\r\n                <p className=\"text-2xl font-bold\">{stats.pending}</p>\r\n              </div>\r\n            </div>\r\n          </CardContent>\r\n        </Card>\r\n\r\n        <Card>\r\n          <CardContent className=\"p-4\">\r\n            <div className=\"flex items-center\">\r\n              <User className=\"h-8 w-8 text-blue-600\" />\r\n              <div className=\"ml-3\">\r\n                <p className=\"text-sm font-medium text-gray-600\">Em Andamento</p>\r\n                <p className=\"text-2xl font-bold\">{stats.in_progress}</p>\r\n              </div>\r\n            </div>\r\n          </CardContent>\r\n        </Card>\r\n\r\n        <Card>\r\n          <CardContent className=\"p-4\">\r\n            <div className=\"flex items-center\">\r\n              <CheckSquare className=\"h-8 w-8 text-green-600\" />\r\n              <div className=\"ml-3\">\r\n                <p className=\"text-sm font-medium text-gray-600\">Concluídas</p>\r\n                <p className=\"text-2xl font-bold\">{stats.completed}</p>\r\n              </div>\r\n            </div>\r\n          </CardContent>\r\n        </Card>\r\n\r\n        <Card>\r\n          <CardContent className=\"p-4\">\r\n            <div className=\"flex items-center\">\r\n              <AlertCircle className=\"h-8 w-8 text-red-600\" />\r\n              <div className=\"ml-3\">\r\n                <p className=\"text-sm font-medium text-gray-600\">Atrasadas</p>\r\n                <p className=\"text-2xl font-bold\">{stats.overdue}</p>\r\n              </div>\r\n            </div>\r\n          </CardContent>\r\n        </Card>\r\n      </div>\r\n\r\n      <Card>\r\n        <CardHeader>\r\n          <div className=\"flex justify-between items-center\">\r\n            <CardTitle>Central de Tarefas</CardTitle>\r\n            <Button onClick={() => setShowCreateDialog(true)}>\r\n              <Plus className=\"h-4 w-4 mr-2\" />\r\n              Nova Tarefa\r\n            </Button>\r\n          </div>\r\n        </CardHeader>\r\n        <CardContent>\r\n          <div className=\"grid grid-cols-2 md:grid-cols-6 gap-4 mb-6\">\r\n            <div className=\"relative\">\r\n              <Search className=\"absolute left-2 top-2.5 h-4 w-4 text-muted-foreground\" />\r\n              <Input\r\n                placeholder=\"Buscar tarefas...\"\r\n                className=\"pl-8\"\r\n                value={filters.search}\r\n                onChange={(e) => setFilters({ ...filters, search: e.target.value })}\r\n              />\r\n            </div>\r\n\r\n            <Select value={filters.status} onValueChange={(value) => setFilters({ ...filters, status: value })}>\r\n              <SelectTrigger>\r\n                <SelectValue placeholder=\"Status\" />\r\n              </SelectTrigger>\r\n              <SelectContent>\r\n                <SelectItem value=\"all_status\">Todos os Status</SelectItem>\r\n                <SelectItem value=\"pending\">Pendente</SelectItem>\r\n                <SelectItem value=\"in_progress\">Em Andamento</SelectItem>\r\n                <SelectItem value=\"completed\">Concluída</SelectItem>\r\n                <SelectItem value=\"cancelled\">Cancelada</SelectItem>\r\n              </SelectContent>\r\n            </Select>\r\n\r\n            <Select value={filters.priority} onValueChange={(value) => setFilters({ ...filters, priority: value })}>\r\n              <SelectTrigger>\r\n                <SelectValue placeholder=\"Prioridade\" />\r\n              </SelectTrigger>\r\n              <SelectContent>\r\n                <SelectItem value=\"all_priority\">Todas as Prioridades</SelectItem>\r\n                <SelectItem value=\"urgent\">Urgente</SelectItem>\r\n                <SelectItem value=\"high\">Alta</SelectItem>\r\n                <SelectItem value=\"medium\">Média</SelectItem>\r\n                <SelectItem value=\"low\">Baixa</SelectItem>\r\n              </SelectContent>\r\n            </Select>\r\n\r\n            <Select value={filters.project} onValueChange={(value) => setFilters({ ...filters, project: value })}>\r\n              <SelectTrigger>\r\n                <SelectValue placeholder=\"Lead\" />\r\n              </SelectTrigger>\r\n              <SelectContent>\r\n                <SelectItem value=\"all_projects\">Todos os Leads</SelectItem>\r\n                {displayLeads.map((lead: any) => (\r\n                  <SelectItem key={lead.id} value={lead.id}>\r\n                    {lead.title} - {lead.company || lead.funnelName}\r\n                  </SelectItem>\r\n                ))}\r\n              </SelectContent>\r\n            </Select>\r\n\r\n            <Select value={filters.assignee} onValueChange={(value) => setFilters({ ...filters, assignee: value })}>\r\n              <SelectTrigger>\r\n                <SelectValue placeholder=\"Responsável\" />\r\n              </SelectTrigger>\r\n              <SelectContent>\r\n                <SelectItem value=\"all_assignee\">Todos os Responsáveis</SelectItem>\r\n                {displayTasks.map(\r\n                  (task: any) =>\r\n                    task.assignedTo && (\r\n                      <SelectItem key={task.assignedTo.id} value={task.assignedTo.id}>\r\n                        {task.assignedTo.name}\r\n                      </SelectItem>\r\n                    ),\r\n                )}\r\n              </SelectContent>\r\n            </Select>\r\n\r\n            <Button\r\n              variant=\"outline\"\r\n              onClick={() =>\r\n                setFilters({\r\n                  status: \"all_status\",\r\n                  priority: \"all_priority\",\r\n                  project: \"all_projects\",\r\n                  assignee: \"all_assignee\",\r\n                  search: \"\",\r\n                })\r\n              }\r\n            >\r\n              <Filter className=\"h-4 w-4 mr-2\" />\r\n              Limpar Filtros\r\n            </Button>\r\n          </div>\r\n\r\n          <Tabs defaultValue=\"kanban\" className=\"w-full\">\r\n            <TabsList>\r\n              <TabsTrigger value=\"kanban\">Kanban</TabsTrigger>\r\n              <TabsTrigger value=\"list\">Lista</TabsTrigger>\r\n              <TabsTrigger value=\"calendar\">Calendário</TabsTrigger>\r\n            </TabsList>\r\n\r\n            <TabsContent value=\"kanban\" className=\"mt-6\">\r\n              <div className=\"grid grid-cols-1 md:grid-cols-4 gap-4\">\r\n                <div className=\"bg-gray-50 rounded-lg p-4\">\r\n                  <h3 className=\"font-medium mb-4 flex items-center\">\r\n                    <Clock className=\"h-4 w-4 mr-2 text-gray-600\" />\r\n                    Pendentes ({tasksByStatus.pending.length})\r\n                  </h3>\r\n                  <div className=\"space-y-3\">\r\n                    {tasksByStatus.pending.map((task: any) => (\r\n                      <TaskCard\r\n                        key={task.id}\r\n                        task={task}\r\n                        onClick={() => setSelectedTask(task)}\r\n                        getPriorityColor={getPriorityColor}\r\n                        getStatusColor={getStatusColor}\r\n                      />\r\n                    ))}\r\n                  </div>\r\n                </div>\r\n\r\n                <div className=\"bg-blue-50 rounded-lg p-4\">\r\n                  <h3 className=\"font-medium mb-4 flex items-center\">\r\n                    <User className=\"h-4 w-4 mr-2 text-blue-600\" />\r\n                    Em Andamento ({tasksByStatus.in_progress.length})\r\n                  </h3>\r\n                  <div className=\"space-y-3\">\r\n                    {tasksByStatus.in_progress.map((task: any) => (\r\n                      <TaskCard\r\n                        key={task.id}\r\n                        task={task}\r\n                        onClick={() => setSelectedTask(task)}\r\n                        getPriorityColor={getPriorityColor}\r\n                        getStatusColor={getStatusColor}\r\n                      />\r\n                    ))}\r\n                  </div>\r\n                </div>\r\n\r\n                <div className=\"bg-green-50 rounded-lg p-4\">\r\n                  <h3 className=\"font-medium mb-4 flex items-center\">\r\n                    <CheckSquare className=\"h-4 w-4 mr-2 text-green-600\" />\r\n                    Concluídas ({tasksByStatus.completed.length})\r\n                  </h3>\r\n                  <div className=\"space-y-3\">\r\n                    {tasksByStatus.completed.map((task: any) => (\r\n                      <TaskCard\r\n                        key={task.id}\r\n                        task={task}\r\n                        onClick={() => setSelectedTask(task)}\r\n                        getPriorityColor={getPriorityColor}\r\n                        getStatusColor={getStatusColor}\r\n                      />\r\n                    ))}\r\n                  </div>\r\n                </div>\r\n\r\n                <div className=\"bg-red-50 rounded-lg p-4\">\r\n                  <h3 className=\"font-medium mb-4 flex items-center\">\r\n                    <AlertCircle className=\"h-4 w-4 mr-2 text-red-600\" />\r\n                    Canceladas ({tasksByStatus.cancelled.length})\r\n                  </h3>\r\n                  <div className=\"space-y-3\">\r\n                    {tasksByStatus.cancelled.map((task: any) => (\r\n                      <TaskCard\r\n                        key={task.id}\r\n                        task={task}\r\n                        onClick={() => setSelectedTask(task)}\r\n                        getPriorityColor={getPriorityColor}\r\n                        getStatusColor={getStatusColor}\r\n                      />\r\n                    ))}\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            </TabsContent>\r\n\r\n            <TabsContent value=\"list\" className=\"mt-6\">\r\n              <div className=\"space-y-2\">\r\n                {filteredTasks.map((task: any) => (\r\n                  <TaskListItem\r\n                    key={task.id}\r\n                    task={task}\r\n                    onClick={() => setSelectedTask(task)}\r\n                    onUpdateTask={handleUpdateTask}\r\n                    getPriorityColor={getPriorityColor}\r\n                    getStatusColor={getStatusColor}\r\n                    getStatusLabel={getStatusLabel}\r\n                    getPriorityLabel={getPriorityLabel}\r\n                  />\r\n                ))}\r\n              </div>\r\n            </TabsContent>\r\n\r\n            <TabsContent value=\"calendar\" className=\"mt-6\">\r\n              <div className=\"text-center py-12\">\r\n                <Calendar className=\"h-12 w-12 mx-auto text-muted-foreground mb-4\" />\r\n                <h3 className=\"text-lg font-medium mb-2\">Visualização de Calendário</h3>\r\n                <p className=\"text-muted-foreground\">Em desenvolvimento - Visualize tarefas por data</p>\r\n              </div>\r\n            </TabsContent>\r\n          </Tabs>\r\n        </CardContent>\r\n      </Card>\r\n\r\n      {selectedTask && (\r\n        <TaskDetailsDialog\r\n          task={selectedTask}\r\n          projects={displayLeads}\r\n          onClose={() => setSelectedTask(null)}\r\n          onUpdate={(updates) => {\r\n            handleUpdateTask(selectedTask.id, updates)\r\n            setSelectedTask({ ...selectedTask, ...updates })\r\n          }}\r\n          onDelete={() => {\r\n            handleDeleteTask(selectedTask.id)\r\n            setSelectedTask(null)\r\n          }}\r\n          getStatusLabel={getStatusLabel}\r\n          getPriorityLabel={getPriorityLabel}\r\n        />\r\n      )}\r\n\r\n      {showCreateDialog && (\r\n        <CreateTaskDialog\r\n          leads={displayLeads}\r\n          onClose={() => setShowCreateDialog(false)}\r\n          onCreate={(task) => {\r\n            handleCreateTask(task)\r\n            setShowCreateDialog(false)\r\n          }}\r\n        />\r\n      )}\r\n    </div>\r\n  )\r\n}\r\n\r\nfunction TaskCard({\r\n  task,\r\n  onClick,\r\n  getPriorityColor,\r\n  getStatusColor,\r\n}: {\r\n  task: Task\r\n  onClick: () => void\r\n  getPriorityColor: (priority: TaskPriority) => string\r\n  getStatusColor: (status: TaskStatus) => string\r\n}) {\r\n  const isOverdue = task.dueDate && new Date(task.dueDate) < new Date() && task.status !== \"completed\"\r\n\r\n  return (\r\n    <Card\r\n      className={`cursor-pointer hover:shadow-md transition-shadow ${isOverdue ? \"border-red-200 bg-red-50\" : \"\"}`}\r\n      onClick={onClick}\r\n    >\r\n      <CardContent className=\"p-3\">\r\n        <div className=\"space-y-2\">\r\n          <div className=\"flex items-start justify-between\">\r\n            <h4 className=\"font-medium text-sm line-clamp-2\">{task.title}</h4>\r\n            {task.createdBy === \"automation\" && (\r\n              <Badge variant=\"outline\" className=\"text-xs\">\r\n                Auto\r\n              </Badge>\r\n            )}\r\n          </div>\r\n\r\n          {task.leadName && (\r\n            <div className=\"flex items-center text-xs text-muted-foreground\">\r\n              <Link className=\"h-3 w-3 mr-1\" />\r\n              {task.leadName}\r\n            </div>\r\n          )}\r\n\r\n          <div className=\"flex items-center justify-between\">\r\n            <Badge className={`text-xs ${getPriorityColor(task.priority)}`}>\r\n              {task.priority === \"low\" && \"Baixa\"}\r\n              {task.priority === \"medium\" && \"Média\"}\r\n              {task.priority === \"high\" && \"Alta\"}\r\n              {task.priority === \"urgent\" && \"Urgente\"}\r\n            </Badge>\r\n\r\n            {task.dueDate && (\r\n              <div className={`text-xs flex items-center ${isOverdue ? \"text-red-600\" : \"text-muted-foreground\"}`}>\r\n                <Calendar className=\"h-3 w-3 mr-1\" />\r\n                {new Date(task.dueDate).toLocaleDateString(\"pt-BR\")}\r\n              </div>\r\n            )}\r\n          </div>\r\n\r\n          {task.assignedTo && (\r\n            <div className=\"flex items-center\">\r\n              <Avatar className=\"h-5 w-5 mr-2\">\r\n                <AvatarImage src={task.assignedTo.avatar || \"/placeholder.svg\"} alt={task.assignedTo.name} />\r\n                <AvatarFallback className=\"text-xs\">{task.assignedTo.name.substring(0, 2)}</AvatarFallback>\r\n              </Avatar>\r\n              <span className=\"text-xs text-muted-foreground\">{task.assignedTo.name}</span>\r\n            </div>\r\n          )}\r\n\r\n          {task.relatedConversations && task.relatedConversations.length > 0 && (\r\n            <div className=\"flex items-center text-xs text-muted-foreground\">\r\n              <MessageSquare className=\"h-3 w-3 mr-1\" />\r\n              {task.relatedConversations.length} conversa(s)\r\n            </div>\r\n          )}\r\n        </div>\r\n      </CardContent>\r\n    </Card>\r\n  )\r\n}\r\n\r\nfunction TaskListItem({\r\n  task,\r\n  onClick,\r\n  onUpdateTask,\r\n  getPriorityColor,\r\n  getStatusColor,\r\n  getStatusLabel,\r\n  getPriorityLabel,\r\n}: {\r\n  task: Task\r\n  onClick: () => void\r\n  onUpdateTask: (taskId: string, updates: Partial<Task>) => void\r\n  getPriorityColor: (priority: TaskPriority) => string\r\n  getStatusColor: (status: TaskStatus) => string\r\n  getStatusLabel: (status: TaskStatus) => string\r\n  getPriorityLabel: (priority: TaskPriority) => string\r\n}) {\r\n  const isOverdue = task.dueDate && new Date(task.dueDate) < new Date() && task.status !== \"completed\"\r\n\r\n  return (\r\n    <Card className={`${isOverdue ? \"border-red-200 bg-red-50\" : \"\"}`}>\r\n      <CardContent className=\"p-4\">\r\n        <div className=\"flex items-center justify-between\">\r\n          <div className=\"flex items-center space-x-4 flex-1\">\r\n            <Checkbox\r\n              checked={task.status === \"completed\"}\r\n              onCheckedChange={(checked) => {\r\n                onUpdateTask(task.id, {\r\n                  status: checked ? \"completed\" : \"pending\",\r\n                })\r\n              }}\r\n            />\r\n\r\n            <div className=\"flex-1 min-w-0\">\r\n              <div className=\"flex items-center space-x-2 mb-1\">\r\n                <h4 className=\"font-medium cursor-pointer hover:text-blue-600\" onClick={onClick}>\r\n                  {task.title}\r\n                </h4>\r\n                {task.createdBy === \"automation\" && (\r\n                  <Badge variant=\"outline\" className=\"text-xs\">\r\n                    Automação\r\n                  </Badge>\r\n                )}\r\n              </div>\r\n\r\n              <div className=\"flex items-center space-x-4 text-sm text-muted-foreground\">\r\n                {task.leadName && (\r\n                  <div className=\"flex items-center\">\r\n                    <Link className=\"h-3 w-3 mr-1\" />\r\n                    {task.leadName}\r\n                  </div>\r\n                )}\r\n\r\n                {task.assignedTo && (\r\n                  <div className=\"flex items-center\">\r\n                    <Avatar className=\"h-4 w-4 mr-1\">\r\n                      <AvatarImage src={task.assignedTo.avatar || \"/placeholder.svg\"} alt={task.assignedTo.name} />\r\n                      <AvatarFallback className=\"text-xs\">{task.assignedTo.name.substring(0, 2)}</AvatarFallback>\r\n                    </Avatar>\r\n                    {task.assignedTo.name}\r\n                  </div>\r\n                )}\r\n\r\n                {task.dueDate && (\r\n                  <div className={`flex items-center ${isOverdue ? \"text-red-600\" : \"\"}`}>\r\n                    <Calendar className=\"h-3 w-3 mr-1\" />\r\n                    {new Date(task.dueDate).toLocaleDateString(\"pt-BR\")}\r\n                  </div>\r\n                )}\r\n\r\n                {task.relatedConversations && task.relatedConversations.length > 0 && (\r\n                  <div className=\"flex items-center\">\r\n                    <MessageSquare className=\"h-3 w-3 mr-1\" />\r\n                    {task.relatedConversations.length} conversa(s)\r\n                  </div>\r\n                )}\r\n              </div>\r\n            </div>\r\n          </div>\r\n\r\n          <div className=\"flex items-center space-x-2\">\r\n            <Badge className={`${getPriorityColor(task.priority)}`}>{getPriorityLabel(task.priority)}</Badge>\r\n            <Select\r\n              value={task.status}\r\n              onValueChange={(value: TaskStatus) => {\r\n                onUpdateTask(task.id, {\r\n                  status: value,\r\n                })\r\n              }}\r\n            >\r\n              <SelectTrigger className={`w-auto border-0 ${getStatusColor(task.status)}`}>\r\n                <SelectValue>{getStatusLabel(task.status)}</SelectValue>\r\n              </SelectTrigger>\r\n              <SelectContent>\r\n                <SelectItem value=\"pending\">Pendente</SelectItem>\r\n                <SelectItem value=\"in_progress\">Em Andamento</SelectItem>\r\n                <SelectItem value=\"completed\">Concluída</SelectItem>\r\n                <SelectItem value=\"cancelled\">Cancelada</SelectItem>\r\n              </SelectContent>\r\n            </Select>\r\n            <Button variant=\"ghost\" size=\"icon\" onClick={onClick}>\r\n              <Eye className=\"h-4 w-4\" />\r\n            </Button>\r\n          </div>\r\n        </div>\r\n      </CardContent>\r\n    </Card>\r\n  )\r\n}\r\n\r\nfunction TaskDetailsDialog({\r\n  task,\r\n  projects,\r\n  onClose,\r\n  onUpdate,\r\n  onDelete,\r\n  getStatusLabel,\r\n  getPriorityLabel,\r\n}: {\r\n  task: Task\r\n  projects: Array<{ id: string; title: string; client: string }>\r\n  onClose: () => void\r\n  onUpdate: (updates: Partial<Task>) => void\r\n  onDelete: () => void\r\n  getStatusLabel: (status: TaskStatus) => string\r\n  getPriorityLabel: (priority: TaskPriority) => string\r\n}) {\r\n  const [isEditing, setIsEditing] = useState(false)\r\n  const [editForm, setEditForm] = useState(task)\r\n\r\n  const handleSave = () => {\r\n    onUpdate(editForm)\r\n    setIsEditing(false)\r\n  }\r\n\r\n  const lead = projects.find((p) => p.id === task.leadId)\r\n\r\n  return (\r\n    <Dialog open={true} onOpenChange={(open) => !open && onClose()}>\r\n      <DialogContent className=\"max-w-2xl max-h-[90vh] overflow-y-auto\">\r\n        <DialogHeader>\r\n          <div className=\"flex items-center justify-between\">\r\n            <DialogTitle>{task.title}</DialogTitle>\r\n            <div className=\"flex gap-2\">\r\n              <Button variant=\"outline\" size=\"sm\" onClick={() => setIsEditing(!isEditing)}>\r\n                <Edit className=\"h-4 w-4 mr-2\" />\r\n                {isEditing ? \"Cancelar\" : \"Editar\"}\r\n              </Button>\r\n              <Button variant=\"outline\" size=\"sm\" onClick={onDelete}>\r\n                <Trash2 className=\"h-4 w-4 mr-2\" />\r\n                Excluir\r\n              </Button>\r\n            </div>\r\n          </div>\r\n        </DialogHeader>\r\n\r\n        <div className=\"space-y-6\">\r\n          {isEditing ? (\r\n            <div className=\"space-y-4\">\r\n              <div>\r\n                <Label>Título</Label>\r\n                <Input value={editForm.title} onChange={(e) => setEditForm({ ...editForm, title: e.target.value })} />\r\n              </div>\r\n\r\n              <div>\r\n                <Label>Descrição</Label>\r\n                <Textarea\r\n                  value={editForm.description}\r\n                  onChange={(e) => setEditForm({ ...editForm, description: e.target.value })}\r\n                  rows={3}\r\n                />\r\n              </div>\r\n\r\n              <div>\r\n                <Label>Status</Label>\r\n                <Select\r\n                  value={editForm.status}\r\n                  onValueChange={(value: TaskStatus) => setEditForm({ ...editForm, status: value })}\r\n                >\r\n                  <SelectTrigger>\r\n                    <SelectValue />\r\n                  </SelectTrigger>\r\n                  <SelectContent>\r\n                    <SelectItem value=\"pending\">Pendente</SelectItem>\r\n                    <SelectItem value=\"in_progress\">Em Andamento</SelectItem>\r\n                    <SelectItem value=\"completed\">Concluída</SelectItem>\r\n                    <SelectItem value=\"cancelled\">Cancelada</SelectItem>\r\n                  </SelectContent>\r\n                </Select>\r\n              </div>\r\n\r\n              <div className=\"grid grid-cols-2 gap-4\">\r\n                <div>\r\n                  <Label>Prioridade</Label>\r\n                  <Select\r\n                    value={editForm.priority}\r\n                    onValueChange={(value: TaskPriority) => setEditForm({ ...editForm, priority: value })}\r\n                  >\r\n                    <SelectTrigger>\r\n                      <SelectValue />\r\n                    </SelectTrigger>\r\n                    <SelectContent>\r\n                      <SelectItem value=\"low\">Baixa</SelectItem>\r\n                      <SelectItem value=\"medium\">Média</SelectItem>\r\n                      <SelectItem value=\"high\">Alta</SelectItem>\r\n                      <SelectItem value=\"urgent\">Urgente</SelectItem>\r\n                    </SelectContent>\r\n                  </Select>\r\n                </div>\r\n\r\n                <div>\r\n                  <Label>Data de Vencimento</Label>\r\n                  <Input\r\n                    type=\"date\"\r\n                    value={editForm.dueDate || \"\"}\r\n                    onChange={(e) => setEditForm({ ...editForm, dueDate: e.target.value })}\r\n                  />\r\n                </div>\r\n              </div>\r\n\r\n              <div className=\"flex justify-end gap-2\">\r\n                <Button variant=\"outline\" onClick={() => setIsEditing(false)}>\r\n                  Cancelar\r\n                </Button>\r\n                <Button onClick={handleSave}>Salvar Alterações</Button>\r\n              </div>\r\n            </div>\r\n          ) : (\r\n            <div className=\"space-y-4\">\r\n              <div>\r\n                <h4 className=\"font-medium mb-2\">Descrição</h4>\r\n                <p className=\"text-muted-foreground\">{task.description || \"Sem descrição\"}</p>\r\n              </div>\r\n\r\n              <div className=\"grid grid-cols-2 gap-4\">\r\n                <div>\r\n                  <h4 className=\"font-medium mb-2\">Status</h4>\r\n                  <Badge className=\"bg-blue-100 text-blue-800\">{getStatusLabel(task.status)}</Badge>\r\n                </div>\r\n\r\n                <div>\r\n                  <h4 className=\"font-medium mb-2\">Prioridade</h4>\r\n                  <Badge className=\"bg-orange-100 text-orange-800\">{getPriorityLabel(task.priority)}</Badge>\r\n                </div>\r\n              </div>\r\n\r\n              {lead && (\r\n                <div>\r\n                  <h4 className=\"font-medium mb-2\">Lead Vinculado</h4>\r\n                  <div className=\"flex items-center justify-between p-3 bg-muted rounded-lg\">\r\n                    <div>\r\n                      <p className=\"font-medium\">{lead.title}</p>\r\n                      <p className=\"text-sm text-muted-foreground\">{lead.client}</p>\r\n                    </div>\r\n                    <Button variant=\"outline\" size=\"sm\">\r\n                      <ExternalLink className=\"h-4 w-4 mr-2\" />\r\n                      Ver Lead\r\n                    </Button>\r\n                  </div>\r\n                </div>\r\n              )}\r\n\r\n              {task.assignedTo && (\r\n                <div>\r\n                  <h4 className=\"font-medium mb-2\">Responsável</h4>\r\n                  <div className=\"flex items-center\">\r\n                    <Avatar className=\"h-8 w-8 mr-3\">\r\n                      <AvatarImage src={task.assignedTo.avatar || \"/placeholder.svg\"} alt={task.assignedTo.name} />\r\n                      <AvatarFallback>{task.assignedTo.name.substring(0, 2)}</AvatarFallback>\r\n                    </Avatar>\r\n                    <span>{task.assignedTo.name}</span>\r\n                  </div>\r\n                </div>\r\n              )}\r\n\r\n              {task.dueDate && (\r\n                <div>\r\n                  <h4 className=\"font-medium mb-2\">Data de Vencimento</h4>\r\n                  <div className=\"flex items-center\">\r\n                    <Calendar className=\"h-4 w-4 mr-2\" />\r\n                    {new Date(task.dueDate).toLocaleDateString(\"pt-BR\")}\r\n                  </div>\r\n                </div>\r\n              )}\r\n\r\n              {task.createdBy === \"automation\" && (\r\n                <div>\r\n                  <h4 className=\"font-medium mb-2\">Criada por Automação</h4>\r\n                  <Badge variant=\"outline\">Tarefa criada automaticamente</Badge>\r\n                </div>\r\n              )}\r\n\r\n              {task.relatedConversations && task.relatedConversations.length > 0 && (\r\n                <div>\r\n                  <h4 className=\"font-medium mb-2\">Conversas Relacionadas</h4>\r\n                  <div className=\"space-y-2\">\r\n                    {task.relatedConversations.map((conversationId, index) => (\r\n                      <div key={index} className=\"flex items-center justify-between p-2 bg-muted rounded\">\r\n                        <div className=\"flex items-center\">\r\n                          <MessageSquare className=\"h-4 w-4 mr-2\" />\r\n                          <span className=\"text-sm\">Conversa #{conversationId}</span>\r\n                        </div>\r\n                        <Button variant=\"outline\" size=\"sm\">\r\n                          <ExternalLink className=\"h-4 w-4 mr-2\" />\r\n                          Abrir\r\n                        </Button>\r\n                      </div>\r\n                    ))}\r\n                  </div>\r\n                </div>\r\n              )}\r\n\r\n              <div className=\"text-sm text-muted-foreground\">\r\n                <p>Criada em: {new Date(task.createdAt).toLocaleString(\"pt-BR\")}</p>\r\n                {task.completedAt && <p>Concluída em: {new Date(task.completedAt).toLocaleString(\"pt-BR\")}</p>}\r\n              </div>\r\n            </div>\r\n          )}\r\n        </div>\r\n      </DialogContent>\r\n    </Dialog>\r\n  )\r\n}\r\n\r\nfunction CreateTaskDialog({\r\n  leads,\r\n  onClose,\r\n  onCreate,\r\n}: {\r\n  leads: Array<{ id: string; title: string; company?: string; funnelName?: string }>\r\n  onClose: () => void\r\n  onCreate: (task: Omit<Task, \"id\" | \"createdAt\">) => void\r\n}) {\r\n  const [form, setForm] = useState({\r\n    title: \"\",\r\n    description: \"\",\r\n    status: \"pending\" as TaskStatus,\r\n    priority: \"medium\" as TaskPriority,\r\n    leadId: \"\",\r\n    dueDate: \"\",\r\n  })\r\n\r\n  const [open, setOpen] = useState(false)\r\n  const [searchValue, setSearchValue] = useState(\"\")\r\n\r\n  const handleSubmit = (e: React.FormEvent) => {\r\n    e.preventDefault()\r\n\r\n    const selectedLead = form.leadId !== \"no_lead\" ? leads.find((l) => l.id === form.leadId) : null\r\n\r\n    onCreate({\r\n      ...form,\r\n      leadId: form.leadId !== \"no_lead\" ? form.leadId : undefined,\r\n      leadName: selectedLead?.title,\r\n      clientName: selectedLead?.company || selectedLead?.funnelName,\r\n      createdBy: \"manual\",\r\n      tags: [],\r\n      relatedConversations: [],\r\n    })\r\n  }\r\n\r\n  const selectedLead = leads.find((lead) => lead.id === form.leadId)\r\n\r\n  return (\r\n    <Dialog open={true} onOpenChange={(open) => !open && onClose()}>\r\n      <DialogContent className=\"max-w-md\">\r\n        <DialogHeader>\r\n          <DialogTitle>Nova Tarefa</DialogTitle>\r\n        </DialogHeader>\r\n\r\n        <form onSubmit={handleSubmit} className=\"space-y-4\">\r\n          <div>\r\n            <Label>Título *</Label>\r\n            <Input\r\n              value={form.title}\r\n              onChange={(e) => setForm({ ...form, title: e.target.value })}\r\n              placeholder=\"Título da tarefa\"\r\n              required\r\n            />\r\n          </div>\r\n\r\n          <div>\r\n            <Label>Descrição</Label>\r\n            <Textarea\r\n              value={form.description}\r\n              onChange={(e) => setForm({ ...form, description: e.target.value })}\r\n              placeholder=\"Descrição da tarefa\"\r\n              rows={3}\r\n            />\r\n          </div>\r\n\r\n          <div>\r\n            <Label>Lead</Label>\r\n            <Popover open={open} onOpenChange={setOpen}>\r\n              <PopoverTrigger asChild>\r\n                <Button\r\n                  variant=\"outline\"\r\n                  role=\"combobox\"\r\n                  aria-expanded={open}\r\n                  className=\"w-full justify-between bg-transparent\"\r\n                >\r\n                  {selectedLead\r\n                    ? `${selectedLead.title} - ${selectedLead.company || selectedLead.funnelName}`\r\n                    : \"Buscar lead...\"}\r\n                  <ChevronsUpDown className=\"ml-2 h-4 w-4 shrink-0 opacity-50\" />\r\n                </Button>\r\n              </PopoverTrigger>\r\n              <PopoverContent className=\"w-full p-0\" align=\"start\">\r\n                <Command>\r\n                  <CommandInput placeholder=\"Buscar lead...\" value={searchValue} onValueChange={setSearchValue} />\r\n                  <CommandList>\r\n                    <CommandEmpty>Nenhum lead encontrado.</CommandEmpty>\r\n                    <CommandGroup>\r\n                      <CommandItem\r\n                        value=\"no_lead\"\r\n                        onSelect={() => {\r\n                          setForm({ ...form, leadId: \"no_lead\" })\r\n                          setOpen(false)\r\n                          setSearchValue(\"\")\r\n                        }}\r\n                      >\r\n                        <Check\r\n                          className={cn(\"mr-2 h-4 w-4\", form.leadId === \"no_lead\" ? \"opacity-100\" : \"opacity-0\")}\r\n                        />\r\n                        Nenhum lead\r\n                      </CommandItem>\r\n                      {leads.map((lead) => (\r\n                        <CommandItem\r\n                          key={lead.id}\r\n                          value={`${lead.title} ${lead.company || lead.funnelName}`}\r\n                          onSelect={() => {\r\n                            setForm({ ...form, leadId: lead.id })\r\n                            setOpen(false)\r\n                            setSearchValue(\"\")\r\n                          }}\r\n                        >\r\n                          <Check\r\n                            className={cn(\"mr-2 h-4 w-4\", form.leadId === lead.id ? \"opacity-100\" : \"opacity-0\")}\r\n                          />\r\n                          <div className=\"flex flex-col\">\r\n                            <span className=\"font-medium\">{lead.title}</span>\r\n                            <span className=\"text-xs text-muted-foreground\">{lead.company || lead.funnelName}</span>\r\n                          </div>\r\n                        </CommandItem>\r\n                      ))}\r\n                    </CommandGroup>\r\n                  </CommandList>\r\n                </Command>\r\n              </PopoverContent>\r\n            </Popover>\r\n          </div>\r\n\r\n          <div>\r\n            <Label>Status</Label>\r\n            <Select value={form.status} onValueChange={(value: TaskStatus) => setForm({ ...form, status: value })}>\r\n              <SelectTrigger>\r\n                <SelectValue />\r\n              </SelectTrigger>\r\n              <SelectContent>\r\n                <SelectItem value=\"pending\">Pendente</SelectItem>\r\n                <SelectItem value=\"in_progress\">Em Andamento</SelectItem>\r\n                <SelectItem value=\"completed\">Concluída</SelectItem>\r\n                <SelectItem value=\"cancelled\">Cancelada</SelectItem>\r\n              </SelectContent>\r\n            </Select>\r\n          </div>\r\n\r\n          <div className=\"grid grid-cols-2 gap-4\">\r\n            <div>\r\n              <Label>Prioridade</Label>\r\n              <Select\r\n                value={form.priority}\r\n                onValueChange={(value: TaskPriority) => setForm({ ...form, priority: value })}\r\n              >\r\n                <SelectTrigger>\r\n                  <SelectValue />\r\n                </SelectTrigger>\r\n                <SelectContent>\r\n                  <SelectItem value=\"low\">Baixa</SelectItem>\r\n                  <SelectItem value=\"medium\">Média</SelectItem>\r\n                  <SelectItem value=\"high\">Alta</SelectItem>\r\n                  <SelectItem value=\"urgent\">Urgente</SelectItem>\r\n                </SelectContent>\r\n              </Select>\r\n            </div>\r\n\r\n            <div>\r\n              <Label>Data de Vencimento</Label>\r\n              <Input type=\"date\" value={form.dueDate} onChange={(e) => setForm({ ...form, dueDate: e.target.value })} />\r\n            </div>\r\n          </div>\r\n\r\n          <div className=\"flex justify-end gap-2 pt-4\">\r\n            <Button type=\"button\" variant=\"outline\" onClick={onClose}>\r\n              Cancelar\r\n            </Button>\r\n            <Button type=\"submit\">Criar Tarefa</Button>\r\n          </div>\r\n        </form>\r\n      </DialogContent>\r\n    </Dialog>\r\n  )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Projetos\\Back_endCrm\\kanbanproject1\\components\\templates-hub-dialog.tsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'choice' is defined but never used.","line":15,"column":14,"nodeType":"Identifier","messageId":"unusedVar","endLine":15,"endColumn":40,"suggestions":[{"messageId":"removeVar","data":{"varName":"choice"},"fix":{"range":[466,492],"text":""},"desc":"Remove unused variable 'choice'."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\"\n\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from \"@/components/ui/dialog\"\nimport { Button } from \"@/components/ui/button\"\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\"\nimport { Download, MessageSquareText, Workflow } from \"lucide-react\"\n\nexport type TemplatesHubChoice = \"funnel\" | \"messages\"\n\nexport default function TemplatesHubDialog({\n  onClose,\n  onChoose,\n}: {\n  onClose: () => void\n  onChoose: (choice: TemplatesHubChoice) => void\n}) {\n  return (\n    <Dialog open={true} onOpenChange={(open) => !open && onClose()}>\n      <DialogContent className=\"max-w-3xl\">\n        <DialogHeader>\n          <DialogTitle className=\"flex items-center gap-2\">\n            <Download className=\"h-5 w-5\" />\n            Templates\n          </DialogTitle>\n        </DialogHeader>\n\n        <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n          <Card className=\"hover:shadow-md transition-shadow\">\n            <CardHeader>\n              <CardTitle className=\"flex items-center gap-2\">\n                <Workflow className=\"h-5 w-5 text-primary\" />\n                Templates de Funil\n              </CardTitle>\n            </CardHeader>\n            <CardContent className=\"space-y-3\">\n              <p className=\"text-sm text-muted-foreground\">\n                Modelos prontos de pipeline por segmento para acelerar a criação do seu funil.\n              </p>\n              <Button className=\"w-full\" onClick={() => onChoose(\"funnel\")}>Acessar</Button>\n            </CardContent>\n          </Card>\n\n          <Card className=\"hover:shadow-md transition-shadow\">\n            <CardHeader>\n              <CardTitle className=\"flex items-center gap-2\">\n                <MessageSquareText className=\"h-5 w-5 text-primary\" />\n                Templates de Mensagens\n              </CardTitle>\n            </CardHeader>\n            <CardContent className=\"space-y-3\">\n              <p className=\"text-sm text-muted-foreground\">\n                Crie templates de WhatsApp (texto, imagem, vídeo, botões) com variáveis e preview.\n              </p>\n              <Button className=\"w-full\" onClick={() => onChoose(\"messages\")}>Acessar</Button>\n            </CardContent>\n          </Card>\n        </div>\n\n        <div className=\"flex justify-end\">\n          <Button variant=\"outline\" onClick={onClose}>\n            Fechar\n          </Button>\n        </div>\n      </DialogContent>\n    </Dialog>\n  )\n}\n\n","usedDeprecatedRules":[]},{"filePath":"C:\\Projetos\\Back_endCrm\\kanbanproject1\\components\\theme-provider.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projetos\\Back_endCrm\\kanbanproject1\\components\\ui\\accordion.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projetos\\Back_endCrm\\kanbanproject1\\components\\ui\\alert-dialog.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projetos\\Back_endCrm\\kanbanproject1\\components\\ui\\alert.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projetos\\Back_endCrm\\kanbanproject1\\components\\ui\\aspect-ratio.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projetos\\Back_endCrm\\kanbanproject1\\components\\ui\\avatar.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projetos\\Back_endCrm\\kanbanproject1\\components\\ui\\badge.tsx","messages":[{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":36,"column":17,"nodeType":"Identifier","messageId":"namedExport","endLine":36,"endColumn":30}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import * as React from 'react'\r\nimport { cva, type VariantProps } from 'class-variance-authority'\r\n\r\nimport { cn } from '@/lib/utils'\r\n\r\nconst badgeVariants = cva(\r\n  'inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2',\r\n  {\r\n    variants: {\r\n      variant: {\r\n        default:\r\n          'border-transparent bg-primary text-primary-foreground hover:bg-primary/80',\r\n        secondary:\r\n          'border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80',\r\n        destructive:\r\n          'border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80',\r\n        outline: 'text-foreground',\r\n      },\r\n    },\r\n    defaultVariants: {\r\n      variant: 'default',\r\n    },\r\n  },\r\n)\r\n\r\nexport interface BadgeProps\r\n  extends React.HTMLAttributes<HTMLDivElement>,\r\n    VariantProps<typeof badgeVariants> {}\r\n\r\nfunction Badge({ className, variant, ...props }: BadgeProps) {\r\n  return (\r\n    <div className={cn(badgeVariants({ variant }), className)} {...props} />\r\n  )\r\n}\r\n\r\nexport { Badge, badgeVariants }\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Projetos\\Back_endCrm\\kanbanproject1\\components\\ui\\breadcrumb.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projetos\\Back_endCrm\\kanbanproject1\\components\\ui\\button-group.tsx","messages":[{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":82,"column":3,"nodeType":"Identifier","messageId":"namedExport","endLine":82,"endColumn":22}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { Slot } from '@radix-ui/react-slot'\r\nimport { cva, type VariantProps } from 'class-variance-authority'\r\n\r\nimport { cn } from '@/lib/utils'\r\nimport { Separator } from '@/components/ui/separator'\r\n\r\nconst buttonGroupVariants = cva(\r\n  \"flex w-fit items-stretch has-[>[data-slot=button-group]]:gap-2 [&>*]:focus-visible:relative [&>*]:focus-visible:z-10 has-[select[aria-hidden=true]:last-child]:[&>[data-slot=select-trigger]:last-of-type]:rounded-r-md [&>[data-slot=select-trigger]:not([class*='w-'])]:w-fit [&>input]:flex-1\",\r\n  {\r\n    variants: {\r\n      orientation: {\r\n        horizontal:\r\n          '[&>*:not(:first-child)]:rounded-l-none [&>*:not(:first-child)]:border-l-0 [&>*:not(:last-child)]:rounded-r-none',\r\n        vertical:\r\n          'flex-col [&>*:not(:first-child)]:rounded-t-none [&>*:not(:first-child)]:border-t-0 [&>*:not(:last-child)]:rounded-b-none',\r\n      },\r\n    },\r\n    defaultVariants: {\r\n      orientation: 'horizontal',\r\n    },\r\n  },\r\n)\r\n\r\nfunction ButtonGroup({\r\n  className,\r\n  orientation,\r\n  ...props\r\n}: React.ComponentProps<'div'> & VariantProps<typeof buttonGroupVariants>) {\r\n  return (\r\n    <div\r\n      role=\"group\"\r\n      data-slot=\"button-group\"\r\n      data-orientation={orientation}\r\n      className={cn(buttonGroupVariants({ orientation }), className)}\r\n      {...props}\r\n    />\r\n  )\r\n}\r\n\r\nfunction ButtonGroupText({\r\n  className,\r\n  asChild = false,\r\n  ...props\r\n}: React.ComponentProps<'div'> & {\r\n  asChild?: boolean\r\n}) {\r\n  const Comp = asChild ? Slot : 'div'\r\n\r\n  return (\r\n    <Comp\r\n      className={cn(\r\n        \"bg-muted shadow-xs flex items-center gap-2 rounded-md border px-4 text-sm font-medium [&_svg:not([class*='size-'])]:size-4 [&_svg]:pointer-events-none\",\r\n        className,\r\n      )}\r\n      {...props}\r\n    />\r\n  )\r\n}\r\n\r\nfunction ButtonGroupSeparator({\r\n  className,\r\n  orientation = 'vertical',\r\n  ...props\r\n}: React.ComponentProps<typeof Separator>) {\r\n  return (\r\n    <Separator\r\n      data-slot=\"button-group-separator\"\r\n      orientation={orientation}\r\n      className={cn(\r\n        'bg-input relative !m-0 self-stretch data-[orientation=vertical]:h-auto',\r\n        className,\r\n      )}\r\n      {...props}\r\n    />\r\n  )\r\n}\r\n\r\nexport {\r\n  ButtonGroup,\r\n  ButtonGroupSeparator,\r\n  ButtonGroupText,\r\n  buttonGroupVariants,\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Projetos\\Back_endCrm\\kanbanproject1\\components\\ui\\button.tsx","messages":[{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":56,"column":18,"nodeType":"Identifier","messageId":"namedExport","endLine":56,"endColumn":32}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import * as React from 'react'\r\nimport { Slot } from '@radix-ui/react-slot'\r\nimport { cva, type VariantProps } from 'class-variance-authority'\r\n\r\nimport { cn } from '@/lib/utils'\r\n\r\nconst buttonVariants = cva(\r\n  'inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0',\r\n  {\r\n    variants: {\r\n      variant: {\r\n        default: 'bg-primary text-primary-foreground hover:bg-primary/90',\r\n        destructive:\r\n          'bg-destructive text-destructive-foreground hover:bg-destructive/90',\r\n        outline:\r\n          'border border-input bg-background hover:bg-accent hover:text-accent-foreground',\r\n        secondary:\r\n          'bg-secondary text-secondary-foreground hover:bg-secondary/80',\r\n        ghost: 'hover:bg-accent hover:text-accent-foreground',\r\n        link: 'text-primary underline-offset-4 hover:underline',\r\n      },\r\n      size: {\r\n        default: 'h-10 px-4 py-2',\r\n        sm: 'h-9 rounded-md px-3',\r\n        lg: 'h-11 rounded-md px-8',\r\n        icon: 'h-10 w-10',\r\n      },\r\n    },\r\n    defaultVariants: {\r\n      variant: 'default',\r\n      size: 'default',\r\n    },\r\n  },\r\n)\r\n\r\nexport interface ButtonProps\r\n  extends React.ButtonHTMLAttributes<HTMLButtonElement>,\r\n    VariantProps<typeof buttonVariants> {\r\n  asChild?: boolean\r\n}\r\n\r\nconst Button = React.forwardRef<HTMLButtonElement, ButtonProps>(\r\n  ({ className, variant, size, asChild = false, ...props }, ref) => {\r\n    const Comp = asChild ? Slot : 'button'\r\n    return (\r\n      <Comp\r\n        className={cn(buttonVariants({ variant, size, className }))}\r\n        ref={ref}\r\n        {...props}\r\n      />\r\n    )\r\n  },\r\n)\r\nButton.displayName = 'Button'\r\n\r\nexport { Button, buttonVariants }\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Projetos\\Back_endCrm\\kanbanproject1\\components\\ui\\calendar.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projetos\\Back_endCrm\\kanbanproject1\\components\\ui\\card.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projetos\\Back_endCrm\\kanbanproject1\\components\\ui\\carousel.tsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'api' is defined but never used.","line":21,"column":13,"nodeType":"Identifier","messageId":"unusedVar","endLine":21,"endColumn":29,"suggestions":[{"messageId":"removeVar","data":{"varName":"api"},"fix":{"range":[620,636],"text":""},"desc":"Remove unused variable 'api'."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\r\n\r\nimport * as React from 'react'\r\nimport useEmblaCarousel, {\r\n  type UseEmblaCarouselType,\r\n} from 'embla-carousel-react'\r\nimport { ArrowLeft, ArrowRight } from 'lucide-react'\r\n\r\nimport { cn } from '@/lib/utils'\r\nimport { Button } from '@/components/ui/button'\r\n\r\ntype CarouselApi = UseEmblaCarouselType[1]\r\ntype UseCarouselParameters = Parameters<typeof useEmblaCarousel>\r\ntype CarouselOptions = UseCarouselParameters[0]\r\ntype CarouselPlugin = UseCarouselParameters[1]\r\n\r\ntype CarouselProps = {\r\n  opts?: CarouselOptions\r\n  plugins?: CarouselPlugin\r\n  orientation?: 'horizontal' | 'vertical'\r\n  setApi?: (api: CarouselApi) => void\r\n}\r\n\r\ntype CarouselContextProps = {\r\n  carouselRef: ReturnType<typeof useEmblaCarousel>[0]\r\n  api: ReturnType<typeof useEmblaCarousel>[1]\r\n  scrollPrev: () => void\r\n  scrollNext: () => void\r\n  canScrollPrev: boolean\r\n  canScrollNext: boolean\r\n} & CarouselProps\r\n\r\nconst CarouselContext = React.createContext<CarouselContextProps | null>(null)\r\n\r\nfunction useCarousel() {\r\n  const context = React.useContext(CarouselContext)\r\n\r\n  if (!context) {\r\n    throw new Error('useCarousel must be used within a <Carousel />')\r\n  }\r\n\r\n  return context\r\n}\r\n\r\nconst Carousel = React.forwardRef<\r\n  HTMLDivElement,\r\n  React.HTMLAttributes<HTMLDivElement> & CarouselProps\r\n>(\r\n  (\r\n    {\r\n      orientation = 'horizontal',\r\n      opts,\r\n      setApi,\r\n      plugins,\r\n      className,\r\n      children,\r\n      ...props\r\n    },\r\n    ref,\r\n  ) => {\r\n    const [carouselRef, api] = useEmblaCarousel(\r\n      {\r\n        ...opts,\r\n        axis: orientation === 'horizontal' ? 'x' : 'y',\r\n      },\r\n      plugins,\r\n    )\r\n    const [canScrollPrev, setCanScrollPrev] = React.useState(false)\r\n    const [canScrollNext, setCanScrollNext] = React.useState(false)\r\n\r\n    const onSelect = React.useCallback((api: CarouselApi) => {\r\n      if (!api) {\r\n        return\r\n      }\r\n\r\n      setCanScrollPrev(api.canScrollPrev())\r\n      setCanScrollNext(api.canScrollNext())\r\n    }, [])\r\n\r\n    const scrollPrev = React.useCallback(() => {\r\n      api?.scrollPrev()\r\n    }, [api])\r\n\r\n    const scrollNext = React.useCallback(() => {\r\n      api?.scrollNext()\r\n    }, [api])\r\n\r\n    const handleKeyDown = React.useCallback(\r\n      (event: React.KeyboardEvent<HTMLDivElement>) => {\r\n        if (event.key === 'ArrowLeft') {\r\n          event.preventDefault()\r\n          scrollPrev()\r\n        } else if (event.key === 'ArrowRight') {\r\n          event.preventDefault()\r\n          scrollNext()\r\n        }\r\n      },\r\n      [scrollPrev, scrollNext],\r\n    )\r\n\r\n    React.useEffect(() => {\r\n      if (!api || !setApi) {\r\n        return\r\n      }\r\n\r\n      setApi(api)\r\n    }, [api, setApi])\r\n\r\n    React.useEffect(() => {\r\n      if (!api) {\r\n        return\r\n      }\r\n\r\n      onSelect(api)\r\n      api.on('reInit', onSelect)\r\n      api.on('select', onSelect)\r\n\r\n      return () => {\r\n        api?.off('select', onSelect)\r\n      }\r\n    }, [api, onSelect])\r\n\r\n    return (\r\n      <CarouselContext.Provider\r\n        value={{\r\n          carouselRef,\r\n          api: api,\r\n          opts,\r\n          orientation:\r\n            orientation || (opts?.axis === 'y' ? 'vertical' : 'horizontal'),\r\n          scrollPrev,\r\n          scrollNext,\r\n          canScrollPrev,\r\n          canScrollNext,\r\n        }}\r\n      >\r\n        <div\r\n          ref={ref}\r\n          onKeyDownCapture={handleKeyDown}\r\n          className={cn('relative', className)}\r\n          role=\"region\"\r\n          aria-roledescription=\"carousel\"\r\n          {...props}\r\n        >\r\n          {children}\r\n        </div>\r\n      </CarouselContext.Provider>\r\n    )\r\n  },\r\n)\r\nCarousel.displayName = 'Carousel'\r\n\r\nconst CarouselContent = React.forwardRef<\r\n  HTMLDivElement,\r\n  React.HTMLAttributes<HTMLDivElement>\r\n>(({ className, ...props }, ref) => {\r\n  const { carouselRef, orientation } = useCarousel()\r\n\r\n  return (\r\n    <div ref={carouselRef} className=\"overflow-hidden\">\r\n      <div\r\n        ref={ref}\r\n        className={cn(\r\n          'flex',\r\n          orientation === 'horizontal' ? '-ml-4' : '-mt-4 flex-col',\r\n          className,\r\n        )}\r\n        {...props}\r\n      />\r\n    </div>\r\n  )\r\n})\r\nCarouselContent.displayName = 'CarouselContent'\r\n\r\nconst CarouselItem = React.forwardRef<\r\n  HTMLDivElement,\r\n  React.HTMLAttributes<HTMLDivElement>\r\n>(({ className, ...props }, ref) => {\r\n  const { orientation } = useCarousel()\r\n\r\n  return (\r\n    <div\r\n      ref={ref}\r\n      role=\"group\"\r\n      aria-roledescription=\"slide\"\r\n      className={cn(\r\n        'min-w-0 shrink-0 grow-0 basis-full',\r\n        orientation === 'horizontal' ? 'pl-4' : 'pt-4',\r\n        className,\r\n      )}\r\n      {...props}\r\n    />\r\n  )\r\n})\r\nCarouselItem.displayName = 'CarouselItem'\r\n\r\nconst CarouselPrevious = React.forwardRef<\r\n  HTMLButtonElement,\r\n  React.ComponentProps<typeof Button>\r\n>(({ className, variant = 'outline', size = 'icon', ...props }, ref) => {\r\n  const { orientation, scrollPrev, canScrollPrev } = useCarousel()\r\n\r\n  return (\r\n    <Button\r\n      ref={ref}\r\n      variant={variant}\r\n      size={size}\r\n      className={cn(\r\n        'absolute  h-8 w-8 rounded-full',\r\n        orientation === 'horizontal'\r\n          ? '-left-12 top-1/2 -translate-y-1/2'\r\n          : '-top-12 left-1/2 -translate-x-1/2 rotate-90',\r\n        className,\r\n      )}\r\n      disabled={!canScrollPrev}\r\n      onClick={scrollPrev}\r\n      {...props}\r\n    >\r\n      <ArrowLeft className=\"h-4 w-4\" />\r\n      <span className=\"sr-only\">Previous slide</span>\r\n    </Button>\r\n  )\r\n})\r\nCarouselPrevious.displayName = 'CarouselPrevious'\r\n\r\nconst CarouselNext = React.forwardRef<\r\n  HTMLButtonElement,\r\n  React.ComponentProps<typeof Button>\r\n>(({ className, variant = 'outline', size = 'icon', ...props }, ref) => {\r\n  const { orientation, scrollNext, canScrollNext } = useCarousel()\r\n\r\n  return (\r\n    <Button\r\n      ref={ref}\r\n      variant={variant}\r\n      size={size}\r\n      className={cn(\r\n        'absolute h-8 w-8 rounded-full',\r\n        orientation === 'horizontal'\r\n          ? '-right-12 top-1/2 -translate-y-1/2'\r\n          : '-bottom-12 left-1/2 -translate-x-1/2 rotate-90',\r\n        className,\r\n      )}\r\n      disabled={!canScrollNext}\r\n      onClick={scrollNext}\r\n      {...props}\r\n    >\r\n      <ArrowRight className=\"h-4 w-4\" />\r\n      <span className=\"sr-only\">Next slide</span>\r\n    </Button>\r\n  )\r\n})\r\nCarouselNext.displayName = 'CarouselNext'\r\n\r\nexport {\r\n  type CarouselApi,\r\n  Carousel,\r\n  CarouselContent,\r\n  CarouselItem,\r\n  CarouselPrevious,\r\n  CarouselNext,\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Projetos\\Back_endCrm\\kanbanproject1\\components\\ui\\chart.tsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'k' is defined but never used.","line":12,"column":4,"nodeType":"Identifier","messageId":"unusedVar","endLine":12,"endColumn":5,"suggestions":[{"messageId":"removeVar","data":{"varName":"k"},"fix":{"range":[262,263],"text":""},"desc":"Remove unused variable 'k'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'_' is defined but never used.","line":64,"column":55,"nodeType":"Identifier","messageId":"unusedVar","endLine":64,"endColumn":56,"suggestions":[{"messageId":"removeVar","data":{"varName":"_"},"fix":{"range":[2424,2425],"text":""},"desc":"Remove unused variable '_'."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'_' is defined but never used.","line":64,"column":55,"nodeType":null,"messageId":"unusedVar","endLine":64,"endColumn":56}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\"\r\n\r\nimport * as React from \"react\"\r\nimport * as RechartsPrimitive from \"recharts\"\r\n\r\nimport { cn } from \"@/lib/utils\"\r\n\r\n// Format: { THEME_NAME: CSS_SELECTOR }\r\nconst THEMES = { light: \"\", dark: \".dark\" } as const\r\n\r\nexport type ChartConfig = {\r\n  [k in string]: {\r\n    label?: React.ReactNode\r\n    icon?: React.ComponentType\r\n  } & ({ color?: string; theme?: never } | { color?: never; theme: Record<keyof typeof THEMES, string> })\r\n}\r\n\r\ntype ChartContextProps = {\r\n  config: ChartConfig\r\n}\r\n\r\nconst ChartContext = React.createContext<ChartContextProps | null>(null)\r\n\r\nfunction useChart() {\r\n  const context = React.useContext(ChartContext)\r\n\r\n  if (!context) {\r\n    throw new Error(\"useChart must be used within a <ChartContainer />\")\r\n  }\r\n\r\n  return context\r\n}\r\n\r\nconst ChartContainer = React.forwardRef<\r\n  HTMLDivElement,\r\n  React.ComponentProps<\"div\"> & {\r\n    config: ChartConfig\r\n    children: React.ComponentProps<typeof RechartsPrimitive.ResponsiveContainer>[\"children\"]\r\n  }\r\n>(({ id, className, children, config, ...props }, ref) => {\r\n  const uniqueId = React.useId()\r\n  const chartId = `chart-${id || uniqueId.replace(/:/g, \"\")}`\r\n\r\n  return (\r\n    <ChartContext.Provider value={{ config }}>\r\n      <div\r\n        data-chart={chartId}\r\n        ref={ref}\r\n        className={cn(\r\n          \"flex aspect-video justify-center text-xs [&_.recharts-cartesian-axis-tick_text]:fill-muted-foreground [&_.recharts-cartesian-grid_line[stroke='#ccc']]:stroke-border/50 [&_.recharts-curve.recharts-tooltip-cursor]:stroke-border [&_.recharts-dot[stroke='#fff']]:stroke-transparent [&_.recharts-layer]:outline-none [&_.recharts-polar-grid_[stroke='#ccc']]:stroke-border [&_.recharts-radial-bar-background-sector]:fill-muted [&_.recharts-rectangle.recharts-tooltip-cursor]:fill-muted [&_.recharts-reference-line_[stroke='#ccc']]:stroke-border [&_.recharts-sector[stroke='#fff']]:stroke-transparent [&_.recharts-sector]:outline-none [&_.recharts-surface]:outline-none\",\r\n          className,\r\n        )}\r\n        {...props}\r\n      >\r\n        <ChartStyle id={chartId} config={config} />\r\n        <RechartsPrimitive.ResponsiveContainer>{children}</RechartsPrimitive.ResponsiveContainer>\r\n      </div>\r\n    </ChartContext.Provider>\r\n  )\r\n})\r\nChartContainer.displayName = \"Chart\"\r\n\r\nconst ChartStyle = ({ id, config }: { id: string; config: ChartConfig }) => {\r\n  const colorConfig = Object.entries(config).filter(([_, config]) => config.theme || config.color)\r\n\r\n  if (!colorConfig.length) {\r\n    return null\r\n  }\r\n\r\n  return (\r\n    <style\r\n      dangerouslySetInnerHTML={{\r\n        __html: Object.entries(THEMES)\r\n          .map(\r\n            ([theme, prefix]) => `\r\n${prefix} [data-chart=${id}] {\r\n${colorConfig\r\n  .map(([key, itemConfig]) => {\r\n    const color = itemConfig.theme?.[theme as keyof typeof itemConfig.theme] || itemConfig.color\r\n    return color ? `  --color-${key}: ${color};` : null\r\n  })\r\n  .join(\"\\n\")}\r\n}\r\n`,\r\n          )\r\n          .join(\"\\n\"),\r\n      }}\r\n    />\r\n  )\r\n}\r\n\r\nconst ChartTooltip = RechartsPrimitive.Tooltip\r\n\r\nconst ChartTooltipContent = React.forwardRef<\r\n  HTMLDivElement,\r\n  React.ComponentProps<typeof RechartsPrimitive.Tooltip> &\r\n    React.ComponentProps<\"div\"> & {\r\n      hideLabel?: boolean\r\n      hideIndicator?: boolean\r\n      indicator?: \"line\" | \"dot\" | \"dashed\"\r\n      nameKey?: string\r\n      labelKey?: string\r\n    }\r\n>(\r\n  (\r\n    {\r\n      active,\r\n      payload,\r\n      className,\r\n      indicator = \"dot\",\r\n      hideLabel = false,\r\n      hideIndicator = false,\r\n      label,\r\n      labelFormatter,\r\n      labelClassName,\r\n      formatter,\r\n      color,\r\n      nameKey,\r\n      labelKey,\r\n    },\r\n    ref,\r\n  ) => {\r\n    const { config } = useChart()\r\n\r\n    const tooltipLabel = React.useMemo(() => {\r\n      if (hideLabel || !payload?.length) {\r\n        return null\r\n      }\r\n\r\n      const [item] = payload\r\n      const key = `${labelKey || item.dataKey || item.name || \"value\"}`\r\n      const itemConfig = getPayloadConfigFromPayload(config, item, key)\r\n      const value =\r\n        !labelKey && typeof label === \"string\"\r\n          ? config[label as keyof typeof config]?.label || label\r\n          : itemConfig?.label\r\n\r\n      if (labelFormatter) {\r\n        return <div className={cn(\"font-medium\", labelClassName)}>{labelFormatter(value, payload)}</div>\r\n      }\r\n\r\n      if (!value) {\r\n        return null\r\n      }\r\n\r\n      return <div className={cn(\"font-medium\", labelClassName)}>{value}</div>\r\n    }, [label, labelFormatter, payload, hideLabel, labelClassName, config, labelKey])\r\n\r\n    if (!active || !payload?.length) {\r\n      return null\r\n    }\r\n\r\n    const nestLabel = payload.length === 1 && indicator !== \"dot\"\r\n\r\n    return (\r\n      <div\r\n        ref={ref}\r\n        className={cn(\r\n          \"grid min-w-[8rem] items-start gap-1.5 rounded-lg border border-muted bg-background px-2.5 py-1.5 text-xs shadow-xl\",\r\n          className,\r\n        )}\r\n      >\r\n        {!nestLabel ? tooltipLabel : null}\r\n        <div className=\"grid gap-1.5\">\r\n          {payload.map((item, index) => {\r\n            const key = `${nameKey || item.name || item.dataKey || \"value\"}`\r\n            const itemConfig = getPayloadConfigFromPayload(config, item, key)\r\n            const indicatorColor = color || item.payload.fill || item.color\r\n\r\n            return (\r\n              <div\r\n                key={item.dataKey}\r\n                className={cn(\r\n                  \"flex w-full flex-wrap items-stretch gap-2 [&>svg]:h-2.5 [&>svg]:w-2.5 [&>svg]:text-muted-foreground\",\r\n                  indicator === \"dot\" && \"items-center\",\r\n                )}\r\n              >\r\n                {formatter && item?.value !== undefined && item.name ? (\r\n                  formatter(item.value, item.name, item, index, item.payload)\r\n                ) : (\r\n                  <>\r\n                    {itemConfig?.icon ? (\r\n                      <itemConfig.icon />\r\n                    ) : (\r\n                      !hideIndicator && (\r\n                        <div\r\n                          className={cn(\"shrink-0 rounded-[2px]\", {\r\n                            \"h-2.5 w-2.5\": indicator === \"dot\",\r\n                            \"w-1\": indicator === \"line\",\r\n                            \"w-0 border-[1.5px] border-dashed bg-transparent\": indicator === \"dashed\",\r\n                            \"my-0.5\": nestLabel && indicator === \"dashed\",\r\n                          })}\r\n                          style={{\r\n                            backgroundColor: indicatorColor,\r\n                            borderColor: indicatorColor,\r\n                          }}\r\n                        />\r\n                      )\r\n                    )}\r\n                    <div\r\n                      className={cn(\r\n                        \"flex flex-1 justify-between leading-none\",\r\n                        nestLabel ? \"items-end\" : \"items-center\",\r\n                      )}\r\n                    >\r\n                      <div className=\"grid gap-1.5\">\r\n                        {nestLabel ? tooltipLabel : null}\r\n                        <span className=\"text-muted-foreground\">{itemConfig?.label || item.name}</span>\r\n                      </div>\r\n                      {item.value && (\r\n                        <span className=\"font-mono font-medium tabular-nums text-foreground\">\r\n                          {item.value.toLocaleString()}\r\n                        </span>\r\n                      )}\r\n                    </div>\r\n                  </>\r\n                )}\r\n              </div>\r\n            )\r\n          })}\r\n        </div>\r\n      </div>\r\n    )\r\n  },\r\n)\r\nChartTooltipContent.displayName = \"ChartTooltip\"\r\n\r\nconst ChartLegend = RechartsPrimitive.Legend\r\n\r\nconst ChartLegendContent = React.forwardRef<\r\n  HTMLDivElement,\r\n  React.ComponentProps<\"div\"> &\r\n    Pick<RechartsPrimitive.LegendProps, \"payload\" | \"verticalAlign\"> & {\r\n      hideIcon?: boolean\r\n      nameKey?: string\r\n    }\r\n>(({ className, hideIcon = false, payload, verticalAlign = \"bottom\", nameKey }, ref) => {\r\n  const { config } = useChart()\r\n\r\n  if (!payload?.length) {\r\n    return null\r\n  }\r\n\r\n  return (\r\n    <div\r\n      ref={ref}\r\n      className={cn(\"flex items-center justify-center gap-4\", verticalAlign === \"top\" ? \"pb-3\" : \"pt-3\", className)}\r\n    >\r\n      {payload.map((item) => {\r\n        const key = `${nameKey || item.dataKey || \"value\"}`\r\n        const itemConfig = getPayloadConfigFromPayload(config, item, key)\r\n\r\n        return (\r\n          <div\r\n            key={item.value}\r\n            className={\"flex items-center gap-1.5 [&>svg]:h-3 [&>svg]:w-3 [&>svg]:text-muted-foreground\"}\r\n          >\r\n            {itemConfig?.icon && !hideIcon ? (\r\n              <itemConfig.icon />\r\n            ) : (\r\n              <div\r\n                className=\"h-2 w-2 shrink-0 rounded-[2px]\"\r\n                style={{\r\n                  backgroundColor: item.color,\r\n                }}\r\n              />\r\n            )}\r\n            {itemConfig?.label}\r\n          </div>\r\n        )\r\n      })}\r\n    </div>\r\n  )\r\n})\r\nChartLegendContent.displayName = \"ChartLegend\"\r\n\r\n// Helper to extract item config from a payload.\r\nfunction getPayloadConfigFromPayload(config: ChartConfig, payload: unknown, key: string) {\r\n  if (typeof payload !== \"object\" || payload === null) {\r\n    return undefined\r\n  }\r\n\r\n  const payloadPayload =\r\n    \"payload\" in payload && typeof payload.payload === \"object\" && payload.payload !== null\r\n      ? payload.payload\r\n      : undefined\r\n\r\n  let configLabelKey: string = key\r\n\r\n  if (key in payload && typeof payload[key as keyof typeof payload] === \"string\") {\r\n    configLabelKey = payload[key as keyof typeof payload] as string\r\n  } else if (\r\n    payloadPayload &&\r\n    key in payloadPayload &&\r\n    typeof payloadPayload[key as keyof typeof payloadPayload] === \"string\"\r\n  ) {\r\n    configLabelKey = payloadPayload[key as keyof typeof payloadPayload] as string\r\n  }\r\n\r\n  return configLabelKey in config ? config[configLabelKey] : config[key as keyof typeof config]\r\n}\r\n\r\nexport { ChartContainer, ChartTooltip, ChartTooltipContent, ChartLegend, ChartLegendContent, ChartStyle }\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Projetos\\Back_endCrm\\kanbanproject1\\components\\ui\\checkbox.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projetos\\Back_endCrm\\kanbanproject1\\components\\ui\\collapsible.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projetos\\Back_endCrm\\kanbanproject1\\components\\ui\\command.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projetos\\Back_endCrm\\kanbanproject1\\components\\ui\\context-menu.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projetos\\Back_endCrm\\kanbanproject1\\components\\ui\\dialog.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projetos\\Back_endCrm\\kanbanproject1\\components\\ui\\drawer.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projetos\\Back_endCrm\\kanbanproject1\\components\\ui\\dropdown-menu.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projetos\\Back_endCrm\\kanbanproject1\\components\\ui\\empty.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projetos\\Back_endCrm\\kanbanproject1\\components\\ui\\field.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projetos\\Back_endCrm\\kanbanproject1\\components\\ui\\form.tsx","messages":[{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":170,"column":3,"nodeType":"Identifier","messageId":"namedExport","endLine":170,"endColumn":15}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\r\n\r\nimport * as React from 'react'\r\nimport * as LabelPrimitive from '@radix-ui/react-label'\r\nimport { Slot } from '@radix-ui/react-slot'\r\nimport {\r\n  Controller,\r\n  ControllerProps,\r\n  FieldPath,\r\n  FieldValues,\r\n  FormProvider,\r\n  useFormContext,\r\n} from 'react-hook-form'\r\n\r\nimport { cn } from '@/lib/utils'\r\nimport { Label } from '@/components/ui/label'\r\n\r\nconst Form = FormProvider\r\n\r\ntype FormFieldContextValue<\r\n  TFieldValues extends FieldValues = FieldValues,\r\n  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>,\r\n> = {\r\n  name: TName\r\n}\r\n\r\nconst FormFieldContext = React.createContext<FormFieldContextValue>(\r\n  {} as FormFieldContextValue,\r\n)\r\n\r\nconst FormField = <\r\n  TFieldValues extends FieldValues = FieldValues,\r\n  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>,\r\n>({\r\n  ...props\r\n}: ControllerProps<TFieldValues, TName>) => {\r\n  return (\r\n    <FormFieldContext.Provider value={{ name: props.name }}>\r\n      <Controller {...props} />\r\n    </FormFieldContext.Provider>\r\n  )\r\n}\r\n\r\nconst useFormField = () => {\r\n  const fieldContext = React.useContext(FormFieldContext)\r\n  const itemContext = React.useContext(FormItemContext)\r\n  const { getFieldState, formState } = useFormContext()\r\n\r\n  const fieldState = getFieldState(fieldContext.name, formState)\r\n\r\n  if (!fieldContext) {\r\n    throw new Error('useFormField should be used within <FormField>')\r\n  }\r\n\r\n  const { id } = itemContext\r\n\r\n  return {\r\n    id,\r\n    name: fieldContext.name,\r\n    formItemId: `${id}-form-item`,\r\n    formDescriptionId: `${id}-form-item-description`,\r\n    formMessageId: `${id}-form-item-message`,\r\n    ...fieldState,\r\n  }\r\n}\r\n\r\ntype FormItemContextValue = {\r\n  id: string\r\n}\r\n\r\nconst FormItemContext = React.createContext<FormItemContextValue>(\r\n  {} as FormItemContextValue,\r\n)\r\n\r\nconst FormItem = React.forwardRef<\r\n  HTMLDivElement,\r\n  React.HTMLAttributes<HTMLDivElement>\r\n>(({ className, ...props }, ref) => {\r\n  const id = React.useId()\r\n\r\n  return (\r\n    <FormItemContext.Provider value={{ id }}>\r\n      <div ref={ref} className={cn('space-y-2', className)} {...props} />\r\n    </FormItemContext.Provider>\r\n  )\r\n})\r\nFormItem.displayName = 'FormItem'\r\n\r\nconst FormLabel = React.forwardRef<\r\n  React.ElementRef<typeof LabelPrimitive.Root>,\r\n  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root>\r\n>(({ className, ...props }, ref) => {\r\n  const { error, formItemId } = useFormField()\r\n\r\n  return (\r\n    <Label\r\n      ref={ref}\r\n      className={cn(error && 'text-destructive', className)}\r\n      htmlFor={formItemId}\r\n      {...props}\r\n    />\r\n  )\r\n})\r\nFormLabel.displayName = 'FormLabel'\r\n\r\nconst FormControl = React.forwardRef<\r\n  React.ElementRef<typeof Slot>,\r\n  React.ComponentPropsWithoutRef<typeof Slot>\r\n>(({ ...props }, ref) => {\r\n  const { error, formItemId, formDescriptionId, formMessageId } = useFormField()\r\n\r\n  return (\r\n    <Slot\r\n      ref={ref}\r\n      id={formItemId}\r\n      aria-describedby={\r\n        !error\r\n          ? `${formDescriptionId}`\r\n          : `${formDescriptionId} ${formMessageId}`\r\n      }\r\n      aria-invalid={!!error}\r\n      {...props}\r\n    />\r\n  )\r\n})\r\nFormControl.displayName = 'FormControl'\r\n\r\nconst FormDescription = React.forwardRef<\r\n  HTMLParagraphElement,\r\n  React.HTMLAttributes<HTMLParagraphElement>\r\n>(({ className, ...props }, ref) => {\r\n  const { formDescriptionId } = useFormField()\r\n\r\n  return (\r\n    <p\r\n      ref={ref}\r\n      id={formDescriptionId}\r\n      className={cn('text-sm text-muted-foreground', className)}\r\n      {...props}\r\n    />\r\n  )\r\n})\r\nFormDescription.displayName = 'FormDescription'\r\n\r\nconst FormMessage = React.forwardRef<\r\n  HTMLParagraphElement,\r\n  React.HTMLAttributes<HTMLParagraphElement>\r\n>(({ className, children, ...props }, ref) => {\r\n  const { error, formMessageId } = useFormField()\r\n  const body = error ? String(error?.message) : children\r\n\r\n  if (!body) {\r\n    return null\r\n  }\r\n\r\n  return (\r\n    <p\r\n      ref={ref}\r\n      id={formMessageId}\r\n      className={cn('text-sm font-medium text-destructive', className)}\r\n      {...props}\r\n    >\r\n      {body}\r\n    </p>\r\n  )\r\n})\r\nFormMessage.displayName = 'FormMessage'\r\n\r\nexport {\r\n  useFormField,\r\n  Form,\r\n  FormItem,\r\n  FormLabel,\r\n  FormControl,\r\n  FormDescription,\r\n  FormMessage,\r\n  FormField,\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Projetos\\Back_endCrm\\kanbanproject1\\components\\ui\\hover-card.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projetos\\Back_endCrm\\kanbanproject1\\components\\ui\\input-group.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projetos\\Back_endCrm\\kanbanproject1\\components\\ui\\input-otp.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projetos\\Back_endCrm\\kanbanproject1\\components\\ui\\input.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projetos\\Back_endCrm\\kanbanproject1\\components\\ui\\item.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projetos\\Back_endCrm\\kanbanproject1\\components\\ui\\kbd.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projetos\\Back_endCrm\\kanbanproject1\\components\\ui\\label.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projetos\\Back_endCrm\\kanbanproject1\\components\\ui\\menubar.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projetos\\Back_endCrm\\kanbanproject1\\components\\ui\\navigation-menu.tsx","messages":[{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":119,"column":3,"nodeType":"Identifier","messageId":"namedExport","endLine":119,"endColumn":29}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import * as React from 'react'\r\nimport * as NavigationMenuPrimitive from '@radix-ui/react-navigation-menu'\r\nimport { cva } from 'class-variance-authority'\r\nimport { ChevronDown } from 'lucide-react'\r\n\r\nimport { cn } from '@/lib/utils'\r\n\r\nconst NavigationMenu = React.forwardRef<\r\n  React.ElementRef<typeof NavigationMenuPrimitive.Root>,\r\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Root>\r\n>(({ className, children, ...props }, ref) => (\r\n  <NavigationMenuPrimitive.Root\r\n    ref={ref}\r\n    className={cn(\r\n      'relative z-10 flex max-w-max flex-1 items-center justify-center',\r\n      className,\r\n    )}\r\n    {...props}\r\n  >\r\n    {children}\r\n    <NavigationMenuViewport />\r\n  </NavigationMenuPrimitive.Root>\r\n))\r\nNavigationMenu.displayName = NavigationMenuPrimitive.Root.displayName\r\n\r\nconst NavigationMenuList = React.forwardRef<\r\n  React.ElementRef<typeof NavigationMenuPrimitive.List>,\r\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.List>\r\n>(({ className, ...props }, ref) => (\r\n  <NavigationMenuPrimitive.List\r\n    ref={ref}\r\n    className={cn(\r\n      'group flex flex-1 list-none items-center justify-center space-x-1',\r\n      className,\r\n    )}\r\n    {...props}\r\n  />\r\n))\r\nNavigationMenuList.displayName = NavigationMenuPrimitive.List.displayName\r\n\r\nconst NavigationMenuItem = NavigationMenuPrimitive.Item\r\n\r\nconst navigationMenuTriggerStyle = cva(\r\n  'group inline-flex h-10 w-max items-center justify-center rounded-md bg-background px-4 py-2 text-sm font-medium transition-colors hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground focus:outline-none disabled:pointer-events-none disabled:opacity-50 data-[active]:bg-accent/50 data-[state=open]:bg-accent/50',\r\n)\r\n\r\nconst NavigationMenuTrigger = React.forwardRef<\r\n  React.ElementRef<typeof NavigationMenuPrimitive.Trigger>,\r\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Trigger>\r\n>(({ className, children, ...props }, ref) => (\r\n  <NavigationMenuPrimitive.Trigger\r\n    ref={ref}\r\n    className={cn(navigationMenuTriggerStyle(), 'group', className)}\r\n    {...props}\r\n  >\r\n    {children}{' '}\r\n    <ChevronDown\r\n      className=\"relative top-[1px] ml-1 h-3 w-3 transition duration-200 group-data-[state=open]:rotate-180\"\r\n      aria-hidden=\"true\"\r\n    />\r\n  </NavigationMenuPrimitive.Trigger>\r\n))\r\nNavigationMenuTrigger.displayName = NavigationMenuPrimitive.Trigger.displayName\r\n\r\nconst NavigationMenuContent = React.forwardRef<\r\n  React.ElementRef<typeof NavigationMenuPrimitive.Content>,\r\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Content>\r\n>(({ className, ...props }, ref) => (\r\n  <NavigationMenuPrimitive.Content\r\n    ref={ref}\r\n    className={cn(\r\n      'left-0 top-0 w-full data-[motion^=from-]:animate-in data-[motion^=to-]:animate-out data-[motion^=from-]:fade-in data-[motion^=to-]:fade-out data-[motion=from-end]:slide-in-from-right-52 data-[motion=from-start]:slide-in-from-left-52 data-[motion=to-end]:slide-out-to-right-52 data-[motion=to-start]:slide-out-to-left-52 md:absolute md:w-auto ',\r\n      className,\r\n    )}\r\n    {...props}\r\n  />\r\n))\r\nNavigationMenuContent.displayName = NavigationMenuPrimitive.Content.displayName\r\n\r\nconst NavigationMenuLink = NavigationMenuPrimitive.Link\r\n\r\nconst NavigationMenuViewport = React.forwardRef<\r\n  React.ElementRef<typeof NavigationMenuPrimitive.Viewport>,\r\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Viewport>\r\n>(({ className, ...props }, ref) => (\r\n  <div className=\"absolute left-0 top-full flex justify-center\">\r\n    <NavigationMenuPrimitive.Viewport\r\n      className={cn(\r\n        'origin-top-center relative mt-1.5 h-[var(--radix-navigation-menu-viewport-height)] w-full overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-90 md:w-[var(--radix-navigation-menu-viewport-width)]',\r\n        className,\r\n      )}\r\n      ref={ref}\r\n      {...props}\r\n    />\r\n  </div>\r\n))\r\nNavigationMenuViewport.displayName =\r\n  NavigationMenuPrimitive.Viewport.displayName\r\n\r\nconst NavigationMenuIndicator = React.forwardRef<\r\n  React.ElementRef<typeof NavigationMenuPrimitive.Indicator>,\r\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Indicator>\r\n>(({ className, ...props }, ref) => (\r\n  <NavigationMenuPrimitive.Indicator\r\n    ref={ref}\r\n    className={cn(\r\n      'top-full z-[1] flex h-1.5 items-end justify-center overflow-hidden data-[state=visible]:animate-in data-[state=hidden]:animate-out data-[state=hidden]:fade-out data-[state=visible]:fade-in',\r\n      className,\r\n    )}\r\n    {...props}\r\n  >\r\n    <div className=\"relative top-[60%] h-2 w-2 rotate-45 rounded-tl-sm bg-border shadow-md\" />\r\n  </NavigationMenuPrimitive.Indicator>\r\n))\r\nNavigationMenuIndicator.displayName =\r\n  NavigationMenuPrimitive.Indicator.displayName\r\n\r\nexport {\r\n  navigationMenuTriggerStyle,\r\n  NavigationMenu,\r\n  NavigationMenuList,\r\n  NavigationMenuItem,\r\n  NavigationMenuContent,\r\n  NavigationMenuTrigger,\r\n  NavigationMenuLink,\r\n  NavigationMenuIndicator,\r\n  NavigationMenuViewport,\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Projetos\\Back_endCrm\\kanbanproject1\\components\\ui\\pagination.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projetos\\Back_endCrm\\kanbanproject1\\components\\ui\\phone-input.tsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'value' is defined but never used.","line":246,"column":14,"nodeType":"Identifier","messageId":"unusedVar","endLine":246,"endColumn":27,"suggestions":[{"messageId":"removeVar","data":{"varName":"value"},"fix":{"range":[21771,21784],"text":""},"desc":"Remove unused variable 'value'."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\"\r\n\r\nimport * as React from \"react\"\r\nimport { Button } from \"@/components/ui/button\"\r\nimport { Input } from \"@/components/ui/input\"\r\nimport { Popover, PopoverContent, PopoverTrigger } from \"@/components/ui/popover\"\r\nimport { ScrollArea } from \"@/components/ui/scroll-area\"\r\nimport { ChevronDown, Search } from \"lucide-react\"\r\nimport { cn } from \"@/lib/utils\"\r\n\r\nconst COUNTRIES = [\r\n  { code: \"BR\", name: \"Brazil (Brasil)\", dialCode: \"+55\", flag: \"🇧🇷\", format: \"(00) 00000-0000\" },\r\n  { code: \"US\", name: \"United States\", dialCode: \"+1\", flag: \"🇺🇸\", format: \"(000) 000-0000\" },\r\n  { code: \"AF\", name: \"Afghanistan (‫افغانستان‬‎)\", dialCode: \"+93\", flag: \"🇦🇫\", format: \"00 000 0000\" },\r\n  { code: \"AL\", name: \"Albania (Shqipëri)\", dialCode: \"+355\", flag: \"🇦🇱\", format: \"00 000 0000\" },\r\n  { code: \"DZ\", name: \"Algeria (‫الجزائر‬‎)\", dialCode: \"+213\", flag: \"🇩🇿\", format: \"00 00 00 00 00\" },\r\n  { code: \"AS\", name: \"American Samoa\", dialCode: \"+1684\", flag: \"🇦🇸\", format: \"(000) 000-0000\" },\r\n  { code: \"AD\", name: \"Andorra\", dialCode: \"+376\", flag: \"🇦🇩\", format: \"000 000\" },\r\n  { code: \"AO\", name: \"Angola\", dialCode: \"+244\", flag: \"🇦🇴\", format: \"000 000 000\" },\r\n  { code: \"AI\", name: \"Anguilla\", dialCode: \"+1264\", flag: \"🇦🇮\", format: \"(000) 000-0000\" },\r\n  { code: \"AG\", name: \"Antigua and Barbuda\", dialCode: \"+1268\", flag: \"🇦🇬\", format: \"(000) 000-0000\" },\r\n  { code: \"AR\", name: \"Argentina\", dialCode: \"+54\", flag: \"🇦🇷\", format: \"00 0000-0000\" },\r\n  { code: \"AM\", name: \"Armenia (Հայաստան)\", dialCode: \"+374\", flag: \"🇦🇲\", format: \"00 000000\" },\r\n  { code: \"AW\", name: \"Aruba\", dialCode: \"+297\", flag: \"🇦🇼\", format: \"000 0000\" },\r\n  { code: \"AU\", name: \"Australia\", dialCode: \"+61\", flag: \"🇦🇺\", format: \"0000 000 000\" },\r\n  { code: \"AT\", name: \"Austria (Österreich)\", dialCode: \"+43\", flag: \"🇦🇹\", format: \"0000 000000\" },\r\n  { code: \"AZ\", name: \"Azerbaijan (Azərbaycan)\", dialCode: \"+994\", flag: \"🇦🇿\", format: \"00 000 00 00\" },\r\n  { code: \"BS\", name: \"Bahamas\", dialCode: \"+1242\", flag: \"🇧🇸\", format: \"(000) 000-0000\" },\r\n  { code: \"BH\", name: \"Bahrain (‫البحرين‬‎)\", dialCode: \"+973\", flag: \"🇧🇭\", format: \"0000 0000\" },\r\n  { code: \"BD\", name: \"Bangladesh (বাংলাদেশ)\", dialCode: \"+880\", flag: \"🇧🇩\", format: \"00000-000000\" },\r\n  { code: \"BB\", name: \"Barbados\", dialCode: \"+1246\", flag: \"🇧🇧\", format: \"(000) 000-0000\" },\r\n  { code: \"BY\", name: \"Belarus (Беларусь)\", dialCode: \"+375\", flag: \"🇧🇾\", format: \"00 000-00-00\" },\r\n  { code: \"BE\", name: \"Belgium (België)\", dialCode: \"+32\", flag: \"🇧🇪\", format: \"0000 00 00 00\" },\r\n  { code: \"BZ\", name: \"Belize\", dialCode: \"+501\", flag: \"🇧🇿\", format: \"000-0000\" },\r\n  { code: \"BJ\", name: \"Benin (Bénin)\", dialCode: \"+229\", flag: \"🇧🇯\", format: \"00 00 00 00\" },\r\n  { code: \"BM\", name: \"Bermuda\", dialCode: \"+1441\", flag: \"🇧🇲\", format: \"(000) 000-0000\" },\r\n  { code: \"BT\", name: \"Bhutan (འབྲུག)\", dialCode: \"+975\", flag: \"🇧🇹\", format: \"00 00 00 00\" },\r\n  { code: \"BO\", name: \"Bolivia\", dialCode: \"+591\", flag: \"🇧🇴\", format: \"0 000 0000\" },\r\n  {\r\n    code: \"BA\",\r\n    name: \"Bosnia and Herzegovina (Босна и Херцеговина)\",\r\n    dialCode: \"+387\",\r\n    flag: \"🇧🇦\",\r\n    format: \"00 000 000\",\r\n  },\r\n  { code: \"BW\", name: \"Botswana\", dialCode: \"+267\", flag: \"🇧🇼\", format: \"00 000 000\" },\r\n  { code: \"BN\", name: \"Brunei\", dialCode: \"+673\", flag: \"🇧🇳\", format: \"000 0000\" },\r\n  { code: \"BG\", name: \"Bulgaria (България)\", dialCode: \"+359\", flag: \"🇧🇬\", format: \"000 000 000\" },\r\n  { code: \"BF\", name: \"Burkina Faso\", dialCode: \"+226\", flag: \"🇧🇫\", format: \"00 00 00 00\" },\r\n  { code: \"BI\", name: \"Burundi (Uburundi)\", dialCode: \"+257\", flag: \"🇧🇮\", format: \"00 00 00 00\" },\r\n  { code: \"KH\", name: \"Cambodia (កម្ពុជា)\", dialCode: \"+855\", flag: \"🇰🇭\", format: \"00 000 000\" },\r\n  { code: \"CM\", name: \"Cameroon (Cameroun)\", dialCode: \"+237\", flag: \"🇨🇲\", format: \"0 00 00 00 00\" },\r\n  { code: \"CA\", name: \"Canada\", dialCode: \"+1\", flag: \"🇨🇦\", format: \"(000) 000-0000\" },\r\n  { code: \"CV\", name: \"Cape Verde (Kabu Verdi)\", dialCode: \"+238\", flag: \"🇨🇻\", format: \"000 00 00\" },\r\n  { code: \"KY\", name: \"Cayman Islands\", dialCode: \"+1345\", flag: \"🇰🇾\", format: \"(000) 000-0000\" },\r\n  { code: \"CF\", name: \"Central African Republic\", dialCode: \"+236\", flag: \"🇨🇫\", format: \"00 00 00 00\" },\r\n  { code: \"TD\", name: \"Chad (Tchad)\", dialCode: \"+235\", flag: \"🇹🇩\", format: \"00 00 00 00\" },\r\n  { code: \"CL\", name: \"Chile\", dialCode: \"+56\", flag: \"🇨🇱\", format: \"0 0000 0000\" },\r\n  { code: \"CN\", name: \"China (中国)\", dialCode: \"+86\", flag: \"🇨🇳\", format: \"000 0000 0000\" },\r\n  { code: \"CO\", name: \"Colombia\", dialCode: \"+57\", flag: \"🇨🇴\", format: \"000 0000000\" },\r\n  { code: \"KM\", name: \"Comoros (‫جزر القمر‬‎)\", dialCode: \"+269\", flag: \"🇰🇲\", format: \"000 00 00\" },\r\n  { code: \"CG\", name: \"Congo (Republic)\", dialCode: \"+242\", flag: \"🇨🇬\", format: \"00 000 0000\" },\r\n  { code: \"CD\", name: \"Congo (DRC)\", dialCode: \"+243\", flag: \"🇨🇩\", format: \"000 000 000\" },\r\n  { code: \"CK\", name: \"Cook Islands\", dialCode: \"+682\", flag: \"🇨🇰\", format: \"00 000\" },\r\n  { code: \"CR\", name: \"Costa Rica\", dialCode: \"+506\", flag: \"🇨🇷\", format: \"0000 0000\" },\r\n  { code: \"CI\", name: \"Côte d'Ivoire\", dialCode: \"+225\", flag: \"🇨🇮\", format: \"00 00 00 00\" },\r\n  { code: \"HR\", name: \"Croatia (Hrvatska)\", dialCode: \"+385\", flag: \"🇭🇷\", format: \"00 000 0000\" },\r\n  { code: \"CU\", name: \"Cuba\", dialCode: \"+53\", flag: \"🇨🇺\", format: \"0 0000000\" },\r\n  { code: \"CW\", name: \"Curaçao\", dialCode: \"+599\", flag: \"🇨🇼\", format: \"0 000 0000\" },\r\n  { code: \"CY\", name: \"Cyprus (Κύπρος)\", dialCode: \"+357\", flag: \"🇨🇾\", format: \"00 000000\" },\r\n  { code: \"CZ\", name: \"Czech Republic (Česká republika)\", dialCode: \"+420\", flag: \"🇨🇿\", format: \"000 000 000\" },\r\n  { code: \"DK\", name: \"Denmark (Danmark)\", dialCode: \"+45\", flag: \"🇩🇰\", format: \"00 00 00 00\" },\r\n  { code: \"DJ\", name: \"Djibouti\", dialCode: \"+253\", flag: \"🇩🇯\", format: \"00 00 00 00\" },\r\n  { code: \"DM\", name: \"Dominica\", dialCode: \"+1767\", flag: \"🇩🇲\", format: \"(000) 000-0000\" },\r\n  { code: \"DO\", name: \"Dominican Republic\", dialCode: \"+1\", flag: \"🇩🇴\", format: \"(000) 000-0000\" },\r\n  { code: \"EC\", name: \"Ecuador\", dialCode: \"+593\", flag: \"🇪🇨\", format: \"00 000 0000\" },\r\n  { code: \"EG\", name: \"Egypt (‫مصر‬‎)\", dialCode: \"+20\", flag: \"🇪🇬\", format: \"000 000 0000\" },\r\n  { code: \"SV\", name: \"El Salvador\", dialCode: \"+503\", flag: \"🇸🇻\", format: \"0000 0000\" },\r\n  { code: \"GQ\", name: \"Equatorial Guinea\", dialCode: \"+240\", flag: \"🇬🇶\", format: \"000 000 000\" },\r\n  { code: \"ER\", name: \"Eritrea\", dialCode: \"+291\", flag: \"🇪🇷\", format: \"0 000 000\" },\r\n  { code: \"EE\", name: \"Estonia (Eesti)\", dialCode: \"+372\", flag: \"🇪🇪\", format: \"0000 0000\" },\r\n  { code: \"ET\", name: \"Ethiopia\", dialCode: \"+251\", flag: \"🇪🇹\", format: \"00 000 0000\" },\r\n  { code: \"FJ\", name: \"Fiji\", dialCode: \"+679\", flag: \"🇫🇯\", format: \"000 0000\" },\r\n  { code: \"FI\", name: \"Finland (Suomi)\", dialCode: \"+358\", flag: \"🇫🇮\", format: \"00 0000000\" },\r\n  { code: \"FR\", name: \"France\", dialCode: \"+33\", flag: \"🇫🇷\", format: \"0 00 00 00 00\" },\r\n  { code: \"GF\", name: \"French Guiana\", dialCode: \"+594\", flag: \"🇬🇫\", format: \"00000 0000\" },\r\n  { code: \"PF\", name: \"French Polynesia\", dialCode: \"+689\", flag: \"🇵🇫\", format: \"00 00 00 00\" },\r\n  { code: \"GA\", name: \"Gabon\", dialCode: \"+241\", flag: \"🇬🇦\", format: \"0 00 00 00\" },\r\n  { code: \"GM\", name: \"Gambia\", dialCode: \"+220\", flag: \"🇬🇲\", format: \"000 0000\" },\r\n  { code: \"GE\", name: \"Georgia (საქართველო)\", dialCode: \"+995\", flag: \"🇬🇪\", format: \"000 00 00 00\" },\r\n  { code: \"DE\", name: \"Germany (Deutschland)\", dialCode: \"+49\", flag: \"🇩🇪\", format: \"0000 0000000\" },\r\n  { code: \"GH\", name: \"Ghana (Gaana)\", dialCode: \"+233\", flag: \"🇬🇭\", format: \"000 000 0000\" },\r\n  { code: \"GI\", name: \"Gibraltar\", dialCode: \"+350\", flag: \"🇬🇮\", format: \"00000000\" },\r\n  { code: \"GR\", name: \"Greece (Ελλάδα)\", dialCode: \"+30\", flag: \"🇬🇷\", format: \"000 000 0000\" },\r\n  { code: \"GL\", name: \"Greenland (Kalaallit Nunaat)\", dialCode: \"+299\", flag: \"🇬🇱\", format: \"00 00 00\" },\r\n  { code: \"GD\", name: \"Grenada\", dialCode: \"+1473\", flag: \"🇬🇩\", format: \"(000) 000-0000\" },\r\n  { code: \"GP\", name: \"Guadeloupe\", dialCode: \"+590\", flag: \"🇬🇵\", format: \"0000 00 00 00\" },\r\n  { code: \"GU\", name: \"Guam\", dialCode: \"+1671\", flag: \"🇬🇺\", format: \"(000) 000-0000\" },\r\n  { code: \"GT\", name: \"Guatemala\", dialCode: \"+502\", flag: \"🇬🇹\", format: \"0000 0000\" },\r\n  { code: \"GN\", name: \"Guinea (Guinée)\", dialCode: \"+224\", flag: \"🇬🇳\", format: \"00 00 00 00\" },\r\n  { code: \"GW\", name: \"Guinea-Bissau (Guiné Bissau)\", dialCode: \"+245\", flag: \"🇬🇼\", format: \"000 000 000\" },\r\n  { code: \"GY\", name: \"Guyana\", dialCode: \"+592\", flag: \"🇬🇾\", format: \"000 0000\" },\r\n  { code: \"HT\", name: \"Haiti\", dialCode: \"+509\", flag: \"🇭🇹\", format: \"00 00 0000\" },\r\n  { code: \"HN\", name: \"Honduras\", dialCode: \"+504\", flag: \"🇭🇳\", format: \"0000-0000\" },\r\n  { code: \"HK\", name: \"Hong Kong (香港)\", dialCode: \"+852\", flag: \"🇭🇰\", format: \"0000 0000\" },\r\n  { code: \"HU\", name: \"Hungary (Magyarország)\", dialCode: \"+36\", flag: \"🇭🇺\", format: \"00 000 0000\" },\r\n  { code: \"IS\", name: \"Iceland (Ísland)\", dialCode: \"+354\", flag: \"🇮🇸\", format: \"000 0000\" },\r\n  { code: \"IN\", name: \"India (भारत)\", dialCode: \"+91\", flag: \"🇮🇳\", format: \"00000 00000\" },\r\n  { code: \"ID\", name: \"Indonesia\", dialCode: \"+62\", flag: \"🇮🇩\", format: \"0000-000-000\" },\r\n  { code: \"IR\", name: \"Iran (‫ایران‬‎)\", dialCode: \"+98\", flag: \"🇮🇷\", format: \"000 000 0000\" },\r\n  { code: \"IQ\", name: \"Iraq (‫العراق‬‎)\", dialCode: \"+964\", flag: \"🇮🇶\", format: \"000 000 0000\" },\r\n  { code: \"IE\", name: \"Ireland\", dialCode: \"+353\", flag: \"🇮🇪\", format: \"00 000 0000\" },\r\n  { code: \"IL\", name: \"Israel (‫ישראל‬‎)\", dialCode: \"+972\", flag: \"🇮🇱\", format: \"00-000-0000\" },\r\n  { code: \"IT\", name: \"Italy (Italia)\", dialCode: \"+39\", flag: \"🇮🇹\", format: \"000 000 0000\" },\r\n  { code: \"JM\", name: \"Jamaica\", dialCode: \"+1876\", flag: \"🇯🇲\", format: \"(000) 000-0000\" },\r\n  { code: \"JP\", name: \"Japan (日本)\", dialCode: \"+81\", flag: \"🇯🇵\", format: \"00-0000-0000\" },\r\n  { code: \"JO\", name: \"Jordan (‫الأردن‬‎)\", dialCode: \"+962\", flag: \"🇯🇴\", format: \"0 0000 0000\" },\r\n  { code: \"KZ\", name: \"Kazakhstan (Казахстан)\", dialCode: \"+7\", flag: \"🇰🇿\", format: \"000 000-00-00\" },\r\n  { code: \"KE\", name: \"Kenya\", dialCode: \"+254\", flag: \"🇰🇪\", format: \"000 000000\" },\r\n  { code: \"KI\", name: \"Kiribati\", dialCode: \"+686\", flag: \"🇰🇮\", format: \"00000\" },\r\n  { code: \"KW\", name: \"Kuwait (‫الكويت‬‎)\", dialCode: \"+965\", flag: \"🇰🇼\", format: \"0000 0000\" },\r\n  { code: \"KG\", name: \"Kyrgyzstan (Кыргызстан)\", dialCode: \"+996\", flag: \"🇰🇬\", format: \"000 000 000\" },\r\n  { code: \"LA\", name: \"Laos (ລາວ)\", dialCode: \"+856\", flag: \"🇱🇦\", format: \"00 00 000 000\" },\r\n  { code: \"LV\", name: \"Latvia (Latvija)\", dialCode: \"+371\", flag: \"🇱🇻\", format: \"00 000 000\" },\r\n  { code: \"LB\", name: \"Lebanon (‫لبنان‬‎)\", dialCode: \"+961\", flag: \"🇱🇧\", format: \"00 000 000\" },\r\n  { code: \"LS\", name: \"Lesotho\", dialCode: \"+266\", flag: \"🇱🇸\", format: \"0000 0000\" },\r\n  { code: \"LR\", name: \"Liberia\", dialCode: \"+231\", flag: \"🇱🇷\", format: \"00 000 0000\" },\r\n  { code: \"LY\", name: \"Libya (‫ليبيا‬‎)\", dialCode: \"+218\", flag: \"🇱🇾\", format: \"00-0000000\" },\r\n  { code: \"LI\", name: \"Liechtenstein\", dialCode: \"+423\", flag: \"🇱🇮\", format: \"000 0000\" },\r\n  { code: \"LT\", name: \"Lithuania (Lietuva)\", dialCode: \"+370\", flag: \"🇱🇹\", format: \"000 00000\" },\r\n  { code: \"LU\", name: \"Luxembourg\", dialCode: \"+352\", flag: \"🇱🇺\", format: \"000 000 000\" },\r\n  { code: \"MO\", name: \"Macau (澳門)\", dialCode: \"+853\", flag: \"🇲🇴\", format: \"0000 0000\" },\r\n  { code: \"MK\", name: \"Macedonia (FYROM) (Македонија)\", dialCode: \"+389\", flag: \"🇲🇰\", format: \"00 000 000\" },\r\n  { code: \"MG\", name: \"Madagascar (Madagasikara)\", dialCode: \"+261\", flag: \"🇲🇬\", format: \"00 00 000 00\" },\r\n  { code: \"MW\", name: \"Malawi\", dialCode: \"+265\", flag: \"🇲🇼\", format: \"0 0000 0000\" },\r\n  { code: \"MY\", name: \"Malaysia\", dialCode: \"+60\", flag: \"🇲🇾\", format: \"00-000 0000\" },\r\n  { code: \"MV\", name: \"Maldives\", dialCode: \"+960\", flag: \"🇲🇻\", format: \"000-0000\" },\r\n  { code: \"ML\", name: \"Mali\", dialCode: \"+223\", flag: \"🇲🇱\", format: \"00 00 00 00\" },\r\n  { code: \"MT\", name: \"Malta\", dialCode: \"+356\", flag: \"🇲🇹\", format: \"0000 0000\" },\r\n  { code: \"MH\", name: \"Marshall Islands\", dialCode: \"+692\", flag: \"🇲🇭\", format: \"000-0000\" },\r\n  { code: \"MQ\", name: \"Martinique\", dialCode: \"+596\", flag: \"🇲🇶\", format: \"0000 00 00 00\" },\r\n  { code: \"MR\", name: \"Mauritania (‫موريتانيا‬‎)\", dialCode: \"+222\", flag: \"🇲🇷\", format: \"00 00 00 00\" },\r\n  { code: \"MU\", name: \"Mauritius (Moris)\", dialCode: \"+230\", flag: \"🇲🇺\", format: \"0000 0000\" },\r\n  { code: \"MX\", name: \"Mexico (México)\", dialCode: \"+52\", flag: \"🇲🇽\", format: \"00 0000 0000\" },\r\n  { code: \"FM\", name: \"Micronesia\", dialCode: \"+691\", flag: \"🇫🇲\", format: \"000 0000\" },\r\n  { code: \"MD\", name: \"Moldova (Republica Moldova)\", dialCode: \"+373\", flag: \"🇲🇩\", format: \"0000 0000\" },\r\n  { code: \"MC\", name: \"Monaco\", dialCode: \"+377\", flag: \"🇲🇨\", format: \"00 00 00 00\" },\r\n  { code: \"MN\", name: \"Mongolia (Монгол)\", dialCode: \"+976\", flag: \"🇲🇳\", format: \"00 00 0000\" },\r\n  { code: \"ME\", name: \"Montenegro (Crna Gora)\", dialCode: \"+382\", flag: \"🇲🇪\", format: \"00 000 000\" },\r\n  { code: \"MS\", name: \"Montserrat\", dialCode: \"+1664\", flag: \"🇲🇸\", format: \"(000) 000-0000\" },\r\n  { code: \"MA\", name: \"Morocco (‫المغرب‬‎)\", dialCode: \"+212\", flag: \"🇲🇦\", format: \"00-0000000\" },\r\n  { code: \"MZ\", name: \"Mozambique (Moçambique)\", dialCode: \"+258\", flag: \"🇲🇿\", format: \"00 000 0000\" },\r\n  { code: \"MM\", name: \"Myanmar (Burma) (မြန်မာ)\", dialCode: \"+95\", flag: \"🇲🇲\", format: \"00 000 0000\" },\r\n  { code: \"NA\", name: \"Namibia (Namibië)\", dialCode: \"+264\", flag: \"🇳🇦\", format: \"00 000 0000\" },\r\n  { code: \"NR\", name: \"Nauru\", dialCode: \"+674\", flag: \"🇳🇷\", format: \"000 0000\" },\r\n  { code: \"NP\", name: \"Nepal (नेपाल)\", dialCode: \"+977\", flag: \"🇳🇵\", format: \"00-000-0000\" },\r\n  { code: \"NL\", name: \"Netherlands (Nederland)\", dialCode: \"+31\", flag: \"🇳🇱\", format: \"00 00000000\" },\r\n  { code: \"NC\", name: \"New Caledonia\", dialCode: \"+687\", flag: \"🇳🇨\", format: \"00.00.00\" },\r\n  { code: \"NZ\", name: \"New Zealand\", dialCode: \"+64\", flag: \"🇳🇿\", format: \"00 000 0000\" },\r\n  { code: \"NI\", name: \"Nicaragua\", dialCode: \"+505\", flag: \"🇳🇮\", format: \"0000 0000\" },\r\n  { code: \"NE\", name: \"Niger (Nijar)\", dialCode: \"+227\", flag: \"🇳🇪\", format: \"00 00 00 00\" },\r\n  { code: \"NG\", name: \"Nigeria\", dialCode: \"+234\", flag: \"🇳🇬\", format: \"000 000 0000\" },\r\n  { code: \"NU\", name: \"Niue\", dialCode: \"+683\", flag: \"🇳🇺\", format: \"0000\" },\r\n  { code: \"NF\", name: \"Norfolk Island\", dialCode: \"+672\", flag: \"🇳🇫\", format: \"000 000\" },\r\n  { code: \"KP\", name: \"North Korea (조선 민주주의 인민 공화국)\", dialCode: \"+850\", flag: \"🇰🇵\", format: \"000 000 0000\" },\r\n  { code: \"MP\", name: \"Northern Mariana Islands\", dialCode: \"+1670\", flag: \"🇲🇵\", format: \"(000) 000-0000\" },\r\n  { code: \"NO\", name: \"Norway (Norge)\", dialCode: \"+47\", flag: \"🇳🇴\", format: \"000 00 000\" },\r\n  { code: \"OM\", name: \"Oman (‫عُمان‬‎)\", dialCode: \"+968\", flag: \"🇴🇲\", format: \"0000 0000\" },\r\n  { code: \"PK\", name: \"Pakistan (‫پاکستان‬‎)\", dialCode: \"+92\", flag: \"🇵🇰\", format: \"000 0000000\" },\r\n  { code: \"PW\", name: \"Palau\", dialCode: \"+680\", flag: \"🇵🇼\", format: \"000 0000\" },\r\n  { code: \"PS\", name: \"Palestine (‫فلسطين‬‎)\", dialCode: \"+970\", flag: \"🇵🇸\", format: \"00 000 0000\" },\r\n  { code: \"PA\", name: \"Panama (Panamá)\", dialCode: \"+507\", flag: \"🇵🇦\", format: \"0000-0000\" },\r\n  { code: \"PG\", name: \"Papua New Guinea\", dialCode: \"+675\", flag: \"🇵🇬\", format: \"000 0000\" },\r\n  { code: \"PY\", name: \"Paraguay\", dialCode: \"+595\", flag: \"🇵🇾\", format: \"000 000000\" },\r\n  { code: \"PE\", name: \"Peru (Perú)\", dialCode: \"+51\", flag: \"🇵🇪\", format: \"000 000 000\" },\r\n  { code: \"PH\", name: \"Philippines\", dialCode: \"+63\", flag: \"🇵🇭\", format: \"0000 000 0000\" },\r\n  { code: \"PL\", name: \"Poland (Polska)\", dialCode: \"+48\", flag: \"🇵🇱\", format: \"000 000 000\" },\r\n  { code: \"PT\", name: \"Portugal\", dialCode: \"+351\", flag: \"🇵🇹\", format: \"00 000 0000\" },\r\n  { code: \"PR\", name: \"Puerto Rico\", dialCode: \"+1\", flag: \"🇵🇷\", format: \"(000) 000-0000\" },\r\n  { code: \"QA\", name: \"Qatar (‫قطر‬‎)\", dialCode: \"+974\", flag: \"🇶🇦\", format: \"0000 0000\" },\r\n  { code: \"RE\", name: \"Réunion (La Réunion)\", dialCode: \"+262\", flag: \"🇷🇪\", format: \"0000 00 00 00\" },\r\n  { code: \"RO\", name: \"Romania (România)\", dialCode: \"+40\", flag: \"🇷🇴\", format: \"000 000 000\" },\r\n  { code: \"RU\", name: \"Russia (Россия)\", dialCode: \"+7\", flag: \"🇷🇺\", format: \"000 000-00-00\" },\r\n  { code: \"RW\", name: \"Rwanda\", dialCode: \"+250\", flag: \"🇷🇼\", format: \"000 000 000\" },\r\n  { code: \"WS\", name: \"Samoa\", dialCode: \"+685\", flag: \"🇼🇸\", format: \"00 0000\" },\r\n  { code: \"SM\", name: \"San Marino\", dialCode: \"+378\", flag: \"🇸🇲\", format: \"0000 000000\" },\r\n  { code: \"ST\", name: \"São Tomé and Príncipe\", dialCode: \"+239\", flag: \"🇸🇹\", format: \"000 0000\" },\r\n  { code: \"SA\", name: \"Saudi Arabia (‫المملكة العربية السعودية‬‎)\", dialCode: \"+966\", flag: \"🇸🇦\", format: \"00 000 0000\" },\r\n  { code: \"SN\", name: \"Senegal (Sénégal)\", dialCode: \"+221\", flag: \"🇸🇳\", format: \"00 000 00 00\" },\r\n  { code: \"RS\", name: \"Serbia (Србија)\", dialCode: \"+381\", flag: \"🇷🇸\", format: \"00 0000000\" },\r\n  { code: \"SC\", name: \"Seychelles\", dialCode: \"+248\", flag: \"🇸🇨\", format: \"0 000 000\" },\r\n  { code: \"SL\", name: \"Sierra Leone\", dialCode: \"+232\", flag: \"🇸🇱\", format: \"00 000000\" },\r\n  { code: \"SG\", name: \"Singapore\", dialCode: \"+65\", flag: \"🇸🇬\", format: \"0000 0000\" },\r\n  { code: \"SK\", name: \"Slovakia (Slovensko)\", dialCode: \"+421\", flag: \"🇸🇰\", format: \"000 000 000\" },\r\n  { code: \"SI\", name: \"Slovenia (Slovenija)\", dialCode: \"+386\", flag: \"🇸🇮\", format: \"00 000 000\" },\r\n  { code: \"SB\", name: \"Solomon Islands\", dialCode: \"+677\", flag: \"🇸🇧\", format: \"00000\" },\r\n  { code: \"SO\", name: \"Somalia (Soomaaliya)\", dialCode: \"+252\", flag: \"🇸🇴\", format: \"0 000 000\" },\r\n  { code: \"ZA\", name: \"South Africa\", dialCode: \"+27\", flag: \"🇿🇦\", format: \"00 000 0000\" },\r\n  { code: \"KR\", name: \"South Korea (대한민국)\", dialCode: \"+82\", flag: \"🇰🇷\", format: \"00-0000-0000\" },\r\n  { code: \"SS\", name: \"South Sudan (‫جنوب السودان‬‎)\", dialCode: \"+211\", flag: \"🇸🇸\", format: \"00 000 0000\" },\r\n  { code: \"ES\", name: \"Spain (España)\", dialCode: \"+34\", flag: \"🇪🇸\", format: \"000 00 00 00\" },\r\n  { code: \"LK\", name: \"Sri Lanka (ශ්‍රී ලංකාව)\", dialCode: \"+94\", flag: \"🇱🇰\", format: \"00 000 0000\" },\r\n  { code: \"SD\", name: \"Sudan (‫السودان‬‎)\", dialCode: \"+249\", flag: \"🇸🇩\", format: \"00 000 0000\" },\r\n  { code: \"SR\", name: \"Suriname\", dialCode: \"+597\", flag: \"🇸🇷\", format: \"000-0000\" },\r\n  { code: \"SZ\", name: \"Swaziland\", dialCode: \"+268\", flag: \"🇸🇿\", format: \"0000 0000\" },\r\n  { code: \"SE\", name: \"Sweden (Sverige)\", dialCode: \"+46\", flag: \"🇸🇪\", format: \"00-000 00 00\" },\r\n  { code: \"CH\", name: \"Switzerland (Schweiz)\", dialCode: \"+41\", flag: \"🇨🇭\", format: \"00 000 00 00\" },\r\n  { code: \"SY\", name: \"Syria (‫سوريا‬‎)\", dialCode: \"+963\", flag: \"🇸🇾\", format: \"00 0000 000\" },\r\n  { code: \"TW\", name: \"Taiwan (台灣)\", dialCode: \"+886\", flag: \"🇹🇼\", format: \"0000 000 000\" },\r\n  { code: \"TJ\", name: \"Tajikistan\", dialCode: \"+992\", flag: \"🇹🇯\", format: \"00 000 0000\" },\r\n  { code: \"TZ\", name: \"Tanzania\", dialCode: \"+255\", flag: \"🇹🇿\", format: \"00 000 0000\" },\r\n  { code: \"TH\", name: \"Thailand (ไทย)\", dialCode: \"+66\", flag: \"🇹🇭\", format: \"00 000 0000\" },\r\n  { code: \"TL\", name: \"Timor-Leste\", dialCode: \"+670\", flag: \"🇹🇱\", format: \"000 0000\" },\r\n  { code: \"TG\", name: \"Togo\", dialCode: \"+228\", flag: \"🇹🇬\", format: \"00 00 00 00\" },\r\n  { code: \"TK\", name: \"Tokelau\", dialCode: \"+690\", flag: \"🇹🇰\", format: \"0000\" },\r\n  { code: \"TO\", name: \"Tonga\", dialCode: \"+676\", flag: \"🇹🇴\", format: \"00000\" },\r\n  { code: \"TT\", name: \"Trinidad and Tobago\", dialCode: \"+1868\", flag: \"🇹🇹\", format: \"(000) 000-0000\" },\r\n  { code: \"TN\", name: \"Tunisia (‫تونس‬‎)\", dialCode: \"+216\", flag: \"🇹🇳\", format: \"00 000 000\" },\r\n  { code: \"TR\", name: \"Turkey (Türkiye)\", dialCode: \"+90\", flag: \"🇹🇷\", format: \"000 000 0000\" },\r\n  { code: \"TM\", name: \"Turkmenistan\", dialCode: \"+993\", flag: \"🇹🇲\", format: \"0 000 0000\" },\r\n  { code: \"TC\", name: \"Turks and Caicos Islands\", dialCode: \"+1649\", flag: \"🇹🇨\", format: \"(000) 000-0000\" },\r\n  { code: \"TV\", name: \"Tuvalu\", dialCode: \"+688\", flag: \"🇹🇻\", format: \"00000\" },\r\n  { code: \"UG\", name: \"Uganda\", dialCode: \"+256\", flag: \"🇺🇬\", format: \"000 000000\" },\r\n  { code: \"UA\", name: \"Ukraine (Україна)\", dialCode: \"+380\", flag: \"🇺🇦\", format: \"00 000 00 00\" },\r\n  {\r\n    code: \"AE\",\r\n    name: \"United Arab Emirates (‫الإمارات العربية المتحدة‬‎)\",\r\n    dialCode: \"+971\",\r\n    flag: \"🇦🇪\",\r\n    format: \"00 000 0000\",\r\n  },\r\n  { code: \"GB\", name: \"United Kingdom\", dialCode: \"+44\", flag: \"🇬🇧\", format: \"0000 000000\" },\r\n  { code: \"UY\", name: \"Uruguay\", dialCode: \"+598\", flag: \"🇺🇾\", format: \"0 000 00 00\" },\r\n  { code: \"UZ\", name: \"Uzbekistan (Oʻzbekiston)\", dialCode: \"+998\", flag: \"🇺🇿\", format: \"00 000 00 00\" },\r\n  { code: \"VU\", name: \"Vanuatu\", dialCode: \"+678\", flag: \"🇻🇺\", format: \"00000\" },\r\n  { code: \"VA\", name: \"Vatican City (Città del Vaticano)\", dialCode: \"+39\", flag: \"🇻🇦\", format: \"0 0000 0000\" },\r\n  { code: \"VE\", name: \"Venezuela\", dialCode: \"+58\", flag: \"🇻🇪\", format: \"000-0000000\" },\r\n  { code: \"VN\", name: \"Vietnam (Việt Nam)\", dialCode: \"+84\", flag: \"🇻🇳\", format: \"00 0000 0000\" },\r\n  { code: \"YE\", name: \"Yemen (‫اليمن‬‎)\", dialCode: \"+967\", flag: \"🇾🇪\", format: \"000 000 000\" },\r\n  { code: \"ZM\", name: \"Zambia\", dialCode: \"+260\", flag: \"🇿🇲\", format: \"00 000 0000\" },\r\n  { code: \"ZW\", name: \"Zimbabwe\", dialCode: \"+263\", flag: \"🇿🇼\", format: \"0 000 000\" },\r\n]\r\n\r\ninterface PhoneInputProps {\r\n  value: string\r\n  onChange: (value: string) => void\r\n  placeholder?: string\r\n  defaultCountry?: string\r\n  className?: string\r\n  disabled?: boolean\r\n}\r\n\r\nexport function PhoneInputComponent({\r\n  value,\r\n  onChange,\r\n  placeholder = \"Telefone\",\r\n  defaultCountry = \"br\",\r\n  className,\r\n  disabled = false,\r\n}: PhoneInputProps) {\r\n  const [open, setOpen] = React.useState(false)\r\n  const [search, setSearch] = React.useState(\"\")\r\n  const [selectedCountry, setSelectedCountry] = React.useState(\r\n    COUNTRIES.find((c) => c.code.toLowerCase() === defaultCountry.toLowerCase()) || COUNTRIES[0],\r\n  )\r\n\r\n  const filteredCountries = COUNTRIES.filter(\r\n    (country) =>\r\n      country.name.toLowerCase().includes(search.toLowerCase()) ||\r\n      country.dialCode.includes(search) ||\r\n      country.code.toLowerCase().includes(search.toLowerCase()),\r\n  )\r\n\r\n  const handleCountrySelect = (country: (typeof COUNTRIES)[0]) => {\r\n    setSelectedCountry(country)\r\n    setOpen(false)\r\n    // Update the value with the new country code\r\n    const phoneNumber = value.replace(/^\\+\\d+\\s*/, \"\")\r\n    onChange(`${country.dialCode} ${phoneNumber}`)\r\n  }\r\n\r\n  const handlePhoneChange = (e: React.ChangeEvent<HTMLInputElement>) => {\r\n    const input = e.target.value\r\n    // Remove the country code if it exists\r\n    const phoneNumber = input.replace(/^\\+\\d+\\s*/, \"\")\r\n    onChange(`${selectedCountry.dialCode} ${phoneNumber}`)\r\n  }\r\n\r\n  // Extract phone number without country code for display\r\n  const displayValue = value.replace(/^\\+\\d+\\s*/, \"\")\r\n\r\n  return (\r\n    <div className={cn(\"flex gap-2\", className)}>\r\n      <Popover open={open} onOpenChange={setOpen}>\r\n        <PopoverTrigger asChild>\r\n          <Button\r\n            variant=\"outline\"\r\n            role=\"combobox\"\r\n            aria-expanded={open}\r\n            className=\"w-[140px] justify-between bg-transparent\"\r\n            disabled={disabled}\r\n          >\r\n            <span className=\"flex items-center gap-2\">\r\n              <span className=\"text-lg\">{selectedCountry.flag}</span>\r\n              <span className=\"text-sm\">{selectedCountry.dialCode}</span>\r\n            </span>\r\n            <ChevronDown className=\"ml-2 h-4 w-4 shrink-0 opacity-50\" />\r\n          </Button>\r\n        </PopoverTrigger>\r\n        <PopoverContent className=\"w-[300px] p-0\" align=\"start\">\r\n          <div className=\"flex items-center border-b px-3\">\r\n            <Search className=\"mr-2 h-4 w-4 shrink-0 opacity-50\" />\r\n            <Input\r\n              placeholder=\"Buscar país...\"\r\n              value={search}\r\n              onChange={(e) => setSearch(e.target.value)}\r\n              className=\"border-0 focus-visible:ring-0 focus-visible:ring-offset-0\"\r\n            />\r\n          </div>\r\n          <ScrollArea className=\"h-[300px]\">\r\n            <div className=\"p-1\">\r\n              {filteredCountries.length === 0 ? (\r\n                <div className=\"py-6 text-center text-sm text-muted-foreground\">País não encontrado</div>\r\n              ) : (\r\n                filteredCountries.map((country) => (\r\n                  <Button\r\n                    key={country.code}\r\n                    variant=\"ghost\"\r\n                    className=\"w-full justify-start font-normal\"\r\n                    onClick={() => handleCountrySelect(country)}\r\n                  >\r\n                    <span className=\"mr-2 text-lg\">{country.flag}</span>\r\n                    <span className=\"flex-1 text-left\">{country.name}</span>\r\n                    <span className=\"text-muted-foreground\">{country.dialCode}</span>\r\n                  </Button>\r\n                ))\r\n              )}\r\n            </div>\r\n          </ScrollArea>\r\n        </PopoverContent>\r\n      </Popover>\r\n      <Input\r\n        type=\"tel\"\r\n        placeholder={placeholder}\r\n        value={displayValue}\r\n        onChange={handlePhoneChange}\r\n        disabled={disabled}\r\n        className=\"flex-1\"\r\n      />\r\n    </div>\r\n  )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Projetos\\Back_endCrm\\kanbanproject1\\components\\ui\\popover.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projetos\\Back_endCrm\\kanbanproject1\\components\\ui\\progress.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projetos\\Back_endCrm\\kanbanproject1\\components\\ui\\radio-group.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projetos\\Back_endCrm\\kanbanproject1\\components\\ui\\resizable.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projetos\\Back_endCrm\\kanbanproject1\\components\\ui\\scroll-area.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projetos\\Back_endCrm\\kanbanproject1\\components\\ui\\select.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projetos\\Back_endCrm\\kanbanproject1\\components\\ui\\separator.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projetos\\Back_endCrm\\kanbanproject1\\components\\ui\\sheet.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projetos\\Back_endCrm\\kanbanproject1\\components\\ui\\sidebar.tsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'open' is defined but never used.","line":32,"column":13,"nodeType":"Identifier","messageId":"unusedVar","endLine":32,"endColumn":26,"suggestions":[{"messageId":"removeVar","data":{"varName":"open"},"fix":{"range":[992,1005],"text":""},"desc":"Remove unused variable 'open'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'open' is defined but never used.","line":34,"column":19,"nodeType":"Identifier","messageId":"unusedVar","endLine":34,"endColumn":32,"suggestions":[{"messageId":"removeVar","data":{"varName":"open"},"fix":{"range":[1057,1070],"text":""},"desc":"Remove unused variable 'open'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'open' is defined but never used.","line":55,"column":21,"nodeType":"Identifier","messageId":"unusedVar","endLine":55,"endColumn":34,"suggestions":[{"messageId":"removeVar","data":{"varName":"open"},"fix":{"range":[1575,1588],"text":""},"desc":"Remove unused variable 'open'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'value' is defined but never used.","line":78,"column":27,"nodeType":"Identifier","messageId":"unusedVar","endLine":78,"endColumn":41,"suggestions":[{"messageId":"removeVar","data":{"varName":"value"},"fix":{"range":[2190,2204],"text":""},"desc":"Remove unused variable 'value'."}]},{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":770,"column":3,"nodeType":"Identifier","messageId":"namedExport","endLine":770,"endColumn":13}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\r\n\r\nimport * as React from 'react'\r\nimport { Slot } from '@radix-ui/react-slot'\r\nimport { VariantProps, cva } from 'class-variance-authority'\r\nimport { PanelLeft } from 'lucide-react'\r\n\r\nimport { useIsMobile } from '@/hooks/use-mobile'\r\nimport { cn } from '@/lib/utils'\r\nimport { Button } from '@/components/ui/button'\r\nimport { Input } from '@/components/ui/input'\r\nimport { Separator } from '@/components/ui/separator'\r\nimport { Sheet, SheetContent } from '@/components/ui/sheet'\r\nimport { Skeleton } from '@/components/ui/skeleton'\r\nimport {\r\n  Tooltip,\r\n  TooltipContent,\r\n  TooltipProvider,\r\n  TooltipTrigger,\r\n} from '@/components/ui/tooltip'\r\n\r\nconst SIDEBAR_COOKIE_NAME = 'sidebar:state'\r\nconst SIDEBAR_COOKIE_MAX_AGE = 60 * 60 * 24 * 7\r\nconst SIDEBAR_WIDTH = '16rem'\r\nconst SIDEBAR_WIDTH_MOBILE = '18rem'\r\nconst SIDEBAR_WIDTH_ICON = '3rem'\r\nconst SIDEBAR_KEYBOARD_SHORTCUT = 'b'\r\n\r\ntype SidebarContext = {\r\n  state: 'expanded' | 'collapsed'\r\n  open: boolean\r\n  setOpen: (open: boolean) => void\r\n  openMobile: boolean\r\n  setOpenMobile: (open: boolean) => void\r\n  isMobile: boolean\r\n  toggleSidebar: () => void\r\n}\r\n\r\nconst SidebarContext = React.createContext<SidebarContext | null>(null)\r\n\r\nfunction useSidebar() {\r\n  const context = React.useContext(SidebarContext)\r\n  if (!context) {\r\n    throw new Error('useSidebar must be used within a SidebarProvider.')\r\n  }\r\n\r\n  return context\r\n}\r\n\r\nconst SidebarProvider = React.forwardRef<\r\n  HTMLDivElement,\r\n  React.ComponentProps<'div'> & {\r\n    defaultOpen?: boolean\r\n    open?: boolean\r\n    onOpenChange?: (open: boolean) => void\r\n  }\r\n>(\r\n  (\r\n    {\r\n      defaultOpen = true,\r\n      open: openProp,\r\n      onOpenChange: setOpenProp,\r\n      className,\r\n      style,\r\n      children,\r\n      ...props\r\n    },\r\n    ref,\r\n  ) => {\r\n    const isMobile = useIsMobile()\r\n    const [openMobile, setOpenMobile] = React.useState(false)\r\n\r\n    // This is the internal state of the sidebar.\r\n    // We use openProp and setOpenProp for control from outside the component.\r\n    const [_open, _setOpen] = React.useState(defaultOpen)\r\n    const open = openProp ?? _open\r\n    const setOpen = React.useCallback(\r\n      (value: boolean | ((value: boolean) => boolean)) => {\r\n        const openState = typeof value === 'function' ? value(open) : value\r\n        if (setOpenProp) {\r\n          setOpenProp(openState)\r\n        } else {\r\n          _setOpen(openState)\r\n        }\r\n\r\n        // This sets the cookie to keep the sidebar state.\r\n        document.cookie = `${SIDEBAR_COOKIE_NAME}=${openState}; path=/; max-age=${SIDEBAR_COOKIE_MAX_AGE}`\r\n      },\r\n      [setOpenProp, open],\r\n    )\r\n\r\n    // Helper to toggle the sidebar.\r\n    const toggleSidebar = React.useCallback(() => {\r\n      return isMobile\r\n        ? setOpenMobile((open) => !open)\r\n        : setOpen((open) => !open)\r\n    }, [isMobile, setOpen, setOpenMobile])\r\n\r\n    // Adds a keyboard shortcut to toggle the sidebar.\r\n    React.useEffect(() => {\r\n      const handleKeyDown = (event: KeyboardEvent) => {\r\n        if (\r\n          event.key === SIDEBAR_KEYBOARD_SHORTCUT &&\r\n          (event.metaKey || event.ctrlKey)\r\n        ) {\r\n          event.preventDefault()\r\n          toggleSidebar()\r\n        }\r\n      }\r\n\r\n      window.addEventListener('keydown', handleKeyDown)\r\n      return () => window.removeEventListener('keydown', handleKeyDown)\r\n    }, [toggleSidebar])\r\n\r\n    // We add a state so that we can do data-state=\"expanded\" or \"collapsed\".\r\n    // This makes it easier to style the sidebar with Tailwind classes.\r\n    const state = open ? 'expanded' : 'collapsed'\r\n\r\n    const contextValue = React.useMemo<SidebarContext>(\r\n      () => ({\r\n        state,\r\n        open,\r\n        setOpen,\r\n        isMobile,\r\n        openMobile,\r\n        setOpenMobile,\r\n        toggleSidebar,\r\n      }),\r\n      [\r\n        state,\r\n        open,\r\n        setOpen,\r\n        isMobile,\r\n        openMobile,\r\n        setOpenMobile,\r\n        toggleSidebar,\r\n      ],\r\n    )\r\n\r\n    return (\r\n      <SidebarContext.Provider value={contextValue}>\r\n        <TooltipProvider delayDuration={0}>\r\n          <div\r\n            style={\r\n              {\r\n                '--sidebar-width': SIDEBAR_WIDTH,\r\n                '--sidebar-width-icon': SIDEBAR_WIDTH_ICON,\r\n                ...style,\r\n              } as React.CSSProperties\r\n            }\r\n            className={cn(\r\n              'group/sidebar-wrapper flex min-h-svh w-full has-[[data-variant=inset]]:bg-sidebar',\r\n              className,\r\n            )}\r\n            ref={ref}\r\n            {...props}\r\n          >\r\n            {children}\r\n          </div>\r\n        </TooltipProvider>\r\n      </SidebarContext.Provider>\r\n    )\r\n  },\r\n)\r\nSidebarProvider.displayName = 'SidebarProvider'\r\n\r\nconst Sidebar = React.forwardRef<\r\n  HTMLDivElement,\r\n  React.ComponentProps<'div'> & {\r\n    side?: 'left' | 'right'\r\n    variant?: 'sidebar' | 'floating' | 'inset'\r\n    collapsible?: 'offcanvas' | 'icon' | 'none'\r\n  }\r\n>(\r\n  (\r\n    {\r\n      side = 'left',\r\n      variant = 'sidebar',\r\n      collapsible = 'offcanvas',\r\n      className,\r\n      children,\r\n      ...props\r\n    },\r\n    ref,\r\n  ) => {\r\n    const { isMobile, state, openMobile, setOpenMobile } = useSidebar()\r\n\r\n    if (collapsible === 'none') {\r\n      return (\r\n        <div\r\n          className={cn(\r\n            'flex h-full w-[--sidebar-width] flex-col bg-sidebar text-sidebar-foreground',\r\n            className,\r\n          )}\r\n          ref={ref}\r\n          {...props}\r\n        >\r\n          {children}\r\n        </div>\r\n      )\r\n    }\r\n\r\n    if (isMobile) {\r\n      return (\r\n        <Sheet open={openMobile} onOpenChange={setOpenMobile} {...props}>\r\n          <SheetContent\r\n            data-sidebar=\"sidebar\"\r\n            data-mobile=\"true\"\r\n            className=\"w-[--sidebar-width] bg-sidebar p-0 text-sidebar-foreground [&>button]:hidden\"\r\n            style={\r\n              {\r\n                '--sidebar-width': SIDEBAR_WIDTH_MOBILE,\r\n              } as React.CSSProperties\r\n            }\r\n            side={side}\r\n          >\r\n            <div className=\"flex h-full w-full flex-col\">{children}</div>\r\n          </SheetContent>\r\n        </Sheet>\r\n      )\r\n    }\r\n\r\n    return (\r\n      <div\r\n        ref={ref}\r\n        className=\"group peer hidden md:block text-sidebar-foreground\"\r\n        data-state={state}\r\n        data-collapsible={state === 'collapsed' ? collapsible : ''}\r\n        data-variant={variant}\r\n        data-side={side}\r\n      >\r\n        {/* This is what handles the sidebar gap on desktop */}\r\n        <div\r\n          className={cn(\r\n            'duration-200 relative h-svh w-[--sidebar-width] bg-transparent transition-[width] ease-linear',\r\n            'group-data-[collapsible=offcanvas]:w-0',\r\n            'group-data-[side=right]:rotate-180',\r\n            variant === 'floating' || variant === 'inset'\r\n              ? 'group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)_+_theme(spacing.4))]'\r\n              : 'group-data-[collapsible=icon]:w-[--sidebar-width-icon]',\r\n          )}\r\n        />\r\n        <div\r\n          className={cn(\r\n            'duration-200 fixed inset-y-0 z-10 hidden h-svh w-[--sidebar-width] transition-[left,right,width] ease-linear md:flex',\r\n            side === 'left'\r\n              ? 'left-0 group-data-[collapsible=offcanvas]:left-[calc(var(--sidebar-width)*-1)]'\r\n              : 'right-0 group-data-[collapsible=offcanvas]:right-[calc(var(--sidebar-width)*-1)]',\r\n            // Adjust the padding for floating and inset variants.\r\n            variant === 'floating' || variant === 'inset'\r\n              ? 'p-2 group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)_+_theme(spacing.4)_+2px)]'\r\n              : 'group-data-[collapsible=icon]:w-[--sidebar-width-icon] group-data-[side=left]:border-r group-data-[side=right]:border-l',\r\n            className,\r\n          )}\r\n          {...props}\r\n        >\r\n          <div\r\n            data-sidebar=\"sidebar\"\r\n            className=\"flex h-full w-full flex-col bg-sidebar group-data-[variant=floating]:rounded-lg group-data-[variant=floating]:border group-data-[variant=floating]:border-sidebar-border group-data-[variant=floating]:shadow\"\r\n          >\r\n            {children}\r\n          </div>\r\n        </div>\r\n      </div>\r\n    )\r\n  },\r\n)\r\nSidebar.displayName = 'Sidebar'\r\n\r\nconst SidebarTrigger = React.forwardRef<\r\n  React.ElementRef<typeof Button>,\r\n  React.ComponentProps<typeof Button>\r\n>(({ className, onClick, ...props }, ref) => {\r\n  const { toggleSidebar } = useSidebar()\r\n\r\n  return (\r\n    <Button\r\n      ref={ref}\r\n      data-sidebar=\"trigger\"\r\n      variant=\"ghost\"\r\n      size=\"icon\"\r\n      className={cn('h-7 w-7', className)}\r\n      onClick={(event) => {\r\n        onClick?.(event)\r\n        toggleSidebar()\r\n      }}\r\n      {...props}\r\n    >\r\n      <PanelLeft />\r\n      <span className=\"sr-only\">Toggle Sidebar</span>\r\n    </Button>\r\n  )\r\n})\r\nSidebarTrigger.displayName = 'SidebarTrigger'\r\n\r\nconst SidebarRail = React.forwardRef<\r\n  HTMLButtonElement,\r\n  React.ComponentProps<'button'>\r\n>(({ className, ...props }, ref) => {\r\n  const { toggleSidebar } = useSidebar()\r\n\r\n  return (\r\n    <button\r\n      ref={ref}\r\n      data-sidebar=\"rail\"\r\n      aria-label=\"Toggle Sidebar\"\r\n      tabIndex={-1}\r\n      onClick={toggleSidebar}\r\n      title=\"Toggle Sidebar\"\r\n      className={cn(\r\n        'absolute inset-y-0 z-20 hidden w-4 -translate-x-1/2 transition-all ease-linear after:absolute after:inset-y-0 after:left-1/2 after:w-[2px] hover:after:bg-sidebar-border group-data-[side=left]:-right-4 group-data-[side=right]:left-0 sm:flex',\r\n        '[[data-side=left]_&]:cursor-w-resize [[data-side=right]_&]:cursor-e-resize',\r\n        '[[data-side=left][data-state=collapsed]_&]:cursor-e-resize [[data-side=right][data-state=collapsed]_&]:cursor-w-resize',\r\n        'group-data-[collapsible=offcanvas]:translate-x-0 group-data-[collapsible=offcanvas]:after:left-full group-data-[collapsible=offcanvas]:hover:bg-sidebar',\r\n        '[[data-side=left][data-collapsible=offcanvas]_&]:-right-2',\r\n        '[[data-side=right][data-collapsible=offcanvas]_&]:-left-2',\r\n        className,\r\n      )}\r\n      {...props}\r\n    />\r\n  )\r\n})\r\nSidebarRail.displayName = 'SidebarRail'\r\n\r\nconst SidebarInset = React.forwardRef<\r\n  HTMLDivElement,\r\n  React.ComponentProps<'main'>\r\n>(({ className, ...props }, ref) => {\r\n  return (\r\n    <main\r\n      ref={ref}\r\n      className={cn(\r\n        'relative flex min-h-svh flex-1 flex-col bg-background',\r\n        'peer-data-[variant=inset]:min-h-[calc(100svh-theme(spacing.4))] md:peer-data-[variant=inset]:m-2 md:peer-data-[state=collapsed]:peer-data-[variant=inset]:ml-2 md:peer-data-[variant=inset]:ml-0 md:peer-data-[variant=inset]:rounded-xl md:peer-data-[variant=inset]:shadow',\r\n        className,\r\n      )}\r\n      {...props}\r\n    />\r\n  )\r\n})\r\nSidebarInset.displayName = 'SidebarInset'\r\n\r\nconst SidebarInput = React.forwardRef<\r\n  React.ElementRef<typeof Input>,\r\n  React.ComponentProps<typeof Input>\r\n>(({ className, ...props }, ref) => {\r\n  return (\r\n    <Input\r\n      ref={ref}\r\n      data-sidebar=\"input\"\r\n      className={cn(\r\n        'h-8 w-full bg-background shadow-none focus-visible:ring-2 focus-visible:ring-sidebar-ring',\r\n        className,\r\n      )}\r\n      {...props}\r\n    />\r\n  )\r\n})\r\nSidebarInput.displayName = 'SidebarInput'\r\n\r\nconst SidebarHeader = React.forwardRef<\r\n  HTMLDivElement,\r\n  React.ComponentProps<'div'>\r\n>(({ className, ...props }, ref) => {\r\n  return (\r\n    <div\r\n      ref={ref}\r\n      data-sidebar=\"header\"\r\n      className={cn('flex flex-col gap-2 p-2', className)}\r\n      {...props}\r\n    />\r\n  )\r\n})\r\nSidebarHeader.displayName = 'SidebarHeader'\r\n\r\nconst SidebarFooter = React.forwardRef<\r\n  HTMLDivElement,\r\n  React.ComponentProps<'div'>\r\n>(({ className, ...props }, ref) => {\r\n  return (\r\n    <div\r\n      ref={ref}\r\n      data-sidebar=\"footer\"\r\n      className={cn('flex flex-col gap-2 p-2', className)}\r\n      {...props}\r\n    />\r\n  )\r\n})\r\nSidebarFooter.displayName = 'SidebarFooter'\r\n\r\nconst SidebarSeparator = React.forwardRef<\r\n  React.ElementRef<typeof Separator>,\r\n  React.ComponentProps<typeof Separator>\r\n>(({ className, ...props }, ref) => {\r\n  return (\r\n    <Separator\r\n      ref={ref}\r\n      data-sidebar=\"separator\"\r\n      className={cn('mx-2 w-auto bg-sidebar-border', className)}\r\n      {...props}\r\n    />\r\n  )\r\n})\r\nSidebarSeparator.displayName = 'SidebarSeparator'\r\n\r\nconst SidebarContent = React.forwardRef<\r\n  HTMLDivElement,\r\n  React.ComponentProps<'div'>\r\n>(({ className, ...props }, ref) => {\r\n  return (\r\n    <div\r\n      ref={ref}\r\n      data-sidebar=\"content\"\r\n      className={cn(\r\n        'flex min-h-0 flex-1 flex-col gap-2 overflow-auto group-data-[collapsible=icon]:overflow-hidden',\r\n        className,\r\n      )}\r\n      {...props}\r\n    />\r\n  )\r\n})\r\nSidebarContent.displayName = 'SidebarContent'\r\n\r\nconst SidebarGroup = React.forwardRef<\r\n  HTMLDivElement,\r\n  React.ComponentProps<'div'>\r\n>(({ className, ...props }, ref) => {\r\n  return (\r\n    <div\r\n      ref={ref}\r\n      data-sidebar=\"group\"\r\n      className={cn('relative flex w-full min-w-0 flex-col p-2', className)}\r\n      {...props}\r\n    />\r\n  )\r\n})\r\nSidebarGroup.displayName = 'SidebarGroup'\r\n\r\nconst SidebarGroupLabel = React.forwardRef<\r\n  HTMLDivElement,\r\n  React.ComponentProps<'div'> & { asChild?: boolean }\r\n>(({ className, asChild = false, ...props }, ref) => {\r\n  const Comp = asChild ? Slot : 'div'\r\n\r\n  return (\r\n    <Comp\r\n      ref={ref}\r\n      data-sidebar=\"group-label\"\r\n      className={cn(\r\n        'duration-200 flex h-8 shrink-0 items-center rounded-md px-2 text-xs font-medium text-sidebar-foreground/70 outline-none ring-sidebar-ring transition-[margin,opa] ease-linear focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0',\r\n        'group-data-[collapsible=icon]:-mt-8 group-data-[collapsible=icon]:opacity-0',\r\n        className,\r\n      )}\r\n      {...props}\r\n    />\r\n  )\r\n})\r\nSidebarGroupLabel.displayName = 'SidebarGroupLabel'\r\n\r\nconst SidebarGroupAction = React.forwardRef<\r\n  HTMLButtonElement,\r\n  React.ComponentProps<'button'> & { asChild?: boolean }\r\n>(({ className, asChild = false, ...props }, ref) => {\r\n  const Comp = asChild ? Slot : 'button'\r\n\r\n  return (\r\n    <Comp\r\n      ref={ref}\r\n      data-sidebar=\"group-action\"\r\n      className={cn(\r\n        'absolute right-3 top-3.5 flex aspect-square w-5 items-center justify-center rounded-md p-0 text-sidebar-foreground outline-none ring-sidebar-ring transition-transform hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0',\r\n        // Increases the hit area of the button on mobile.\r\n        'after:absolute after:-inset-2 after:md:hidden',\r\n        'group-data-[collapsible=icon]:hidden',\r\n        className,\r\n      )}\r\n      {...props}\r\n    />\r\n  )\r\n})\r\nSidebarGroupAction.displayName = 'SidebarGroupAction'\r\n\r\nconst SidebarGroupContent = React.forwardRef<\r\n  HTMLDivElement,\r\n  React.ComponentProps<'div'>\r\n>(({ className, ...props }, ref) => (\r\n  <div\r\n    ref={ref}\r\n    data-sidebar=\"group-content\"\r\n    className={cn('w-full text-sm', className)}\r\n    {...props}\r\n  />\r\n))\r\nSidebarGroupContent.displayName = 'SidebarGroupContent'\r\n\r\nconst SidebarMenu = React.forwardRef<\r\n  HTMLUListElement,\r\n  React.ComponentProps<'ul'>\r\n>(({ className, ...props }, ref) => (\r\n  <ul\r\n    ref={ref}\r\n    data-sidebar=\"menu\"\r\n    className={cn('flex w-full min-w-0 flex-col gap-1', className)}\r\n    {...props}\r\n  />\r\n))\r\nSidebarMenu.displayName = 'SidebarMenu'\r\n\r\nconst SidebarMenuItem = React.forwardRef<\r\n  HTMLLIElement,\r\n  React.ComponentProps<'li'>\r\n>(({ className, ...props }, ref) => (\r\n  <li\r\n    ref={ref}\r\n    data-sidebar=\"menu-item\"\r\n    className={cn('group/menu-item relative', className)}\r\n    {...props}\r\n  />\r\n))\r\nSidebarMenuItem.displayName = 'SidebarMenuItem'\r\n\r\nconst sidebarMenuButtonVariants = cva(\r\n  'peer/menu-button flex w-full items-center gap-2 overflow-hidden rounded-md p-2 text-left text-sm outline-none ring-sidebar-ring transition-[width,height,padding] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 group-has-[[data-sidebar=menu-action]]/menu-item:pr-8 aria-disabled:pointer-events-none aria-disabled:opacity-50 data-[active=true]:bg-sidebar-accent data-[active=true]:font-medium data-[active=true]:text-sidebar-accent-foreground data-[state=open]:hover:bg-sidebar-accent data-[state=open]:hover:text-sidebar-accent-foreground group-data-[collapsible=icon]:!size-8 group-data-[collapsible=icon]:!p-2 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0',\r\n  {\r\n    variants: {\r\n      variant: {\r\n        default: 'hover:bg-sidebar-accent hover:text-sidebar-accent-foreground',\r\n        outline:\r\n          'bg-background shadow-[0_0_0_1px_hsl(var(--sidebar-border))] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground hover:shadow-[0_0_0_1px_hsl(var(--sidebar-accent))]',\r\n      },\r\n      size: {\r\n        default: 'h-8 text-sm',\r\n        sm: 'h-7 text-xs',\r\n        lg: 'h-12 text-sm group-data-[collapsible=icon]:!p-0',\r\n      },\r\n    },\r\n    defaultVariants: {\r\n      variant: 'default',\r\n      size: 'default',\r\n    },\r\n  },\r\n)\r\n\r\nconst SidebarMenuButton = React.forwardRef<\r\n  HTMLButtonElement,\r\n  React.ComponentProps<'button'> & {\r\n    asChild?: boolean\r\n    isActive?: boolean\r\n    tooltip?: string | React.ComponentProps<typeof TooltipContent>\r\n  } & VariantProps<typeof sidebarMenuButtonVariants>\r\n>(\r\n  (\r\n    {\r\n      asChild = false,\r\n      isActive = false,\r\n      variant = 'default',\r\n      size = 'default',\r\n      tooltip,\r\n      className,\r\n      ...props\r\n    },\r\n    ref,\r\n  ) => {\r\n    const Comp = asChild ? Slot : 'button'\r\n    const { isMobile, state } = useSidebar()\r\n\r\n    const button = (\r\n      <Comp\r\n        ref={ref}\r\n        data-sidebar=\"menu-button\"\r\n        data-size={size}\r\n        data-active={isActive}\r\n        className={cn(sidebarMenuButtonVariants({ variant, size }), className)}\r\n        {...props}\r\n      />\r\n    )\r\n\r\n    if (!tooltip) {\r\n      return button\r\n    }\r\n\r\n    if (typeof tooltip === 'string') {\r\n      tooltip = {\r\n        children: tooltip,\r\n      }\r\n    }\r\n\r\n    return (\r\n      <Tooltip>\r\n        <TooltipTrigger asChild>{button}</TooltipTrigger>\r\n        <TooltipContent\r\n          side=\"right\"\r\n          align=\"center\"\r\n          hidden={state !== 'collapsed' || isMobile}\r\n          {...tooltip}\r\n        />\r\n      </Tooltip>\r\n    )\r\n  },\r\n)\r\nSidebarMenuButton.displayName = 'SidebarMenuButton'\r\n\r\nconst SidebarMenuAction = React.forwardRef<\r\n  HTMLButtonElement,\r\n  React.ComponentProps<'button'> & {\r\n    asChild?: boolean\r\n    showOnHover?: boolean\r\n  }\r\n>(({ className, asChild = false, showOnHover = false, ...props }, ref) => {\r\n  const Comp = asChild ? Slot : 'button'\r\n\r\n  return (\r\n    <Comp\r\n      ref={ref}\r\n      data-sidebar=\"menu-action\"\r\n      className={cn(\r\n        'absolute right-1 top-1.5 flex aspect-square w-5 items-center justify-center rounded-md p-0 text-sidebar-foreground outline-none ring-sidebar-ring transition-transform hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 peer-hover/menu-button:text-sidebar-accent-foreground [&>svg]:size-4 [&>svg]:shrink-0',\r\n        // Increases the hit area of the button on mobile.\r\n        'after:absolute after:-inset-2 after:md:hidden',\r\n        'peer-data-[size=sm]/menu-button:top-1',\r\n        'peer-data-[size=default]/menu-button:top-1.5',\r\n        'peer-data-[size=lg]/menu-button:top-2.5',\r\n        'group-data-[collapsible=icon]:hidden',\r\n        showOnHover &&\r\n          'group-focus-within/menu-item:opacity-100 group-hover/menu-item:opacity-100 data-[state=open]:opacity-100 peer-data-[active=true]/menu-button:text-sidebar-accent-foreground md:opacity-0',\r\n        className,\r\n      )}\r\n      {...props}\r\n    />\r\n  )\r\n})\r\nSidebarMenuAction.displayName = 'SidebarMenuAction'\r\n\r\nconst SidebarMenuBadge = React.forwardRef<\r\n  HTMLDivElement,\r\n  React.ComponentProps<'div'>\r\n>(({ className, ...props }, ref) => (\r\n  <div\r\n    ref={ref}\r\n    data-sidebar=\"menu-badge\"\r\n    className={cn(\r\n      'absolute right-1 flex h-5 min-w-5 items-center justify-center rounded-md px-1 text-xs font-medium tabular-nums text-sidebar-foreground select-none pointer-events-none',\r\n      'peer-hover/menu-button:text-sidebar-accent-foreground peer-data-[active=true]/menu-button:text-sidebar-accent-foreground',\r\n      'peer-data-[size=sm]/menu-button:top-1',\r\n      'peer-data-[size=default]/menu-button:top-1.5',\r\n      'peer-data-[size=lg]/menu-button:top-2.5',\r\n      'group-data-[collapsible=icon]:hidden',\r\n      className,\r\n    )}\r\n    {...props}\r\n  />\r\n))\r\nSidebarMenuBadge.displayName = 'SidebarMenuBadge'\r\n\r\nconst SidebarMenuSkeleton = React.forwardRef<\r\n  HTMLDivElement,\r\n  React.ComponentProps<'div'> & {\r\n    showIcon?: boolean\r\n  }\r\n>(({ className, showIcon = false, ...props }, ref) => {\r\n  // Random width between 50 to 90%.\r\n  const width = React.useMemo(() => {\r\n    return `${Math.floor(Math.random() * 40) + 50}%`\r\n  }, [])\r\n\r\n  return (\r\n    <div\r\n      ref={ref}\r\n      data-sidebar=\"menu-skeleton\"\r\n      className={cn('rounded-md h-8 flex gap-2 px-2 items-center', className)}\r\n      {...props}\r\n    >\r\n      {showIcon && (\r\n        <Skeleton\r\n          className=\"size-4 rounded-md\"\r\n          data-sidebar=\"menu-skeleton-icon\"\r\n        />\r\n      )}\r\n      <Skeleton\r\n        className=\"h-4 flex-1 max-w-[--skeleton-width]\"\r\n        data-sidebar=\"menu-skeleton-text\"\r\n        style={\r\n          {\r\n            '--skeleton-width': width,\r\n          } as React.CSSProperties\r\n        }\r\n      />\r\n    </div>\r\n  )\r\n})\r\nSidebarMenuSkeleton.displayName = 'SidebarMenuSkeleton'\r\n\r\nconst SidebarMenuSub = React.forwardRef<\r\n  HTMLUListElement,\r\n  React.ComponentProps<'ul'>\r\n>(({ className, ...props }, ref) => (\r\n  <ul\r\n    ref={ref}\r\n    data-sidebar=\"menu-sub\"\r\n    className={cn(\r\n      'mx-3.5 flex min-w-0 translate-x-px flex-col gap-1 border-l border-sidebar-border px-2.5 py-0.5',\r\n      'group-data-[collapsible=icon]:hidden',\r\n      className,\r\n    )}\r\n    {...props}\r\n  />\r\n))\r\nSidebarMenuSub.displayName = 'SidebarMenuSub'\r\n\r\nconst SidebarMenuSubItem = React.forwardRef<\r\n  HTMLLIElement,\r\n  React.ComponentProps<'li'>\r\n>(({ ...props }, ref) => <li ref={ref} {...props} />)\r\nSidebarMenuSubItem.displayName = 'SidebarMenuSubItem'\r\n\r\nconst SidebarMenuSubButton = React.forwardRef<\r\n  HTMLAnchorElement,\r\n  React.ComponentProps<'a'> & {\r\n    asChild?: boolean\r\n    size?: 'sm' | 'md'\r\n    isActive?: boolean\r\n  }\r\n>(({ asChild = false, size = 'md', isActive, className, ...props }, ref) => {\r\n  const Comp = asChild ? Slot : 'a'\r\n\r\n  return (\r\n    <Comp\r\n      ref={ref}\r\n      data-sidebar=\"menu-sub-button\"\r\n      data-size={size}\r\n      data-active={isActive}\r\n      className={cn(\r\n        'flex h-7 min-w-0 -translate-x-px items-center gap-2 overflow-hidden rounded-md px-2 text-sidebar-foreground outline-none ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 aria-disabled:pointer-events-none aria-disabled:opacity-50 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0 [&>svg]:text-sidebar-accent-foreground',\r\n        'data-[active=true]:bg-sidebar-accent data-[active=true]:text-sidebar-accent-foreground',\r\n        size === 'sm' && 'text-xs',\r\n        size === 'md' && 'text-sm',\r\n        'group-data-[collapsible=icon]:hidden',\r\n        className,\r\n      )}\r\n      {...props}\r\n    />\r\n  )\r\n})\r\nSidebarMenuSubButton.displayName = 'SidebarMenuSubButton'\r\n\r\nexport {\r\n  Sidebar,\r\n  SidebarContent,\r\n  SidebarFooter,\r\n  SidebarGroup,\r\n  SidebarGroupAction,\r\n  SidebarGroupContent,\r\n  SidebarGroupLabel,\r\n  SidebarHeader,\r\n  SidebarInput,\r\n  SidebarInset,\r\n  SidebarMenu,\r\n  SidebarMenuAction,\r\n  SidebarMenuBadge,\r\n  SidebarMenuButton,\r\n  SidebarMenuItem,\r\n  SidebarMenuSkeleton,\r\n  SidebarMenuSub,\r\n  SidebarMenuSubButton,\r\n  SidebarMenuSubItem,\r\n  SidebarProvider,\r\n  SidebarRail,\r\n  SidebarSeparator,\r\n  SidebarTrigger,\r\n  useSidebar,\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Projetos\\Back_endCrm\\kanbanproject1\\components\\ui\\skeleton.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projetos\\Back_endCrm\\kanbanproject1\\components\\ui\\slider.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projetos\\Back_endCrm\\kanbanproject1\\components\\ui\\sonner.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projetos\\Back_endCrm\\kanbanproject1\\components\\ui\\spinner.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projetos\\Back_endCrm\\kanbanproject1\\components\\ui\\switch.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projetos\\Back_endCrm\\kanbanproject1\\components\\ui\\table.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projetos\\Back_endCrm\\kanbanproject1\\components\\ui\\tabs.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projetos\\Back_endCrm\\kanbanproject1\\components\\ui\\textarea.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projetos\\Back_endCrm\\kanbanproject1\\components\\ui\\toast.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projetos\\Back_endCrm\\kanbanproject1\\components\\ui\\toaster.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projetos\\Back_endCrm\\kanbanproject1\\components\\ui\\toggle-group.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projetos\\Back_endCrm\\kanbanproject1\\components\\ui\\toggle.tsx","messages":[{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":45,"column":18,"nodeType":"Identifier","messageId":"namedExport","endLine":45,"endColumn":32}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\r\n\r\nimport * as React from 'react'\r\nimport * as TogglePrimitive from '@radix-ui/react-toggle'\r\nimport { cva, type VariantProps } from 'class-variance-authority'\r\n\r\nimport { cn } from '@/lib/utils'\r\n\r\nconst toggleVariants = cva(\r\n  'inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors hover:bg-muted hover:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=on]:bg-accent data-[state=on]:text-accent-foreground [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0 gap-2',\r\n  {\r\n    variants: {\r\n      variant: {\r\n        default: 'bg-transparent',\r\n        outline:\r\n          'border border-input bg-transparent hover:bg-accent hover:text-accent-foreground',\r\n      },\r\n      size: {\r\n        default: 'h-10 px-3 min-w-10',\r\n        sm: 'h-9 px-2.5 min-w-9',\r\n        lg: 'h-11 px-5 min-w-11',\r\n      },\r\n    },\r\n    defaultVariants: {\r\n      variant: 'default',\r\n      size: 'default',\r\n    },\r\n  },\r\n)\r\n\r\nconst Toggle = React.forwardRef<\r\n  React.ElementRef<typeof TogglePrimitive.Root>,\r\n  React.ComponentPropsWithoutRef<typeof TogglePrimitive.Root> &\r\n    VariantProps<typeof toggleVariants>\r\n>(({ className, variant, size, ...props }, ref) => (\r\n  <TogglePrimitive.Root\r\n    ref={ref}\r\n    className={cn(toggleVariants({ variant, size, className }))}\r\n    {...props}\r\n  />\r\n))\r\n\r\nToggle.displayName = TogglePrimitive.Root.displayName\r\n\r\nexport { Toggle, toggleVariants }\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Projetos\\Back_endCrm\\kanbanproject1\\components\\ui\\tooltip.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projetos\\Back_endCrm\\kanbanproject1\\components\\ui\\use-mobile.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projetos\\Back_endCrm\\kanbanproject1\\components\\ui\\use-toast.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'actionTypes' is assigned a value but only used as a type.","line":18,"column":7,"nodeType":null,"messageId":"usedOnlyAsType","endLine":18,"endColumn":18},{"ruleId":"no-unused-vars","severity":1,"message":"'state' is defined but never used.","line":129,"column":25,"nodeType":"Identifier","messageId":"unusedVar","endLine":129,"endColumn":37,"suggestions":[{"messageId":"removeVar","data":{"varName":"state"},"fix":{"range":[2878,2890],"text":""},"desc":"Remove unused variable 'state'."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\r\n\r\n// Inspired by react-hot-toast library\r\nimport * as React from 'react'\r\n\r\nimport type { ToastActionElement, ToastProps } from '@/components/ui/toast'\r\n\r\nconst TOAST_LIMIT = 1\r\nconst TOAST_REMOVE_DELAY = 1000000\r\n\r\ntype ToasterToast = ToastProps & {\r\n  id: string\r\n  title?: React.ReactNode\r\n  description?: React.ReactNode\r\n  action?: ToastActionElement\r\n}\r\n\r\nconst actionTypes = {\r\n  ADD_TOAST: 'ADD_TOAST',\r\n  UPDATE_TOAST: 'UPDATE_TOAST',\r\n  DISMISS_TOAST: 'DISMISS_TOAST',\r\n  REMOVE_TOAST: 'REMOVE_TOAST',\r\n} as const\r\n\r\nlet count = 0\r\n\r\nfunction genId() {\r\n  count = (count + 1) % Number.MAX_SAFE_INTEGER\r\n  return count.toString()\r\n}\r\n\r\ntype ActionType = typeof actionTypes\r\n\r\ntype Action =\r\n  | {\r\n      type: ActionType['ADD_TOAST']\r\n      toast: ToasterToast\r\n    }\r\n  | {\r\n      type: ActionType['UPDATE_TOAST']\r\n      toast: Partial<ToasterToast>\r\n    }\r\n  | {\r\n      type: ActionType['DISMISS_TOAST']\r\n      toastId?: ToasterToast['id']\r\n    }\r\n  | {\r\n      type: ActionType['REMOVE_TOAST']\r\n      toastId?: ToasterToast['id']\r\n    }\r\n\r\ninterface State {\r\n  toasts: ToasterToast[]\r\n}\r\n\r\nconst toastTimeouts = new Map<string, ReturnType<typeof setTimeout>>()\r\n\r\nconst addToRemoveQueue = (toastId: string) => {\r\n  if (toastTimeouts.has(toastId)) {\r\n    return\r\n  }\r\n\r\n  const timeout = setTimeout(() => {\r\n    toastTimeouts.delete(toastId)\r\n    dispatch({\r\n      type: 'REMOVE_TOAST',\r\n      toastId: toastId,\r\n    })\r\n  }, TOAST_REMOVE_DELAY)\r\n\r\n  toastTimeouts.set(toastId, timeout)\r\n}\r\n\r\nexport const reducer = (state: State, action: Action): State => {\r\n  switch (action.type) {\r\n    case 'ADD_TOAST':\r\n      return {\r\n        ...state,\r\n        toasts: [action.toast, ...state.toasts].slice(0, TOAST_LIMIT),\r\n      }\r\n\r\n    case 'UPDATE_TOAST':\r\n      return {\r\n        ...state,\r\n        toasts: state.toasts.map((t) =>\r\n          t.id === action.toast.id ? { ...t, ...action.toast } : t,\r\n        ),\r\n      }\r\n\r\n    case 'DISMISS_TOAST': {\r\n      const { toastId } = action\r\n\r\n      // ! Side effects ! - This could be extracted into a dismissToast() action,\r\n      // but I'll keep it here for simplicity\r\n      if (toastId) {\r\n        addToRemoveQueue(toastId)\r\n      } else {\r\n        state.toasts.forEach((toast) => {\r\n          addToRemoveQueue(toast.id)\r\n        })\r\n      }\r\n\r\n      return {\r\n        ...state,\r\n        toasts: state.toasts.map((t) =>\r\n          t.id === toastId || toastId === undefined\r\n            ? {\r\n                ...t,\r\n                open: false,\r\n              }\r\n            : t,\r\n        ),\r\n      }\r\n    }\r\n    case 'REMOVE_TOAST':\r\n      if (action.toastId === undefined) {\r\n        return {\r\n          ...state,\r\n          toasts: [],\r\n        }\r\n      }\r\n      return {\r\n        ...state,\r\n        toasts: state.toasts.filter((t) => t.id !== action.toastId),\r\n      }\r\n  }\r\n}\r\n\r\nconst listeners: Array<(state: State) => void> = []\r\n\r\nlet memoryState: State = { toasts: [] }\r\n\r\nfunction dispatch(action: Action) {\r\n  memoryState = reducer(memoryState, action)\r\n  listeners.forEach((listener) => {\r\n    listener(memoryState)\r\n  })\r\n}\r\n\r\ntype Toast = Omit<ToasterToast, 'id'>\r\n\r\nfunction toast({ ...props }: Toast) {\r\n  const id = genId()\r\n\r\n  const update = (props: ToasterToast) =>\r\n    dispatch({\r\n      type: 'UPDATE_TOAST',\r\n      toast: { ...props, id },\r\n    })\r\n  const dismiss = () => dispatch({ type: 'DISMISS_TOAST', toastId: id })\r\n\r\n  dispatch({\r\n    type: 'ADD_TOAST',\r\n    toast: {\r\n      ...props,\r\n      id,\r\n      open: true,\r\n      onOpenChange: (open) => {\r\n        if (!open) dismiss()\r\n      },\r\n    },\r\n  })\r\n\r\n  return {\r\n    id: id,\r\n    dismiss,\r\n    update,\r\n  }\r\n}\r\n\r\nfunction useToast() {\r\n  const [state, setState] = React.useState<State>(memoryState)\r\n\r\n  React.useEffect(() => {\r\n    listeners.push(setState)\r\n    return () => {\r\n      const index = listeners.indexOf(setState)\r\n      if (index > -1) {\r\n        listeners.splice(index, 1)\r\n      }\r\n    }\r\n  }, [state])\r\n\r\n  return {\r\n    ...state,\r\n    toast,\r\n    dismiss: (toastId?: string) => dispatch({ type: 'DISMISS_TOAST', toastId }),\r\n  }\r\n}\r\n\r\nexport { useToast, toast }\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Projetos\\Back_endCrm\\kanbanproject1\\components\\user-management.tsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'user' is defined but never used.","line":59,"column":19,"nodeType":"Identifier","messageId":"unusedVar","endLine":59,"endColumn":40,"suggestions":[{"messageId":"removeVar","data":{"varName":"user"},"fix":{"range":[1989,2010],"text":""},"desc":"Remove unused variable 'user'."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'editingUser'. Either include it or remove the dependency array.","line":165,"column":6,"nodeType":"ArrayExpression","endLine":165,"endColumn":20,"suggestions":[{"desc":"Update the dependencies array to be: [editingUser, onUserChange]","fix":{"range":[6255,6269],"text":"[editingUser, onUserChange]"}}]},{"ruleId":"no-unused-vars","severity":1,"message":"'currentUserData' is assigned a value but never used.","line":287,"column":11,"nodeType":"Identifier","messageId":"unusedVar","endLine":287,"endColumn":26},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'currentUserData' is assigned a value but never used.","line":287,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":287,"endColumn":26}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\"\r\n\r\nimport { useState, useEffect } from \"react\"\r\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\"\r\nimport { Button } from \"@/components/ui/button\"\r\nimport { Input } from \"@/components/ui/input\"\r\nimport { Label } from \"@/components/ui/label\"\r\nimport { Badge } from \"@/components/ui/badge\"\r\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from \"@/components/ui/dialog\"\r\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\"\r\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\"\r\nimport { Avatar, AvatarFallback } from \"@/components/ui/avatar\"\r\nimport { Separator } from \"@/components/ui/separator\"\r\nimport { Checkbox } from \"@/components/ui/checkbox\"\r\nimport { getCurrentUser, setCurrentUser, logout } from \"@/lib/storage\"\r\nimport { authApi } from \"@/lib/api/auth-api\"\r\nimport { usersApi } from \"@/lib/api/users-api\"\r\nimport { companiesApi } from \"@/lib/api/companies-api\"\r\nimport type { Company } from \"@/lib/types/company\"\r\nimport type { JobTitle } from \"@/lib/types/job-title\"\r\nimport { jobTitlesApi } from \"@/lib/api/job-titles-api\"\r\nimport {\r\n  Users,\r\n  UserPlus,\r\n  Shield,\r\n  Mail,\r\n  Phone,\r\n  Edit,\r\n  Trash2,\r\n  LogOut,\r\n  Crown,\r\n  Network,\r\n  Eye,\r\n  EyeOff,\r\n  Briefcase,\r\n  Plus,\r\n} from \"lucide-react\"\r\n\r\ntype UserType = {\r\n  id: string\r\n  name: string\r\n  email: string\r\n  password: string // Added password field\r\n  phone?: string\r\n  role: \"admin\" | \"manager\" | \"supervisor\" | \"employee\"\r\n  jobTitleId?: string // Added job title reference\r\n  department?: string\r\n  position?: string\r\n  status: \"active\" | \"inactive\"\r\n  createdAt: string\r\n  lastLogin?: string\r\n  supervisorId?: string // ID of the user's supervisor/manager\r\n  teamMembers?: string[] // IDs of users this person supervises\r\n  modules?: string[] // Array of accessible modules\r\n  companyId?: string // Added companyId field\r\n}\r\n\r\ntype UserManagementProps = {\r\n  onUserChange?: (user: UserType | null) => void\r\n}\r\n\r\nconst AVAILABLE_MODULES = [\r\n  { id: \"pipeline\", name: \"Pipeline De Leads\" },\r\n  { id: \"unichat\", name: \"UniChat\" },\r\n  { id: \"dashboard\", name: \"Dashboard\" },\r\n  { id: \"tarefas\", name: \"Tarefas\" },\r\n  { id: \"relatorios\", name: \"Relatórios\" },\r\n  { id: \"configuracoes\", name: \"Configurações\" },\r\n  { id: \"usuarios\", name: \"Gerenciamento De Usuários\" },\r\n]\r\n\r\nexport default function UserManagement({ onUserChange }: UserManagementProps) {\r\n  const [users, setUsers] = useState<UserType[]>([])\r\n  const [currentUser, setCurrentUserState] = useState<UserType | null>(null)\r\n  const [isAddUserOpen, setIsAddUserOpen] = useState(false)\r\n  const [editingUser, setEditingUser] = useState<UserType | null>(null)\r\n  const [activeTab, setActiveTab] = useState(\"users\")\r\n  const [showPassword, setShowPassword] = useState(false)\r\n  const [showConfirmPassword, setShowConfirmPassword] = useState(false)\r\n\r\n  const [companies, setCompanies] = useState<Company[]>([])\r\n\r\n  const [jobTitles, setJobTitles] = useState<JobTitle[]>([])\r\n  const [isAddJobTitleOpen, setIsAddJobTitleOpen] = useState(false)\r\n  const [editingJobTitle, setEditingJobTitle] = useState<JobTitle | null>(null)\r\n  const [jobTitleForm, setJobTitleForm] = useState({\r\n    name: \"\",\r\n    systemRole: \"employee\" as \"admin\" | \"manager\" | \"supervisor\" | \"employee\",\r\n    canViewSameRoleData: true,\r\n  })\r\n\r\n  // Form states\r\n  const [formData, setFormData] = useState({\r\n    name: \"\",\r\n    email: \"\",\r\n    password: \"\", // Added password field\r\n    confirmPassword: \"\", // Added confirm password field\r\n    phone: \"\",\r\n    role: \"employee\" as \"admin\" | \"manager\" | \"supervisor\" | \"employee\",\r\n    jobTitleId: \"\", // Added job title selection\r\n    department: \"\",\r\n    position: \"\",\r\n    supervisorId: \"\", // Added supervisor reference\r\n    companyId: \"\",\r\n    modules: [\"pipeline\", \"unichat\", \"dashboard\", \"tarefas\", \"relatorios\", \"configuracoes\", \"usuarios\"] as string[], // Updated to initialize with all modules selected by default\r\n  })\r\n\r\n  useEffect(() => {\r\n    const init = async () => {\r\n      let storedCurrentUser = getCurrentUser()\r\n\r\n      // Fallback para /auth/me quando não há user em storage ou falta companyId\r\n      if (!storedCurrentUser || !storedCurrentUser.companyId) {\r\n        try {\r\n          const me = await authApi.me()\r\n          storedCurrentUser = me as any\r\n          console.log(\"[v0] Loaded current user from /auth/me:\", me)\r\n        } catch (e) {\r\n          console.warn(\"[v0] Could not load user from /auth/me\", e)\r\n        }\r\n      }\r\n\r\n      setCurrentUserState(storedCurrentUser)\r\n      // Pré-seleciona empresa do usuário logado no formulário\r\n      if (!editingUser && storedCurrentUser?.companyId) {\r\n        setFormData((prev) => ({ ...prev, companyId: storedCurrentUser!.companyId }))\r\n      }\r\n\r\n      // Load companies from API (filtered by current company)\r\n      try {\r\n        const list = await companiesApi.list(storedCurrentUser?.companyId)\r\n        const arr = Array.isArray(list) ? list : []\r\n        // Defensive client-side filter: ensure only current tenant's company is shown\r\n        const filtered = storedCurrentUser?.companyId\r\n          ? arr.filter((c) => c.id === storedCurrentUser!.companyId)\r\n          : arr\r\n        setCompanies(filtered)\r\n      } catch (e) {\r\n        console.warn(\"[api] Could not load companies\", e)\r\n        setCompanies([])\r\n      }\r\n      try {\r\n        const apiJobTitles = await jobTitlesApi.list(storedCurrentUser?.companyId)\r\n        setJobTitles(Array.isArray(apiJobTitles) ? apiJobTitles : [])\r\n      } catch (e) {\r\n        console.warn(\"[api] Could not load job titles\", e)\r\n        setJobTitles([])\r\n      }\r\n\r\n      if (storedCurrentUser?.companyId) {\r\n        try {\r\n          const apiUsers = await usersApi.list(storedCurrentUser.companyId)\r\n          console.log(\"[api] Loaded users for company:\", storedCurrentUser.companyId, apiUsers)\r\n          setUsers(Array.isArray(apiUsers) ? apiUsers : [])\r\n        } catch (e) {\r\n          console.error(\"[api] Failed to load users:\", e)\r\n          setUsers([])\r\n        }\r\n      } else {\r\n        console.log(\"[v0] No current user or companyId, setting empty users array\")\r\n        setUsers([])\r\n      }\r\n    }\r\n    init()\r\n  }, [onUserChange])\r\n\r\n  const handleAddJobTitle = async () => {\r\n    if (!jobTitleForm.name.trim()) {\r\n      alert(\"Por favor, insira um nome para o cargo\")\r\n      return\r\n    }\r\n\r\n    // Validação de duplicidade por empresa (case-insensitive)\r\n    const exists = jobTitles.some(\r\n      (jt) => jt.name.trim().toLowerCase() === jobTitleForm.name.trim().toLowerCase(),\r\n    )\r\n    if (exists) {\r\n      alert(\"Já existe um cargo com esse nome nesta empresa\")\r\n      return\r\n    }\r\n\r\n    try {\r\n      if (!currentUser?.companyId) {\r\n        alert(\"Não foi possível identificar a empresa do usuário atual\")\r\n        return\r\n      }\r\n      await jobTitlesApi.create({\r\n        name: jobTitleForm.name.trim(),\r\n        systemRole: jobTitleForm.systemRole,\r\n        companyId: currentUser.companyId,\r\n        canViewSameRoleData: jobTitleForm.canViewSameRoleData,\r\n      })\r\n      const apiJobTitles = await jobTitlesApi.list(currentUser.companyId)\r\n      setJobTitles(Array.isArray(apiJobTitles) ? apiJobTitles : [])\r\n    } catch (e: any) {\r\n      alert(e?.message || \"Falha ao criar cargo\")\r\n    }\r\n    resetJobTitleForm()\r\n  }\r\n\r\n  const handleEditJobTitle = (jobTitle: JobTitle) => {\r\n    setEditingJobTitle(jobTitle)\r\n    setJobTitleForm({\r\n      name: jobTitle.name,\r\n      systemRole: jobTitle.systemRole,\r\n      canViewSameRoleData: jobTitle.canViewSameRoleData !== false,\r\n    })\r\n    setIsAddJobTitleOpen(true)\r\n  }\r\n\r\n  const handleUpdateJobTitle = async () => {\r\n    if (!editingJobTitle || !jobTitleForm.name.trim()) return\r\n\r\n    // Validação de duplicidade (exclui o próprio em edição)\r\n    const exists = jobTitles.some(\r\n      (jt) => jt.id !== editingJobTitle.id && jt.name.trim().toLowerCase() === jobTitleForm.name.trim().toLowerCase(),\r\n    )\r\n    if (exists) {\r\n      alert(\"Já existe um cargo com esse nome nesta empresa\")\r\n      return\r\n    }\r\n\r\n    try {\r\n      await jobTitlesApi.update(editingJobTitle.id, {\r\n        name: jobTitleForm.name.trim(),\r\n        systemRole: jobTitleForm.systemRole,\r\n        canViewSameRoleData: jobTitleForm.canViewSameRoleData,\r\n      })\r\n      const apiJobTitles = await jobTitlesApi.list(currentUser?.companyId)\r\n      setJobTitles(Array.isArray(apiJobTitles) ? apiJobTitles : [])\r\n    } catch (e: any) {\r\n      alert(e?.message || \"Falha ao atualizar cargo\")\r\n    }\r\n    resetJobTitleForm()\r\n  }\r\n\r\n  const handleDeleteJobTitle = async (id: string) => {\r\n    const usersWithJobTitle = users.filter((u) => u.jobTitleId === id)\r\n    if (usersWithJobTitle.length > 0) {\r\n      alert(`Este cargo está sendo usado por ${usersWithJobTitle.length} usuário(s) e não pode ser excluído`)\r\n      return\r\n    }\r\n\r\n    try {\r\n      await jobTitlesApi.remove(id)\r\n      const apiJobTitles = await jobTitlesApi.list(currentUser?.companyId)\r\n      setJobTitles(Array.isArray(apiJobTitles) ? apiJobTitles : [])\r\n    } catch (e: any) {\r\n      alert(e?.message || \"Falha ao excluir cargo\")\r\n    }\r\n  }\r\n\r\n  const resetJobTitleForm = () => {\r\n    setJobTitleForm({\r\n      name: \"\",\r\n      systemRole: \"employee\",\r\n      canViewSameRoleData: true,\r\n    })\r\n    setEditingJobTitle(null)\r\n    setIsAddJobTitleOpen(false)\r\n  }\r\n\r\n  const handleAddUser = async () => {\r\n    if (!formData.name || !formData.email || !formData.password || !formData.companyId) {\r\n      alert(\"Por favor, preencha os campos obrigatórios: nome, email, senha e empresa\")\r\n      return\r\n    }\r\n\r\n    if (formData.password !== formData.confirmPassword) {\r\n      alert(\"As senhas não coincidem\")\r\n      return\r\n    }\r\n\r\n    if (formData.password.length < 6) {\r\n      alert(\"A senha deve ter pelo menos 6 caracteres\")\r\n      return\r\n    }\r\n\r\n    let role = formData.role\r\n    if (formData.jobTitleId) {\r\n      const jobTitle = jobTitles.find((jt) => jt.id === formData.jobTitleId)\r\n      if (jobTitle) {\r\n        role = jobTitle.systemRole\r\n      }\r\n    }\r\n\r\n    const currentUserData = currentUser\r\n\r\n    const existingUser = users.find((u: any) => u.email.toLowerCase() === formData.email.toLowerCase())\r\n    if (existingUser) {\r\n      alert(\"Este email já está cadastrado\")\r\n      return\r\n    }\r\n\r\n    const payload = {\r\n      name: formData.name,\r\n      email: formData.email,\r\n      password: formData.password,\r\n      phone: formData.phone,\r\n      role,\r\n      jobTitleId: formData.jobTitleId || undefined,\r\n      companyId: formData.companyId,\r\n      modules: formData.modules,\r\n    }\r\n\r\n    console.log(\"[api] Creating new user:\", payload)\r\n    try {\r\n      const res = await usersApi.create(payload)\r\n      const createdUser = res.user as UserType\r\n\r\n    // Update supervisor's team members\r\n      let updatedUsers: UserType[]\r\n    if (formData.supervisorId) {\r\n      updatedUsers = users.map((u) => {\r\n        if (u.id === formData.supervisorId) {\r\n          return {\r\n            ...u,\r\n            teamMembers: [...(u.teamMembers || []), newUser.id],\r\n          }\r\n        }\r\n        return u\r\n      })\r\n      updatedUsers = [...updatedUsers, createdUser]\r\n    } else {\r\n      updatedUsers = [...users, createdUser]\r\n    }\r\n\r\n      setUsers(updatedUsers)\r\n\r\n      resetForm()\r\n      alert(\"Usuário criado com sucesso! Ele já pode fazer login no sistema.\")\r\n    } catch (e: any) {\r\n      console.error(\"[api] Failed to create user:\", e)\r\n      alert(e?.message || \"Falha ao criar usuário\")\r\n    }\r\n  }\r\n\r\nconst handleEditUser = (user: UserType) => {\r\n    setEditingUser(user)\r\n    setFormData({\r\n      name: user.name,\r\n      email: user.email,\r\n      password: \"\",\r\n      confirmPassword: \"\",\r\n      phone: user.phone || \"\",\r\n      role: user.role,\r\n      jobTitleId: user.jobTitleId || \"\",\r\n      department: user.department || \"\",\r\n      position: user.position || \"\",\r\n      supervisorId: user.supervisorId || \"\",\r\n      companyId: user.companyId || \"\",\r\n      modules: user.modules || [],\r\n    })\r\n    setIsAddUserOpen(true)\r\n  }\r\n\r\n  const handleUpdateUser = async () => {\r\n    if (!editingUser || !formData.name || !formData.email) return\r\n\r\n    if (formData.password && formData.password !== formData.confirmPassword) {\r\n      alert(\"As senhas não coincidem\")\r\n      return\r\n    }\r\n\r\n    if (formData.password && formData.password.length < 6) {\r\n      alert(\"A senha deve ter pelo menos 6 caracteres\")\r\n      return\r\n    }\r\n\r\n    let role = formData.role\r\n    if (formData.jobTitleId) {\r\n      const jobTitle = jobTitles.find((jt) => jt.id === formData.jobTitleId)\r\n      if (jobTitle) {\r\n        role = jobTitle.systemRole\r\n      }\r\n    }\r\n\r\n    const updatedUser: UserType = {\r\n      ...editingUser,\r\n      name: formData.name,\r\n      email: formData.email,\r\n      password: formData.password || editingUser.password,\r\n      phone: formData.phone,\r\n      role: role, // Now properly updates role based on job title\r\n      jobTitleId: formData.jobTitleId || undefined,\r\n      department: formData.department,\r\n      position: formData.position,\r\n      supervisorId: formData.supervisorId || undefined,\r\n      modules: formData.modules,\r\n    }\r\n\r\n    try {\r\n      const updatePayload: any = {\r\n        name: updatedUser.name,\r\n        phone: updatedUser.phone,\r\n        role: updatedUser.role,\r\n        jobTitleId: updatedUser.jobTitleId,\r\n        modules: updatedUser.modules,\r\n      }\r\n      if (formData.password) updatePayload.password = formData.password\r\n      const res = await usersApi.update(editingUser.id, updatePayload)\r\n      const saved = res.user as UserType\r\n\r\n    const oldSupervisorId = editingUser.supervisorId\r\n    const newSupervisorId = formData.supervisorId\r\n    let updatedUsers = [...users]\r\n\r\n    if (oldSupervisorId !== newSupervisorId) {\r\n      // Remove from old supervisor's team\r\n      if (oldSupervisorId) {\r\n        updatedUsers = updatedUsers.map((u) => {\r\n          if (u.id === oldSupervisorId) {\r\n            return { ...u, teamMembers: u.teamMembers?.filter((id) => id !== editingUser.id) }\r\n          }\r\n          return u\r\n        })\r\n      }\r\n      // Add to new supervisor's team\r\n      if (newSupervisorId) {\r\n        updatedUsers = updatedUsers.map((u) => {\r\n          if (u.id === newSupervisorId) {\r\n            return { ...u, teamMembers: [...(u.teamMembers || []), editingUser.id] }\r\n          }\r\n          return u\r\n        })\r\n      }\r\n    }\r\n\r\n    // Update the user itself\r\n    updatedUsers = updatedUsers.map((u) => (u.id === editingUser.id ? updatedUser : u))\r\n\r\n    console.log(\"[api] User updated:\", saved)\r\n\r\n    setUsers(updatedUsers)\r\n\r\n    if (currentUser?.id === editingUser.id) {\r\n      setCurrentUser(updatedUser)\r\n      setCurrentUserState(updatedUser)\r\n      onUserChange?.(updatedUser)\r\n    }\r\n\r\n      resetForm()\r\n      alert(\"Usuário atualizado com sucesso!\")\r\n    } catch (e: any) {\r\n      console.error(\"[api] Failed to update user:\", e)\r\n      alert(e?.message || \"Falha ao atualizar usuário\")\r\n    }\r\n  }\r\n\r\n  const handleDeleteUser = async (userId: string) => {\r\n    if (userId === currentUser?.id) return\r\n\r\n    const userToDelete = users.find((u) => u.id === userId)\r\n\r\n    if (userToDelete?.supervisorId) {\r\n      const updatedUsers = users.map((u) => {\r\n        if (u.id === userToDelete.supervisorId) {\r\n          return {\r\n            ...u,\r\n            teamMembers: u.teamMembers?.filter((id) => id !== userId),\r\n          }\r\n        }\r\n        return u\r\n      })\r\n      setUsers(updatedUsers)\r\n      // persistência é feita no backend; aqui só atualizamos estado local\r\n    }\r\n\r\n    // Remove user's team members from reporting to this user (if this user was a supervisor)\r\n    const teamMembers = getTeamHierarchy(userId)\r\n    if (teamMembers.length > 0) {\r\n      const updatedUsers = users.map((u) => {\r\n        if (teamMembers.some((member) => member.id === u.id)) {\r\n          return {\r\n            ...u,\r\n            supervisorId: undefined,\r\n          }\r\n        }\r\n        return u\r\n      })\r\n      setUsers(updatedUsers)\r\n      // persistência é feita no backend; aqui só atualizamos estado local\r\n    }\r\n\r\n    try {\r\n      await usersApi.remove(userId)\r\n      const finalUsers = users.filter((u) => u.id !== userId)\r\n      setUsers(finalUsers)\r\n    } catch (e: any) {\r\n      console.error(\"[api] Failed to delete user:\", e)\r\n      alert(e?.message || \"Falha ao excluir usuário\")\r\n    }\r\n  }\r\n\r\n  // const handleSwitchUser = (user: UserType) => {\r\n  //   setCurrentUser(user)\r\n  //   setCurrentUserState(user)\r\n  //   onUserChange?.(user)\r\n  // }\r\n\r\n  const handleLogout = () => {\r\n    logout()\r\n    setCurrentUserState(null)\r\n    onUserChange?.(null)\r\n  }\r\n\r\n  const resetForm = () => {\r\n    setFormData({\r\n      name: \"\",\r\n      email: \"\",\r\n      password: \"\", // Reset password fields\r\n      confirmPassword: \"\",\r\n      phone: \"\",\r\n      role: \"employee\",\r\n      jobTitleId: \"\", // Reset job title\r\n      department: \"\",\r\n      position: \"\",\r\n      supervisorId: \"\", // Reset supervisor\r\n      companyId: \"\",\r\n      modules: [\"pipeline\", \"unichat\", \"dashboard\", \"tarefas\", \"relatorios\", \"configuracoes\", \"usuarios\"], // Updated to reset with all modules selected by default\r\n    })\r\n    setEditingUser(null)\r\n    setIsAddUserOpen(false)\r\n    setShowPassword(false)\r\n    setShowConfirmPassword(false)\r\n  }\r\n\r\n  const handleJobTitleChange = (jobTitleId: string) => {\r\n    const jobTitle = jobTitles.find((jt) => jt.id === jobTitleId)\r\n    if (jobTitle) {\r\n      setFormData({ ...formData, jobTitleId, role: jobTitle.systemRole })\r\n    }\r\n  }\r\n\r\n  // Normaliza o papel/sistema de cargo para comparação e exibição\r\n  const normalizeRole = (role?: string) => (role ? role.toLowerCase() : \"\")\r\n\r\n  const getJobTitleName = (user: UserType): string => {\r\n    if (user.jobTitleId) {\r\n      const jobTitle = jobTitles.find((jt) => jt.id === user.jobTitleId)\r\n      if (jobTitle) return jobTitle.name\r\n    }\r\n    return getRoleLabel(user.role)\r\n  }\r\n\r\n  const getRoleIcon = (role: string) => {\r\n    const r = normalizeRole(role)\r\n    switch (r) {\r\n      case \"admin\":\r\n        return <Crown className=\"h-4 w-4 text-yellow-600\" />\r\n      case \"manager\":\r\n        return <Shield className=\"h-4 w-4 text-blue-600\" />\r\n      case \"supervisor\":\r\n        return <Network className=\"h-4 w-4 text-purple-600\" />\r\n      default:\r\n        return <Users className=\"h-4 w-4 text-gray-600\" />\r\n    }\r\n  }\r\n\r\n  const getRoleBadgeColor = (role: string) => {\r\n    const r = normalizeRole(role)\r\n    switch (r) {\r\n      case \"admin\":\r\n        return \"bg-yellow-100 text-yellow-800\"\r\n      case \"manager\":\r\n        return \"bg-blue-100 text-blue-800\"\r\n      case \"supervisor\":\r\n        return \"bg-purple-100 text-purple-800\"\r\n      default:\r\n        return \"bg-gray-100 text-gray-800\"\r\n    }\r\n  }\r\n\r\n  const getRoleLabel = (role: string) => {\r\n    const r = normalizeRole(role)\r\n    switch (r) {\r\n      case \"admin\":\r\n        return \"Administrador\"\r\n      case \"manager\":\r\n        return \"Gerente\"\r\n      case \"supervisor\":\r\n        return \"Supervisor\"\r\n      case \"employee\":\r\n        return \"Funcionário\"\r\n      default:\r\n        return role\r\n    }\r\n  }\r\n\r\n  const getTeamHierarchy = (userId: string): UserType[] => {\r\n    const user = users.find((u) => u.id === userId)\r\n    if (!user || !user.teamMembers) return []\r\n    return users.filter((u) => user.teamMembers?.includes(u.id))\r\n  }\r\n\r\n  const getSupervisor = (userId: string): UserType | undefined => {\r\n    const user = users.find((u) => u.id === userId)\r\n    if (!user || !user.supervisorId) return undefined\r\n    return users.find((u) => u.id === user.supervisorId)\r\n  }\r\n\r\n  const toggleModule = (moduleId: string) => {\r\n    setFormData((prev) => ({\r\n      ...prev,\r\n      modules: prev.modules.includes(moduleId)\r\n        ? prev.modules.filter((m) => m !== moduleId)\r\n        : [...prev.modules, moduleId],\r\n    }))\r\n  }\r\n\r\n  const toggleAllModules = (checked: boolean) => {\r\n    setFormData((prev) => ({\r\n      ...prev,\r\n      modules: checked ? AVAILABLE_MODULES.map((m) => m.id) : [],\r\n    }))\r\n  }\r\n\r\n  return (\r\n    <div className=\"space-y-6\">\r\n      {/* Header */}\r\n      <div className=\"flex flex-col md:flex-row md:justify-between md:items-center gap-4\">\r\n        <div>\r\n          <h1 className=\"text-3xl font-bold\">Gerenciamento de Usuários</h1>\r\n          <p className=\"text-muted-foreground\">Gerencie funcionários, cargos e hierarquia do sistema</p>\r\n        </div>\r\n        {currentUser && (\r\n          <div className=\"flex items-center gap-2 px-3 py-2 bg-gray-50 rounded-lg\">\r\n            <Avatar className=\"h-8 w-8\">\r\n              <AvatarFallback>{currentUser.name?.charAt(0) || \"U\"}</AvatarFallback>\r\n            </Avatar>\r\n            <div className=\"text-sm\">\r\n              <div className=\"font-medium\">{currentUser.name}</div>\r\n              <div className=\"text-muted-foreground text-xs\">{getRoleLabel(currentUser.role)}</div>\r\n            </div>\r\n            <Button variant=\"ghost\" size=\"sm\" onClick={handleLogout}>\r\n              <LogOut className=\"h-4 w-4\" />\r\n            </Button>\r\n          </div>\r\n        )}\r\n      </div>\r\n\r\n      <Tabs value={activeTab} onValueChange={setActiveTab} className=\"w-full\">\r\n        <TabsList className=\"grid grid-cols-3\">\r\n          <TabsTrigger value=\"users\">Usuários</TabsTrigger>\r\n          <TabsTrigger value=\"job-titles\">Cargos</TabsTrigger>\r\n          <TabsTrigger value=\"hierarchy\">Hierarquia</TabsTrigger>\r\n        </TabsList>\r\n\r\n        <TabsContent value=\"users\" className=\"space-y-6\">\r\n          {/* Stats Cards */}\r\n          <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\r\n            <Card>\r\n              <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\r\n                <CardTitle className=\"text-sm font-medium\">Total de Usuários</CardTitle>\r\n                <Users className=\"h-4 w-4 text-muted-foreground\" />\r\n              </CardHeader>\r\n              <CardContent>\r\n                <div className=\"text-2xl font-bold\">{users.length}</div>\r\n                <p className=\"text-xs text-muted-foreground\">\r\n                  {users.filter((u) => u.status === \"active\").length} ativos\r\n                </p>\r\n              </CardContent>\r\n            </Card>\r\n\r\n            <Card>\r\n              <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\r\n                <CardTitle className=\"text-sm font-medium\">Administradores</CardTitle>\r\n                <Crown className=\"h-4 w-4 text-yellow-600\" />\r\n              </CardHeader>\r\n              <CardContent>\r\n                <div className=\"text-2xl font-bold\">{users.filter((u) => normalizeRole(u.role) === \"admin\").length}</div>\r\n                <p className=\"text-xs text-muted-foreground\">Acesso total</p>\r\n              </CardContent>\r\n            </Card>\r\n\r\n            <Card>\r\n              <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\r\n                <CardTitle className=\"text-sm font-medium\">Gerentes</CardTitle>\r\n                <Shield className=\"h-4 w-4 text-blue-600\" />\r\n              </CardHeader>\r\n              <CardContent>\r\n                <div className=\"text-2xl font-bold\">{users.filter((u) => normalizeRole(u.role) === \"manager\").length}</div>\r\n                <p className=\"text-xs text-muted-foreground\">Gerenciam equipes</p>\r\n              </CardContent>\r\n            </Card>\r\n          </div>\r\n\r\n          {/* Lista de Usuários */}\r\n          <Card>\r\n            <CardHeader className=\"flex flex-row items-center justify-between\">\r\n              <CardTitle>Lista de Usuários</CardTitle>\r\n              <Button onClick={() => setIsAddUserOpen(true)}>\r\n                <UserPlus className=\"h-4 w-4 mr-2\" />\r\n                Adicionar Usuário\r\n              </Button>\r\n            </CardHeader>\r\n            <CardContent>\r\n              <div className=\"space-y-4\">\r\n                {users.map((user) => {\r\n                  const supervisor = getSupervisor(user.id)\r\n                  const teamMembers = getTeamHierarchy(user.id)\r\n\r\n                  return (\r\n                    <div\r\n                      key={user.id}\r\n                      className=\"flex flex-col md:flex-row md:items-center justify-between p-4 border rounded-lg gap-4\"\r\n                    >\r\n                      <div className=\"flex items-center gap-4 flex-1\">\r\n                        <Avatar>\r\n                          <AvatarFallback>{user.name?.charAt(0) || \"U\"}</AvatarFallback>\r\n                        </Avatar>\r\n                        <div className=\"flex-1 min-w-0\">\r\n                          <div className=\"flex items-center gap-2 flex-wrap\">\r\n                            <h3 className=\"font-medium\">{user.name}</h3>\r\n                            {currentUser?.id === user.id && <Badge variant=\"secondary\">Você</Badge>}\r\n                          </div>\r\n                          <div className=\"flex items-center gap-4 text-sm text-muted-foreground flex-wrap\">\r\n                            <div className=\"flex items-center gap-1\">\r\n                              <Mail className=\"h-3 w-3\" />\r\n                              <span className=\"truncate\">{user.email}</span>\r\n                            </div>\r\n                            {user.phone && (\r\n                              <div className=\"flex items-center gap-1\">\r\n                                <Phone className=\"h-3 w-3\" />\r\n                                <span>{user.phone}</span>\r\n                              </div>\r\n                            )}\r\n                            {user.department && <span>• {user.department}</span>}\r\n                            {user.position && <span>• {user.position}</span>}\r\n                          </div>\r\n                          {supervisor && (\r\n                            <div className=\"text-xs text-muted-foreground mt-1\">Reporta para: {supervisor.name}</div>\r\n                          )}\r\n                          {teamMembers.length > 0 && (\r\n                            <div className=\"text-xs text-muted-foreground mt-1\">\r\n                              Supervisiona: {teamMembers.length} pessoa(s)\r\n                            </div>\r\n                          )}\r\n                        </div>\r\n                      </div>\r\n                      <div className=\"flex items-center gap-2 flex-wrap\">\r\n                        <div className=\"flex items-center gap-1\">\r\n                          {getRoleIcon(user.role)}\r\n                          <Badge className={getRoleBadgeColor(user.role)}>{getJobTitleName(user)}</Badge>\r\n                        </div>\r\n                        <Badge variant={user.status === \"active\" ? \"default\" : \"secondary\"}>\r\n                          {user.status === \"active\" ? \"Ativo\" : \"Inativo\"}\r\n                        </Badge>\r\n                        <div className=\"flex items-center gap-1\">\r\n                          <Button variant=\"ghost\" size=\"sm\" onClick={() => handleEditUser(user)}>\r\n                            <Edit className=\"h-4 w-4\" />\r\n                          </Button>\r\n                          {currentUser?.id !== user.id && (\r\n                            <Button variant=\"ghost\" size=\"sm\" onClick={() => handleDeleteUser(user.id)}>\r\n                              <Trash2 className=\"h-4 w-4\" />\r\n                            </Button>\r\n                          )}\r\n                        </div>\r\n                      </div>\r\n                    </div>\r\n                  )\r\n                })}\r\n              </div>\r\n            </CardContent>\r\n          </Card>\r\n        </TabsContent>\r\n\r\n        <TabsContent value=\"job-titles\" className=\"space-y-6\">\r\n          <Card>\r\n            <CardHeader className=\"flex flex-row items-center justify-between\">\r\n              <div>\r\n                <CardTitle>Gerenciar Cargos</CardTitle>\r\n                <p className=\"text-sm text-muted-foreground mt-1\">\r\n                  Crie todos os cargos personalizados que sua empresa precisa\r\n                </p>\r\n              </div>\r\n              <Button onClick={() => setIsAddJobTitleOpen(true)}>\r\n                <Plus className=\"h-4 w-4 mr-2\" />\r\n                Adicionar Cargo\r\n              </Button>\r\n            </CardHeader>\r\n            <CardContent>\r\n              {jobTitles.length === 0 ? (\r\n                <div className=\"text-center py-12\">\r\n                  <Briefcase className=\"h-12 w-12 text-muted-foreground mx-auto mb-4\" />\r\n                  <h3 className=\"text-lg font-medium mb-2\">Nenhum cargo cadastrado</h3>\r\n                  <p className=\"text-sm text-muted-foreground mb-4\">Comece criando os cargos que sua empresa utiliza</p>\r\n                  <Button onClick={() => setIsAddJobTitleOpen(true)}>\r\n                    <Plus className=\"h-4 w-4 mr-2\" />\r\n                    Criar Primeiro Cargo\r\n                  </Button>\r\n                </div>\r\n              ) : (\r\n                <div className=\"space-y-4\">\r\n                  {jobTitles.map((jobTitle) => (\r\n                    <div key={jobTitle.id} className=\"flex items-center justify-between p-4 border rounded-lg\">\r\n                      <div className=\"flex items-center gap-4\">\r\n                        <Briefcase className=\"h-5 w-5 text-muted-foreground\" />\r\n                        <div>\r\n                          <div className=\"flex items-center gap-2\">\r\n                            <h3 className=\"font-medium\">{jobTitle.name}</h3>\r\n                          </div>\r\n                          <p className=\"text-sm text-muted-foreground\">\r\n                            Nível de permissão: {getRoleLabel(jobTitle.systemRole)}\r\n                          </p>\r\n                        </div>\r\n                      </div>\r\n                      <div className=\"flex items-center gap-2\">\r\n                        <Button variant=\"ghost\" size=\"sm\" onClick={() => handleEditJobTitle(jobTitle)}>\r\n                          <Edit className=\"h-4 w-4\" />\r\n                        </Button>\r\n                        <Button variant=\"ghost\" size=\"sm\" onClick={() => handleDeleteJobTitle(jobTitle.id)}>\r\n                          <Trash2 className=\"h-4 w-4\" />\r\n                        </Button>\r\n                      </div>\r\n                    </div>\r\n                  ))}\r\n                </div>\r\n              )}\r\n            </CardContent>\r\n          </Card>\r\n        </TabsContent>\r\n\r\n        <TabsContent value=\"hierarchy\" className=\"space-y-6\">\r\n          <Card>\r\n            <CardHeader>\r\n              <CardTitle>Hierarquia Organizacional</CardTitle>\r\n              <p className=\"text-muted-foreground\">Visualize a estrutura hierárquica da equipe</p>\r\n            </CardHeader>\r\n            <CardContent>\r\n              <div className=\"space-y-6\">\r\n                {users\r\n                  .filter((u) => !u.supervisorId)\r\n                  .map((topUser) => (\r\n                    <div key={topUser.id} className=\"space-y-2\">\r\n                      <div className=\"flex items-center space-x-3 p-3 bg-gray-50 rounded-lg\">\r\n                        <Avatar>\r\n                          <AvatarFallback>{topUser.name?.charAt(0) || \"U\"}</AvatarFallback>\r\n                        </Avatar>\r\n                        <div className=\"flex-1\">\r\n                          <div className=\"flex items-center space-x-2\">\r\n                            <span className=\"font-medium\">{topUser.name}</span>\r\n                            {getRoleIcon(topUser.role)}\r\n                            <Badge className={getRoleBadgeColor(topUser.role)}>{getRoleLabel(topUser.role)}</Badge>\r\n                          </div>\r\n                          <div className=\"text-sm text-muted-foreground\">\r\n                            {topUser.department && `${topUser.department} • `}\r\n                            {topUser.position || topUser.email}\r\n                          </div>\r\n                        </div>\r\n                      </div>\r\n\r\n                      {/* Team Members */}\r\n                      {getTeamHierarchy(topUser.id).length > 0 && (\r\n                        <div className=\"ml-8 space-y-2 border-l-2 border-gray-200 pl-4\">\r\n                          {getTeamHierarchy(topUser.id).map((member) => (\r\n                            <div key={member.id}>\r\n                              <div className=\"flex items-center space-x-3 p-2 bg-white rounded-lg border\">\r\n                                <Avatar className=\"h-8 w-8\">\r\n                                  <AvatarFallback>{member.name?.charAt(0) || \"U\"}</AvatarFallback>\r\n                                </Avatar>\r\n                                <div className=\"flex-1\">\r\n                                  <div className=\"flex items-center space-x-2\">\r\n                                    <span className=\"text-sm font-medium\">{member.name}</span>\r\n                                    {getRoleIcon(member.role)}\r\n                                    <Badge className={getRoleBadgeColor(member.role)} variant=\"outline\">\r\n                                      {getRoleLabel(member.role)}\r\n                                    </Badge>\r\n                                  </div>\r\n                                  <div className=\"text-xs text-muted-foreground\">\r\n                                    {member.department && `${member.department} • `}\r\n                                    {member.position || member.email}\r\n                                  </div>\r\n                                </div>\r\n                              </div>\r\n\r\n                              {/* Sub-team members */}\r\n                              {getTeamHierarchy(member.id).length > 0 && (\r\n                                <div className=\"ml-8 mt-2 space-y-2 border-l-2 border-gray-200 pl-4\">\r\n                                  {getTeamHierarchy(member.id).map((subMember) => (\r\n                                    <div\r\n                                      key={subMember.id}\r\n                                      className=\"flex items-center space-x-3 p-2 bg-white rounded-lg border\"\r\n                                    >\r\n                                      <Avatar className=\"h-6 w-6\">\r\n                                        <AvatarFallback className=\"text-xs\">\r\n                                          {subMember.name?.charAt(0) || \"U\"}\r\n                                        </AvatarFallback>\r\n                                      </Avatar>\r\n                                      <div className=\"flex-1\">\r\n                                        <div className=\"flex items-center space-x-2\">\r\n                                          <span className=\"text-xs font-medium\">{subMember.name}</span>\r\n                                          <Badge className={getRoleBadgeColor(subMember.role)} variant=\"outline\">\r\n                                            {getRoleLabel(subMember.role)}\r\n                                          </Badge>\r\n                                        </div>\r\n                                        <div className=\"text-xs text-muted-foreground\">\r\n                                          {subMember.position || subMember.email}\r\n                                        </div>\r\n                                      </div>\r\n                                    </div>\r\n                                  ))}\r\n                                </div>\r\n                              )}\r\n                            </div>\r\n                          ))}\r\n                        </div>\r\n                      )}\r\n                    </div>\r\n                  ))}\r\n              </div>\r\n            </CardContent>\r\n          </Card>\r\n        </TabsContent>\r\n\r\n        {/* <TabsContent value=\"login\" className=\"space-y-6\">\r\n          <Card>\r\n            <CardHeader>\r\n              <CardTitle>Trocar de Usuário</CardTitle>\r\n              <p className=\"text-muted-foreground\">Selecione um usuário para fazer login no sistema</p>\r\n            </CardHeader>\r\n            <CardContent>\r\n              <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\r\n                {users.map((user) => (\r\n                  <Card\r\n                    key={user.id}\r\n                    className={`cursor-pointer transition-colors ${\r\n                      currentUser?.id === user.id ? \"border-blue-500 bg-blue-50\" : \"hover:bg-gray-50\"\r\n                    }`}\r\n                    onClick={() => handleSwitchUser(user)}\r\n                  >\r\n                    <CardContent className=\"p-4\">\r\n                      <div className=\"flex items-center space-x-3\">\r\n                        <Avatar>\r\n                          <AvatarFallback>{user.name?.charAt(0) || \"U\"}</AvatarFallback>\r\n                        </Avatar>\r\n                        <div className=\"flex-1\">\r\n                          <div className=\"flex items-center space-x-2\">\r\n                            <h3 className=\"font-medium\">{user.name}</h3>\r\n                            {currentUser?.id === user.id && <Badge variant=\"secondary\">Ativo</Badge>}\r\n                          </div>\r\n                          <p className=\"text-sm text-muted-foreground\">{user.email}</p>\r\n                          <div className=\"flex items-center space-x-1 mt-1\">\r\n                            {getRoleIcon(user.role)}\r\n                            <span className=\"text-xs text-muted-foreground\">\r\n                              {user.role === \"admin\"\r\n                                ? \"Administrador\"\r\n                                : user.role === \"manager\"\r\n                                  ? \"Gerente\"\r\n                                  : user.role === \"supervisor\"\r\n                                    ? \"Supervisor\"\r\n                                    : \"Funcionário\"}\r\n                            </span>\r\n                          </div>\r\n                        </div>\r\n                      </div>\r\n                    </CardContent>\r\n                  </Card>\r\n                ))}\r\n              </div>\r\n            </CardContent>\r\n          </Card>\r\n        </TabsContent> */}\r\n      </Tabs>\r\n\r\n      <Dialog open={isAddUserOpen} onOpenChange={setIsAddUserOpen}>\r\n        <DialogContent className=\"max-w-2xl max-h-[90vh] overflow-y-auto\">\r\n          <DialogHeader>\r\n            <DialogTitle>{editingUser ? \"Editar Usuário\" : \"Adicionar Novo Usuário\"}</DialogTitle>\r\n          </DialogHeader>\r\n          <div className=\"space-y-6\">\r\n            {/* Basic Information */}\r\n            <div className=\"space-y-4\">\r\n              <h3 className=\"font-medium\">Informações Básicas</h3>\r\n              <div className=\"grid grid-cols-2 gap-4\">\r\n                <div>\r\n                  <Label htmlFor=\"name\">Nome Completo</Label>\r\n                  <Input\r\n                    id=\"name\"\r\n                    value={formData.name}\r\n                    onChange={(e) => setFormData({ ...formData, name: e.target.value })}\r\n                    placeholder=\"Nome completo\"\r\n                  />\r\n                </div>\r\n                <div>\r\n                  <Label htmlFor=\"email\">Email</Label>\r\n                  <Input\r\n                    id=\"email\"\r\n                    type=\"email\"\r\n                    value={formData.email}\r\n                    onChange={(e) => setFormData({ ...formData, email: e.target.value })}\r\n                    placeholder=\"email@empresa.com\"\r\n                  />\r\n                </div>\r\n                <div>\r\n                  <Label htmlFor=\"company\">Empresa</Label>\r\n                  <Select value={formData.companyId} onValueChange={(val) => setFormData({ ...formData, companyId: val })}>\r\n                    <SelectTrigger>\r\n                      <SelectValue placeholder=\"Selecione uma empresa\" />\r\n                    </SelectTrigger>\r\n                    <SelectContent>\r\n                      {companies.map((c) => (\r\n                        <SelectItem key={c.id} value={c.id}>\r\n                          {c.name}\r\n                        </SelectItem>\r\n                      ))}\r\n                    </SelectContent>\r\n                  </Select>\r\n                </div>\r\n                <div>\r\n                  <Label htmlFor=\"password\">Senha {editingUser && \"(deixe em branco para manter)\"}</Label>\r\n                  <div className=\"relative\">\r\n                    <Input\r\n                      id=\"password\"\r\n                      type={showPassword ? \"text\" : \"password\"}\r\n                      value={formData.password}\r\n                      onChange={(e) => setFormData({ ...formData, password: e.target.value })}\r\n                      placeholder=\"Mínimo 6 caracteres\"\r\n                    />\r\n                    <Button\r\n                      type=\"button\"\r\n                      variant=\"ghost\"\r\n                      size=\"sm\"\r\n                      className=\"absolute right-0 top-0 h-full px-3\"\r\n                      onClick={() => setShowPassword(!showPassword)}\r\n                    >\r\n                      {showPassword ? <EyeOff className=\"h-4 w-4\" /> : <Eye className=\"h-4 w-4\" />}\r\n                    </Button>\r\n                  </div>\r\n                </div>\r\n                <div>\r\n                  <Label htmlFor=\"confirmPassword\">Confirmar Senha</Label>\r\n                  <div className=\"relative\">\r\n                    <Input\r\n                      id=\"confirmPassword\"\r\n                      type={showConfirmPassword ? \"text\" : \"password\"}\r\n                      value={formData.confirmPassword}\r\n                      onChange={(e) => setFormData({ ...formData, confirmPassword: e.target.value })}\r\n                      placeholder=\"Repita a senha\"\r\n                    />\r\n                    <Button\r\n                      type=\"button\"\r\n                      variant=\"ghost\"\r\n                      size=\"sm\"\r\n                      className=\"absolute right-0 top-0 h-full px-3\"\r\n                      onClick={() => setShowConfirmPassword(!showConfirmPassword)}\r\n                    >\r\n                      {showConfirmPassword ? <EyeOff className=\"h-4 w-4\" /> : <Eye className=\"h-4 w-4\" />}\r\n                    </Button>\r\n                  </div>\r\n                </div>\r\n                <div>\r\n                  <Label htmlFor=\"phone\">Telefone</Label>\r\n                  <Input\r\n                    id=\"phone\"\r\n                    value={formData.phone}\r\n                    onChange={(e) => setFormData({ ...formData, phone: e.target.value })}\r\n                    placeholder=\"(11) 99999-9999\"\r\n                  />\r\n                </div>\r\n                <div>\r\n                  <Label htmlFor=\"jobTitle\">Cargo/Função</Label>\r\n                  <Select value={formData.jobTitleId} onValueChange={handleJobTitleChange}>\r\n                    <SelectTrigger>\r\n                      <SelectValue placeholder=\"Selecione um cargo\" />\r\n                    </SelectTrigger>\r\n                    <SelectContent>\r\n                      {jobTitles.map((jobTitle) => (\r\n                        <SelectItem key={jobTitle.id} value={jobTitle.id}>\r\n                          {jobTitle.name} ({getRoleLabel(jobTitle.systemRole)})\r\n                        </SelectItem>\r\n                      ))}\r\n                    </SelectContent>\r\n                  </Select>\r\n                  <p className=\"text-xs text-muted-foreground mt-1\">\r\n                    O nível de permissão é definido pelo cargo selecionado\r\n                  </p>\r\n                </div>\r\n                <div>\r\n                  <Label htmlFor=\"department\">Departamento</Label>\r\n                  <Input\r\n                    id=\"department\"\r\n                    value={formData.department}\r\n                    onChange={(e) => setFormData({ ...formData, department: e.target.value })}\r\n                    placeholder=\"Ex: Vendas, Marketing\"\r\n                  />\r\n                </div>\r\n                <div>\r\n                  <Label htmlFor=\"position\">Posição</Label>\r\n                  <Input\r\n                    id=\"position\"\r\n                    value={formData.position}\r\n                    onChange={(e) => setFormData({ ...formData, position: e.target.value })}\r\n                    placeholder=\"Ex: Júnior, Pleno, Sênior\"\r\n                  />\r\n                </div>\r\n              </div>\r\n            </div>\r\n\r\n            <Separator />\r\n\r\n            {/* Hierarchy */}\r\n            <div className=\"space-y-4\">\r\n              <h3 className=\"font-medium\">Hierarquia</h3>\r\n              <div>\r\n                <Label htmlFor=\"supervisor\">Supervisor/Gerente</Label>\r\n                <Select\r\n                  value={formData.supervisorId}\r\n                  onValueChange={(value) => setFormData({ ...formData, supervisorId: value })}\r\n                >\r\n                  <SelectTrigger>\r\n                    <SelectValue placeholder=\"Selecione um supervisor (opcional)\" />\r\n                  </SelectTrigger>\r\n                  <SelectContent>\r\n                    <SelectItem value=\"none\">Nenhum</SelectItem>\r\n                    {users\r\n                      .filter(\r\n                        (u) =>\r\n                          (u.role === \"manager\" || u.role === \"supervisor\" || u.role === \"admin\") &&\r\n                          u.id !== editingUser?.id,\r\n                      )\r\n                      .map((user) => (\r\n                        <SelectItem key={user.id} value={user.id}>\r\n                          {user.name} ({getRoleLabel(user.role)})\r\n                        </SelectItem>\r\n                      ))}\r\n                  </SelectContent>\r\n                </Select>\r\n                <p className=\"text-xs text-muted-foreground mt-1\">\r\n                  Define quem supervisiona este usuário na hierarquia\r\n                </p>\r\n              </div>\r\n            </div>\r\n\r\n            <Separator />\r\n\r\n            <div className=\"space-y-4\">\r\n              <div className=\"flex items-center justify-between\">\r\n                <h3 className=\"font-medium\">Permissões de Acesso</h3>\r\n                <div className=\"flex items-center space-x-2\">\r\n                  <Checkbox\r\n                    id=\"select-all\"\r\n                    checked={formData.modules.length === AVAILABLE_MODULES.length}\r\n                    onCheckedChange={toggleAllModules}\r\n                  />\r\n                  <Label htmlFor=\"select-all\" className=\"text-sm cursor-pointer\">\r\n                    Selecionar todos\r\n                  </Label>\r\n                </div>\r\n              </div>\r\n              <p className=\"text-sm text-muted-foreground\">Selecione quais módulos o usuário pode acessar</p>\r\n              <div className=\"grid grid-cols-1 gap-3\">\r\n                {AVAILABLE_MODULES.map((module) => (\r\n                  <div key={module.id} className=\"flex items-center space-x-3 p-3 border rounded-lg\">\r\n                    <Checkbox\r\n                      id={module.id}\r\n                      checked={formData.modules.includes(module.id)}\r\n                      onCheckedChange={() => toggleModule(module.id)}\r\n                    />\r\n                    <Label htmlFor={module.id} className=\"flex-1 cursor-pointer font-normal\">\r\n                      {module.name}\r\n                    </Label>\r\n                  </div>\r\n                ))}\r\n              </div>\r\n            </div>\r\n\r\n            <div className=\"flex justify-end space-x-2\">\r\n              <Button variant=\"outline\" onClick={resetForm}>\r\n                Cancelar\r\n              </Button>\r\n              <Button onClick={editingUser ? handleUpdateUser : handleAddUser}>\r\n                {editingUser ? \"Atualizar\" : \"Adicionar\"}\r\n              </Button>\r\n            </div>\r\n          </div>\r\n        </DialogContent>\r\n      </Dialog>\r\n\r\n      <Dialog open={isAddJobTitleOpen} onOpenChange={setIsAddJobTitleOpen}>\r\n        <DialogContent>\r\n          <DialogHeader>\r\n            <DialogTitle>{editingJobTitle ? \"Editar Cargo\" : \"Adicionar Novo Cargo\"}</DialogTitle>\r\n          </DialogHeader>\r\n          <div className=\"space-y-4\">\r\n            <div>\r\n              <Label htmlFor=\"jobTitleName\">Nome do Cargo</Label>\r\n              <Input\r\n                id=\"jobTitleName\"\r\n                value={jobTitleForm.name}\r\n                onChange={(e) => setJobTitleForm({ ...jobTitleForm, name: e.target.value })}\r\n                placeholder=\"Ex: Analista de Vendas, Coordenador\"\r\n              />\r\n            </div>\r\n            <div>\r\n              <Label htmlFor=\"systemRole\">Nível de Permissão</Label>\r\n              <Select\r\n                value={jobTitleForm.systemRole}\r\n                onValueChange={(value: \"admin\" | \"manager\" | \"supervisor\" | \"employee\") =>\r\n                  setJobTitleForm({ ...jobTitleForm, systemRole: value })\r\n                }\r\n              >\r\n                <SelectTrigger>\r\n                  <SelectValue />\r\n                </SelectTrigger>\r\n                <SelectContent>\r\n                  <SelectItem value=\"employee\">Funcionário (Básico)</SelectItem>\r\n                  <SelectItem value=\"supervisor\">Supervisor (Intermediário)</SelectItem>\r\n                  <SelectItem value=\"manager\">Gerente (Avançado)</SelectItem>\r\n                  <SelectItem value=\"admin\">Administrador (Total)</SelectItem>\r\n                </SelectContent>\r\n              </Select>\r\n              <p className=\"text-xs text-muted-foreground mt-1\">\r\n                Define as permissões que usuários com este cargo terão no sistema\r\n              </p>\r\n              <div className=\"flex items-center gap-2 mt-2\">\r\n                {getRoleIcon(jobTitleForm.systemRole)}\r\n                <Badge className={getRoleBadgeColor(jobTitleForm.systemRole)}>\r\n                  {getRoleLabel(jobTitleForm.systemRole)}\r\n                </Badge>\r\n              </div>\r\n            </div>\r\n            <div className=\"flex items-start space-x-3 p-3 border rounded-lg\">\r\n              <Checkbox\r\n                id=\"canViewSameRoleData\"\r\n                checked={jobTitleForm.canViewSameRoleData}\r\n                onCheckedChange={(checked) =>\r\n                  setJobTitleForm({ ...jobTitleForm, canViewSameRoleData: checked as boolean })\r\n                }\r\n              />\r\n              <div className=\"flex-1\">\r\n                <Label htmlFor=\"canViewSameRoleData\" className=\"cursor-pointer font-medium\">\r\n                  Compartilhar dados entre usuários do mesmo cargo\r\n                </Label>\r\n                <p className=\"text-xs text-muted-foreground mt-1\">\r\n                  Quando ativado, usuários com este cargo poderão visualizar leads e atendimentos uns dos outros.\r\n                  Usuários em cargos superiores na hierarquia sempre terão acesso aos dados de cargos abaixo.\r\n                </p>\r\n              </div>\r\n            </div>\r\n            <div className=\"flex justify-end space-x-2\">\r\n              <Button variant=\"outline\" onClick={resetJobTitleForm}>\r\n                Cancelar\r\n              </Button>\r\n              <Button onClick={editingJobTitle ? handleUpdateJobTitle : handleAddJobTitle}>\r\n                {editingJobTitle ? \"Atualizar\" : \"Adicionar\"}\r\n              </Button>\r\n            </div>\r\n          </div>\r\n        </DialogContent>\r\n      </Dialog>\r\n    </div>\r\n  )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Projetos\\Back_endCrm\\kanbanproject1\\components\\whatsapp-config.tsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'isCreatingInstance' is assigned a value but never used.","line":42,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":42,"endColumn":28,"suggestions":[{"messageId":"removeVar","data":{"varName":"isCreatingInstance"},"fix":{"range":[1818,1836],"text":""},"desc":"Remove unused variable 'isCreatingInstance'."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'isCreatingInstance' is assigned a value but never used.","line":42,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":42,"endColumn":28},{"ruleId":"no-unused-vars","severity":1,"message":"'setIsCreatingInstance' is assigned a value but never used.","line":42,"column":30,"nodeType":"Identifier","messageId":"unusedVar","endLine":42,"endColumn":51,"suggestions":[{"messageId":"removeVar","data":{"varName":"setIsCreatingInstance"},"fix":{"range":[1836,1859],"text":""},"desc":"Remove unused variable 'setIsCreatingInstance'."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'setIsCreatingInstance' is assigned a value but never used.","line":42,"column":30,"nodeType":null,"messageId":"unusedVar","endLine":42,"endColumn":51},{"ruleId":"no-unused-vars","severity":1,"message":"'createError' is assigned a value but never used.","line":43,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":43,"endColumn":21,"suggestions":[{"messageId":"removeVar","data":{"varName":"createError"},"fix":{"range":[1889,1900],"text":""},"desc":"Remove unused variable 'createError'."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'createError' is assigned a value but never used.","line":43,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":43,"endColumn":21},{"ruleId":"no-unused-vars","severity":1,"message":"'setCreateError' is assigned a value but never used.","line":43,"column":23,"nodeType":"Identifier","messageId":"unusedVar","endLine":43,"endColumn":37,"suggestions":[{"messageId":"removeVar","data":{"varName":"setCreateError"},"fix":{"range":[1900,1916],"text":""},"desc":"Remove unused variable 'setCreateError'."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'setCreateError' is assigned a value but never used.","line":43,"column":23,"nodeType":null,"messageId":"unusedVar","endLine":43,"endColumn":37},{"ruleId":"no-unused-vars","severity":1,"message":"'createSuccess' is assigned a value but never used.","line":44,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":44,"endColumn":23,"suggestions":[{"messageId":"removeVar","data":{"varName":"createSuccess"},"fix":{"range":[1960,1973],"text":""},"desc":"Remove unused variable 'createSuccess'."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'createSuccess' is assigned a value but never used.","line":44,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":44,"endColumn":23},{"ruleId":"no-unused-vars","severity":1,"message":"'setCreateSuccess' is assigned a value but never used.","line":44,"column":25,"nodeType":"Identifier","messageId":"unusedVar","endLine":44,"endColumn":41,"suggestions":[{"messageId":"removeVar","data":{"varName":"setCreateSuccess"},"fix":{"range":[1973,1991],"text":""},"desc":"Remove unused variable 'setCreateSuccess'."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'setCreateSuccess' is assigned a value but never used.","line":44,"column":25,"nodeType":null,"messageId":"unusedVar","endLine":44,"endColumn":41},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has missing dependencies: 'defaultBase' and 'defaultWebhook'. Either include them or remove the dependency array.","line":98,"column":6,"nodeType":"ArrayExpression","endLine":98,"endColumn":8,"suggestions":[{"desc":"Update the dependencies array to be: [defaultBase, defaultWebhook]","fix":{"range":[4447,4449],"text":"[defaultBase, defaultWebhook]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":13,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\"\r\n\r\nimport { useState, useEffect } from \"react\"\r\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from \"@/components/ui/dialog\"\r\nimport { Button } from \"@/components/ui/button\"\r\nimport { Input } from \"@/components/ui/input\"\r\nimport { Label } from \"@/components/ui/label\"\r\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\"\r\nimport { Textarea } from \"@/components/ui/textarea\"\r\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\"\r\nimport { Badge } from \"@/components/ui/badge\"\r\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\"\r\nimport { MessageSquare, Settings, Zap, CheckCircle, XCircle, AlertCircle } from \"lucide-react\"\r\nimport { type WhatsAppAPIConfig, type ZApiConfig, whatsappService } from \"@/lib/whatsapp-api\"\r\nimport { API_BASE_URL } from \"@/lib/api-client\"\r\nimport { apiClient } from \"@/lib/api-client\"\r\nconst LOCAL_KEY = \"unicrm_whatsapp_config\"\r\n\r\ntype WhatsAppConfigProps = {\r\n  onClose: () => void\r\n}\r\n\r\ntype ConfigState = WhatsAppAPIConfig & Partial<ZApiConfig>\r\n\r\nexport default function WhatsAppConfig({ onClose }: WhatsAppConfigProps) {\r\n  const defaultBase = `${API_BASE_URL}/whatsapp`\r\n  const defaultWebhook = `${API_BASE_URL}/whatsapp/webhook`\r\n  const ZAPI_BASE = \"https://api.z-api.io\"\r\n\r\n  const [config, setConfig] = useState<WhatsAppAPIConfig>({\r\n    provider: \"custom\",\r\n    apiKey: \"\",\r\n    webhookUrl: defaultWebhook,\r\n    customEndpoint: defaultBase,\r\n    customHeaders: {},\r\n  })\r\n\r\n  const [isConnected, setIsConnected] = useState(false)\r\n  const [isConnecting, setIsConnecting] = useState(false)\r\n  const [connectionError, setConnectionError] = useState<string | null>(null)\r\n  const [customHeadersText, setCustomHeadersText] = useState(\"\")\r\n  const [isCreatingInstance, setIsCreatingInstance] = useState(false)\r\n  const [createError, setCreateError] = useState<string | null>(null)\r\n  const [createSuccess, setCreateSuccess] = useState<string | null>(null)\r\nconst [qrCode, setQrCode] = useState<string | null>(null)\r\nconst [isGeneratingQr, setIsGeneratingQr] = useState(false)\r\nconst [statusDetails, setStatusDetails] = useState<any | null>(null)\r\nconst [instanceUrlInput, setInstanceUrlInput] = useState(\"\")\r\nconst [connectedFlag, setConnectedFlag] = useState(false)\r\n\r\n  // Extrai instanceId e token quando o usuário cola a URL completa da instância Z-API\r\n  const parseZapiInstanceUrl = (raw?: string) => {\r\n    if (!raw) return null\r\n    const text = raw.trim()\r\n    const re = /^https?:\\/\\/[^/]+\\/instances\\/([^/]+)\\/token\\/([^/?#]+)\\/?$/i\r\n    const match = text.match(re)\r\n    if (!match) return null\r\n    return { instanceId: match[1], instanceToken: match[2] }\r\n  }\r\n\r\n  useEffect(() => {\r\n    // Load saved configuration from backend per tenant\r\n    ;(async () => {\r\n      try {\r\n        const safe = await apiClient.get<any>(\"/whatsapp/config\")\r\n        if (safe) {\r\n          const mapped: ConfigState = {\r\n            provider: (safe.provider as any) || \"custom\",\r\n            apiKey: \"\", // not returned by backend (encrypted), keep empty\r\n            webhookUrl: safe.webhookUrl || defaultWebhook,\r\n            customEndpoint: safe.baseUrl || defaultBase,\r\n            clientId: safe.clientId || undefined,\r\n            instanceId: safe.instanceId || undefined,\r\n          }\r\n          setCustomHeadersText(JSON.stringify({}, null, 2))\r\n          const raw = typeof window !== \"undefined\" ? localStorage.getItem(LOCAL_KEY) : null\r\n          const local = raw ? JSON.parse(raw) : null\r\n          const merged = {\r\n            ...mapped,\r\n            apiKey: local?.apiKey || mapped.apiKey,\r\n            instanceToken: local?.instanceToken || undefined,\r\n            webhookUrl: local?.webhookUrl || mapped.webhookUrl,\r\n            customEndpoint: local?.customEndpoint || mapped.customEndpoint,\r\n            clientId: local?.clientId || mapped.clientId,\r\n            instanceId: local?.instanceId || mapped.instanceId,\r\n          }\r\n          if (typeof window !== \"undefined\") {\r\n            localStorage.setItem(LOCAL_KEY, JSON.stringify(merged))\r\n          }\r\n          // Ensure UI fields reflect merged values (including secrets from local storage)\r\n          setConfig(merged)\r\n          setConnectedFlag(Boolean(safe.connected))\r\n        }\r\n      } catch (error) {\r\n        console.error(\"[v0] Error loading backend config:\", error)\r\n      }\r\n    })()\r\n  }, [])\r\n\r\n  const saveConfig = async () => {\r\n    try {\r\n      // Normalização para Z-API: garantir base raiz e extrair ID/Token se necessário\r\n      let baseUrl = config.customEndpoint || ZAPI_BASE\r\n      if (config.provider === \"z-api\") {\r\n        const parsedFromBase = parseZapiInstanceUrl(instanceUrlInput || baseUrl)\r\n        if (parsedFromBase) {\r\n          baseUrl = ZAPI_BASE\r\n          setConfig({\r\n            ...config,\r\n            provider: \"z-api\" as const,\r\n            customEndpoint: ZAPI_BASE,\r\n            instanceId: parsedFromBase.instanceId,\r\n            instanceToken: parsedFromBase.instanceToken,\r\n          } as ZApiConfig)\r\n        } else if (/\\/instances\\//i.test(baseUrl) || /\\/token\\//i.test(baseUrl) || /\\/api\\/whatsapp/i.test(baseUrl)) {\r\n          // Avisa usuário e corrige automaticamente\r\n          alert(\"A URL Base da Z-API deve ser apenas https://api.z-api.io. Corrigi automaticamente.\")\r\n          baseUrl = ZAPI_BASE\r\n        }\r\n\r\n        // Validação obrigatória quando usando domínio remoto (dev.uniconnectcrm.com.br)\r\n        const isRemoteDev = API_BASE_URL.startsWith(\"https://dev.uniconnectcrm.com.br\")\r\n        const parsedFromInput = parseZapiInstanceUrl(instanceUrlInput || \"\")\r\n        const finalInstanceId = (config as any).instanceId || parsedFromInput?.instanceId || \"\"\r\n        const finalInstanceToken = (config as any).instanceToken || parsedFromInput?.instanceToken || \"\"\r\n        if (isRemoteDev && (finalInstanceId.trim() === \"\" || finalInstanceToken.trim() === \"\")) {\r\n          alert(\"Para salvar no domínio dev.uniconnectcrm.com.br, informe 'instanceId' e 'instanceToken' da Z-API (cole a URL completa da instância).\")\r\n          return\r\n        }\r\n      }\r\n      const body = {\r\n        connected: Boolean(connectedFlag),\r\n        baseUrl,\r\n        instanceId: (config as any).instanceId || parseZapiInstanceUrl(instanceUrlInput || \"\")?.instanceId || \"\",\r\n        token: (config as any).instanceToken || parseZapiInstanceUrl(instanceUrlInput || \"\")?.instanceToken || \"\",\r\n        apiKey: config.apiKey || \"\",\r\n        webhookUrl: config.webhookUrl || defaultWebhook,\r\n      }\r\n      if (!body.baseUrl || !body.instanceId || !body.token || !body.webhookUrl) {\r\n        alert(\"Preencha baseUrl, instanceId, token e webhookUrl.\")\r\n        return\r\n      }\r\n      await apiClient.post(\"/whatsapp/config\", body)\r\n      console.log(\"[v0] WhatsApp configuration saved to backend\")\r\n      alert(\"Configuração salva com sucesso.\")\r\n\r\n      // Persist minimal usable config to local storage for front-end provider\r\n      setConnectedFlag(Boolean(body.connected))\r\n    } catch (error) {\r\n      console.error(\"[v0] Error saving backend config:\", error)\r\n      alert(\"Erro ao salvar configuração no servidor.\")\r\n      return\r\n    }\r\n  }\r\n\r\n  const testConnection = async () => {\r\n    setIsConnecting(true)\r\n    setConnectionError(null)\r\n    setQrCode(null)\r\n\r\n    try {\r\n      const status = await apiClient.get<any>(\"/whatsapp/status\")\r\n      setIsConnected(Boolean(status?.connected))\r\n      // Sempre exibir o objeto completo para diagnóstico, mesmo sem \"details\"\r\n      setStatusDetails(status?.details ?? status ?? null)\r\n      if (!status?.connected && status?.requiresInstance) {\r\n        setConnectionError(\"Instância não configurada. Crie a instância e gere o QR.\")\r\n      } else if (!status?.connected && status?.details) {\r\n        setConnectionError(\"Desconectado. Gere o QR para conectar.\")\r\n      }\r\n      console.log(\"[v0] Status:\", status)\r\n    } catch (error: any) {\r\n      setConnectionError(error?.message || \"Erro ao verificar status.\")\r\n      // Exibir o conteúdo retornado do erro para diagnóstico\r\n      setStatusDetails(error?.data || { error: error?.message || \"unknown\" })\r\n      setIsConnected(false)\r\n    } finally {\r\n      setIsConnecting(false)\r\n    }\r\n  }\r\n\r\n  const disconnect = async () => {\r\n    try {\r\n      await whatsappService.disconnect()\r\n      setIsConnected(false)\r\n      console.log(\"[v0] WhatsApp disconnected\")\r\n    } catch (error) {\r\n      console.error(\"[v0] Error disconnecting:\", error)\r\n    }\r\n  }\r\n\r\n  const getProviderDescription = (provider: string) => {\r\n    const descriptions = {\r\n      \"z-api\": \"Z-Api - Integração oficial com WhatsApp Business\",\r\n      \"whatsapp-web-js\": \"Biblioteca JavaScript para WhatsApp Web\",\r\n      baileys: \"Biblioteca TypeScript para WhatsApp Business API\",\r\n      twilio: \"API do Twilio para WhatsApp Business\",\r\n      \"meta-business\": \"Meta Business API (WhatsApp Business)\",\r\n      custom: \"API personalizada ou webhook customizado\",\r\n    }\r\n    return descriptions[provider as keyof typeof descriptions] || \"Provedor personalizado\"\r\n  }\r\n\r\n  return (\r\n    <Dialog open={true} onOpenChange={(open) => !open && onClose()}>\r\n      <DialogContent forceMount className=\"max-w-4xl max-h-[90vh] overflow-y-auto\">\r\n        <DialogHeader>\r\n          <DialogTitle className=\"flex items-center\">\r\n            <MessageSquare className=\"h-5 w-5 mr-2\" />\r\n            Configuração da API do WhatsApp\r\n          </DialogTitle>\r\n        </DialogHeader>\r\n\r\n        <Tabs defaultValue=\"config\" className=\"w-full\">\r\n          <TabsList className=\"grid w-full grid-cols-3\">\r\n            <TabsTrigger value=\"config\">\r\n              <Settings className=\"h-4 w-4 mr-2\" />\r\n              Configuração\r\n            </TabsTrigger>\r\n            <TabsTrigger value=\"test\">\r\n              <Zap className=\"h-4 w-4 mr-2\" />\r\n              Teste de Conexão\r\n            </TabsTrigger>\r\n            <TabsTrigger value=\"examples\">\r\n              <AlertCircle className=\"h-4 w-4 mr-2\" />\r\n              Exemplos\r\n            </TabsTrigger>\r\n          </TabsList>\r\n\r\n          <TabsContent value=\"config\" className=\"space-y-6\">\r\n            <Card>\r\n              <CardHeader>\r\n                <CardTitle>Provedor da API</CardTitle>\r\n              </CardHeader>\r\n              <CardContent className=\"space-y-4\">\r\n                <div>\r\n                  <Label>Tipo de Provedor</Label>\r\n                  <Select\r\n                    value={config.provider}\r\n                    onValueChange={(value) => setConfig({ ...config, provider: value as any })}\r\n                  >\r\n                    <SelectTrigger>\r\n                      <SelectValue />\r\n                    </SelectTrigger>\r\n                    <SelectContent>\r\n                      <SelectItem value=\"z-api\">Z-Api (Recomendado)</SelectItem>\r\n                      <SelectItem value=\"custom\">API Personalizada</SelectItem>\r\n                      <SelectItem value=\"whatsapp-web-js\">WhatsApp Web JS</SelectItem>\r\n                      <SelectItem value=\"baileys\">Baileys</SelectItem>\r\n                      <SelectItem value=\"twilio\">Twilio</SelectItem>\r\n                      <SelectItem value=\"meta-business\">Meta Business API</SelectItem>\r\n                    </SelectContent>\r\n                  </Select>\r\n                  <p className=\"text-sm text-muted-foreground mt-1\">{getProviderDescription(config.provider)}</p>\r\n                </div>\r\n\r\n                {config.provider === \"z-api\" && (\r\n                  <>\r\n                    <div>\r\n                      <Label>URL da Instância (opcional)</Label>\r\n                      <Input\r\n                        value={instanceUrlInput}\r\n                        onChange={(e) => {\r\n                          const val = e.target.value\r\n                          setInstanceUrlInput(val)\r\n                          const parsed = parseZapiInstanceUrl(val)\r\n                          if (parsed) {\r\n                            setConfig({\r\n                              ...config,\r\n                              provider: \"z-api\" as const,\r\n                              customEndpoint: ZAPI_BASE,\r\n                              instanceId: parsed.instanceId,\r\n                              instanceToken: parsed.instanceToken,\r\n                            } as any)\r\n                          }\r\n                        }}\r\n                        placeholder=\"Cole aqui: https://api.z-api.io/instances/ID/token/TOKEN\"\r\n                      />\r\n                      <p className=\"text-sm text-muted-foreground mt-1\">\r\n                        Cole a URL completa da instância e eu extraio ID e Token automaticamente.\r\n                      </p>\r\n                    </div>\r\n                    <div>\r\n                      <Label>Conectado</Label>\r\n                      <div className=\"flex items-center gap-2\">\r\n                        <input\r\n                          type=\"checkbox\"\r\n                          checked={connectedFlag}\r\n                          onChange={(e) => setConnectedFlag(e.target.checked)}\r\n                        />\r\n                        <span className=\"text-sm text-muted-foreground\">Marcar como conectado</span>\r\n                      </div>\r\n                    </div>\r\n                    <div>\r\n                      <Label>Token da API Z-Api (opcional)</Label>\r\n                      <Input\r\n                        type=\"password\"\r\n                        value={config.apiKey || \"\"}\r\n                        onChange={(e) => setConfig({ ...config, apiKey: e.target.value })}\r\n                        placeholder=\"Client-Token (se sua conta usar)\"\r\n                      />\r\n                      <p className=\"text-sm text-muted-foreground mt-1\">Se sua conta não usa Client-Token, deixe em branco e informe o ID e o Token da instância.</p>\r\n                    </div>\r\n\r\n                    <div className=\"grid grid-cols-2 gap-4\">\r\n                      <div>\r\n                        <Label>ID da Instância (opcional)</Label>\r\n                        <Input\r\n                          value={(config as any).instanceId || \"\"}\r\n                          onChange={(e) => {\r\n                            const val = e.target.value.trim()\r\n                            const parsed = parseZapiInstanceUrl(val)\r\n                            if (parsed) {\r\n                              setConfig({\r\n                                ...config,\r\n                                provider: \"z-api\" as const,\r\n                                customEndpoint: ZAPI_BASE,\r\n                                instanceId: parsed.instanceId,\r\n                                instanceToken: parsed.instanceToken,\r\n                              } as any)\r\n                            } else {\r\n                              setConfig({ ...config, instanceId: val } as any)\r\n                            }\r\n                          }}\r\n                          placeholder=\"Ex.: 12345 (ou cole a URL completa da instância)\"\r\n                        />\r\n                        <p className=\"text-sm text-muted-foreground mt-1\">Use uma instância existente ou deixe em branco para criar.</p>\r\n                      </div>\r\n                      <div>\r\n                        <Label>Token da Instância (opcional)</Label>\r\n                        <Input\r\n                          type=\"password\"\r\n                          value={(config as any).instanceToken || \"\"}\r\n                          onChange={(e) => {\r\n                            const val = e.target.value.trim()\r\n                            const parsed = parseZapiInstanceUrl(val)\r\n                            if (parsed) {\r\n                              setConfig({\r\n                                ...config,\r\n                                provider: \"z-api\" as const,\r\n                                customEndpoint: ZAPI_BASE,\r\n                                instanceId: parsed.instanceId,\r\n                                instanceToken: parsed.instanceToken,\r\n                              } as any)\r\n                            } else {\r\n                              setConfig({ ...config, instanceToken: val } as any)\r\n                            }\r\n                          }}\r\n                          placeholder=\"Token da instância (ou cole a URL completa)\"\r\n                        />\r\n                        <p className=\"text-sm text-muted-foreground mt-1\">Necessário se você já possui uma instância ativa.</p>\r\n                      </div>\r\n                    </div>\r\n\r\n                    {/* Opções avançadas removidas para simplificar: Client-Token e criação de instância não são necessários */}\r\n                  </>\r\n                )}\r\n\r\n                {config.provider !== \"z-api\" && (\r\n                  <>\r\n                    <div className=\"grid grid-cols-2 gap-4\">\r\n                      <div>\r\n                        <Label>Chave da API</Label>\r\n                        <Input\r\n                          type=\"password\"\r\n                          value={config.apiKey || \"\"}\r\n                          onChange={(e) => setConfig({ ...config, apiKey: e.target.value })}\r\n                          placeholder=\"Sua chave de API\"\r\n                        />\r\n                      </div>\r\n                      <div>\r\n                        <Label>ID do Número de Telefone</Label>\r\n                        <Input\r\n                          value={config.phoneNumberId || \"\"}\r\n                          onChange={(e) => setConfig({ ...config, phoneNumberId: e.target.value })}\r\n                          placeholder=\"ID do número (se aplicável)\"\r\n                        />\r\n                      </div>\r\n                    </div>\r\n\r\n                    <div>\r\n                      <Label>Endpoint Personalizado</Label>\r\n                      <Input\r\n                        value={config.customEndpoint || \"\"}\r\n                        onChange={(e) => setConfig({ ...config, customEndpoint: e.target.value })}\r\n                        placeholder=\"https://sua-api.com/whatsapp\"\r\n                      />\r\n                      <p className=\"text-sm text-muted-foreground mt-1\">URL base da sua API personalizada</p>\r\n                    </div>\r\n\r\n                    <div>\r\n                      <Label>URL do Webhook</Label>\r\n                      <Input\r\n                        value={config.webhookUrl || \"\"}\r\n                        onChange={(e) => setConfig({ ...config, webhookUrl: e.target.value })}\r\n                        placeholder=\"https://sua-api.com/webhook/whatsapp\"\r\n                      />\r\n                      <p className=\"text-sm text-muted-foreground mt-1\">URL para receber mensagens em tempo real</p>\r\n                    </div>\r\n\r\n                    <div>\r\n                      <Label>Headers Personalizados (JSON)</Label>\r\n                      <Textarea\r\n                        value={customHeadersText}\r\n                        onChange={(e) => setCustomHeadersText(e.target.value)}\r\n                        placeholder='{\\n  \"X-Custom-Header\": \"valor\",\\n  \"Authorization\": \"Bearer token\"\\n}'\r\n                        rows={4}\r\n                      />\r\n                      <p className=\"text-sm text-muted-foreground mt-1\">\r\n                        Headers adicionais para as requisições da API\r\n                      </p>\r\n                    </div>\r\n                  </>\r\n                )}\r\n              </CardContent>\r\n            </Card>\r\n          </TabsContent>\r\n\r\n          <TabsContent value=\"test\" className=\"space-y-6\">\r\n            <Card>\r\n              <CardHeader>\r\n                <CardTitle className=\"flex items-center justify-between\">\r\n                  Status da Conexão\r\n                  <Badge variant={isConnected ? \"default\" : \"secondary\"}>\r\n                    {isConnected ? (\r\n                      <>\r\n                        <CheckCircle className=\"h-4 w-4 mr-1\" />\r\n                        Conectado\r\n                      </>\r\n                    ) : (\r\n                      <>\r\n                        <XCircle className=\"h-4 w-4 mr-1\" />\r\n                        Desconectado\r\n                      </>\r\n                    )}\r\n                  </Badge>\r\n                </CardTitle>\r\n              </CardHeader>\r\n              <CardContent className=\"space-y-4\">\r\n                {connectionError && (\r\n                  <div className=\"p-3 bg-red-50 border border-red-200 rounded-lg\">\r\n                    <p className=\"text-red-800 text-sm\">{connectionError}</p>\r\n                  </div>\r\n                )}\r\n\r\n                <div className=\"flex gap-2\">\r\n                  <Button onClick={testConnection} disabled={isConnecting} className=\"flex-1\">\r\n                    {isConnecting ? \"Conectando...\" : \"Testar Conexão\"}\r\n                  </Button>\r\n\r\n                  {isConnected && (\r\n                    <Button onClick={disconnect} variant=\"outline\" className=\"flex-1 bg-transparent\">\r\n                      Desconectar\r\n                    </Button>\r\n                  )}\r\n                  {!isConnected && config.provider === \"z-api\" && (\r\n                    <Button\r\n                      onClick={async () => {\r\n                        setIsGeneratingQr(true)\r\n                        setConnectionError(null)\r\n                        setQrCode(null)\r\n                        try {\r\n                          // Primeiro verificar status para garantir que podemos gerar QR\r\n                          const status = await apiClient.get<any>(\"/whatsapp/status\")\r\n                          if (!status?.connected) {\r\n                            const rawText = await apiClient.getText(\"/whatsapp/qr\")\r\n                            console.log(\"[QR RAW TEXT RECEIVED]\", rawText)\r\n                            const trimmed = rawText.trim()\r\n                            if (trimmed.startsWith(\"{\")) {\r\n                              const data = JSON.parse(trimmed)\r\n                              setConnectionError(data.error || \"Erro inesperado ao gerar QR\")\r\n                              return\r\n                            }\r\n                            if (!trimmed) {\r\n                              setConnectionError(\"QR Code vazio ou inválido retornado pelo backend\")\r\n                              return\r\n                            }\r\n                            setQrCode(trimmed)\r\n                          } else {\r\n                            setConnectionError(\"Já conectado. Não é necessário gerar QR.\")\r\n                          }\r\n                        } catch (err: any) {\r\n                          console.error(\"[v0] Erro ao gerar QR:\", err)\r\n                          setConnectionError(err?.message || \"Erro ao gerar QR.\")\r\n                        } finally {\r\n                          setIsGeneratingQr(false)\r\n                        }\r\n                      }}\r\n                      variant=\"outline\"\r\n                      className=\"flex-1\"\r\n                      disabled={isGeneratingQr}\r\n                    >\r\n                      {isGeneratingQr ? \"Gerando QR...\" : \"Gerar QR\"}\r\n                    </Button>\r\n                  )}\r\n                </div>\r\n\r\n                <div className=\"space-y-2\">\r\n<h4 className=\"font-medium\">Teste de Conexão (via backend):</h4>\r\n                  <ul className=\"text-sm text-muted-foreground space-y-1\">\r\n                    <li>• GET /api/whatsapp/status</li>\r\n                    <li>• POST /api/whatsapp/qr</li>\r\n                  </ul>\r\n{qrCode && (\r\n                    <div className=\"mt-3 p-3 bg-gray-50 border rounded-lg\">\r\n                      <p className=\"text-sm mb-2\">Escaneie o QR abaixo no WhatsApp:</p>\r\n                      {qrCode ? (\r\n                        <img src={qrCode} alt=\"QR Code\" className=\"w-64 h-64\" />\r\n                      ) : (\r\n                        <div className=\"w-64 h-64 bg-gray-200 rounded flex items-center justify-center\">\r\n                          <p className=\"text-gray-500 text-sm\">QR Code inválido</p>\r\n                        </div>\r\n                      )}\r\n                    </div>\r\n)}\r\n\r\n{/* Status detalhado da Instância */}\r\n<div className=\"mt-4 border rounded p-3 bg-muted/30\">\r\n  <h4 className=\"font-medium mb-2\">Status detalhado</h4>\r\n  {statusDetails ? (\r\n    <>\r\n      <pre className=\"text-xs whitespace-pre-wrap overflow-auto max-h-64 p-2 bg-background border rounded\">\r\n        {JSON.stringify(statusDetails, null, 2)}\r\n      </pre>\r\n      <button\r\n        className=\"mt-2 text-sm px-3 py-1 border rounded hover:bg-muted\"\r\n        onClick={() => navigator.clipboard.writeText(JSON.stringify(statusDetails, null, 2))}\r\n      >\r\n        Copiar JSON\r\n      </button>\r\n    </>\r\n  ) : (\r\n    <p className=\"text-sm text-muted-foreground\">Nenhum detalhe disponível. Execute \"Testar Conexão\".</p>\r\n  )}\r\n  <p className=\"text-xs text-muted-foreground mt-2\">Exibe a resposta completa da Z-API para diagnóstico.</p>\r\n  </div>\r\n                </div>\r\n              </CardContent>\r\n            </Card>\r\n          </TabsContent>\r\n\r\n          <TabsContent value=\"examples\" className=\"space-y-6\">\r\n            <Card>\r\n              <CardHeader>\r\n                <CardTitle>Exemplos de Configuração</CardTitle>\r\n              </CardHeader>\r\n              <CardContent className=\"space-y-4\">\r\n                <div className=\"space-y-4\">\r\n                  <div className=\"p-4 bg-green-50 rounded-lg border-2 border-green-200\">\r\n                    <h4 className=\"font-medium mb-2 text-green-800\">Z-Api (Recomendado)</h4>\r\n                    <pre className=\"text-sm text-green-700\">\r\n                      {`{\r\n  \"provider\": \"z-api\",\r\n  \"apiKey\": \"seu-token-zapi\",\r\n  \"webhookUrl\": \"https://seu-dominio.com/webhook/zapi\"\r\n}`}\r\n                    </pre>\r\n                    <p className=\"text-xs text-green-600 mt-2\">\r\n                      Cada cliente terá sua própria instância e QR Code para conectar\r\n                    </p>\r\n                  </div>\r\n\r\n                  <div className=\"p-4 bg-gray-50 rounded-lg\">\r\n                    <h4 className=\"font-medium mb-2\">API Personalizada</h4>\r\n                    <pre className=\"text-sm text-gray-600\">\r\n                      {`{\r\n  \"provider\": \"custom\",\r\n  \"customEndpoint\": \"https://sua-api.com/whatsapp\",\r\n  \"apiKey\": \"sua-chave-secreta\",\r\n  \"webhookUrl\": \"https://sua-api.com/webhook\",\r\n  \"customHeaders\": {\r\n    \"X-API-Version\": \"v1\",\r\n    \"Content-Type\": \"application/json\"\r\n  }\r\n}`}\r\n                    </pre>\r\n                  </div>\r\n\r\n                  <div className=\"p-4 bg-blue-50 rounded-lg\">\r\n                    <h4 className=\"font-medium mb-2\">Meta Business API</h4>\r\n                    <pre className=\"text-sm text-blue-600\">\r\n                      {`{\r\n  \"provider\": \"meta-business\",\r\n  \"accessToken\": \"seu-access-token\",\r\n  \"phoneNumberId\": \"123456789\",\r\n  \"webhookUrl\": \"https://sua-api.com/webhook/meta\"\r\n}`}\r\n                    </pre>\r\n                  </div>\r\n\r\n                  <div className=\"p-4 bg-green-50 rounded-lg\">\r\n                    <h4 className=\"font-medium mb-2\">Twilio</h4>\r\n                    <pre className=\"text-sm text-green-600\">\r\n                      {`{\r\n  \"provider\": \"twilio\",\r\n  \"apiKey\": \"seu-account-sid\",\r\n  \"customEndpoint\": \"https://api.twilio.com/2010-04-01\",\r\n  \"customHeaders\": {\r\n    \"Authorization\": \"Basic base64(sid:token)\"\r\n  }\r\n}`}\r\n                    </pre>\r\n                  </div>\r\n                </div>\r\n\r\n                <div className=\"mt-6 p-4 bg-yellow-50 border border-yellow-200 rounded-lg\">\r\n                  <h4 className=\"font-medium text-yellow-800 mb-2\">Estrutura da API Esperada</h4>\r\n                  <p className=\"text-sm text-yellow-700 mb-2\">Sua API deve implementar os seguintes endpoints:</p>\r\n                  <ul className=\"text-sm text-yellow-700 space-y-1\">\r\n                    <li>\r\n                      • <code>GET /contacts</code> - Lista de contatos\r\n                    </li>\r\n                    <li>\r\n                      • <code>GET /conversations</code> - Lista de conversas\r\n                    </li>\r\n                    <li>\r\n                      • <code>GET /messages/:contactId</code> - Mensagens de um contato\r\n                    </li>\r\n                    <li>\r\n                      • <code>POST /send-message</code> - Enviar mensagem\r\n                    </li>\r\n                    <li>\r\n                      • <code>POST /mark-read</code> - Marcar como lida\r\n                    </li>\r\n                    <li>\r\n                      • <code>GET /events</code> - Server-Sent Events para tempo real\r\n                    </li>\r\n                  </ul>\r\n                </div>\r\n              </CardContent>\r\n            </Card>\r\n          </TabsContent>\r\n        </Tabs>\r\n\r\n        <div className=\"flex justify-end gap-2 pt-4 border-t\">\r\n          <Button variant=\"outline\" onClick={onClose}>\r\n            Cancelar\r\n          </Button>\r\n          <Button onClick={saveConfig}>Salvar Configuração</Button>\r\n        </div>\r\n      </DialogContent>\r\n    </Dialog>\r\n  )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Projetos\\Back_endCrm\\kanbanproject1\\components\\whatsapp-integration.tsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'qrLoading' is assigned a value but never used.","line":73,"column":32,"nodeType":"Identifier","messageId":"unusedVar","endLine":73,"endColumn":41,"suggestions":[{"messageId":"removeVar","data":{"varName":"qrLoading"},"fix":{"range":[2452,2472],"text":""},"desc":"Remove unused variable 'qrLoading'."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'qrLoading' is assigned a value but never used.","line":73,"column":32,"nodeType":null,"messageId":"unusedVar","endLine":73,"endColumn":41},{"ruleId":"prefer-const","severity":2,"message":"'v' is never reassigned. Use 'const' instead.","line":122,"column":9,"nodeType":"Identifier","messageId":"useConst","endLine":122,"endColumn":10,"fix":{"range":[3920,3940],"text":"const v = value.trim()"}},{"ruleId":"no-unused-vars","severity":1,"message":"'e' is defined but never used.","line":189,"column":16,"nodeType":"Identifier","messageId":"unusedVar","endLine":189,"endColumn":17},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'e' is defined but never used.","line":189,"column":16,"nodeType":null,"messageId":"unusedVar","endLine":189,"endColumn":17},{"ruleId":"no-unused-vars","severity":1,"message":"'e' is defined but never used.","line":205,"column":16,"nodeType":"Identifier","messageId":"unusedVar","endLine":205,"endColumn":17},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'e' is defined but never used.","line":205,"column":16,"nodeType":null,"messageId":"unusedVar","endLine":205,"endColumn":17},{"ruleId":"no-unused-vars","severity":1,"message":"'innerErr' is defined but never used.","line":214,"column":18,"nodeType":"Identifier","messageId":"unusedVar","endLine":214,"endColumn":26},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'innerErr' is defined but never used.","line":214,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":214,"endColumn":26}],"suppressedMessages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'revokeQr'. Either include it or remove the dependency array.","line":95,"column":6,"nodeType":"ArrayExpression","endLine":95,"endColumn":8,"suggestions":[{"desc":"Update the dependencies array to be: [revokeQr]","fix":{"range":[3167,3169],"text":"[revokeQr]"}}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":1,"fatalErrorCount":0,"warningCount":8,"fixableErrorCount":1,"fixableWarningCount":0,"source":"\"use client\"\r\n\r\nimport { useState, useEffect } from \"react\"\r\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\"\r\nimport { Button } from \"@/components/ui/button\"\r\nimport { Badge } from \"@/components/ui/badge\"\r\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from \"@/components/ui/dialog\"\r\nimport { ScrollArea } from \"@/components/ui/scroll-area\"\r\nimport { Input } from \"@/components/ui/input\"\r\nimport { useToast } from \"@/hooks/use-toast\"\r\nimport {\r\n  MessageSquare,\r\n  Send,\r\n  Check,\r\n  CheckCheck,\r\n  Clock,\r\n  User,\r\n  Search,\r\n  QrCode,\r\n  Smartphone,\r\n  RefreshCw,\r\n  AlertCircle,\r\n} from \"lucide-react\"\r\nimport { loadFromStorage, saveToStorage } from \"@/lib/storage\"\r\nimport { ZApiProvider, type ZApiConfig } from \"@/lib/whatsapp-api\"\r\nimport { apiClient, API_BASE_URL } from \"@/lib/api-client\"\r\nimport { useQr } from \"@/hooks/use-qr\"\r\n\r\ntype WhatsAppMessage = {\r\n  id: string\r\n  text: string\r\n  timestamp: string\r\n  isFromClient: boolean\r\n  status: \"sent\" | \"delivered\" | \"read\"\r\n  leadId?: string\r\n}\r\n\r\ntype WhatsAppConversation = {\r\n  id: string\r\n  contactName: string\r\n  contactPhone: string\r\n  lastMessage: string\r\n  lastMessageTime: string\r\n  unreadCount: number\r\n  leadId?: string\r\n  messages: WhatsAppMessage[]\r\n}\r\n\r\ninterface WhatsAppIntegrationProps {\r\n  open: boolean\r\n  onClose: () => void\r\n}\r\n\r\nexport default function WhatsAppIntegration({ open, onClose }: WhatsAppIntegrationProps) {\r\n  const { toast } = useToast()\r\n  const [conversations, setConversations] = useState<WhatsAppConversation[]>([])\r\n  const [selectedConversation, setSelectedConversation] = useState<WhatsAppConversation | null>(null)\r\n  const [newMessage, setNewMessage] = useState(\"\")\r\n  const [searchTerm, setSearchTerm] = useState(\"\")\r\n  const [connectionStatus, setConnectionStatus] = useState<\"connected\" | \"connecting\" | \"disconnected\">(\r\n    \"disconnected\",\r\n  )\r\n  const [qrCode, setQrCode] = useState<string | null>(null) // used for provider callbacks\r\n  const [isGeneratingQR, setIsGeneratingQR] = useState(false)\r\n  const [provider, setProvider] = useState<ZApiProvider | null>(null)\r\n  const [mounted, setMounted] = useState(false)\r\n  const fallbackUrlRef = useRef<string | null>(null)\r\n\r\n  // token from local storage (if your app uses Bearer tokens)\r\n  const token = typeof window !== \"undefined\" ? localStorage.getItem(\"unicrm_access_token\") : null\r\n\r\n  // use the hook created earlier\r\n  const { src: qrSrc, loading: qrLoading, error: qrError, generate: generateQrImage, revoke: revokeQr } = useQr({\r\n    apiBase: API_BASE_URL,\r\n    token: token, // if null, hook will try public image (cookie-based) first\r\n    cacheBuster: true,\r\n  })\r\n\r\n  useEffect(() => {\r\n    // Load conversations from storage\r\n    const storedConversations = loadFromStorage(\"whatsapp_conversations\", [])\r\n    setConversations(storedConversations)\r\n\r\n    // Check connection status\r\n    checkConnectionStatus()\r\n    setMounted(true)\r\n\r\n    // cleanup on unmount - revoke any object URL created by hook\r\n    return () => {\r\n      try {\r\n        revokeQr()\r\n      } catch {}\r\n    }\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, [])\r\n\r\n  const checkConnectionStatus = async () => {\r\n    const config = loadFromStorage(\"whatsapp_config\", null)\r\n\r\n    if (!config || config.provider !== \"z-api\") {\r\n      setConnectionStatus(\"disconnected\")\r\n      return\r\n    }\r\n\r\n    // Check if there's a saved instance\r\n    const userId = loadFromStorage(\"current_user_id\", \"default_user\")\r\n    const savedInstance = localStorage.getItem(`zapi_instance_${userId}`)\r\n\r\n    if (savedInstance) {\r\n      const instance = JSON.parse(savedInstance)\r\n\r\n      if (instance.status === \"connected\") {\r\n        setConnectionStatus(\"connected\")\r\n      } else {\r\n        setConnectionStatus(\"disconnected\")\r\n      }\r\n    }\r\n  }\r\n\r\n  function normalizeClient(value: string) {\r\n    if (!value) return value\r\n    let v = value.trim()\r\n    const hasPrefix = v.startsWith(\"data:image\")\r\n    let prefix = \"data:image/png;base64,\"\r\n    let raw = v\r\n    if (hasPrefix) {\r\n      const i = v.indexOf(\",\")\r\n      if (i >= 0) {\r\n        prefix = v.substring(0, i + 1)\r\n        raw = v.substring(i + 1)\r\n      }\r\n    }\r\n    raw = raw.replace(/^\\d+@/, \"\")\r\n    const joined = raw.split(/[,|\\s]+/).filter(Boolean).join(\"\")\r\n    let cleaned = joined.replace(/[^A-Za-z0-9+/=]/g, \"\")\r\n    while (cleaned.length % 4 !== 0) cleaned += \"=\"\r\n    return prefix + cleaned\r\n  }\r\n\r\n  const generateQRCode = async () => {\r\n    setIsGeneratingQR(true)\r\n    setConnectionStatus(\"connecting\")\r\n\r\n    try {\r\n      // Load Z-Api configuration\r\n      const config = loadFromStorage(\"whatsapp_config\", null)\r\n\r\n      if (!config) {\r\n        toast({\r\n          title: \"Configuração Necessária\",\r\n          description: \"Preencha os dados da instância do WhatsApp.\",\r\n          variant: \"destructive\",\r\n        })\r\n        setConnectionStatus(\"disconnected\")\r\n        setIsGeneratingQR(false)\r\n        return\r\n      }\r\n\r\n      // If ApiKey is not provided, require instanceId and instanceToken\r\n      const hasInstanceCreds = Boolean(config.instanceId && config.instanceToken)\r\n      if (!config.apiKey && !hasInstanceCreds) {\r\n        toast({\r\n          title: \"Dados da Instância Necessários\",\r\n          description:\r\n            \"Informe o ID e o Token da instância (ou use ApiKey para criar automaticamente).\",\r\n          variant: \"destructive\",\r\n        })\r\n        setConnectionStatus(\"disconnected\")\r\n        setIsGeneratingQR(false)\r\n        return\r\n      }\r\n\r\n      // Primeiro verificar status da conexão\r\n      // NOTE: apiClient is expected to be globally available (as before).\r\n      const statusData = await apiClient.get<any>(\"/whatsapp/status\")\r\n\r\n      // Se já estiver conectado, não gerar QR\r\n      if (statusData.connected) {\r\n        setConnectionStatus(\"connected\")\r\n        setQrCode(null)\r\n        saveToStorage(true, \"whatsapp_connected\")\r\n        setIsGeneratingQR(false)\r\n        return\r\n      }\r\n\r\n      // Use the hook to attempt fetching the image (public or with token). This ensures the frontend can display the QR safely.\r\n      try {\r\n        await generateQrImage()\r\n      } catch (e) {\r\n        // ignore - the hook sets error state if it fails\r\n      }\r\n\r\n      // Prepare a stable fallback image URL with cache buster for this generation cycle\r\n      try {\r\n        fallbackUrlRef.current = `${API_BASE_URL}/whatsapp/qr/image?ts=${Date.now()}`\r\n      } catch {}\r\n\r\n      // Also keep original flow: request backend /whatsapp/qr to ensure provider/backend state is triggered\r\n      // This preserves previous behavior where backend is asked to produce QR and provider initializes\r\n      let value: string | null = null\r\n      try {\r\n        const json = await apiClient.post<{ value?: string; error?: string }>(\"/whatsapp/qr\", {})\r\n        if (json.error) throw new Error(json.error)\r\n        value = json.value || null\r\n      } catch (e) {\r\n        try {\r\n          const rawText = await apiClient.getText(\"/whatsapp/qr\")\r\n          const trimmed = rawText.trim()\r\n          if (trimmed.startsWith(\"{\")) {\r\n            const data = JSON.parse(trimmed)\r\n            throw new Error(data.error || \"Erro inesperado ao gerar QR\")\r\n          }\r\n          value = trimmed\r\n        } catch (innerErr) {\r\n          // ignore; rely on hook fallback if available\r\n        }\r\n      }\r\n\r\n      // If backend returned a value, normalize and set (this supports provider callback fallback)\r\n      if (value) {\r\n        const norm = normalizeClient(value)\r\n        // prefer hook src if available; otherwise set provider QR state to normalized data URL\r\n        setQrCode(norm)\r\n      }\r\n\r\n      // Get or create client ID\r\n      const userId = loadFromStorage(\"current_user_id\", \"default_user\")\r\n\r\n      const zapiConfig: ZApiConfig = {\r\n        ...config,\r\n        provider: \"z-api\",\r\n        clientId: userId,\r\n      }\r\n\r\n      // Create Z-Api provider\r\n      const zapiProvider = new ZApiProvider(zapiConfig)\r\n      setProvider(zapiProvider)\r\n\r\n      // Setup callbacks\r\n      zapiProvider.onQRCodeGenerated((qr) => {\r\n        console.log(\"[v0] QR Code received via callback\")\r\n        // provider may send either base64 or data URL\r\n        const normalized = qr && typeof qr === \"string\" ? normalizeClient(qr) : null\r\n        if (normalized) {\r\n          setQrCode(normalized)\r\n        } else {\r\n          setQrCode(qr)\r\n        }\r\n        setIsGeneratingQR(false)\r\n      })\r\n\r\n      zapiProvider.onStatusChanged((status) => {\r\n        console.log(\"[v0] Status changed:\", status)\r\n\r\n        if (status === \"connected\") {\r\n          setConnectionStatus(\"connected\")\r\n          setQrCode(null)\r\n          saveToStorage(true, \"whatsapp_connected\")\r\n\r\n          toast({\r\n            title: \"WhatsApp Conectado!\",\r\n            description: \"Seu WhatsApp foi conectado com sucesso.\",\r\n          })\r\n        }\r\n      })\r\n\r\n      // Initialize provider (may cause provider to request/generate QR)\r\n      await zapiProvider.initialize()\r\n\r\n      setIsGeneratingQR(false)\r\n    } catch (error) {\r\n      console.error(\"[v0] Error generating QR Code:\", error)\r\n\r\n      toast({\r\n        title: \"Erro ao Gerar QR Code\",\r\n        description: error instanceof Error ? error.message : \"Erro desconhecido\",\r\n        variant: \"destructive\",\r\n      })\r\n\r\n      setConnectionStatus(\"disconnected\")\r\n      setIsGeneratingQR(false)\r\n    }\r\n  }\r\n\r\n  const handleDisconnect = async () => {\r\n    if (provider) {\r\n      await provider.disconnect()\r\n    }\r\n\r\n    setConnectionStatus(\"disconnected\")\r\n    setQrCode(null)\r\n    setProvider(null)\r\n    saveToStorage(false, \"whatsapp_connected\")\r\n\r\n    // revoke any object url created by hook\r\n    try {\r\n      revokeQr()\r\n    } catch {}\r\n\r\n    toast({\r\n      title: \"WhatsApp Desconectado\",\r\n      description: \"Sua conexão com WhatsApp foi removida.\",\r\n    })\r\n  }\r\n\r\n  const handleSendMessage = () => {\r\n    if (!newMessage.trim() || !selectedConversation) return\r\n\r\n    const message: WhatsAppMessage = {\r\n      id: `msg_${Date.now()}`,\r\n      text: newMessage,\r\n      timestamp: new Date().toISOString(),\r\n      isFromClient: false,\r\n      status: \"sent\",\r\n      leadId: selectedConversation.leadId,\r\n    }\r\n\r\n    // Update conversation\r\n    const updatedConversation = {\r\n      ...selectedConversation,\r\n      lastMessage: newMessage,\r\n      lastMessageTime: new Date().toISOString(),\r\n      messages: [...selectedConversation.messages, message],\r\n    }\r\n\r\n    setConversations((prev) => prev.map((conv) => (conv.id === selectedConversation.id ? updatedConversation : conv)))\r\n    setSelectedConversation(updatedConversation)\r\n    setNewMessage(\"\")\r\n\r\n    saveToStorage(\r\n      conversations.map((conv) => (conv.id === selectedConversation.id ? updatedConversation : conv)),\r\n      \"whatsapp_conversations\",\r\n    )\r\n\r\n    // Send via Z-Api if connected\r\n    if (provider && connectionStatus === \"connected\") {\r\n      provider\r\n        .sendMessage(selectedConversation.contactPhone, newMessage)\r\n        .then(() => {\r\n          console.log(\"[v0] Message sent via Z-Api\")\r\n        })\r\n        .catch((error) => {\r\n          console.error(\"[v0] Error sending message:\", error)\r\n        })\r\n    }\r\n\r\n    // Simulate message delivery\r\n    setTimeout(() => {\r\n      const deliveredMessage = { ...message, status: \"delivered\" as const }\r\n      setConversations((prev) =>\r\n        prev.map((conv) =>\r\n          conv.id === selectedConversation.id\r\n            ? {\r\n                ...conv,\r\n                messages: conv.messages.map((msg) => (msg.id === message.id ? deliveredMessage : msg)),\r\n              }\r\n            : conv,\r\n        ),\r\n      )\r\n    }, 1000)\r\n  }\r\n\r\n  const filteredConversations = conversations.filter(\r\n    (conv) =>\r\n      conv.contactName.toLowerCase().includes(searchTerm.toLowerCase()) || conv.contactPhone.includes(searchTerm),\r\n  )\r\n\r\n  const getStatusIcon = (status: string) => {\r\n    switch (status) {\r\n      case \"sent\":\r\n        return <Check className=\"h-3 w-3 text-gray-400\" />\r\n      case \"delivered\":\r\n        return <CheckCheck className=\"h-3 w-3 text-gray-400\" />\r\n      case \"read\":\r\n        return <CheckCheck className=\"h-3 w-3 text-blue-500\" />\r\n      default:\r\n        return <Clock className=\"h-3 w-3 text-gray-400\" />\r\n    }\r\n  }\r\n\r\n  if (!mounted) return null\r\n\r\n  // determine which source to show: prefer hook's safe src, then provider QR (data URL), else fallback to image endpoint\r\n  const imageSrc = qrSrc ?? qrCode ?? fallbackUrlRef.current\r\n\r\n  return (\r\n    <Dialog key=\"whatsapp-integration-dialog\" open={open} onOpenChange={(v) => { if (!v) onClose() }}>\r\n      <DialogContent forceMount key={qrCode ? \"content-with-qr\" : \"content-no-qr\"} className=\"max-w-6xl h-[80vh]\">\r\n        <DialogHeader>\r\n          <DialogTitle className=\"flex items-center gap-2\">\r\n            <MessageSquare className=\"h-5 w-5\" />\r\n            WhatsApp - UniCRM\r\n          </DialogTitle>\r\n        </DialogHeader>\r\n\r\n        <div className=\"flex-1 mt-4\">\r\n          {connectionStatus === \"disconnected\" ? (\r\n            <div className=\"flex items-center justify-center h-full\">\r\n              <Card className=\"w-full max-w-md\">\r\n                <CardHeader className=\"text-center\">\r\n                  <QrCode className=\"h-12 w-12 mx-auto mb-4 text-green-600\" />\r\n                  <CardTitle>Conectar WhatsApp</CardTitle>\r\n                </CardHeader>\r\n                <CardContent className=\"text-center space-y-4\">\r\n                  <div className=\"p-4 bg-blue-50 rounded-lg text-left\">\r\n                    <div className=\"flex items-start gap-2\">\r\n                      <AlertCircle className=\"h-5 w-5 text-blue-600 mt-0.5\" />\r\n                      <div className=\"text-sm text-blue-800\">\r\n                        <p className=\"font-medium mb-1\">Integração Z-Api</p>\r\n                        <p>Cada cliente conecta seu próprio número de WhatsApp de forma independente e segura.</p>\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n\r\n                  <p className=\"text-muted-foreground\">\r\n                    Clique no botão abaixo para gerar seu QR Code exclusivo e conectar seu WhatsApp.\r\n                  </p>\r\n\r\n                  <Button onClick={generateQRCode} disabled={isGeneratingQR} className=\"w-full\">\r\n                    {isGeneratingQR ? (\r\n                      <>\r\n                        <RefreshCw className=\"h-4 w-4 mr-2 animate-spin\" />\r\n                        Gerando QR Code...\r\n                      </>\r\n                    ) : (\r\n                      <>\r\n                        <QrCode className=\"h-4 w-4 mr-2\" />\r\n                        Gerar QR Code\r\n                      </>\r\n                    )}\r\n                  </Button>\r\n                </CardContent>\r\n              </Card>\r\n            </div>\r\n          ) : connectionStatus === \"connecting\" && imageSrc ? (\r\n            <div className=\"flex items-center justify-center h-full\">\r\n              <Card className=\"w-full max-w-md\">\r\n                <CardHeader className=\"text-center\">\r\n                  <Smartphone className=\"h-12 w-12 mx-auto mb-4 text-green-600\" />\r\n                  <CardTitle>Escaneie o QR Code</CardTitle>\r\n                </CardHeader>\r\n                <CardContent className=\"text-center space-y-4\">\r\n                  <div className=\"flex justify-center p-4 bg-white rounded-lg border-2 border-gray-200\">\r\n                    {imageSrc ? (\r\n                      <img\r\n                        id=\"qrImg\"\r\n                        key={(imageSrc || \"\").slice(0, 32)}\r\n                        src={imageSrc}\r\n                        alt=\"QR Code WhatsApp\"\r\n                        className=\"w-64 h-64\"\r\n                      />\r\n                    ) : (\r\n                      <div className=\"w-64 h-64 bg-gray-100 rounded flex items-center justify-center\">\r\n                        <p className=\"text-gray-500 text-sm\">QR Code inválido</p>\r\n                      </div>\r\n                    )}\r\n                  </div>\r\n                  {qrError && (\r\n                    <div className=\"mt-2 text-sm text-red-600 flex items-center justify-center\">\r\n                      <AlertCircle className=\"h-4 w-4 mr-2\" />\r\n                      {qrError}\r\n                    </div>\r\n                  )}\r\n                  <div className=\"space-y-2\">\r\n                    <p className=\"text-sm font-medium\">Como conectar:</p>\r\n                    <ol className=\"text-sm text-muted-foreground text-left space-y-1 pl-4\">\r\n                      <li>1. Abra o WhatsApp no seu celular</li>\r\n                      <li>2. Toque em Menu (⋮) ou Configurações</li>\r\n                      <li>3. Selecione \"Dispositivos conectados\"</li>\r\n                      <li>4. Toque em \"Conectar um dispositivo\"</li>\r\n                      <li>5. Aponte a câmera para este código</li>\r\n                    </ol>\r\n                  </div>\r\n                  <div className=\"flex items-center justify-center gap-2 text-sm text-green-600 bg-green-50 p-3 rounded-lg\">\r\n                    <div className=\"animate-spin rounded-full h-4 w-4 border-b-2 border-green-600\"></div>\r\n                    Aguardando conexão...\r\n                  </div>\r\n                  <Button variant=\"outline\" onClick={() => setConnectionStatus(\"disconnected\")} className=\"w-full\">\r\n                    Cancelar\r\n                  </Button>\r\n                </CardContent>\r\n              </Card>\r\n            </div>\r\n          ) : (\r\n            <div className=\"flex h-full gap-4\">\r\n              {/* Lista de Conversas */}\r\n              <div className=\"w-1/3 border-r\">\r\n                <div className=\"p-4 border-b\">\r\n                  <div className=\"flex items-center justify-between mb-4\">\r\n                    <Badge className=\"bg-green-100 text-green-800\">\r\n                      <div className=\"w-2 h-2 bg-green-500 rounded-full mr-2\"></div>\r\n                      Conectado\r\n                    </Badge>\r\n                    <Button variant=\"outline\" size=\"sm\" onClick={handleDisconnect}>\r\n                      Desconectar\r\n                    </Button>\r\n                  </div>\r\n                  <div className=\"relative\">\r\n                    <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400\" />\r\n                    <Input\r\n                      placeholder=\"Buscar conversas...\"\r\n                      value={searchTerm}\r\n                      onChange={(e) => setSearchTerm(e.target.value)}\r\n                      className=\"pl-10\"\r\n                    />\r\n                  </div>\r\n                </div>\r\n\r\n                <ScrollArea className=\"h-full\">\r\n                  {filteredConversations.length === 0 ? (\r\n                    <div className=\"p-8 text-center text-muted-foreground\">\r\n                      <MessageSquare className=\"h-12 w-12 mx-auto mb-4 opacity-50\" />\r\n                      <p>Nenhuma conversa encontrada</p>\r\n                      <p className=\"text-sm mt-2\">As conversas aparecerão aqui quando você receber mensagens</p>\r\n                    </div>\r\n                  ) : (\r\n                    filteredConversations.map((conversation) => (\r\n                      <div\r\n                        key={conversation.id}\r\n                        className={`p-4 border-b cursor-pointer hover:bg-gray-50 ${\r\n                          selectedConversation?.id === conversation.id ? \"bg-blue-50\" : \"\"\r\n                        }`}\r\n                        onClick={() => setSelectedConversation(conversation)}\r\n                      >\r\n                        <div className=\"flex items-start gap-3\">\r\n                          <div className=\"h-10 w-10 rounded-full bg-green-100 flex items-center justify-center\">\r\n                            <User className=\"h-5 w-5 text-green-600\" />\r\n                          </div>\r\n                          <div className=\"flex-1 min-w-0\">\r\n                            <div className=\"flex items-center justify-between\">\r\n                              <h4 className=\"font-medium truncate\">{conversation.contactName}</h4>\r\n                              <span className=\"text-xs text-gray-500\">\r\n                                {new Date(conversation.lastMessageTime).toLocaleTimeString(\"pt-BR\", {\r\n                                  hour: \"2-digit\",\r\n                                  minute: \"2-digit\",\r\n                                })}\r\n                              </span>\r\n                            </div>\r\n                            <p className=\"text-sm text-gray-600 truncate\">{conversation.lastMessage}</p>\r\n                            <div className=\"flex items-center justify-between mt-1\">\r\n                              <span className=\"text-xs text-gray-400\">{conversation.contactPhone}</span>\r\n                              {conversation.unreadCount > 0 && (\r\n                                <Badge className=\"bg-green-500 text-white text-xs\">{conversation.unreadCount}</Badge>\r\n                              )}\r\n                            </div>\r\n                          </div>\r\n                        </div>\r\n                      </div>\r\n                    ))\r\n                  )}\r\n                </ScrollArea>\r\n              </div>\r\n\r\n              {/* Área de Conversa */}\r\n              <div className=\"flex-1 flex flex-col\">\r\n                {selectedConversation ? (\r\n                  <>\r\n                    {/* Header da Conversa */}\r\n                    <div className=\"p-4 border-b flex items-center gap-3\">\r\n                      <div className=\"h-10 w-10 rounded-full bg-green-100 flex items-center justify-center\">\r\n                        <User className=\"h-5 w-5 text-green-600\" />\r\n                      </div>\r\n                      <div>\r\n                        <h3 className=\"font-medium\">{selectedConversation.contactName}</h3>\r\n                        <p className=\"text-sm text-gray-500\">{selectedConversation.contactPhone}</p>\r\n                      </div>\r\n                    </div>\r\n\r\n                    {/* Mensagens */}\r\n                    <ScrollArea className=\"flex-1 p-4\">\r\n                      <div className=\"space-y-4\">\r\n                        {selectedConversation.messages.map((message) => (\r\n                          <div\r\n                            key={message.id}\r\n                            className={`flex ${message.isFromClient ? \"justify-start\" : \"justify-end\"}`}\r\n                          >\r\n                            <div\r\n                              className={`max-w-xs lg:max-w-md px-4 py-2 rounded-lg ${\r\n                                message.isFromClient ? \"bg-gray-100 text-gray-900\" : \"bg-green-500 text-white\"\r\n                              }`}\r\n                            >\r\n                              <p className=\"text-sm\">{message.text}</p>\r\n                              <div className=\"flex items-center justify-end gap-1 mt-1\">\r\n                                <span className=\"text-xs opacity-70\">\r\n                                  {new Date(message.timestamp).toLocaleTimeString(\"pt-BR\", {\r\n                                    hour: \"2-digit\",\r\n                                    minute: \"2-digit\",\r\n                                  })}\r\n                                </span>\r\n                                {!message.isFromClient && getStatusIcon(message.status)}\r\n                              </div>\r\n                            </div>\r\n                          </div>\r\n                        ))}\r\n                      </div>\r\n                    </ScrollArea>\r\n\r\n                    {/* Input de Mensagem */}\r\n                    <div className=\"p-4 border-t\">\r\n                      <div className=\"flex gap-2\">\r\n                        <Input\r\n                          placeholder=\"Digite sua mensagem...\"\r\n                          value={newMessage}\r\n                          onChange={(e) => setNewMessage(e.target.value)}\r\n                          onKeyPress={(e) => e.key === \"Enter\" && handleSendMessage()}\r\n                          className=\"flex-1\"\r\n                        />\r\n                        <Button onClick={handleSendMessage} disabled={!newMessage.trim()}>\r\n                          <Send className=\"h-4 w-4\" />\r\n                        </Button>\r\n                      </div>\r\n                    </div>\r\n                  </>\r\n                ) : (\r\n                  <div className=\"flex-1 flex items-center justify-center text-muted-foreground\">\r\n                    <div className=\"text-center\">\r\n                      <MessageSquare className=\"h-12 w-12 mx-auto mb-4 opacity-50\" />\r\n                      <p>Selecione uma conversa para começar</p>\r\n                    </div>\r\n                  </div>\r\n                )}\r\n              </div>\r\n            </div>\r\n          )}\r\n        </div>\r\n      </DialogContent>\r\n    </Dialog>\r\n  )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Projetos\\Back_endCrm\\kanbanproject1\\components\\whatsapp-message-status.tsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'AlertCircle' is defined but never used.","line":5,"column":36,"nodeType":"Identifier","messageId":"unusedVar","endLine":5,"endColumn":47,"suggestions":[{"messageId":"removeVar","data":{"varName":"AlertCircle"},"fix":{"range":[194,207],"text":""},"desc":"Remove unused variable 'AlertCircle'."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'AlertCircle' is defined but never used.","line":5,"column":36,"nodeType":null,"messageId":"unusedVar","endLine":5,"endColumn":47},{"ruleId":"no-unused-vars","severity":1,"message":"'isReadByMe' is assigned a value but never used.","line":30,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":30,"endColumn":20,"suggestions":[{"messageId":"removeVar","data":{"varName":"isReadByMe"},"fix":{"range":[803,813],"text":""},"desc":"Remove unused variable 'isReadByMe'."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'isReadByMe' is assigned a value but never used.","line":30,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":30,"endColumn":20}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\"\r\n\r\nimport { useEffect, useState } from \"react\"\r\nimport { Tooltip, TooltipContent, TooltipProvider, TooltipTrigger } from \"@/components/ui/tooltip\"\r\nimport { Check, CheckCheck, Clock, AlertCircle } from \"lucide-react\"\r\n\r\nexport type MessageStatus = \"SENT\" | \"RECEIVED\" | \"READ\" | \"READ_BY_ME\" | \"PLAYED\"\r\n\r\nexport interface MessageStatusData {\r\n  phone: string\r\n  status: MessageStatus\r\n  ids: string[]\r\n  instanceId?: string\r\n  isGroup?: boolean\r\n  momment?: number\r\n}\r\n\r\ninterface WhatsAppMessageStatusProps {\r\n  messageId: string\r\n  statusData?: MessageStatusData\r\n  className?: string\r\n}\r\n\r\nexport function WhatsAppMessageStatus({ \r\n  messageId, \r\n  statusData,\r\n  className = \"\"\r\n}: WhatsAppMessageStatusProps) {\r\n  const [status, setStatus] = useState<MessageStatus>(\"SENT\")\r\n  const [isReadByMe, setIsReadByMe] = useState(false)\r\n\r\n  useEffect(() => {\r\n    if (statusData && statusData.ids.includes(messageId)) {\r\n      setStatus(statusData.status)\r\n      setIsReadByMe(statusData.status === \"READ_BY_ME\")\r\n    }\r\n  }, [statusData, messageId])\r\n\r\n  const getStatusIcon = () => {\r\n    switch (status) {\r\n      case \"SENT\":\r\n        return <Check className=\"h-3 w-3 text-gray-400\" />\r\n      case \"RECEIVED\":\r\n        return <CheckCheck className=\"h-3 w-3 text-gray-400\" />\r\n      case \"READ\":\r\n        return <CheckCheck className=\"h-3 w-3 text-blue-500\" />\r\n      case \"READ_BY_ME\":\r\n        return <CheckCheck className=\"h-3 w-3 text-green-500\" />\r\n      case \"PLAYED\":\r\n        return <CheckCheck className=\"h-3 w-3 text-green-500\" />\r\n      default:\r\n        return <Clock className=\"h-3 w-3 text-gray-400\" />\r\n    }\r\n  }\r\n\r\n  const getStatusText = () => {\r\n    switch (status) {\r\n      case \"SENT\":\r\n        return \"Enviada\"\r\n      case \"RECEIVED\":\r\n        return \"Recebida\"\r\n      case \"READ\":\r\n        return \"Lida\"\r\n      case \"READ_BY_ME\":\r\n        return \"Lida por você\"\r\n      case \"PLAYED\":\r\n        return \"Reproduzida\"\r\n      default:\r\n        return \"Pendente\"\r\n    }\r\n  }\r\n\r\n  return (\r\n    <TooltipProvider>\r\n      <Tooltip>\r\n        <TooltipTrigger asChild>\r\n          <div className={`flex items-center ${className}`}>\r\n            {getStatusIcon()}\r\n          </div>\r\n        </TooltipTrigger>\r\n        <TooltipContent>\r\n          <p className=\"text-sm\">{getStatusText()}</p>\r\n        </TooltipContent>\r\n      </Tooltip>\r\n    </TooltipProvider>\r\n  )\r\n}\r\n\r\ninterface MessageStatusListProps {\r\n  statuses: MessageStatusData[]\r\n  className?: string\r\n}\r\n\r\nexport function MessageStatusList({ statuses, className = \"\" }: MessageStatusListProps) {\r\n  if (statuses.length === 0) return null\r\n\r\n  return (\r\n    <div className={`space-y-2 ${className}`}>\r\n      <h4 className=\"text-sm font-medium text-muted-foreground\">Status de Mensagens</h4>\r\n      <div className=\"space-y-1\">\r\n        {statuses.map((status) => (\r\n          <div key={`${status.phone}-${status.ids.join(',')}`} className=\"flex items-center justify-between p-2 rounded-lg bg-muted/50\">\r\n            <div className=\"flex items-center gap-2\">\r\n              <WhatsAppMessageStatus \r\n                messageId={status.ids[0]} \r\n                statusData={status}\r\n              />\r\n              <span className=\"text-sm font-medium\">\r\n                {status.phone}\r\n              </span>\r\n            </div>\r\n            <div className=\"flex items-center gap-2\">\r\n              <span className=\"text-xs text-muted-foreground\">\r\n                {status.ids.length} mensagen{status.ids.length > 1 ? 's' : ''}\r\n              </span>\r\n              <span className=\"text-xs font-medium\">\r\n                {status.status}\r\n              </span>\r\n            </div>\r\n          </div>\r\n        ))}\r\n      </div>\r\n    </div>\r\n  )\r\n}","usedDeprecatedRules":[]},{"filePath":"C:\\Projetos\\Back_endCrm\\kanbanproject1\\components\\whatsapp-presence-indicator.tsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'Wifi' is defined but never used.","line":6,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":6,"endColumn":14,"suggestions":[{"messageId":"removeVar","data":{"varName":"Wifi"},"fix":{"range":[217,222],"text":""},"desc":"Remove unused variable 'Wifi'."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Wifi' is defined but never used.","line":6,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":6,"endColumn":14},{"ruleId":"no-unused-vars","severity":1,"message":"'WifiOff' is defined but never used.","line":6,"column":16,"nodeType":"Identifier","messageId":"unusedVar","endLine":6,"endColumn":23,"suggestions":[{"messageId":"removeVar","data":{"varName":"WifiOff"},"fix":{"range":[221,230],"text":""},"desc":"Remove unused variable 'WifiOff'."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'WifiOff' is defined but never used.","line":6,"column":16,"nodeType":null,"messageId":"unusedVar","endLine":6,"endColumn":23},{"ruleId":"no-unused-vars","severity":1,"message":"'phone' is defined but never used.","line":24,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":24,"endColumn":8,"suggestions":[{"messageId":"removeVar","data":{"varName":"phone"},"fix":{"range":[697,703],"text":""},"desc":"Remove unused variable 'phone'."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'phone' is defined but never used.","line":24,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":24,"endColumn":8}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":6,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\"\r\n\r\nimport { useEffect, useState } from \"react\"\r\nimport { Badge } from \"@/components/ui/badge\"\r\nimport { Tooltip, TooltipContent, TooltipProvider, TooltipTrigger } from \"@/components/ui/tooltip\"\r\nimport { Wifi, WifiOff, Circle, Clock, Edit3, Mic } from \"lucide-react\"\r\n\r\nexport type ChatPresenceStatus = \"UNAVAILABLE\" | \"AVAILABLE\" | \"COMPOSING\" | \"RECORDING\" | \"PAUSED\"\r\n\r\nexport interface ChatPresenceData {\r\n  phone: string\r\n  status: ChatPresenceStatus\r\n  lastSeen?: number | null\r\n  instanceId?: string\r\n}\r\n\r\ninterface WhatsAppPresenceIndicatorProps {\r\n  phone: string\r\n  presenceData?: ChatPresenceData\r\n  className?: string\r\n}\r\n\r\nexport function WhatsAppPresenceIndicator({ \r\n  phone, \r\n  presenceData,\r\n  className = \"\" \r\n}: WhatsAppPresenceIndicatorProps) {\r\n  const [status, setStatus] = useState<ChatPresenceStatus>(\"UNAVAILABLE\")\r\n  const [lastSeen, setLastSeen] = useState<number | null>(null)\r\n\r\n  useEffect(() => {\r\n    if (presenceData) {\r\n      setStatus(presenceData.status)\r\n      setLastSeen(presenceData.lastSeen || null)\r\n    }\r\n  }, [presenceData])\r\n\r\n  const getPresenceIcon = () => {\r\n    switch (status) {\r\n      case \"AVAILABLE\":\r\n        return <Circle className=\"h-3 w-3 fill-green-500 text-green-500\" />\r\n      case \"COMPOSING\":\r\n        return <Edit3 className=\"h-3 w-3 text-blue-500 animate-pulse\" />\r\n      case \"RECORDING\":\r\n        return <Mic className=\"h-3 w-3 text-red-500 animate-pulse\" />\r\n      case \"PAUSED\":\r\n        return <Clock className=\"h-3 w-3 text-yellow-500\" />\r\n      case \"UNAVAILABLE\":\r\n      default:\r\n        return <Circle className=\"h-3 w-3 fill-gray-400 text-gray-400\" />\r\n    }\r\n  }\r\n\r\n  const getStatusText = () => {\r\n    switch (status) {\r\n      case \"AVAILABLE\":\r\n        return \"Online\"\r\n      case \"COMPOSING\":\r\n        return \"Digitando...\"\r\n      case \"RECORDING\":\r\n        return \"Gravando áudio...\"\r\n      case \"PAUSED\":\r\n        return \"Digitando (pausado)\"\r\n      case \"UNAVAILABLE\":\r\n        return lastSeen ? `Visto por último ${formatLastSeen(lastSeen)}` : \"Offline\"\r\n      default:\r\n        return \"Offline\"\r\n    }\r\n  }\r\n\r\n  const formatLastSeen = (timestamp: number) => {\r\n    const now = Date.now()\r\n    const diff = now - timestamp\r\n    const minutes = Math.floor(diff / 60000)\r\n    const hours = Math.floor(diff / 3600000)\r\n    const days = Math.floor(diff / 86400000)\r\n\r\n    if (minutes < 1) return \"agora\"\r\n    if (minutes < 60) return `há ${minutes} minuto${minutes > 1 ? 's' : ''}`\r\n    if (hours < 24) return `há ${hours} hora${hours > 1 ? 's' : ''}`\r\n    return `há ${days} dia${days > 1 ? 's' : ''}`\r\n  }\r\n\r\n  return (\r\n    <TooltipProvider>\r\n      <Tooltip>\r\n        <TooltipTrigger asChild>\r\n          <div className={`flex items-center gap-1 ${className}`}>\r\n            {getPresenceIcon()}\r\n            <span className=\"text-xs text-muted-foreground\">\r\n              {status === \"AVAILABLE\" ? \"Online\" : \"\"}\r\n            </span>\r\n          </div>\r\n        </TooltipTrigger>\r\n        <TooltipContent>\r\n          <p className=\"text-sm\">{getStatusText()}</p>\r\n        </TooltipContent>\r\n      </Tooltip>\r\n    </TooltipProvider>\r\n  )\r\n}\r\n\r\ninterface ChatPresenceListProps {\r\n  presences: ChatPresenceData[]\r\n  className?: string\r\n}\r\n\r\nexport function ChatPresenceList({ presences, className = \"\" }: ChatPresenceListProps) {\r\n  if (presences.length === 0) return null\r\n\r\n  return (\r\n    <div className={`space-y-2 ${className}`}>\r\n      <h4 className=\"text-sm font-medium text-muted-foreground\">Status de Presença</h4>\r\n      <div className=\"space-y-1\">\r\n        {presences.map((presence) => (\r\n          <div key={presence.phone} className=\"flex items-center justify-between p-2 rounded-lg bg-muted/50\">\r\n            <div className=\"flex items-center gap-2\">\r\n              <WhatsAppPresenceIndicator \r\n                phone={presence.phone} \r\n                presenceData={presence}\r\n              />\r\n              <span className=\"text-sm font-medium\">\r\n                {presence.phone}\r\n              </span>\r\n            </div>\r\n            <Badge variant=\"outline\" className=\"text-xs\">\r\n              {presence.status}\r\n            </Badge>\r\n          </div>\r\n        ))}\r\n      </div>\r\n    </div>\r\n  )\r\n}","usedDeprecatedRules":[]},{"filePath":"C:\\Projetos\\Back_endCrm\\kanbanproject1\\components\\whatsapp-status-monitor.tsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'Clock' is defined but never used.","line":13,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":13,"endColumn":8,"suggestions":[{"messageId":"removeVar","data":{"varName":"Clock"},"fix":{"range":[423,434],"text":""},"desc":"Remove unused variable 'Clock'."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Clock' is defined but never used.","line":13,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":13,"endColumn":8},{"ruleId":"no-unused-vars","severity":1,"message":"'autoScroll' is assigned a value but never used.","line":45,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":45,"endColumn":20,"suggestions":[{"messageId":"removeVar","data":{"varName":"autoScroll"},"fix":{"range":[1495,1505],"text":""},"desc":"Remove unused variable 'autoScroll'."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'autoScroll' is assigned a value but never used.","line":45,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":45,"endColumn":20},{"ruleId":"no-unused-vars","severity":1,"message":"'setAutoScroll' is assigned a value but never used.","line":45,"column":22,"nodeType":"Identifier","messageId":"unusedVar","endLine":45,"endColumn":35,"suggestions":[{"messageId":"removeVar","data":{"varName":"setAutoScroll"},"fix":{"range":[1505,1520],"text":""},"desc":"Remove unused variable 'setAutoScroll'."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'setAutoScroll' is assigned a value but never used.","line":45,"column":22,"nodeType":null,"messageId":"unusedVar","endLine":45,"endColumn":35},{"ruleId":"no-unused-vars","severity":1,"message":"'isConnected' is assigned a value but never used.","line":46,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":46,"endColumn":21,"suggestions":[{"messageId":"removeVar","data":{"varName":"isConnected"},"fix":{"range":[1549,1560],"text":""},"desc":"Remove unused variable 'isConnected'."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'isConnected' is assigned a value but never used.","line":46,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":46,"endColumn":21},{"ruleId":"react-hooks/rules-of-hooks","severity":2,"message":"React Hook \"useWhatsappSse\" is called conditionally. React Hooks must be called in the exact same order in every component render.","line":61,"column":26,"nodeType":"Identifier","endLine":61,"endColumn":40},{"ruleId":"no-unused-vars","severity":1,"message":"'chatPresenceEvents' is assigned a value but never used.","line":71,"column":5,"nodeType":"Identifier","messageId":"unusedVar","endLine":71,"endColumn":23,"suggestions":[{"messageId":"removeVar","data":{"varName":"chatPresenceEvents"},"fix":{"range":[2204,2230],"text":""},"desc":"Remove unused variable 'chatPresenceEvents'."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'chatPresenceEvents' is assigned a value but never used.","line":71,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":71,"endColumn":23},{"ruleId":"no-unused-vars","severity":1,"message":"'messageStatusEvents' is assigned a value but never used.","line":72,"column":5,"nodeType":"Identifier","messageId":"unusedVar","endLine":72,"endColumn":24,"suggestions":[{"messageId":"removeVar","data":{"varName":"messageStatusEvents"},"fix":{"range":[2230,2257],"text":""},"desc":"Remove unused variable 'messageStatusEvents'."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'messageStatusEvents' is assigned a value but never used.","line":72,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":72,"endColumn":24},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has missing dependencies: 'start' and 'stop'. Either include them or remove the dependency array.","line":122,"column":6,"nodeType":"ArrayExpression","endLine":122,"endColumn":17,"suggestions":[{"desc":"Update the dependencies array to be: [clientKey, start, stop]","fix":{"range":[3794,3805],"text":"[clientKey, start, stop]"}}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":13,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\"\r\n\r\nimport { useEffect, useState } from \"react\"\r\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\"\r\nimport { Badge } from \"@/components/ui/badge\"\r\nimport { Button } from \"@/components/ui/button\"\r\nimport { ScrollArea } from \"@/components/ui/scroll-area\"\r\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\"\r\nimport { \r\n  Wifi, \r\n  MessageSquare, \r\n  User, \r\n  Clock, \r\n  CheckCircle2,\r\n  AlertCircle,\r\n  Eye,\r\n  EyeOff\r\n} from \"lucide-react\"\r\nimport { useWhatsappSse } from \"@/hooks/use-whatsapp-sse\"\r\nimport { ChatPresenceList, type ChatPresenceData } from \"@/components/whatsapp-presence-indicator\"\r\nimport { MessageStatusList, type MessageStatusData } from \"@/components/whatsapp-message-status\"\r\nimport { API_BASE_URL } from \"@/lib/api-client\"\r\nimport { loadFromStorage } from \"@/lib/storage\"\r\n\r\ninterface WhatsAppStatusMonitorProps {\r\n  className?: string\r\n  maxHeight?: string\r\n  showControls?: boolean\r\n  sse?: any\r\n  presenceData?: ChatPresenceData[]\r\n  messageStatusData?: MessageStatusData[]\r\n}\r\n\r\nexport function WhatsAppStatusMonitor({ \r\n  className = \"\", \r\n  maxHeight = \"400px\",\r\n  showControls = true,\r\n  sse,\r\n  presenceData,\r\n  messageStatusData\r\n}: WhatsAppStatusMonitorProps) {\r\n  const [clientKey, setClientKey] = useState<string>(\"\")\r\n  const [chatPresences, setChatPresences] = useState<ChatPresenceData[]>([])\r\n  const [messageStatuses, setMessageStatuses] = useState<MessageStatusData[]>([])\r\n  const [autoScroll, setAutoScroll] = useState(true)\r\n  const [isConnected, setIsConnected] = useState(false)\r\n\r\n  // Get client key from storage or generate from current user\r\n  useEffect(() => {\r\n    const userId = loadFromStorage(\"current_user_id\", \"default_user\")\r\n    const config = loadFromStorage(\"whatsapp_config\", null)\r\n    \r\n    if (config?.instanceId) {\r\n      setClientKey(`instance:${config.instanceId}`)\r\n    } else {\r\n      setClientKey(`instance:${userId}`)\r\n    }\r\n  }, [])\r\n\r\n  // Use external SSE if provided, otherwise create internal one\r\n  const sseHook = sse || useWhatsappSse({\r\n    apiBase: API_BASE_URL,\r\n    clientKey\r\n  })\r\n\r\n  const { \r\n    connected, \r\n    error, \r\n    start, \r\n    stop, \r\n    chatPresenceEvents, \r\n    messageStatusEvents,\r\n    lastChatPresence,\r\n    lastMessageStatus\r\n  } = sseHook\r\n\r\n  // Update connection status\r\n  useEffect(() => {\r\n    setIsConnected(connected)\r\n  }, [connected])\r\n\r\n  // Process chat presence events\r\n  useEffect(() => {\r\n    if (presenceData) {\r\n      // Use external data if provided\r\n      setChatPresences(presenceData)\r\n    } else if (lastChatPresence) {\r\n      // Otherwise use internal SSE events\r\n      const presenceData = lastChatPresence.payload\r\n      setChatPresences(prev => {\r\n        const filtered = prev.filter(p => p.phone !== presenceData.phone)\r\n        return [...filtered, presenceData]\r\n      })\r\n    }\r\n  }, [lastChatPresence, presenceData])\r\n\r\n  // Process message status events\r\n  useEffect(() => {\r\n    if (messageStatusData) {\r\n      // Use external data if provided\r\n      setMessageStatuses(messageStatusData)\r\n    } else if (lastMessageStatus) {\r\n      // Otherwise use internal SSE events\r\n      const statusData = lastMessageStatus.payload\r\n      setMessageStatuses(prev => {\r\n        // Keep only recent statuses (last 50) to avoid memory issues\r\n        const filtered = prev.filter(s => s.phone !== statusData.phone || !statusData.ids.some((id: string) => s.ids.includes(id)))\r\n        const recent = [...filtered, statusData]\r\n        return recent.slice(-50) // Keep only last 50 statuses\r\n      })\r\n    }\r\n  }, [lastMessageStatus, messageStatusData])\r\n\r\n  // Auto-connect on mount\r\n  useEffect(() => {\r\n    if (clientKey) {\r\n      start()\r\n    }\r\n    return () => {\r\n      stop()\r\n    }\r\n  }, [clientKey])\r\n\r\n  const clearAll = () => {\r\n    setChatPresences([])\r\n    setMessageStatuses([])\r\n  }\r\n\r\n  const getConnectionStatusColor = () => {\r\n    if (error) return \"destructive\"\r\n    if (connected) return \"default\"\r\n    return \"secondary\"\r\n  }\r\n\r\n  const getConnectionStatusText = () => {\r\n    if (error) return \"Erro na conexão\"\r\n    if (connected) return \"Conectado\"\r\n    return \"Desconectado\"\r\n  }\r\n\r\n  return (\r\n    <Card className={className}>\r\n      <CardHeader className=\"pb-3\">\r\n        <div className=\"flex items-center justify-between\">\r\n          <CardTitle className=\"text-lg flex items-center gap-2\">\r\n            <MessageSquare className=\"h-5 w-5\" />\r\n            Monitor WhatsApp\r\n          </CardTitle>\r\n          <div className=\"flex items-center gap-2\">\r\n            <Badge variant={getConnectionStatusColor()}>\r\n              {getConnectionStatusText()}\r\n            </Badge>\r\n            {showControls && (\r\n              <>\r\n                <Button\r\n                  variant=\"ghost\"\r\n                  size=\"sm\"\r\n                  onClick={connected ? stop : start}\r\n                  className=\"h-8 px-2\"\r\n                >\r\n                  {connected ? <EyeOff className=\"h-4 w-4\" /> : <Eye className=\"h-4 w-4\" />}\r\n                </Button>\r\n                <Button\r\n                  variant=\"ghost\"\r\n                  size=\"sm\"\r\n                  onClick={clearAll}\r\n                  className=\"h-8 px-2\"\r\n                >\r\n                  <CheckCircle2 className=\"h-4 w-4\" />\r\n                </Button>\r\n              </>\r\n            )}\r\n          </div>\r\n        </div>\r\n        {error && (\r\n          <div className=\"flex items-center gap-2 text-sm text-destructive mt-2\">\r\n            <AlertCircle className=\"h-4 w-4\" />\r\n            {error}\r\n          </div>\r\n        )}\r\n      </CardHeader>\r\n      <CardContent>\r\n        <Tabs defaultValue=\"presence\" className=\"w-full\">\r\n          <TabsList className=\"grid w-full grid-cols-2\">\r\n            <TabsTrigger value=\"presence\" className=\"flex items-center gap-2\">\r\n              <Wifi className=\"h-4 w-4\" />\r\n              Presença ({chatPresences.length})\r\n            </TabsTrigger>\r\n            <TabsTrigger value=\"messages\" className=\"flex items-center gap-2\">\r\n              <MessageSquare className=\"h-4 w-4\" />\r\n              Mensagens ({messageStatuses.length})\r\n            </TabsTrigger>\r\n          </TabsList>\r\n          \r\n          <TabsContent value=\"presence\" className=\"mt-4\">\r\n            <ScrollArea className=\"rounded-md border\" style={{ maxHeight }}>\r\n              {chatPresences.length === 0 ? (\r\n                <div className=\"flex flex-col items-center justify-center p-8 text-center\">\r\n                  <User className=\"h-12 w-12 text-muted-foreground mb-2\" />\r\n                  <p className=\"text-sm text-muted-foreground\">\r\n                    Nenhum status de presença recebido ainda\r\n                  </p>\r\n                  <p className=\"text-xs text-muted-foreground mt-1\">\r\n                    Os status aparecerão aqui quando os contatos mudarem de status\r\n                  </p>\r\n                </div>\r\n              ) : (\r\n                <ChatPresenceList presences={chatPresences} />\r\n              )}\r\n            </ScrollArea>\r\n          </TabsContent>\r\n          \r\n          <TabsContent value=\"messages\" className=\"mt-4\">\r\n            <ScrollArea className=\"rounded-md border\" style={{ maxHeight }}>\r\n              {messageStatuses.length === 0 ? (\r\n                <div className=\"flex flex-col items-center justify-center p-8 text-center\">\r\n                  <MessageSquare className=\"h-12 w-12 text-muted-foreground mb-2\" />\r\n                  <p className=\"text-sm text-muted-foreground\">\r\n                    Nenhum status de mensagem recebido ainda\r\n                  </p>\r\n                  <p className=\"text-xs text-muted-foreground mt-1\">\r\n                    Os status aparecerão aqui quando as mensagens forem atualizadas\r\n                  </p>\r\n                </div>\r\n              ) : (\r\n                <MessageStatusList statuses={messageStatuses} />\r\n              )}\r\n            </ScrollArea>\r\n          </TabsContent>\r\n        </Tabs>\r\n      </CardContent>\r\n    </Card>\r\n  )\r\n}\r\n\r\ninterface WhatsAppStatusSidebarProps {\r\n  className?: string\r\n}\r\n\r\nexport function WhatsAppStatusSidebar({ className = \"\" }: WhatsAppStatusSidebarProps) {\r\n  return (\r\n    <div className={className}>\r\n      <WhatsAppStatusMonitor \r\n        maxHeight=\"600px\"\r\n        showControls={true}\r\n      />\r\n    </div>\r\n  )\r\n}","usedDeprecatedRules":[]},{"filePath":"C:\\Projetos\\Back_endCrm\\kanbanproject1\\hooks\\use-api-auth.ts","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'data' is defined but never used.","line":12,"column":11,"nodeType":"Identifier","messageId":"unusedVar","endLine":12,"endColumn":29,"suggestions":[{"messageId":"removeVar","data":{"varName":"data"},"fix":{"range":[351,369],"text":""},"desc":"Remove unused variable 'data'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'data' is defined but never used.","line":13,"column":14,"nodeType":"Identifier","messageId":"unusedVar","endLine":13,"endColumn":35,"suggestions":[{"messageId":"removeVar","data":{"varName":"data"},"fix":{"range":[402,423],"text":""},"desc":"Remove unused variable 'data'."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\"\r\n\r\nimport { useState, useEffect, useCallback } from \"react\"\r\nimport { authApi, type User, type LoginRequest, type RegisterRequest } from \"@/lib/api/auth-api\"\r\nimport { ApiError } from \"@/lib/api-client\"\r\n\r\ninterface UseAuthReturn {\r\n  user: User | null\r\n  isAuthenticated: boolean\r\n  isLoading: boolean\r\n  error: string | null\r\n  login: (data: LoginRequest) => Promise<void>\r\n  register: (data: RegisterRequest) => Promise<void>\r\n  logout: () => Promise<void>\r\n  refreshUser: () => Promise<void>\r\n  clearError: () => void\r\n}\r\n\r\nexport function useApiAuth(): UseAuthReturn {\r\n  const [user, setUser] = useState<User | null>(null)\r\n  const [isLoading, setIsLoading] = useState(true)\r\n  const [error, setError] = useState<string | null>(null)\r\n\r\n  // Initialize auth from localStorage and hydrate user via /auth/me\r\n  useEffect(() => {\r\n    const { user: storedUser, token } = authApi.initializeAuth()\r\n    setUser(storedUser)\r\n    if (token) {\r\n      setIsLoading(true)\r\n      \r\n      // Add 5s timeout to prevent infinite loading if backend is unreachable\r\n      const authCheckPromise = authApi.me()\r\n      const timeoutPromise = new Promise((_, reject) => \r\n        setTimeout(() => reject(new Error(\"Auth check timed out\")), 5000)\r\n      )\r\n\r\n      Promise.race([authCheckPromise, timeoutPromise])\r\n        .then((me) => {\r\n          setUser(me as User)\r\n          console.log(\"[v0] Auth initialized with token; user:\", me)\r\n        })\r\n        .catch((err) => {\r\n          console.warn(\"[v0] Auth init /auth/me failed; keeping stored user\", err)\r\n        })\r\n        .finally(() => setIsLoading(false))\r\n    } else {\r\n      setIsLoading(false)\r\n    }\r\n  }, [])\r\n\r\n  const login = useCallback(async (data: LoginRequest) => {\r\n    setIsLoading(true)\r\n    setError(null)\r\n\r\n    try {\r\n      const response = await authApi.login(data)\r\n      // Após login, garantir dados completos do usuário (inclui companyId)\r\n      try {\r\n        const me = await authApi.me()\r\n        setUser(me)\r\n        console.log(\"[v0] Login successful (me):\", me)\r\n      } catch (e) {\r\n        // Fallback para user retornado do login\r\n        setUser(response.user)\r\n        console.warn(\"[v0] /auth/me falhou após login; usando user da resposta de login.\", e)\r\n      }\r\n    } catch (err) {\r\n      const errorMessage = err instanceof ApiError ? err.message : \"Erro ao fazer login\"\r\n      setError(errorMessage)\r\n      console.error(\"[v0] Login error:\", err)\r\n      throw err\r\n    } finally {\r\n      setIsLoading(false)\r\n    }\r\n  }, [])\r\n\r\n  const register = useCallback(async (data: RegisterRequest) => {\r\n    setIsLoading(true)\r\n    setError(null)\r\n\r\n    try {\r\n      const response = await authApi.register(data)\r\n      try {\r\n        const me = await authApi.me()\r\n        setUser(me)\r\n        console.log(\"[v0] Registration successful (me):\", me)\r\n      } catch (e) {\r\n        setUser(response.user)\r\n        console.warn(\"[v0] /auth/me falhou após registro; usando user da resposta de registro.\", e)\r\n      }\r\n    } catch (err) {\r\n      const errorMessage = err instanceof ApiError ? err.message : \"Erro ao criar conta\"\r\n      setError(errorMessage)\r\n      console.error(\"[v0] Registration error:\", err)\r\n      throw err\r\n    } finally {\r\n      setIsLoading(false)\r\n    }\r\n  }, [])\r\n\r\n  const logout = useCallback(async () => {\r\n    setIsLoading(true)\r\n    setError(null)\r\n\r\n    try {\r\n      await authApi.logout()\r\n      setUser(null)\r\n      console.log(\"[v0] Logout successful\")\r\n    } catch (err) {\r\n      console.error(\"[v0] Logout error:\", err)\r\n      // Still clear user even if API call fails\r\n      setUser(null)\r\n    } finally {\r\n      setIsLoading(false)\r\n    }\r\n  }, [])\r\n\r\n  const refreshUser = useCallback(async () => {\r\n    if (!user) return\r\n\r\n    setIsLoading(true)\r\n    setError(null)\r\n\r\n    try {\r\n      const updatedUser = await authApi.me()\r\n      setUser(updatedUser)\r\n      console.log(\"[v0] User refreshed:\", updatedUser)\r\n    } catch (err) {\r\n      const errorMessage = err instanceof ApiError ? err.message : \"Erro ao atualizar usuário\"\r\n      setError(errorMessage)\r\n      console.error(\"[v0] Refresh user error:\", err)\r\n    } finally {\r\n      setIsLoading(false)\r\n    }\r\n  }, [user])\r\n\r\n  const clearError = useCallback(() => {\r\n    setError(null)\r\n  }, [])\r\n\r\n  return {\r\n    user,\r\n    isAuthenticated: !!user,\r\n    isLoading,\r\n    error,\r\n    login,\r\n    register,\r\n    logout,\r\n    refreshUser,\r\n    clearError,\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Projetos\\Back_endCrm\\kanbanproject1\\hooks\\use-api-funnels.ts","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'data' is defined but never used.","line":12,"column":18,"nodeType":"Identifier","messageId":"unusedVar","endLine":12,"endColumn":27,"suggestions":[{"messageId":"removeVar","data":{"varName":"data"},"fix":{"range":[337,346],"text":""},"desc":"Remove unused variable 'data'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'id' is defined but never used.","line":13,"column":18,"nodeType":"Identifier","messageId":"unusedVar","endLine":13,"endColumn":28,"suggestions":[{"messageId":"removeVar","data":{"varName":"id"},"fix":{"range":[385,396],"text":""},"desc":"Remove unused variable 'id'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'data' is defined but never used.","line":13,"column":30,"nodeType":"Identifier","messageId":"unusedVar","endLine":13,"endColumn":39,"suggestions":[{"messageId":"removeVar","data":{"varName":"data"},"fix":{"range":[395,406],"text":""},"desc":"Remove unused variable 'data'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'id' is defined but never used.","line":14,"column":18,"nodeType":"Identifier","messageId":"unusedVar","endLine":14,"endColumn":28,"suggestions":[{"messageId":"removeVar","data":{"varName":"id"},"fix":{"range":[445,455],"text":""},"desc":"Remove unused variable 'id'."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\"\r\n\r\nimport { useState, useEffect, useCallback } from \"react\"\r\nimport { funnelsApi, type Funnel } from \"@/lib/api/funnels-api\"\r\nimport { ApiError } from \"@/lib/api-client\"\r\n\r\ninterface UseFunnelsReturn {\r\n  funnels: Funnel[]\r\n  isLoading: boolean\r\n  error: string | null\r\n  fetchFunnels: () => Promise<void>\r\n  createFunnel: (data: any) => Promise<Funnel>\r\n  updateFunnel: (id: string, data: any) => Promise<Funnel>\r\n  deleteFunnel: (id: string) => Promise<void>\r\n  clearError: () => void\r\n}\r\n\r\nexport function useApiFunnels(): UseFunnelsReturn {\r\n  const [funnels, setFunnels] = useState<Funnel[]>([])\r\n  const [isLoading, setIsLoading] = useState(false)\r\n  const [error, setError] = useState<string | null>(null)\r\n\r\n  const fetchFunnels = useCallback(async () => {\r\n    setIsLoading(true)\r\n    setError(null)\r\n\r\n    try {\r\n      const data = await funnelsApi.getFunnels()\r\n      setFunnels(data)\r\n      console.log(\"[v0] Funnels fetched:\", data.length)\r\n    } catch (err) {\r\n      const errorMessage = err instanceof ApiError ? err.message : \"Erro ao carregar funis\"\r\n      setError(errorMessage)\r\n      console.error(\"[v0] Fetch funnels error:\", err)\r\n    } finally {\r\n      setIsLoading(false)\r\n    }\r\n  }, [])\r\n\r\n  const createFunnel = useCallback(async (data: any): Promise<Funnel> => {\r\n    setIsLoading(true)\r\n    setError(null)\r\n\r\n    try {\r\n      const newFunnel = await funnelsApi.createFunnel(data)\r\n      setFunnels((prev) => [...prev, newFunnel])\r\n      console.log(\"[v0] Funnel created:\", newFunnel)\r\n      return newFunnel\r\n    } catch (err) {\r\n      const errorMessage = err instanceof ApiError ? err.message : \"Erro ao criar funil\"\r\n      setError(errorMessage)\r\n      console.error(\"[v0] Create funnel error:\", err)\r\n      throw err\r\n    } finally {\r\n      setIsLoading(false)\r\n    }\r\n  }, [])\r\n\r\n  const updateFunnel = useCallback(async (id: string, data: any): Promise<Funnel> => {\r\n    setIsLoading(true)\r\n    setError(null)\r\n\r\n    try {\r\n      const updatedFunnel = await funnelsApi.updateFunnel(id, data)\r\n      setFunnels((prev) => prev.map((f) => (f.id === id ? updatedFunnel : f)))\r\n      console.log(\"[v0] Funnel updated:\", updatedFunnel)\r\n      return updatedFunnel\r\n    } catch (err) {\r\n      const errorMessage = err instanceof ApiError ? err.message : \"Erro ao atualizar funil\"\r\n      setError(errorMessage)\r\n      console.error(\"[v0] Update funnel error:\", err)\r\n      throw err\r\n    } finally {\r\n      setIsLoading(false)\r\n    }\r\n  }, [])\r\n\r\n  const deleteFunnel = useCallback(async (id: string): Promise<void> => {\r\n    setIsLoading(true)\r\n    setError(null)\r\n\r\n    try {\r\n      await funnelsApi.deleteFunnel(id)\r\n      setFunnels((prev) => prev.filter((f) => f.id !== id))\r\n      console.log(\"[v0] Funnel deleted:\", id)\r\n    } catch (err) {\r\n      const errorMessage = err instanceof ApiError ? err.message : \"Erro ao deletar funil\"\r\n      setError(errorMessage)\r\n      console.error(\"[v0] Delete funnel error:\", err)\r\n      throw err\r\n    } finally {\r\n      setIsLoading(false)\r\n    }\r\n  }, [])\r\n\r\n  const clearError = useCallback(() => {\r\n    setError(null)\r\n  }, [])\r\n\r\n  // Auto-fetch on mount\r\n  useEffect(() => {\r\n    fetchFunnels()\r\n  }, [fetchFunnels])\r\n\r\n  return {\r\n    funnels,\r\n    isLoading,\r\n    error,\r\n    fetchFunnels,\r\n    createFunnel,\r\n    updateFunnel,\r\n    deleteFunnel,\r\n    clearError,\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Projetos\\Back_endCrm\\kanbanproject1\\hooks\\use-api-leads.ts","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'params' is defined but never used.","line":17,"column":16,"nodeType":"Identifier","messageId":"unusedVar","endLine":17,"endColumn":41,"suggestions":[{"messageId":"removeVar","data":{"varName":"params"},"fix":{"range":[374,399],"text":""},"desc":"Remove unused variable 'params'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'data' is defined but never used.","line":18,"column":16,"nodeType":"Identifier","messageId":"unusedVar","endLine":18,"endColumn":39,"suggestions":[{"messageId":"removeVar","data":{"varName":"data"},"fix":{"range":[434,457],"text":""},"desc":"Remove unused variable 'data'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'id' is defined but never used.","line":19,"column":16,"nodeType":"Identifier","messageId":"unusedVar","endLine":19,"endColumn":26,"suggestions":[{"messageId":"removeVar","data":{"varName":"id"},"fix":{"range":[492,503],"text":""},"desc":"Remove unused variable 'id'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'data' is defined but never used.","line":19,"column":28,"nodeType":"Identifier","messageId":"unusedVar","endLine":19,"endColumn":51,"suggestions":[{"messageId":"removeVar","data":{"varName":"data"},"fix":{"range":[502,527],"text":""},"desc":"Remove unused variable 'data'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'id' is defined but never used.","line":20,"column":16,"nodeType":"Identifier","messageId":"unusedVar","endLine":20,"endColumn":26,"suggestions":[{"messageId":"removeVar","data":{"varName":"id"},"fix":{"range":[562,572],"text":""},"desc":"Remove unused variable 'id'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'id' is defined but never used.","line":21,"column":22,"nodeType":"Identifier","messageId":"unusedVar","endLine":21,"endColumn":32,"suggestions":[{"messageId":"removeVar","data":{"varName":"id"},"fix":{"range":[613,624],"text":""},"desc":"Remove unused variable 'id'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'status' is defined but never used.","line":21,"column":34,"nodeType":"Identifier","messageId":"unusedVar","endLine":21,"endColumn":48,"suggestions":[{"messageId":"removeVar","data":{"varName":"status"},"fix":{"range":[623,639],"text":""},"desc":"Remove unused variable 'status'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'notes' is defined but never used.","line":21,"column":50,"nodeType":"Identifier","messageId":"unusedVar","endLine":21,"endColumn":64,"suggestions":[{"messageId":"removeVar","data":{"varName":"notes"},"fix":{"range":[639,655],"text":""},"desc":"Remove unused variable 'notes'."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":8,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\"\r\n\r\nimport { useState, useEffect, useCallback } from \"react\"\r\nimport {\r\n  leadsApi,\r\n  type Lead,\r\n  type LeadsQueryParams,\r\n  type CreateLeadRequest,\r\n  type UpdateLeadRequest,\r\n} from \"@/lib/api/leads-api\"\r\nimport { ApiError } from \"@/lib/api-client\"\r\n\r\ninterface UseLeadsReturn {\r\n  leads: Lead[]\r\n  isLoading: boolean\r\n  error: string | null\r\n  fetchLeads: (params?: LeadsQueryParams) => Promise<void>\r\n  createLead: (data: CreateLeadRequest) => Promise<Lead>\r\n  updateLead: (id: string, data: UpdateLeadRequest) => Promise<Lead>\r\n  deleteLead: (id: string) => Promise<void>\r\n  updateLeadStatus: (id: string, status: string, notes?: string) => Promise<Lead>\r\n  clearError: () => void\r\n}\r\n\r\nexport function useApiLeads(initialParams?: LeadsQueryParams): UseLeadsReturn {\r\n  const [leads, setLeads] = useState<Lead[]>([])\r\n  const [isLoading, setIsLoading] = useState(false)\r\n  const [error, setError] = useState<string | null>(null)\r\n\r\n  const fetchLeads = useCallback(\r\n    async (params?: LeadsQueryParams) => {\r\n      setIsLoading(true)\r\n      setError(null)\r\n\r\n      try {\r\n        const data = await leadsApi.getLeads(params || initialParams)\r\n        setLeads(data)\r\n        console.log(\"[v0] Leads fetched:\", data.length)\r\n      } catch (err) {\r\n        const errorMessage = err instanceof ApiError ? err.message : \"Erro ao carregar leads\"\r\n        setError(errorMessage)\r\n        console.error(\"[v0] Fetch leads error:\", err)\r\n      } finally {\r\n        setIsLoading(false)\r\n      }\r\n    },\r\n    [initialParams],\r\n  )\r\n\r\n  const createLead = useCallback(async (data: CreateLeadRequest): Promise<Lead> => {\r\n    setIsLoading(true)\r\n    setError(null)\r\n\r\n    try {\r\n      const newLead = await leadsApi.createLead(data)\r\n      setLeads((prev) => [...prev, newLead])\r\n      console.log(\"[v0] Lead created:\", newLead)\r\n      return newLead\r\n    } catch (err) {\r\n      const errorMessage = err instanceof ApiError ? err.message : \"Erro ao criar lead\"\r\n      setError(errorMessage)\r\n      console.error(\"[v0] Create lead error:\", err)\r\n      throw err\r\n    } finally {\r\n      setIsLoading(false)\r\n    }\r\n  }, [])\r\n\r\n  const updateLead = useCallback(async (id: string, data: UpdateLeadRequest): Promise<Lead> => {\r\n    setIsLoading(true)\r\n    setError(null)\r\n\r\n    try {\r\n      const updatedLead = await leadsApi.updateLead(id, data)\r\n      setLeads((prev) => prev.map((lead) => (lead.id === id ? updatedLead : lead)))\r\n      console.log(\"[v0] Lead updated:\", updatedLead)\r\n      return updatedLead\r\n    } catch (err) {\r\n      const errorMessage = err instanceof ApiError ? err.message : \"Erro ao atualizar lead\"\r\n      setError(errorMessage)\r\n      console.error(\"[v0] Update lead error:\", err)\r\n      throw err\r\n    } finally {\r\n      setIsLoading(false)\r\n    }\r\n  }, [])\r\n\r\n  const deleteLead = useCallback(async (id: string): Promise<void> => {\r\n    setIsLoading(true)\r\n    setError(null)\r\n\r\n    try {\r\n      await leadsApi.deleteLead(id)\r\n      setLeads((prev) => prev.filter((lead) => lead.id !== id))\r\n      console.log(\"[v0] Lead deleted:\", id)\r\n    } catch (err) {\r\n      const errorMessage = err instanceof ApiError ? err.message : \"Erro ao deletar lead\"\r\n      setError(errorMessage)\r\n      console.error(\"[v0] Delete lead error:\", err)\r\n      throw err\r\n    } finally {\r\n      setIsLoading(false)\r\n    }\r\n  }, [])\r\n\r\n  const updateLeadStatus = useCallback(async (id: string, status: string, notes?: string): Promise<Lead> => {\r\n    setIsLoading(true)\r\n    setError(null)\r\n\r\n    try {\r\n      const updatedLead = await leadsApi.updateStatus(id, { status, notes })\r\n      setLeads((prev) => prev.map((lead) => (lead.id === id ? updatedLead : lead)))\r\n      console.log(\"[v0] Lead status updated:\", updatedLead)\r\n      return updatedLead\r\n    } catch (err) {\r\n      const errorMessage = err instanceof ApiError ? err.message : \"Erro ao atualizar status do lead\"\r\n      setError(errorMessage)\r\n      console.error(\"[v0] Update lead status error:\", err)\r\n      throw err\r\n    } finally {\r\n      setIsLoading(false)\r\n    }\r\n  }, [])\r\n\r\n  const clearError = useCallback(() => {\r\n    setError(null)\r\n  }, [])\r\n\r\n  // Auto-fetch on mount\r\n  useEffect(() => {\r\n    fetchLeads()\r\n  }, [fetchLeads])\r\n\r\n  return {\r\n    leads,\r\n    isLoading,\r\n    error,\r\n    fetchLeads,\r\n    createLead,\r\n    updateLead,\r\n    deleteLead,\r\n    updateLeadStatus,\r\n    clearError,\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Projetos\\Back_endCrm\\kanbanproject1\\hooks\\use-api-message-templates.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projetos\\Back_endCrm\\kanbanproject1\\hooks\\use-api-tags.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projetos\\Back_endCrm\\kanbanproject1\\hooks\\use-api-tasks.ts","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'data' is defined but never used.","line":13,"column":16,"nodeType":"Identifier","messageId":"unusedVar","endLine":13,"endColumn":25,"suggestions":[{"messageId":"removeVar","data":{"varName":"data"},"fix":{"range":[372,381],"text":""},"desc":"Remove unused variable 'data'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'id' is defined but never used.","line":14,"column":16,"nodeType":"Identifier","messageId":"unusedVar","endLine":14,"endColumn":26,"suggestions":[{"messageId":"removeVar","data":{"varName":"id"},"fix":{"range":[416,427],"text":""},"desc":"Remove unused variable 'id'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'data' is defined but never used.","line":14,"column":28,"nodeType":"Identifier","messageId":"unusedVar","endLine":14,"endColumn":37,"suggestions":[{"messageId":"removeVar","data":{"varName":"data"},"fix":{"range":[426,437],"text":""},"desc":"Remove unused variable 'data'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'id' is defined but never used.","line":15,"column":18,"nodeType":"Identifier","messageId":"unusedVar","endLine":15,"endColumn":28,"suggestions":[{"messageId":"removeVar","data":{"varName":"id"},"fix":{"range":[474,485],"text":""},"desc":"Remove unused variable 'id'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'status' is defined but never used.","line":15,"column":30,"nodeType":"Identifier","messageId":"unusedVar","endLine":15,"endColumn":91,"suggestions":[{"messageId":"removeVar","data":{"varName":"status"},"fix":{"range":[484,547],"text":""},"desc":"Remove unused variable 'status'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'id' is defined but never used.","line":16,"column":16,"nodeType":"Identifier","messageId":"unusedVar","endLine":16,"endColumn":26,"suggestions":[{"messageId":"removeVar","data":{"varName":"id"},"fix":{"range":[582,592],"text":""},"desc":"Remove unused variable 'id'."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useCallback has a missing dependency: 'user.companyId'. Either include it or remove the dependency array.","line":64,"column":6,"nodeType":"ArrayExpression","endLine":64,"endColumn":8,"suggestions":[{"desc":"Update the dependencies array to be: [user.companyId]","fix":{"range":[2163,2165],"text":"[user.companyId]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":7,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\"\r\n\r\nimport { useState, useEffect, useCallback } from \"react\"\r\nimport { useApiAuth } from \"@/hooks/use-api-auth\"\r\nimport { tasksApi, type Task } from \"@/lib/api/tasks-api\"\r\nimport { ApiError } from \"@/lib/api-client\"\r\n\r\ninterface UseTasksReturn {\r\n  tasks: Task[]\r\n  isLoading: boolean\r\n  error: string | null\r\n  fetchTasks: () => Promise<void>\r\n  createTask: (data: any) => Promise<Task>\r\n  updateTask: (id: string, data: any) => Promise<Task>\r\n  updateStatus: (id: string, status: \"pending\" | \"in_progress\" | \"completed\" | \"cancelled\") => Promise<Task>\r\n  deleteTask: (id: string) => Promise<void>\r\n  clearError: () => void\r\n}\r\n\r\nexport function useApiTasks(): UseTasksReturn {\r\n  const [tasks, setTasks] = useState<Task[]>([])\r\n  const [isLoading, setIsLoading] = useState(false)\r\n  const [error, setError] = useState<string | null>(null)\r\n  const { user } = useApiAuth()\r\n\r\n  const fetchTasks = useCallback(async () => {\r\n    setIsLoading(true)\r\n    setError(null)\r\n\r\n    try {\r\n      const params: any = {}\r\n      if (user?.companyId) params.companyId = user.companyId\r\n      const data = await tasksApi.getTasks(params)\r\n      setTasks(data)\r\n      console.log(\"[v0] Tasks fetched:\", data.length)\r\n    } catch (err) {\r\n      const errorMessage = err instanceof ApiError ? err.message : \"Erro ao carregar tarefas\"\r\n      setError(errorMessage)\r\n      console.error(\"[v0] Fetch tasks error:\", err)\r\n    } finally {\r\n      setIsLoading(false)\r\n    }\r\n  }, [user?.companyId])\r\n\r\n  const createTask = useCallback(async (data: any): Promise<Task> => {\r\n    setIsLoading(true)\r\n    setError(null)\r\n\r\n    try {\r\n      const payload = { ...data }\r\n      if (user?.companyId) payload.companyId = user.companyId\r\n      const newTask = await tasksApi.createTask(payload)\r\n      setTasks((prev) => [...prev, newTask])\r\n      console.log(\"[v0] Task created:\", newTask)\r\n      return newTask\r\n    } catch (err) {\r\n      const errorMessage = err instanceof ApiError ? err.message : \"Erro ao criar tarefa\"\r\n      setError(errorMessage)\r\n      console.error(\"[v0] Create task error:\", err)\r\n      throw err\r\n    } finally {\r\n      setIsLoading(false)\r\n    }\r\n  }, [])\r\n\r\n  const updateTask = useCallback(async (id: string, data: any): Promise<Task> => {\r\n    setIsLoading(true)\r\n    setError(null)\r\n\r\n    try {\r\n      const updatedTask = await tasksApi.updateTask(id, data)\r\n      setTasks((prev) => prev.map((t) => (t.id === id ? updatedTask : t)))\r\n      console.log(\"[v0] Task updated:\", updatedTask)\r\n      return updatedTask\r\n    } catch (err) {\r\n      const errorMessage = err instanceof ApiError ? err.message : \"Erro ao atualizar tarefa\"\r\n      setError(errorMessage)\r\n      console.error(\"[v0] Update task error:\", err)\r\n      throw err\r\n    } finally {\r\n      setIsLoading(false)\r\n    }\r\n  }, [])\r\n\r\n  const updateStatus = useCallback(async (id: string, status: \"pending\" | \"in_progress\" | \"completed\" | \"cancelled\"): Promise<Task> => {\r\n    setIsLoading(true)\r\n    setError(null)\r\n\r\n    try {\r\n      const updatedTask = await tasksApi.updateStatus(id, { status })\r\n      setTasks((prev) => prev.map((t) => (t.id === id ? updatedTask : t)))\r\n      console.log(\"[v0] Task status updated:\", updatedTask)\r\n      return updatedTask\r\n    } catch (err) {\r\n      const errorMessage = err instanceof ApiError ? err.message : \"Erro ao atualizar status da tarefa\"\r\n      setError(errorMessage)\r\n      console.error(\"[v0] Update task status error:\", err)\r\n      throw err\r\n    } finally {\r\n      setIsLoading(false)\r\n    }\r\n  }, [])\r\n\r\n  const deleteTask = useCallback(async (id: string): Promise<void> => {\r\n    setIsLoading(true)\r\n    setError(null)\r\n\r\n    try {\r\n      await tasksApi.deleteTask(id)\r\n      setTasks((prev) => prev.filter((t) => t.id !== id))\r\n      console.log(\"[v0] Task deleted:\", id)\r\n    } catch (err) {\r\n      const errorMessage = err instanceof ApiError ? err.message : \"Erro ao deletar tarefa\"\r\n      setError(errorMessage)\r\n      console.error(\"[v0] Delete task error:\", err)\r\n      throw err\r\n    } finally {\r\n      setIsLoading(false)\r\n    }\r\n  }, [])\r\n\r\n  const clearError = useCallback(() => {\r\n    setError(null)\r\n  }, [])\r\n\r\n  // Auto-fetch on mount\r\n  useEffect(() => {\r\n    fetchTasks()\r\n  }, [fetchTasks])\r\n\r\n  return {\r\n    tasks,\r\n    isLoading,\r\n    error,\r\n    fetchTasks,\r\n    createTask,\r\n    updateTask,\r\n    updateStatus,\r\n    deleteTask,\r\n    clearError,\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Projetos\\Back_endCrm\\kanbanproject1\\hooks\\use-builder.ts","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'parentId' is defined but never used.","line":16,"column":70,"nodeType":"Identifier","messageId":"unusedVar","endLine":16,"endColumn":87,"suggestions":[{"messageId":"removeVar","data":{"varName":"parentId"},"fix":{"range":[545,564],"text":""},"desc":"Remove unused variable 'parentId'."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'parentId' is defined but never used.","line":16,"column":70,"nodeType":null,"messageId":"unusedVar","endLine":16,"endColumn":78}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\nimport { useState, useCallback } from 'react';\nimport { v4 as uuidv4 } from 'uuid';\nimport { BuilderElement, ElementType, COMPONENT_DEFINITIONS } from '@/lib/types/builder-types';\nimport { \n  findElementById, \n  removeElementById, \n  updateElementById,\n  insertElementAfter\n} from '@/lib/builder/tree-utils';\n\nexport function useBuilder() {\n  const [elements, setElements] = useState<BuilderElement[]>([]);\n  const [selectedId, setSelectedId] = useState<string | null>(null);\n\n  const addElement = useCallback((type: ElementType, index?: number, parentId?: string) => {\n    const definition = COMPONENT_DEFINITIONS.find(c => c.type === type);\n    if (!definition) return;\n\n    let children: BuilderElement[] | undefined = undefined;\n\n    if (type === 'section') {\n      children = [];\n    } else if (type === 'columns') {\n      // Create 2 default columns\n      children = [\n        {\n          id: uuidv4(),\n          type: 'column',\n          content: {},\n          styles: {},\n          children: []\n        },\n        {\n          id: uuidv4(),\n          type: 'column',\n          content: {},\n          styles: {},\n          children: []\n        }\n      ];\n    } else if (type === 'column') {\n      children = [];\n    }\n\n    const newElement: BuilderElement = {\n      id: uuidv4(),\n      type,\n      content: { \n        ...definition.defaultContent,\n        columns: type === 'columns' ? 2 : undefined\n      },\n      styles: { ...definition.defaultStyles },\n      children\n    };\n\n    setElements(prev => {\n      // If parentId is provided, we would add to that parent (not implemented in this simplified addElement yet, \n      // usually handled by dnd or specific insertion logic)\n      \n      if (index !== undefined) {\n        const updated = [...prev];\n        updated.splice(index, 0, newElement);\n        return updated;\n      }\n      return [...prev, newElement];\n    });\n\n    setSelectedId(newElement.id);\n  }, []);\n\n  const updateElement = useCallback((id: string, updates: Partial<BuilderElement>) => {\n    setElements(prev => updateElementById(prev, id, updates));\n  }, []);\n\n  const deleteElement = useCallback((id: string) => {\n    setElements(prev => removeElementById(prev, id));\n    if (selectedId === id) {\n      setSelectedId(null);\n    }\n  }, [selectedId]);\n\n  const duplicateElement = useCallback((id: string) => {\n    const location = findElementById(elements, id);\n    if (!location) return;\n\n    const element = location.element;\n\n    // Deep clone with new IDs\n    const cloneElement = (el: BuilderElement): BuilderElement => ({\n      ...el,\n      id: uuidv4(),\n      content: { ...el.content },\n      styles: { ...el.styles },\n      children: el.children ? el.children.map(cloneElement) : undefined\n    });\n\n    const newElement = cloneElement(element);\n\n    setElements(prev => insertElementAfter(prev, id, newElement));\n  }, [elements]);\n\n  const moveElement = useCallback((fromIndex: number, toIndex: number) => {\n    // This is only for root level reordering for now, until we fully implement nested DnD\n    setElements(prev => {\n      const updated = [...prev];\n      const [removed] = updated.splice(fromIndex, 1);\n      updated.splice(toIndex, 0, removed);\n      return updated;\n    });\n  }, []);\n\n  const selectedElementLocation = selectedId ? findElementById(elements, selectedId) : null;\n  const selectedElement = selectedElementLocation?.element || null;\n\n  return {\n    elements,\n    selectedId,\n    selectedElement,\n    setSelectedId,\n    addElement,\n    updateElement,\n    deleteElement,\n    duplicateElement,\n    moveElement,\n    setElements\n  };\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Projetos\\Back_endCrm\\kanbanproject1\\hooks\\use-mass-action-assistant.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projetos\\Back_endCrm\\kanbanproject1\\hooks\\use-mobile.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projetos\\Back_endCrm\\kanbanproject1\\hooks\\use-permissions.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projetos\\Back_endCrm\\kanbanproject1\\hooks\\use-qr.ts","messages":[{"ruleId":"prefer-const","severity":2,"message":"'value' is never reassigned. Use 'const' instead.","line":56,"column":9,"nodeType":"Identifier","messageId":"useConst","endLine":56,"endColumn":29,"fix":{"range":[1694,1740],"text":"const value: string | null = json?.value || null"}}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":1,"fixableWarningCount":0,"source":"\"use client\"\r\n\r\nimport { useCallback, useEffect, useRef, useState } from \"react\"\r\n\r\nexport type UseQrOptions = {\r\n  apiBase: string\r\n  token?: string | null\r\n  clientToken?: string | null\r\n  cacheBuster?: boolean\r\n}\r\n\r\nexport type UseQrResult = {\r\n  src: string | null\r\n  loading: boolean\r\n  error: string | null\r\n  generate: () => Promise<void>\r\n  revoke: () => void\r\n}\r\n\r\nfunction safeApiBase(apiBase: string) {\r\n  if (!apiBase) return \"\"\r\n  return apiBase.endsWith(\"/\") ? apiBase.slice(0, -1) : apiBase\r\n}\r\n\r\nfunction cleanBase64(b64raw: string) {\r\n  if (!b64raw) return null\r\n  const comma = b64raw.indexOf(\",\")\r\n  let raw = comma >= 0 ? b64raw.slice(comma + 1) : b64raw\r\n  raw = raw.replace(/\\s+/g, \"\")\r\n  raw = raw.replace(/[^A-Za-z0-9+/=]/g, \"\")\r\n  const mod = raw.length % 4\r\n  if (mod !== 0) raw = raw + \"=\".repeat(4 - mod)\r\n  return raw\r\n}\r\n\r\nasync function tryFetchPublicImage(imageUrl: string): Promise<boolean> {\r\n  try {\r\n    const resp = await fetch(imageUrl, { method: \"GET\", credentials: \"include\" })\r\n    if (!resp.ok) return false\r\n    const ct = resp.headers.get(\"content-type\") || \"\"\r\n    if (ct.includes(\"image\")) return true\r\n    return false\r\n  } catch {\r\n    return false\r\n  }\r\n}\r\n\r\nasync function fetchJsonQr(apiBase: string, token?: string | null): Promise<string | null> {\r\n  try {\r\n    const url = `${apiBase}/whatsapp/qr`\r\n    const headers: Record<string, string> = { Accept: \"application/json\" }\r\n    if (token) headers[\"Authorization\"] = `Bearer ${token}`\r\n    const resp = await fetch(url, { method: \"GET\", headers, credentials: token ? \"omit\" : \"include\" })\r\n    if (!resp.ok) throw new Error(`status ${resp.status}`)\r\n    const json = await resp.json()\r\n    let value: string | null = json?.value || null\r\n    if (!value) return null\r\n    const comma = value.indexOf(\",\")\r\n    if (comma >= 0) {\r\n      const meta = value.slice(0, comma + 1)\r\n      const raw = value.slice(comma + 1)\r\n      const cleaned = cleanBase64(raw)\r\n      if (!cleaned) return null\r\n      return meta + cleaned\r\n    } else {\r\n      const cleaned = cleanBase64(value)\r\n      if (!cleaned) return null\r\n      return \"data:image/png;base64,\" + cleaned\r\n    }\r\n  } catch {\r\n    return null\r\n  }\r\n}\r\n\r\nasync function fetchImageBlobAsObjectUrl(apiBase: string, token?: string | null): Promise<string | null> {\r\n  try {\r\n    const url = `${apiBase}/whatsapp/qr/image`\r\n    const headers: Record<string, string> = {}\r\n    if (token) headers[\"Authorization\"] = `Bearer ${token}`\r\n    const resp = await fetch(url, { method: \"GET\", headers, credentials: token ? \"omit\" : \"include\" })\r\n    if (!resp.ok) throw new Error(`status ${resp.status}`)\r\n    const blob = await resp.blob()\r\n    if (!blob) return null\r\n    return URL.createObjectURL(blob)\r\n  } catch {\r\n    return null\r\n  }\r\n}\r\n\r\nfunction dataUrlToObjectUrl(dataUrl: string): string | null {\r\n  try {\r\n    const idx = dataUrl.indexOf(\",\")\r\n    const meta = idx >= 0 ? dataUrl.slice(0, idx) : \"data:image/png;base64,\"\r\n    const raw = idx >= 0 ? dataUrl.slice(idx + 1) : dataUrl\r\n    const cleaned = cleanBase64(raw)\r\n    if (!cleaned) return null\r\n    const bytes = atob(cleaned)\r\n    const arr = new Uint8Array(bytes.length)\r\n    for (let i = 0; i < bytes.length; i++) arr[i] = bytes.charCodeAt(i)\r\n    const type = meta.match(/^data:([^;]+);/)?.[1] || \"image/png\"\r\n    const blob = new Blob([arr], { type })\r\n    return URL.createObjectURL(blob)\r\n  } catch {\r\n    return null\r\n  }\r\n}\r\n\r\nexport function useQr(opts: UseQrOptions): UseQrResult {\r\n  const apiBase = safeApiBase(opts.apiBase || \"\")\r\n  const token = opts.token || null\r\n  const cacheBuster = opts.cacheBuster ?? true\r\n  const [src, setSrc] = useState<string | null>(null)\r\n  const [loading, setLoading] = useState(false)\r\n  const [error, setError] = useState<string | null>(null)\r\n  const currentObjectUrl = useRef<string | null>(null)\r\n\r\n  const revoke = useCallback(() => {\r\n    if (currentObjectUrl.current) {\r\n      try {\r\n        URL.revokeObjectURL(currentObjectUrl.current)\r\n      } catch {}\r\n      currentObjectUrl.current = null\r\n    }\r\n    setSrc(null)\r\n  }, [])\r\n\r\n  const generate = useCallback(async () => {\r\n    setLoading(true)\r\n    setError(null)\r\n    if (currentObjectUrl.current) {\r\n      try { URL.revokeObjectURL(currentObjectUrl.current) } catch {}\r\n      currentObjectUrl.current = null\r\n    }\r\n\r\n    try {\r\n      const ts = cacheBuster ? `?ts=${Date.now()}` : \"\"\r\n      const publicUrl = `${apiBase}/whatsapp/qr/image${ts}`\r\n      const ok = await tryFetchPublicImage(publicUrl)\r\n      if (ok) {\r\n        setSrc(publicUrl)\r\n        setLoading(false)\r\n        return\r\n      }\r\n\r\n      if (token) {\r\n        const dataUrl = await fetchJsonQr(apiBase, token)\r\n        if (dataUrl) {\r\n          const url = dataUrlToObjectUrl(dataUrl)\r\n          if (url) {\r\n            currentObjectUrl.current = url\r\n            setSrc(url)\r\n            setLoading(false)\r\n            return\r\n          }\r\n        }\r\n\r\n        const blobUrl = await fetchImageBlobAsObjectUrl(apiBase, token)\r\n        if (blobUrl) {\r\n          currentObjectUrl.current = blobUrl\r\n          setSrc(blobUrl)\r\n          setLoading(false)\r\n          return\r\n        }\r\n      }\r\n\r\n      setError(\"Falha ao obter QR Code\")\r\n    } catch (e: any) {\r\n      setError(e?.message || \"Erro ao gerar QR\")\r\n    } finally {\r\n      setLoading(false)\r\n    }\r\n  }, [apiBase, token, cacheBuster])\r\n\r\n  useEffect(() => {\r\n    return () => {\r\n      if (currentObjectUrl.current) {\r\n        try { URL.revokeObjectURL(currentObjectUrl.current) } catch {}\r\n        currentObjectUrl.current = null\r\n      }\r\n    }\r\n  }, [])\r\n\r\n  return { src, loading, error, generate, revoke }\r\n}\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Projetos\\Back_endCrm\\kanbanproject1\\hooks\\use-toast.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'actionTypes' is assigned a value but only used as a type.","line":16,"column":7,"nodeType":null,"messageId":"usedOnlyAsType","endLine":16,"endColumn":18},{"ruleId":"no-unused-vars","severity":1,"message":"'state' is defined but never used.","line":123,"column":25,"nodeType":"Identifier","messageId":"unusedVar","endLine":123,"endColumn":37,"suggestions":[{"messageId":"removeVar","data":{"varName":"state"},"fix":{"range":[2635,2647],"text":""},"desc":"Remove unused variable 'state'."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\"\r\n\r\nimport * as React from \"react\"\r\n\r\nconst TOAST_LIMIT = 1\r\nconst TOAST_REMOVE_DELAY = 1000000\r\n\r\ntype ToasterToast = {\r\n  id: string\r\n  title?: React.ReactNode\r\n  description?: React.ReactNode\r\n  action?: React.ReactElement\r\n  variant?: \"default\" | \"destructive\"\r\n}\r\n\r\nconst actionTypes = {\r\n  ADD_TOAST: \"ADD_TOAST\",\r\n  UPDATE_TOAST: \"UPDATE_TOAST\",\r\n  DISMISS_TOAST: \"DISMISS_TOAST\",\r\n  REMOVE_TOAST: \"REMOVE_TOAST\",\r\n} as const\r\n\r\nlet count = 0\r\n\r\nfunction genId() {\r\n  count = (count + 1) % Number.MAX_SAFE_INTEGER\r\n  return count.toString()\r\n}\r\n\r\ntype ActionType = typeof actionTypes\r\n\r\ntype Action =\r\n  | {\r\n      type: ActionType[\"ADD_TOAST\"]\r\n      toast: ToasterToast\r\n    }\r\n  | {\r\n      type: ActionType[\"UPDATE_TOAST\"]\r\n      toast: Partial<ToasterToast>\r\n    }\r\n  | {\r\n      type: ActionType[\"DISMISS_TOAST\"]\r\n      toastId?: ToasterToast[\"id\"]\r\n    }\r\n  | {\r\n      type: ActionType[\"REMOVE_TOAST\"]\r\n      toastId?: ToasterToast[\"id\"]\r\n    }\r\n\r\ninterface State {\r\n  toasts: ToasterToast[]\r\n}\r\n\r\nconst toastTimeouts = new Map<string, ReturnType<typeof setTimeout>>()\r\n\r\nconst addToRemoveQueue = (toastId: string) => {\r\n  if (toastTimeouts.has(toastId)) {\r\n    return\r\n  }\r\n\r\n  const timeout = setTimeout(() => {\r\n    toastTimeouts.delete(toastId)\r\n    dispatch({\r\n      type: \"REMOVE_TOAST\",\r\n      toastId: toastId,\r\n    })\r\n  }, TOAST_REMOVE_DELAY)\r\n\r\n  toastTimeouts.set(toastId, timeout)\r\n}\r\n\r\nexport const reducer = (state: State, action: Action): State => {\r\n  switch (action.type) {\r\n    case \"ADD_TOAST\":\r\n      return {\r\n        ...state,\r\n        toasts: [action.toast, ...state.toasts].slice(0, TOAST_LIMIT),\r\n      }\r\n\r\n    case \"UPDATE_TOAST\":\r\n      return {\r\n        ...state,\r\n        toasts: state.toasts.map((t) => (t.id === action.toast.id ? { ...t, ...action.toast } : t)),\r\n      }\r\n\r\n    case \"DISMISS_TOAST\": {\r\n      const { toastId } = action\r\n\r\n      if (toastId) {\r\n        addToRemoveQueue(toastId)\r\n      } else {\r\n        state.toasts.forEach((toast) => {\r\n          addToRemoveQueue(toast.id)\r\n        })\r\n      }\r\n\r\n      return {\r\n        ...state,\r\n        toasts: state.toasts.map((t) =>\r\n          t.id === toastId || toastId === undefined\r\n            ? {\r\n                ...t,\r\n                open: false,\r\n              }\r\n            : t,\r\n        ),\r\n      }\r\n    }\r\n    case \"REMOVE_TOAST\":\r\n      if (action.toastId === undefined) {\r\n        return {\r\n          ...state,\r\n          toasts: [],\r\n        }\r\n      }\r\n      return {\r\n        ...state,\r\n        toasts: state.toasts.filter((t) => t.id !== action.toastId),\r\n      }\r\n  }\r\n}\r\n\r\nconst listeners: Array<(state: State) => void> = []\r\n\r\nlet memoryState: State = { toasts: [] }\r\n\r\nfunction dispatch(action: Action) {\r\n  memoryState = reducer(memoryState, action)\r\n  listeners.forEach((listener) => {\r\n    listener(memoryState)\r\n  })\r\n}\r\n\r\ntype Toast = Omit<ToasterToast, \"id\">\r\n\r\nfunction toast({ ...props }: Toast) {\r\n  const id = genId()\r\n\r\n  const update = (props: ToasterToast) =>\r\n    dispatch({\r\n      type: \"UPDATE_TOAST\",\r\n      toast: { ...props, id },\r\n    })\r\n  const dismiss = () => dispatch({ type: \"DISMISS_TOAST\", toastId: id })\r\n\r\n  dispatch({\r\n    type: \"ADD_TOAST\",\r\n    toast: {\r\n      ...props,\r\n      id,\r\n      onOpenChange: (open: boolean) => {\r\n        if (!open) dismiss()\r\n      },\r\n    } as any,\r\n  })\r\n\r\n  return {\r\n    id: id,\r\n    dismiss,\r\n    update,\r\n  }\r\n}\r\n\r\nfunction useToast() {\r\n  const [state, setState] = React.useState<State>(memoryState)\r\n\r\n  React.useEffect(() => {\r\n    listeners.push(setState)\r\n    return () => {\r\n      const index = listeners.indexOf(setState)\r\n      if (index > -1) {\r\n        listeners.splice(index, 1)\r\n      }\r\n    }\r\n  }, [state])\r\n\r\n  return {\r\n    ...state,\r\n    toast,\r\n    dismiss: (toastId?: string) => dispatch({ type: \"DISMISS_TOAST\", toastId }),\r\n  }\r\n}\r\n\r\nexport { useToast, toast }\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Projetos\\Back_endCrm\\kanbanproject1\\hooks\\use-whatsapp-sse.ts","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'ev' is defined but never used.","line":65,"column":34,"nodeType":"Identifier","messageId":"unusedVar","endLine":65,"endColumn":50,"suggestions":[{"messageId":"removeVar","data":{"varName":"ev"},"fix":{"range":[2255,2271],"text":""},"desc":"Remove unused variable 'ev'."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'ev' is defined but never used.","line":65,"column":34,"nodeType":null,"messageId":"unusedVar","endLine":65,"endColumn":36}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\"\r\n\r\nimport { useEffect, useRef, useState, useCallback } from \"react\"\r\n\r\nexport type UseWhatsappSseOptions = {\r\n  apiBase: string\r\n  clientKey?: string\r\n}\r\n\r\nexport type WhatsAppEvent = {\r\n  type: \"message\" | \"chat_presence\" | \"message_status\"\r\n  payload: any\r\n}\r\n\r\nexport type UseWhatsappSseResult<T = any> = {\r\n  events: T[]\r\n  lastEvent: T | null\r\n  connected: boolean\r\n  error: string | null\r\n  start: () => void\r\n  stop: () => void\r\n  clear: () => void\r\n  chatPresenceEvents: WhatsAppEvent[]\r\n  messageStatusEvents: WhatsAppEvent[]\r\n  lastChatPresence: WhatsAppEvent | null\r\n  lastMessageStatus: WhatsAppEvent | null\r\n}\r\n\r\nfunction safeBase(apiBase: string) {\r\n  return apiBase.endsWith(\"/\") ? apiBase.slice(0, -1) : apiBase\r\n}\r\n\r\nexport function useWhatsappSse<T = any>(opts: UseWhatsappSseOptions): UseWhatsappSseResult<T> {\r\n  const apiBase = safeBase(opts.apiBase || \"\")\r\n  const clientKey = opts.clientKey || \"\"\r\n  const [events, setEvents] = useState<T[]>([])\r\n  const [lastEvent, setLastEvent] = useState<T | null>(null)\r\n  const [connected, setConnected] = useState(false)\r\n  const [error, setError] = useState<string | null>(null)\r\n  const [chatPresenceEvents, setChatPresenceEvents] = useState<WhatsAppEvent[]>([])\r\n  const [messageStatusEvents, setMessageStatusEvents] = useState<WhatsAppEvent[]>([])\r\n  const [lastChatPresence, setLastChatPresence] = useState<WhatsAppEvent | null>(null)\r\n  const [lastMessageStatus, setLastMessageStatus] = useState<WhatsAppEvent | null>(null)\r\n  const esRef = useRef<EventSource | null>(null)\r\n\r\n  const stop = useCallback(() => {\r\n    if (esRef.current) {\r\n      try { esRef.current.close() } catch {}\r\n      esRef.current = null\r\n    }\r\n    setConnected(false)\r\n  }, [])\r\n\r\n  const start = useCallback(() => {\r\n    setError(null)\r\n    const url = clientKey ? `${apiBase}/whatsapp/stream?clientKey=${encodeURIComponent(clientKey)}` : `${apiBase}/whatsapp/stream`\r\n    const es = new EventSource(url)\r\n    esRef.current = es\r\n    es.addEventListener(\"open\", () => setConnected(true))\r\n    es.addEventListener(\"error\", () => {\r\n      // Silenciar erros de reconexão do SSE para evitar ruído no console\r\n      setConnected(false)\r\n      setError(null)\r\n    })\r\n    es.addEventListener(\"init\", (ev: MessageEvent) => {\r\n      // ignore or log init\r\n    })\r\n    es.addEventListener(\"message\", (ev: MessageEvent) => {\r\n      try {\r\n        const data = JSON.parse(ev.data)\r\n        \r\n        // Handle different event types\r\n        if (data.type === \"chat_presence\") {\r\n          const event: WhatsAppEvent = {\r\n            type: \"chat_presence\",\r\n            payload: data\r\n          }\r\n          setLastChatPresence(event)\r\n          setChatPresenceEvents(prev => [...prev, event])\r\n        } else if (data.type === \"message_status\") {\r\n          const event: WhatsAppEvent = {\r\n            type: \"message_status\",\r\n            payload: data\r\n          }\r\n          setLastMessageStatus(event)\r\n          setMessageStatusEvents(prev => [...prev, event])\r\n        } else {\r\n          // Default message handling (backward compatibility)\r\n          setLastEvent(data as T)\r\n          setEvents(prev => [...prev, data as T])\r\n        }\r\n      } catch (error) {\r\n        console.error(\"Error parsing SSE data:\", error)\r\n      }\r\n    })\r\n  }, [apiBase, clientKey])\r\n\r\n  const clear = useCallback(() => {\r\n    setEvents([])\r\n    setLastEvent(null)\r\n    setChatPresenceEvents([])\r\n    setMessageStatusEvents([])\r\n    setLastChatPresence(null)\r\n    setLastMessageStatus(null)\r\n  }, [])\r\n\r\n  useEffect(() => {\r\n    return () => { stop() }\r\n  }, [stop])\r\n\r\n  return { \r\n    events, \r\n    lastEvent, \r\n    connected, \r\n    error, \r\n    start, \r\n    stop, \r\n    clear,\r\n    chatPresenceEvents,\r\n    messageStatusEvents,\r\n    lastChatPresence,\r\n    lastMessageStatus\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Projetos\\Back_endCrm\\kanbanproject1\\index.js","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'React' is defined but never used.","line":1,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":1,"endColumn":13,"suggestions":[{"messageId":"removeVar","data":{"varName":"React"},"fix":{"range":[7,18],"text":""},"desc":"Remove unused variable 'React'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'App' is defined but never used.","line":3,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":3,"endColumn":11,"suggestions":[{"messageId":"removeVar","data":{"varName":"App"},"fix":{"range":[75,84],"text":""},"desc":"Remove unused variable 'App'."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from \"react\"\r\nimport ReactDOM from \"react-dom/client\"\r\nimport App from \"./components/App\"\r\n\r\nconst root = ReactDOM.createRoot(document.getElementById(\"root\"))\r\nroot.render(\r\n  <React.StrictMode>\r\n    <App />\r\n  </React.StrictMode>,\r\n)\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Projetos\\Back_endCrm\\kanbanproject1\\lib\\api-client.ts","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'status' is defined but never used.","line":23,"column":12,"nodeType":"Identifier","messageId":"unusedVar","endLine":23,"endColumn":26,"suggestions":[{"messageId":"removeVar","data":{"varName":"status"},"fix":{"range":[852,866],"text":""},"desc":"Remove unused variable 'status'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'data' is defined but never used.","line":24,"column":12,"nodeType":"Identifier","messageId":"unusedVar","endLine":24,"endColumn":22,"suggestions":[{"messageId":"removeVar","data":{"varName":"data"},"fix":{"range":[880,890],"text":""},"desc":"Remove unused variable 'data'."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// Prefer a local same-site base URL in development to ensure cookies are sent.\r\n// If running in the browser, derive API URL from current origin, mapping port 3000 -> 8080.\r\n// Fallback to NEXT_PUBLIC_API_URL or localhost when window is not available.\r\nconst API_BASE_URL = (() => {\r\n  const envUrl = (typeof process !== \"undefined\" && process.env?.NEXT_PUBLIC_API_URL) || undefined\r\n  if (envUrl) return envUrl\r\n  if (typeof window !== \"undefined\") {\r\n    const origin = window.location.origin\r\n    try {\r\n      const url = new URL(origin)\r\n      const backendOrigin = `${url.protocol}//${url.hostname}:8080`\r\n      return `${backendOrigin}/api`\r\n    } catch {\r\n      return \"http://localhost:8080/api\"\r\n    }\r\n  }\r\n  return \"http://localhost:8080/api\"\r\n})()\r\n\r\nexport class ApiError extends Error {\r\n  constructor(\r\n    message: string,\r\n    public status: number,\r\n    public data?: any,\r\n  ) {\r\n    super(message)\r\n    this.name = \"ApiError\"\r\n  }\r\n}\r\n\r\nclass ApiClient {\r\n  private baseUrl: string\r\n  private token: string | null = null\r\n\r\n  constructor(baseUrl: string) {\r\n    this.baseUrl = baseUrl\r\n  }\r\n\r\n  setToken(token: string | null) {\r\n    this.token = token\r\n    console.log(\"[v0] API token updated:\", token ? \"Token set\" : \"Token cleared\")\r\n  }\r\n\r\n  getToken(): string | null {\r\n    return this.token\r\n  }\r\n\r\n  private async request<T>(endpoint: string, options: RequestInit = {}): Promise<T> {\r\n    const url = `${this.baseUrl}${endpoint}`\r\n\r\n    const headers: Record<string, string> = {\r\n      \"Content-Type\": \"application/json\",\r\n      ...(options.headers as Record<string, string> || {}),\r\n    }\r\n\r\n    // Bypass ngrok free abuse warning\r\n    if (this.baseUrl.includes(\"ngrok-free.dev\") || this.baseUrl.includes(\"ngrok.app\")) {\r\n      headers[\"ngrok-skip-browser-warning\"] = \"true\"\r\n    }\r\n\r\n    if (this.token) {\r\n      headers[\"Authorization\"] = `Bearer ${this.token}`\r\n      console.log(\"[v0] Adding token to request:\", { tokenExists: !!this.token })\r\n    }\r\n\r\n    console.log(\"[v0] API Request:\", {\r\n      method: options.method || \"GET\",\r\n      url,\r\n      hasToken: !!this.token,\r\n      hasBody: !!options.body,\r\n    })\r\n\r\n    try {\r\n      const response = await fetch(url, {\r\n        ...options,\r\n        headers,\r\n        credentials: \"include\", // include cookies for auth\r\n      })\r\n\r\n      console.log(\"[v0] API Response:\", {\r\n        status: response.status,\r\n        statusText: response.statusText,\r\n        url,\r\n      })\r\n\r\n      if (!response.ok) {\r\n        let errorData\r\n        try {\r\n          errorData = await response.json()\r\n        } catch {\r\n          errorData = { message: response.statusText }\r\n        }\r\n\r\n        // Handle 401 Unauthorized - redirect to login\r\n        if (response.status === 401) {\r\n          console.error(\"[v0] 401 Unauthorized - clearing token and redirecting to login\")\r\n          this.token = null\r\n          localStorage.removeItem(\"unicrm_access_token\")\r\n          \r\n          // Redirect to login page\r\n          if (typeof window !== \"undefined\") {\r\n            window.location.href = \"/login\"\r\n          }\r\n          \r\n          throw new ApiError(\"Sessão expirada. Por favor, faça login novamente.\", 401, errorData)\r\n        }\r\n\r\n        throw new ApiError(errorData.error || errorData.message || \"Request failed\", response.status, errorData)\r\n      }\r\n\r\n      // Handle 204 No Content\r\n      if (response.status === 204) {\r\n        return {} as T\r\n      }\r\n\r\n      return await response.json()\r\n    } catch (error) {\r\n      if (error instanceof ApiError) {\r\n        throw error\r\n      }\r\n\r\n      console.error(\"[v0] API Request failed:\", error)\r\n      throw new ApiError(\"Network error or server unavailable\", 0, error)\r\n    }\r\n  }\r\n\r\n  // GET request\r\n  async get<T>(endpoint: string, params?: Record<string, any>): Promise<T> {\r\n    const queryString = params ? \"?\" + new URLSearchParams(params).toString() : \"\"\r\n\r\n    return this.request<T>(`${endpoint}${queryString}`, {\r\n      method: \"GET\",\r\n    })\r\n  }\r\n\r\n  // POST request\r\n  async post<T>(endpoint: string, data?: any): Promise<T> {\r\n    return this.request<T>(endpoint, {\r\n      method: \"POST\",\r\n      body: data ? JSON.stringify(data) : undefined,\r\n    })\r\n  }\r\n\r\n  // POST request que retorna texto bruto (para QR code)\r\n  async postText(endpoint: string, data?: any): Promise<string> {\r\n    const url = `${this.baseUrl}${endpoint}`\r\n\r\n    const headers: Record<string, string> = {\r\n      \"Content-Type\": \"application/json\",\r\n    }\r\n\r\n    // Bypass ngrok free abuse warning\r\n    if (this.baseUrl.includes(\"ngrok-free.dev\") || this.baseUrl.includes(\"ngrok.app\")) {\r\n      headers[\"ngrok-skip-browser-warning\"] = \"true\"\r\n    }\r\n\r\n    if (this.token) {\r\n      headers[\"Authorization\"] = `Bearer ${this.token}`\r\n      console.log(\"[v0] Adding token to request:\", { tokenExists: !!this.token })\r\n    }\r\n\r\n    console.log(\"[v0] API Text Request:\", {\r\n      method: \"POST\",\r\n      url,\r\n      hasToken: !!this.token,\r\n      hasBody: !!data,\r\n    })\r\n\r\n    try {\r\n      const response = await fetch(url, {\r\n        method: \"POST\",\r\n        headers,\r\n        body: data ? JSON.stringify(data) : undefined,\r\n        credentials: \"include\",\r\n      })\r\n\r\n      console.log(\"[v0] API Text Response:\", {\r\n        status: response.status,\r\n        statusText: response.statusText,\r\n        url,\r\n      })\r\n\r\n      if (!response.ok) {\r\n        let errorData\r\n        try {\r\n          errorData = await response.json()\r\n        } catch {\r\n          errorData = { message: response.statusText }\r\n        }\r\n\r\n        // Handle 401 Unauthorized - redirect to login\r\n        if (response.status === 401) {\r\n          console.error(\"[v0] 401 Unauthorized - clearing token and redirecting to login\")\r\n          this.token = null\r\n          localStorage.removeItem(\"unicrm_access_token\")\r\n          \r\n          // Redirect to login page\r\n          if (typeof window !== \"undefined\") {\r\n            window.location.href = \"/login\"\r\n          }\r\n          \r\n          throw new ApiError(\"Sessão expirada. Por favor, faça login novamente.\", 401, errorData)\r\n        }\r\n\r\n        throw new ApiError(errorData.error || errorData.message || \"Request failed\", response.status, errorData)\r\n      }\r\n\r\n      // Retorna texto bruto\r\n      return await response.text()\r\n    } catch (error) {\r\n      if (error instanceof ApiError) {\r\n        throw error\r\n      }\r\n\r\n      console.error(\"[v0] API Text Request failed:\", error)\r\n      throw new ApiError(\"Network error or server unavailable\", 0, error)\r\n    }\r\n  }\r\n\r\n  // PUT request\r\n  async put<T>(endpoint: string, data?: any): Promise<T> {\r\n    return this.request<T>(endpoint, {\r\n      method: \"PUT\",\r\n      body: data ? JSON.stringify(data) : undefined,\r\n    })\r\n  }\r\n\r\n  // DELETE request\r\n  async delete<T>(endpoint: string): Promise<T> {\r\n    return this.request<T>(endpoint, {\r\n      method: \"DELETE\",\r\n    })\r\n  }\r\n\r\n  // Removed getBinary: prefer getText + data URL for QR\r\n\r\n  async getText(endpoint: string): Promise<string> {\r\n    const url = `${this.baseUrl}${endpoint}`\r\n    const headers: Record<string, string> = {}\r\n    if (this.baseUrl.includes(\"ngrok-free.dev\") || this.baseUrl.includes(\"ngrok.app\")) {\r\n      headers[\"ngrok-skip-browser-warning\"] = \"true\"\r\n    }\r\n    if (this.token) {\r\n      headers[\"Authorization\"] = `Bearer ${this.token}`\r\n    }\r\n    const response = await fetch(url, {\r\n      method: \"GET\",\r\n      headers,\r\n      credentials: \"include\",\r\n    })\r\n    if (!response.ok) {\r\n      let errorData\r\n      try { errorData = await response.json() } catch { errorData = { message: response.statusText } }\r\n      throw new ApiError(errorData.error || errorData.message || \"Request failed\", response.status, errorData)\r\n    }\r\n    return await response.text()\r\n  }\r\n}\r\n\r\n// Export singleton instance\r\nexport const apiClient = new ApiClient(API_BASE_URL)\r\n\r\n// Export API base URL for reference\r\nexport { API_BASE_URL }\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Projetos\\Back_endCrm\\kanbanproject1\\lib\\api\\auth-api.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projetos\\Back_endCrm\\kanbanproject1\\lib\\api\\automations-api.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projetos\\Back_endCrm\\kanbanproject1\\lib\\api\\companies-api.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projetos\\Back_endCrm\\kanbanproject1\\lib\\api\\funnels-api-types.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projetos\\Back_endCrm\\kanbanproject1\\lib\\api\\funnels-api.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projetos\\Back_endCrm\\kanbanproject1\\lib\\api\\job-titles-api.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projetos\\Back_endCrm\\kanbanproject1\\lib\\api\\leads-api.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projetos\\Back_endCrm\\kanbanproject1\\lib\\api\\message-templates-api.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projetos\\Back_endCrm\\kanbanproject1\\lib\\api\\tags-api.ts","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'apiClient' is defined but never used.","line":1,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":1,"endColumn":19,"suggestions":[{"messageId":"removeVar","data":{"varName":"apiClient"},"fix":{"range":[0,44],"text":""},"desc":"Remove unused variable 'apiClient'."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'apiClient' is defined but never used.","line":1,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":1,"endColumn":19}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { apiClient } from \"@/lib/api-client\"\n\nexport type Tag = {\n  id: string\n  name: string\n  color: string\n  description?: string\n  createdAt: string\n}\n\nexport type CreateTagRequest = {\n  name: string\n  color?: string\n  description?: string\n}\n\nexport type UpdateTagRequest = Partial<CreateTagRequest>\n\nexport const tagsApi = {\n  // Get all tags\n  async getTags(): Promise<Tag[]> {\n    const response = await fetch(\"/api/tags\");\n    if (!response.ok) throw new Error(\"Failed to fetch tags\");\n    return response.json();\n  },\n\n  // Create tag\n  async createTag(data: CreateTagRequest): Promise<Tag> {\n    const response = await fetch(\"/api/tags\", {\n      method: \"POST\",\n      headers: { \"Content-Type\": \"application/json\" },\n      body: JSON.stringify(data),\n    });\n    if (!response.ok) {\n        const error = await response.json();\n        throw new Error(error.error || \"Failed to create tag\");\n    }\n    return response.json();\n  },\n\n  // Update tag\n  async updateTag(id: string, data: UpdateTagRequest): Promise<Tag> {\n    const response = await fetch(`/api/tags/${id}`, {\n      method: \"PUT\",\n      headers: { \"Content-Type\": \"application/json\" },\n      body: JSON.stringify(data),\n    });\n    if (!response.ok) throw new Error(\"Failed to update tag\");\n    return response.json();\n  },\n\n  // Delete tag\n  async deleteTag(id: string): Promise<void> {\n    const response = await fetch(`/api/tags/${id}`, {\n      method: \"DELETE\",\n    });\n    if (!response.ok) throw new Error(\"Failed to delete tag\");\n  },\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Projetos\\Back_endCrm\\kanbanproject1\\lib\\api\\tasks-api.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projetos\\Back_endCrm\\kanbanproject1\\lib\\api\\users-api.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projetos\\Back_endCrm\\kanbanproject1\\lib\\auth.ts","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'AUTH_STORAGE_KEY' is assigned a value but never used.","line":23,"column":7,"nodeType":"Identifier","messageId":"unusedVar","endLine":23,"endColumn":23},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'AUTH_STORAGE_KEY' is assigned a value but never used.","line":23,"column":7,"nodeType":null,"messageId":"unusedVar","endLine":23,"endColumn":23},{"ruleId":"no-unused-vars","severity":1,"message":"'USERS_STORAGE_KEY' is assigned a value but never used.","line":24,"column":7,"nodeType":"Identifier","messageId":"unusedVar","endLine":24,"endColumn":24},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'USERS_STORAGE_KEY' is assigned a value but never used.","line":24,"column":7,"nodeType":null,"messageId":"unusedVar","endLine":24,"endColumn":24},{"ruleId":"no-unused-vars","severity":1,"message":"'companyId' is defined but never used.","line":36,"column":35,"nodeType":"Identifier","messageId":"unusedVar","endLine":36,"endColumn":52,"suggestions":[{"messageId":"removeVar","data":{"varName":"companyId"},"fix":{"range":[913,930],"text":""},"desc":"Remove unused variable 'companyId'."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'companyId' is defined but never used.","line":36,"column":35,"nodeType":null,"messageId":"unusedVar","endLine":36,"endColumn":44},{"ruleId":"no-unused-vars","severity":1,"message":"'resourceCompanyId' is defined but never used.","line":41,"column":38,"nodeType":"Identifier","messageId":"unusedVar","endLine":41,"endColumn":63,"suggestions":[{"messageId":"removeVar","data":{"varName":"resourceCompanyId"},"fix":{"range":[1075,1100],"text":""},"desc":"Remove unused variable 'resourceCompanyId'."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'resourceCompanyId' is defined but never used.","line":41,"column":38,"nodeType":null,"messageId":"unusedVar","endLine":41,"endColumn":55},{"ruleId":"no-unused-vars","severity":1,"message":"'userData' is defined but never used.","line":51,"column":36,"nodeType":"Identifier","messageId":"unusedVar","endLine":51,"endColumn":49,"suggestions":[{"messageId":"removeVar","data":{"varName":"userData"},"fix":{"range":[1409,1422],"text":""},"desc":"Remove unused variable 'userData'."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'userData' is defined but never used.","line":51,"column":36,"nodeType":null,"messageId":"unusedVar","endLine":51,"endColumn":44},{"ruleId":"no-unused-vars","severity":1,"message":"'email' is defined but never used.","line":57,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":57,"endColumn":16,"suggestions":[{"messageId":"removeVar","data":{"varName":"email"},"fix":{"range":[1679,1693],"text":""},"desc":"Remove unused variable 'email'."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'email' is defined but never used.","line":57,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":57,"endColumn":8},{"ruleId":"no-unused-vars","severity":1,"message":"'password' is defined but never used.","line":58,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":58,"endColumn":19,"suggestions":[{"messageId":"removeVar","data":{"varName":"password"},"fix":{"range":[1692,1713],"text":""},"desc":"Remove unused variable 'password'."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'password' is defined but never used.","line":58,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":58,"endColumn":11},{"ruleId":"no-unused-vars","severity":1,"message":"'userId' is defined but never used.","line":64,"column":35,"nodeType":"Identifier","messageId":"unusedVar","endLine":64,"endColumn":49,"suggestions":[{"messageId":"removeVar","data":{"varName":"userId"},"fix":{"range":[1968,1982],"text":""},"desc":"Remove unused variable 'userId'."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'userId' is defined but never used.","line":64,"column":35,"nodeType":null,"messageId":"unusedVar","endLine":64,"endColumn":41},{"ruleId":"no-unused-vars","severity":1,"message":"'userId' is defined but never used.","line":69,"column":31,"nodeType":"Identifier","messageId":"unusedVar","endLine":69,"endColumn":45,"suggestions":[{"messageId":"removeVar","data":{"varName":"userId"},"fix":{"range":[2107,2121],"text":""},"desc":"Remove unused variable 'userId'."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'userId' is defined but never used.","line":69,"column":31,"nodeType":null,"messageId":"unusedVar","endLine":69,"endColumn":37},{"ruleId":"no-unused-vars","severity":1,"message":"'userData' is defined but never used.","line":74,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":74,"endColumn":16,"suggestions":[{"messageId":"removeVar","data":{"varName":"userData"},"fix":{"range":[2230,2244],"text":""},"desc":"Remove unused variable 'userData'."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'userData' is defined but never used.","line":74,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":74,"endColumn":11},{"ruleId":"no-unused-vars","severity":1,"message":"'createdBy' is defined but never used.","line":75,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":75,"endColumn":20,"suggestions":[{"messageId":"removeVar","data":{"varName":"createdBy"},"fix":{"range":[2243,2265],"text":""},"desc":"Remove unused variable 'createdBy'."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'createdBy' is defined but never used.","line":75,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":75,"endColumn":12},{"ruleId":"no-unused-vars","severity":1,"message":"'module' is defined but never used.","line":101,"column":33,"nodeType":"Identifier","messageId":"unusedVar","endLine":101,"endColumn":55,"suggestions":[{"messageId":"removeVar","data":{"varName":"module"},"fix":{"range":[3105,3127],"text":""},"desc":"Remove unused variable 'module'."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'module' is defined but never used.","line":101,"column":33,"nodeType":null,"messageId":"unusedVar","endLine":101,"endColumn":39}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":24,"fixableErrorCount":0,"fixableWarningCount":0,"source":"export interface User {\r\n  id: string\r\n  name: string\r\n  email: string\r\n  role: string // Changed from union type to string to accept custom roles\r\n  companyId?: string\r\n  createdAt: string\r\n  createdBy?: string\r\n  lastLogin?: string\r\n  password?: string\r\n  phone?: string\r\n  status?: string\r\n  modules?: string[]\r\n  jobTitleId?: string // Added jobTitleId to User interface\r\n}\r\n\r\nexport interface AuthState {\r\n  isAuthenticated: boolean\r\n  user: User | null\r\n}\r\n\r\n// Storage keys\r\nconst AUTH_STORAGE_KEY = \"unicrm_auth\"\r\nconst USERS_STORAGE_KEY = \"unicrm_users\"\r\n\r\nexport const getAuthState = (): AuthState => {\r\n  console.warn(\"[v0] getAuthState is deprecated. Use useApiAuth hook instead.\")\r\n  return { isAuthenticated: false, user: null }\r\n}\r\n\r\nexport const getAllUsers = (): User[] => {\r\n  console.warn(\"[v0] getAllUsers is deprecated. Use API instead.\")\r\n  return []\r\n}\r\n\r\nexport const getUsersByCompany = (companyId: string): User[] => {\r\n  console.warn(\"[v0] getUsersByCompany is deprecated. Use API instead.\")\r\n  return []\r\n}\r\n\r\nexport const validateTenantAccess = (resourceCompanyId: string): boolean => {\r\n  console.warn(\"[v0] validateTenantAccess is deprecated. Use API instead.\")\r\n  return false\r\n}\r\n\r\nexport const getCompanyScope = (): string | null => {\r\n  console.warn(\"[v0] getCompanyScope is deprecated. Use useApiAuth hook instead.\")\r\n  return null\r\n}\r\n\r\nexport const registerUser = async (userData: any): Promise<{ success: boolean; error?: string; user?: User }> => {\r\n  console.warn(\"[v0] registerUser is deprecated. Use useApiAuth hook instead.\")\r\n  return { success: false, error: \"Use useApiAuth hook instead\" }\r\n}\r\n\r\nexport const loginUser = async (\r\n  email: string,\r\n  password: string,\r\n): Promise<{ success: boolean; error?: string; user?: User }> => {\r\n  console.warn(\"[v0] loginUser is deprecated. Use useApiAuth hook instead.\")\r\n  return { success: false, error: \"Use useApiAuth hook instead\" }\r\n}\r\n\r\nexport const isAccountVerified = (userId: string): boolean => {\r\n  console.warn(\"[v0] isAccountVerified is deprecated.\")\r\n  return false\r\n}\r\n\r\nexport const verifyAccount = (userId: string): void => {\r\n  console.warn(\"[v0] verifyAccount is deprecated.\")\r\n}\r\n\r\nexport const createUser = async (\r\n  userData: any,\r\n  createdBy: string,\r\n): Promise<{ success: boolean; error?: string; user?: User }> => {\r\n  console.warn(\"[v0] createUser is deprecated. Use API instead.\")\r\n  return { success: false, error: \"Use API instead\" }\r\n}\r\n\r\nexport const isOwner = (): boolean => {\r\n  console.warn(\"[v0] isOwner is deprecated. Use useApiAuth hook instead.\")\r\n  return false\r\n}\r\n\r\nexport const isAdminOrOwner = (): boolean => {\r\n  console.warn(\"[v0] isAdminOrOwner is deprecated. Use useApiAuth hook instead.\")\r\n  return false\r\n}\r\n\r\nexport const isSuperAdmin = (): boolean => {\r\n  console.warn(\"[v0] isSuperAdmin is deprecated. Use useApiAuth hook instead.\")\r\n  return false\r\n}\r\n\r\nexport const getCompanyPlan = (): \"completo\" | \"crm\" | \"chat\" | null => {\r\n  console.warn(\"[v0] getCompanyPlan is deprecated. Use API instead.\")\r\n  return \"completo\"\r\n}\r\n\r\nexport const hasModuleAccess = (module: \"crm\" | \"chat\"): boolean => {\r\n  console.warn(\"[v0] hasModuleAccess is deprecated. Use useApiAuth hook instead.\")\r\n  return true\r\n}\r\n\r\n// Chat access based on plan verification\r\n// Returns true if the current company plan includes chat features.\r\n// In the current implementation, this defers to getCompanyPlan()\r\n// and grants access for plans \"completo\" or \"chat\".\r\nexport const hasChatAccess = (): boolean => {\r\n  try {\r\n    const plan = getCompanyPlan()\r\n    return plan === \"completo\" || plan === \"chat\"\r\n  } catch (e) {\r\n    console.warn(\"[v0] hasChatAccess fallback to true due to plan check error\", e)\r\n    return true\r\n  }\r\n}\r\n\r\n// Legacy functions for backward compatibility\r\nexport type UserRole = \"admin\" | \"client\"\r\n\r\nexport const getUserRole = (): UserRole => {\r\n  console.warn(\"[v0] getUserRole is deprecated. Use useApiAuth hook instead.\")\r\n  return \"client\"\r\n}\r\n\r\nexport const isAdmin = (): boolean => {\r\n  console.warn(\"[v0] isAdmin is deprecated. Use useApiAuth hook instead.\")\r\n  return false\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Projetos\\Back_endCrm\\kanbanproject1\\lib\\builder\\form-utils.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projetos\\Back_endCrm\\kanbanproject1\\lib\\builder\\tree-utils.ts","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'cloneTree' is assigned a value but never used.","line":135,"column":7,"nodeType":"Identifier","messageId":"unusedVar","endLine":135,"endColumn":16,"suggestions":[{"messageId":"removeVar","data":{"varName":"cloneTree"},"fix":{"range":[3079,3192],"text":""},"desc":"Remove unused variable 'cloneTree'."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'cloneTree' is assigned a value but never used.","line":135,"column":7,"nodeType":null,"messageId":"unusedVar","endLine":135,"endColumn":16}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\nimport { BuilderElement } from '@/lib/types/builder-types';\nimport { arrayMove } from '@dnd-kit/sortable';\n\nexport interface NodeLocation {\n  parent: BuilderElement | null; // null if root\n  index: number;\n  element: BuilderElement;\n  list: BuilderElement[]; // The array containing the element\n}\n\nexport const findElementById = (\n  elements: BuilderElement[],\n  id: string\n): NodeLocation | null => {\n  for (let i = 0; i < elements.length; i++) {\n    if (elements[i].id === id) {\n      return {\n        parent: null,\n        index: i,\n        element: elements[i],\n        list: elements,\n      };\n    }\n    \n    if (elements[i].children) {\n      const result = findNestedElement(elements[i].children!, id, elements[i]);\n      if (result) return result;\n    }\n  }\n  return null;\n};\n\nconst findNestedElement = (\n  elements: BuilderElement[],\n  id: string,\n  parent: BuilderElement\n): NodeLocation | null => {\n  for (let i = 0; i < elements.length; i++) {\n    if (elements[i].id === id) {\n      return {\n        parent,\n        index: i,\n        element: elements[i],\n        list: elements,\n      };\n    }\n    \n    if (elements[i].children) {\n      const result = findNestedElement(elements[i].children!, id, elements[i]);\n      if (result) return result;\n    }\n  }\n  return null;\n};\n\nexport const removeElementById = (elements: BuilderElement[], id: string): BuilderElement[] => {\n  return elements.filter(el => {\n    if (el.id === id) return false;\n    if (el.children) {\n      el.children = removeElementById(el.children, id);\n    }\n    return true;\n  });\n};\n\nexport const updateElementById = (\n  elements: BuilderElement[],\n  id: string,\n  updates: Partial<BuilderElement>\n): BuilderElement[] => {\n  return elements.map(el => {\n    if (el.id === id) {\n      return { ...el, ...updates };\n    }\n    if (el.children) {\n      return {\n        ...el,\n        children: updateElementById(el.children, id, updates)\n      };\n    }\n    return el;\n  });\n};\n\nexport const insertElementAfter = (\n  elements: BuilderElement[],\n  targetId: string,\n  newElement: BuilderElement\n): BuilderElement[] => {\n  const newElements = [...elements];\n  \n  // Check if target is in this list\n  const index = newElements.findIndex(el => el.id === targetId);\n  if (index !== -1) {\n    newElements.splice(index + 1, 0, newElement);\n    return newElements;\n  }\n\n  // Recursive check\n  return newElements.map(el => {\n    if (el.children) {\n      return {\n        ...el,\n        children: insertElementAfter(el.children, targetId, newElement)\n      };\n    }\n    return el;\n  });\n};\n\nexport const insertElementAtEnd = (\n  elements: BuilderElement[],\n  parentId: string,\n  newElement: BuilderElement\n): BuilderElement[] => {\n  return elements.map(el => {\n    if (el.id === parentId) {\n      return {\n        ...el,\n        children: [...(el.children || []), newElement]\n      };\n    }\n    if (el.children) {\n      return {\n        ...el,\n        children: insertElementAtEnd(el.children, parentId, newElement)\n      };\n    }\n    return el;\n  });\n};\n\n// Helper to deep clone the tree to avoid mutation issues\nconst cloneTree = (items: BuilderElement[]): BuilderElement[] => {\n  return JSON.parse(JSON.stringify(items));\n};\n\nexport const moveElement = (\n  elements: BuilderElement[],\n  activeId: string,\n  overId: string\n): BuilderElement[] => {\n  const activeNode = findElementById(elements, activeId);\n  const overNode = findElementById(elements, overId);\n\n  if (!activeNode || !overNode) return elements;\n\n  const activeParentId = activeNode.parent?.id || 'root';\n  const overParentId = overNode.parent?.id || 'root';\n\n  // If same parent, just reorder\n  if (activeParentId === overParentId) {\n    // If it's the root list\n    if (activeParentId === 'root') {\n      return arrayMove(elements, activeNode.index, overNode.index);\n    }\n\n    // If it's a nested list, we need to find the parent and update its children\n    return updateElementById(elements, activeParentId, {\n      children: arrayMove(activeNode.list, activeNode.index, overNode.index)\n    });\n  }\n\n  // If different parents, move from one to another\n  let newElements = removeElementById(elements, activeId);\n  \n  // Insert into new location\n  // We need to insert it *relative* to the overId\n  // The insertElementAfter logic is a bit simple, let's refine it or use a specific insert function\n  \n  // If we are dropping ONTO a container (like an empty column), we might want to append to it\n  // But here overId is usually a Sortable item.\n  \n  // If overNode is a container and it's empty, we might be dropping onto it?\n  // SortableContext usually gives overId of the item.\n  \n  // Let's assume we drop relative to the item (sortable behavior)\n  newElements = insertElementAfter(newElements, overId, activeNode.element);\n  \n  return newElements;\n};\n\nexport const moveElementToContainer = (\n  elements: BuilderElement[],\n  activeId: string,\n  overId: string\n): BuilderElement[] => {\n  const clonedItems = JSON.parse(JSON.stringify(elements));\n  const activeNode = findElementById(clonedItems, activeId);\n  \n  if (!activeNode) return elements;\n  const activeElement = activeNode.element;\n\n  // Remover o elemento de sua posição atual\n  const itemsWithoutActive = removeElementById(clonedItems, activeId);\n  \n  // Função recursiva para encontrar o container e adicionar o elemento\n  const addToContainer = (items: BuilderElement[]): BuilderElement[] => {\n    return items.map(item => {\n      if (item.id === overId) {\n        // Se este é o container alvo, adiciona ao final dos filhos\n        return {\n          ...item,\n          children: [...(item.children || []), activeElement]\n        };\n      }\n      \n      if (item.children && item.children.length > 0) {\n        return {\n          ...item,\n          children: addToContainer(item.children)\n        };\n      }\n      \n      return item;\n    });\n  };\n\n  return addToContainer(itemsWithoutActive);\n};\n","usedDeprecatedRules":[]},{"filePath":"C:\\Projetos\\Back_endCrm\\kanbanproject1\\lib\\data-visibility.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projetos\\Back_endCrm\\kanbanproject1\\lib\\data\\templates.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projetos\\Back_endCrm\\kanbanproject1\\lib\\db.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projetos\\Back_endCrm\\kanbanproject1\\lib\\funnel-triggers.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projetos\\Back_endCrm\\kanbanproject1\\lib\\input-formatters.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projetos\\Back_endCrm\\kanbanproject1\\lib\\job-titles.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projetos\\Back_endCrm\\kanbanproject1\\lib\\landing-page-storage.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projetos\\Back_endCrm\\kanbanproject1\\lib\\mass-action-utils.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projetos\\Back_endCrm\\kanbanproject1\\lib\\permissions.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projetos\\Back_endCrm\\kanbanproject1\\lib\\saved-filters.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projetos\\Back_endCrm\\kanbanproject1\\lib\\storage.ts","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'user' is defined but never used.","line":75,"column":32,"nodeType":"Identifier","messageId":"unusedVar","endLine":75,"endColumn":41,"suggestions":[{"messageId":"removeVar","data":{"varName":"user"},"fix":{"range":[2030,2039],"text":""},"desc":"Remove unused variable 'user'."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'user' is defined but never used.","line":75,"column":32,"nodeType":null,"messageId":"unusedVar","endLine":75,"endColumn":36}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { getCompanyScope, isSuperAdmin } from \"./auth\"\r\nimport { type User, authApi } from \"./api/auth-api\"\r\n\r\nexport interface StorageData {\r\n  leads: any[]\r\n  funnels: any[]\r\n  tasks: any[]\r\n  users: any[]\r\n}\r\n\r\nconst STORAGE_KEY = \"kanban-data\"\r\n\r\nconst getTenantStorageKey = (key: string, companyId?: string): string => {\r\n  if (key === \"current-user\" || key === \"unicrm_auth\") {\r\n    return key\r\n  }\r\n\r\n  // Use provided companyId if available\r\n  const targetCompanyId = companyId || getCompanyScope()\r\n\r\n  // Superadmin uses global keys (only when no explicit companyId is provided)\r\n  if (!companyId && isSuperAdmin()) {\r\n    return key\r\n  }\r\n\r\n  // Regular users get company-scoped keys\r\n  if (targetCompanyId) {\r\n    return `${targetCompanyId}_${key}`\r\n  }\r\n\r\n  // Fallback to original key (for backward compatibility)\r\n  return key\r\n}\r\n\r\nexport const loadFromStorage = (key?: string, defaultValue?: any): any => {\r\n  try {\r\n    if (typeof window === \"undefined\") return defaultValue\r\n    const storageKey = getTenantStorageKey(key || STORAGE_KEY)\r\n    const raw = localStorage.getItem(storageKey)\r\n    if (!raw) return defaultValue\r\n    return JSON.parse(raw)\r\n  } catch {\r\n    return defaultValue\r\n  }\r\n}\r\n\r\nexport const saveToStorage = (data: any, key?: string) => {\r\n  try {\r\n    if (typeof window === \"undefined\") return\r\n    const storageKey = getTenantStorageKey(key || STORAGE_KEY)\r\n    localStorage.setItem(storageKey, JSON.stringify(data))\r\n  } catch {}\r\n}\r\n\r\nexport const clearStorage = () => {\r\n  try {\r\n    if (typeof window === \"undefined\") return\r\n    localStorage.clear()\r\n  } catch {}\r\n}\r\n\r\nexport const getCurrentUser = (): User | null => {\r\n  if (typeof window === \"undefined\") return null\r\n  try {\r\n    const raw = localStorage.getItem(\"unicrm_auth\")\r\n    if (!raw) return null\r\n    const parsed = JSON.parse(raw)\r\n    return parsed.user || null\r\n  } catch (error) {\r\n    console.error(\"[v0] Error getting current user from storage:\", error)\r\n    return null\r\n  }\r\n}\r\n\r\nexport const setCurrentUser = (user: any) => {\r\n  console.warn(\"[v0] setCurrentUser is deprecated. Use useApiAuth hook instead.\")\r\n}\r\n\r\nexport const logout = async () => {\r\n  try {\r\n    await authApi.logout()\r\n  } catch (error) {\r\n    console.error(\"[v0] Error logging out:\", error)\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Projetos\\Back_endCrm\\kanbanproject1\\lib\\types\\builder-types.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projetos\\Back_endCrm\\kanbanproject1\\lib\\types\\company.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projetos\\Back_endCrm\\kanbanproject1\\lib\\types\\job-title.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projetos\\Back_endCrm\\kanbanproject1\\lib\\types\\landing-page.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projetos\\Back_endCrm\\kanbanproject1\\lib\\user-role.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projetos\\Back_endCrm\\kanbanproject1\\lib\\utils.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projetos\\Back_endCrm\\kanbanproject1\\lib\\whatsapp-api-integration-guide.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projetos\\Back_endCrm\\kanbanproject1\\lib\\whatsapp-api.ts","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'contactId' is defined but never used.","line":73,"column":24,"nodeType":"Identifier","messageId":"unusedVar","endLine":73,"endColumn":41,"suggestions":[{"messageId":"removeVar","data":{"varName":"contactId"},"fix":{"range":[1843,1861],"text":""},"desc":"Remove unused variable 'contactId'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'message' is defined but never used.","line":73,"column":43,"nodeType":"Identifier","messageId":"unusedVar","endLine":73,"endColumn":58,"suggestions":[{"messageId":"removeVar","data":{"varName":"message"},"fix":{"range":[1860,1877],"text":""},"desc":"Remove unused variable 'message'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'contactId' is defined but never used.","line":76,"column":24,"nodeType":"Identifier","messageId":"unusedVar","endLine":76,"endColumn":41,"suggestions":[{"messageId":"removeVar","data":{"varName":"contactId"},"fix":{"range":[2047,2064],"text":""},"desc":"Remove unused variable 'contactId'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'contactId' is defined but never used.","line":77,"column":23,"nodeType":"Identifier","messageId":"unusedVar","endLine":77,"endColumn":40,"suggestions":[{"messageId":"removeVar","data":{"varName":"contactId"},"fix":{"range":[2117,2135],"text":""},"desc":"Remove unused variable 'contactId'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'messageId' is defined but never used.","line":77,"column":42,"nodeType":"Identifier","messageId":"unusedVar","endLine":77,"endColumn":59,"suggestions":[{"messageId":"removeVar","data":{"varName":"messageId"},"fix":{"range":[2134,2153],"text":""},"desc":"Remove unused variable 'messageId'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'callback' is defined but never used.","line":78,"column":30,"nodeType":"Identifier","messageId":"unusedVar","endLine":78,"endColumn":74,"suggestions":[{"messageId":"removeVar","data":{"varName":"callback"},"fix":{"range":[2200,2244],"text":""},"desc":"Remove unused variable 'callback'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'message' is defined but never used.","line":78,"column":41,"nodeType":"Identifier","messageId":"unusedVar","endLine":78,"endColumn":65,"suggestions":[{"messageId":"removeVar","data":{"varName":"message"},"fix":{"range":[2211,2235],"text":""},"desc":"Remove unused variable 'message'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'callback' is defined but never used.","line":79,"column":35,"nodeType":"Identifier","messageId":"unusedVar","endLine":79,"endColumn":79,"suggestions":[{"messageId":"removeVar","data":{"varName":"callback"},"fix":{"range":[2287,2331],"text":""},"desc":"Remove unused variable 'callback'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'contact' is defined but never used.","line":79,"column":46,"nodeType":"Identifier","messageId":"unusedVar","endLine":79,"endColumn":70,"suggestions":[{"messageId":"removeVar","data":{"varName":"contact"},"fix":{"range":[2298,2322],"text":""},"desc":"Remove unused variable 'contact'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'message' is defined but never used.","line":85,"column":30,"nodeType":"Identifier","messageId":"unusedVar","endLine":85,"endColumn":54,"suggestions":[{"messageId":"removeVar","data":{"varName":"message"},"fix":{"range":[2531,2555],"text":""},"desc":"Remove unused variable 'message'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'contact' is defined but never used.","line":86,"column":30,"nodeType":"Identifier","messageId":"unusedVar","endLine":86,"endColumn":54,"suggestions":[{"messageId":"removeVar","data":{"varName":"contact"},"fix":{"range":[2595,2619],"text":""},"desc":"Remove unused variable 'contact'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'message' is defined but never used.","line":265,"column":32,"nodeType":"Identifier","messageId":"unusedVar","endLine":265,"endColumn":56,"suggestions":[{"messageId":"removeVar","data":{"varName":"message"},"fix":{"range":[7821,7845],"text":""},"desc":"Remove unused variable 'message'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'contact' is defined but never used.","line":269,"column":37,"nodeType":"Identifier","messageId":"unusedVar","endLine":269,"endColumn":61,"suggestions":[{"messageId":"removeVar","data":{"varName":"contact"},"fix":{"range":[7945,7969],"text":""},"desc":"Remove unused variable 'contact'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'message' is defined but never used.","line":283,"column":30,"nodeType":"Identifier","messageId":"unusedVar","endLine":283,"endColumn":54,"suggestions":[{"messageId":"removeVar","data":{"varName":"message"},"fix":{"range":[8328,8352],"text":""},"desc":"Remove unused variable 'message'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'contact' is defined but never used.","line":284,"column":30,"nodeType":"Identifier","messageId":"unusedVar","endLine":284,"endColumn":54,"suggestions":[{"messageId":"removeVar","data":{"varName":"contact"},"fix":{"range":[8392,8416],"text":""},"desc":"Remove unused variable 'contact'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'qrCode' is defined but never used.","line":285,"column":29,"nodeType":"Identifier","messageId":"unusedVar","endLine":285,"endColumn":43,"suggestions":[{"messageId":"removeVar","data":{"varName":"qrCode"},"fix":{"range":[8455,8469],"text":""},"desc":"Remove unused variable 'qrCode'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'status' is defined but never used.","line":286,"column":29,"nodeType":"Identifier","messageId":"unusedVar","endLine":286,"endColumn":43,"suggestions":[{"messageId":"removeVar","data":{"varName":"status"},"fix":{"range":[8508,8522],"text":""},"desc":"Remove unused variable 'status'."}]},{"ruleId":null,"message":"Unused eslint-disable directive (no problems were reported from '@typescript-eslint/no-var-requires').","line":324,"column":9,"severity":1,"nodeType":null,"fix":{"range":[9736,9798],"text":" "}},{"ruleId":"no-unused-vars","severity":1,"message":"'message' is defined but never used.","line":638,"column":32,"nodeType":"Identifier","messageId":"unusedVar","endLine":638,"endColumn":56,"suggestions":[{"messageId":"removeVar","data":{"varName":"message"},"fix":{"range":[20176,20200],"text":""},"desc":"Remove unused variable 'message'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'contact' is defined but never used.","line":642,"column":37,"nodeType":"Identifier","messageId":"unusedVar","endLine":642,"endColumn":61,"suggestions":[{"messageId":"removeVar","data":{"varName":"contact"},"fix":{"range":[20300,20324],"text":""},"desc":"Remove unused variable 'contact'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'qrCode' is defined but never used.","line":646,"column":32,"nodeType":"Identifier","messageId":"unusedVar","endLine":646,"endColumn":46,"suggestions":[{"messageId":"removeVar","data":{"varName":"qrCode"},"fix":{"range":[20419,20433],"text":""},"desc":"Remove unused variable 'qrCode'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'status' is defined but never used.","line":650,"column":30,"nodeType":"Identifier","messageId":"unusedVar","endLine":650,"endColumn":44,"suggestions":[{"messageId":"removeVar","data":{"varName":"status"},"fix":{"range":[20525,20539],"text":""},"desc":"Remove unused variable 'status'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'message' is defined but never used.","line":789,"column":31,"nodeType":"Identifier","messageId":"unusedVar","endLine":789,"endColumn":55,"suggestions":[{"messageId":"removeVar","data":{"varName":"message"},"fix":{"range":[24986,25010],"text":""},"desc":"Remove unused variable 'message'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'contact' is defined but never used.","line":790,"column":31,"nodeType":"Identifier","messageId":"unusedVar","endLine":790,"endColumn":55,"suggestions":[{"messageId":"removeVar","data":{"varName":"contact"},"fix":{"range":[25059,25083],"text":""},"desc":"Remove unused variable 'contact'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'message' is defined but never used.","line":1190,"column":32,"nodeType":"Identifier","messageId":"unusedVar","endLine":1190,"endColumn":56,"suggestions":[{"messageId":"removeVar","data":{"varName":"message"},"fix":{"range":[39618,39642],"text":""},"desc":"Remove unused variable 'message'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'message' is defined but never used.","line":1194,"column":33,"nodeType":"Identifier","messageId":"unusedVar","endLine":1194,"endColumn":57,"suggestions":[{"messageId":"removeVar","data":{"varName":"message"},"fix":{"range":[39743,39767],"text":""},"desc":"Remove unused variable 'message'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'contact' is defined but never used.","line":1198,"column":37,"nodeType":"Identifier","messageId":"unusedVar","endLine":1198,"endColumn":61,"suggestions":[{"messageId":"removeVar","data":{"varName":"contact"},"fix":{"range":[39913,39937],"text":""},"desc":"Remove unused variable 'contact'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'contact' is defined but never used.","line":1202,"column":38,"nodeType":"Identifier","messageId":"unusedVar","endLine":1202,"endColumn":62,"suggestions":[{"messageId":"removeVar","data":{"varName":"contact"},"fix":{"range":[40043,40067],"text":""},"desc":"Remove unused variable 'contact'."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":28,"fixableErrorCount":0,"fixableWarningCount":1,"source":"import { API_BASE_URL, apiClient } from \"./api-client\"\r\n\r\nexport interface WhatsAppContact {\r\n  id: string\r\n  name: string\r\n  phone: string\r\n  avatar?: string\r\n  isOnline: boolean\r\n  lastSeen?: Date\r\n}\r\n\r\nexport interface WhatsAppMessage {\r\n  id: string\r\n  contactId: string\r\n  content: string\r\n  timestamp: Date\r\n  isFromMe: boolean\r\n  messageType: \"text\" | \"image\" | \"document\" | \"audio\" | \"video\"\r\n  status: \"sent\" | \"delivered\" | \"read\" | \"failed\"\r\n  mediaUrl?: string\r\n}\r\n\r\nexport interface WhatsAppConversation {\r\n  contactId: string\r\n  messages: WhatsAppMessage[]\r\n  unreadCount: number\r\n  lastMessage?: WhatsAppMessage\r\n  status?: \"em_atendimento\" | \"encerrado\" | \"aguardando\"\r\n  tags?: string[]\r\n  queueId?: string\r\n  assignedUserId?: string\r\n  isRead?: boolean\r\n}\r\n\r\n// API Configuration interface - supports multiple WhatsApp APIs\r\nexport interface WhatsAppAPIConfig {\r\n  provider: \"whatsapp-web-js\" | \"baileys\" | \"twilio\" | \"meta-business\" | \"custom\" | \"z-api\"\r\n  apiKey?: string\r\n  webhookUrl?: string\r\n  phoneNumberId?: string\r\n  accessToken?: string\r\n  customEndpoint?: string\r\n  customHeaders?: Record<string, string>\r\n}\r\n\r\n// Z-Api specific configuration and instance management\r\nexport interface ZApiConfig extends WhatsAppAPIConfig {\r\n  provider: \"z-api\"\r\n  instanceId?: string\r\n  instanceToken?: string\r\n  clientId?: string\r\n  zapiBaseUrl?: string\r\n}\r\n\r\nexport interface ZApiInstance {\r\n  instanceId: string\r\n  instanceToken: string\r\n  status: \"connected\" | \"disconnected\" | \"qrcode\"\r\n  qrCode?: string\r\n  phone?: string\r\n  clientId: string\r\n}\r\n\r\n// Abstract WhatsApp API class for extensibility\r\nexport abstract class WhatsAppAPIProvider {\r\n  protected config: WhatsAppAPIConfig\r\n\r\n  constructor(config: WhatsAppAPIConfig) {\r\n    this.config = config\r\n  }\r\n\r\n  abstract initialize(): Promise<void>\r\n  abstract sendMessage(contactId: string, message: string): Promise<WhatsAppMessage>\r\n  abstract getContacts(): Promise<WhatsAppContact[]>\r\n  abstract getConversations(): Promise<WhatsAppConversation[]>\r\n  abstract getMessages(contactId: string): Promise<WhatsAppMessage[]>\r\n  abstract markAsRead(contactId: string, messageId: string): Promise<void>\r\n  abstract onMessageReceived(callback: (message: WhatsAppMessage) => void): void\r\n  abstract onContactStatusChanged(callback: (contact: WhatsAppContact) => void): void\r\n  abstract disconnect(): Promise<void>\r\n}\r\n\r\n// Generic API Provider for custom integrations\r\nexport class GenericWhatsAppProvider extends WhatsAppAPIProvider {\r\n  private messageCallback?: (message: WhatsAppMessage) => void\r\n  private contactCallback?: (contact: WhatsAppContact) => void\r\n  private eventSource?: EventSource\r\n\r\n  async initialize(): Promise<void> {\r\n    console.log(\"[v0] Initializing Generic WhatsApp Provider with config:\", this.config.provider)\r\n\r\n    // Setup webhook listener for real-time messages\r\n    if (this.config.webhookUrl) {\r\n      this.setupWebhookListener()\r\n    }\r\n\r\n    // Setup Server-Sent Events for real-time updates\r\n    if (this.config.customEndpoint) {\r\n      this.setupSSEConnection()\r\n    }\r\n  }\r\n\r\n  private setupWebhookListener(): void {\r\n    // This would be handled by your backend webhook endpoint\r\n    console.log(\"[v0] Webhook listener setup for:\", this.config.webhookUrl)\r\n  }\r\n\r\n  private setupSSEConnection(): void {\r\n    if (this.config.customEndpoint) {\r\n      this.eventSource = new EventSource(`${this.config.customEndpoint}/events`)\r\n\r\n      this.eventSource.onmessage = (event) => {\r\n        try {\r\n          const data = JSON.parse(event.data)\r\n\r\n          if (data.type === \"message\" && this.messageCallback) {\r\n            this.messageCallback(data.message)\r\n          } else if (data.type === \"contact_status\" && this.contactCallback) {\r\n            this.contactCallback(data.contact)\r\n          }\r\n        } catch (error) {\r\n          console.error(\"[v0] Error parsing SSE data:\", error)\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  async sendMessage(contactId: string, message: string): Promise<WhatsAppMessage> {\r\n    const endpoint = `${this.config.customEndpoint}/send-message`\r\n    const headers: Record<string, string> = {\r\n      \"Content-Type\": \"application/json\",\r\n      ...(this.config.customHeaders || {}),\r\n    }\r\n\r\n    if (this.config.apiKey) {\r\n      headers[\"Authorization\"] = `Bearer ${this.config.apiKey}`\r\n    }\r\n\r\n    const response = await fetch(endpoint, {\r\n      method: \"POST\",\r\n      headers,\r\n      body: JSON.stringify({\r\n        contactId,\r\n        message,\r\n        timestamp: new Date().toISOString(),\r\n      }),\r\n    })\r\n\r\n    if (!response.ok) {\r\n      throw new Error(`Failed to send message: ${response.statusText}`)\r\n    }\r\n\r\n    const result = await response.json()\r\n    return {\r\n      id: result.messageId || `msg_${Date.now()}`,\r\n      contactId,\r\n      content: message,\r\n      timestamp: new Date(),\r\n      isFromMe: true,\r\n      messageType: \"text\",\r\n      status: \"sent\",\r\n    }\r\n  }\r\n\r\n  async getContacts(): Promise<WhatsAppContact[]> {\r\n    const endpoint = `${this.config.customEndpoint}/contacts`\r\n    const headers: Record<string, string> = {\r\n      ...this.config.customHeaders,\r\n    }\r\n\r\n    if (this.config.apiKey) {\r\n      headers[\"Authorization\"] = `Bearer ${this.config.apiKey}`\r\n    }\r\n\r\n    try {\r\n      const response = await fetch(endpoint, { headers })\r\n\r\n      if (!response.ok) {\r\n        console.warn(\"[v0] Failed to fetch contacts, returning empty array\")\r\n        return []\r\n      }\r\n\r\n      const data = await response.json()\r\n      return data.contacts || []\r\n    } catch (error) {\r\n      console.error(\"[v0] Error fetching contacts:\", error)\r\n      return []\r\n    }\r\n  }\r\n\r\n  async getConversations(): Promise<WhatsAppConversation[]> {\r\n    const endpoint = `${this.config.customEndpoint}/conversations`\r\n    const headers: Record<string, string> = {\r\n      ...this.config.customHeaders,\r\n    }\r\n\r\n    if (this.config.apiKey) {\r\n      headers[\"Authorization\"] = `Bearer ${this.config.apiKey}`\r\n    }\r\n\r\n    try {\r\n      const response = await fetch(endpoint, { headers })\r\n\r\n      if (!response.ok) {\r\n        console.warn(\"[v0] Failed to fetch conversations, returning empty array\")\r\n        return []\r\n      }\r\n\r\n      const data = await response.json()\r\n      return data.conversations || []\r\n    } catch (error) {\r\n      console.error(\"[v0] Error fetching conversations:\", error)\r\n      return []\r\n    }\r\n  }\r\n\r\n  async getMessages(contactId: string): Promise<WhatsAppMessage[]> {\r\n    const endpoint = `${this.config.customEndpoint}/messages/${contactId}`\r\n    const headers: Record<string, string> = {\r\n      ...this.config.customHeaders,\r\n    }\r\n\r\n    if (this.config.apiKey) {\r\n      headers[\"Authorization\"] = `Bearer ${this.config.apiKey}`\r\n    }\r\n\r\n    try {\r\n      const response = await fetch(endpoint, { headers })\r\n\r\n      if (!response.ok) {\r\n        console.warn(`[v0] Failed to fetch messages for contact ${contactId}, returning empty array`)\r\n        return []\r\n      }\r\n\r\n      const data = await response.json()\r\n      return data.messages || []\r\n    } catch (error) {\r\n      console.error(\"[v0] Error fetching messages:\", error)\r\n      return []\r\n    }\r\n  }\r\n\r\n  async markAsRead(contactId: string, messageId: string): Promise<void> {\r\n    const endpoint = `${this.config.customEndpoint}/mark-read`\r\n    const headers: Record<string, string> = {\r\n      \"Content-Type\": \"application/json\",\r\n      ...(this.config.customHeaders || {}),\r\n    }\r\n\r\n    if (this.config.apiKey) {\r\n      headers[\"Authorization\"] = `Bearer ${this.config.apiKey}`\r\n    }\r\n\r\n    try {\r\n      await fetch(endpoint, {\r\n        method: \"POST\",\r\n        headers,\r\n        body: JSON.stringify({ contactId, messageId }),\r\n      })\r\n    } catch (error) {\r\n      console.error(\"[v0] Error marking message as read:\", error)\r\n    }\r\n  }\r\n\r\n  onMessageReceived(callback: (message: WhatsAppMessage) => void): void {\r\n    this.messageCallback = callback\r\n  }\r\n\r\n  onContactStatusChanged(callback: (contact: WhatsAppContact) => void): void {\r\n    this.contactCallback = callback\r\n  }\r\n\r\n  async disconnect(): Promise<void> {\r\n    if (this.eventSource) {\r\n      this.eventSource.close()\r\n      this.eventSource = undefined\r\n    }\r\n    console.log(\"[v0] WhatsApp provider disconnected\")\r\n  }\r\n}\r\n\r\nexport class ZApiProvider extends WhatsAppAPIProvider {\r\n  private messageCallback?: (message: WhatsAppMessage) => void\r\n  private contactCallback?: (contact: WhatsAppContact) => void\r\n  private qrCodeCallback?: (qrCode: string) => void\r\n  private statusCallback?: (status: string) => void\r\n  private instanceId?: string\r\n  private instanceToken?: string\r\n  private clientId: string\r\n  private baseUrl: string\r\n\r\n  constructor(config: ZApiConfig) {\r\n    super(config)\r\n    this.instanceId = config.instanceId\r\n    this.instanceToken = config.instanceToken\r\n    this.clientId = config.clientId || `client_${Date.now()}`\r\n    this.baseUrl = config.zapiBaseUrl || config.customEndpoint || \"https://api.z-api.io\"\r\n    if (this.baseUrl.includes(\"/instances/\")) {\r\n      try {\r\n        const u = new URL(this.baseUrl)\r\n        this.baseUrl = `${u.protocol}//${u.host}`\r\n      } catch {\r\n        this.baseUrl = this.baseUrl.split(\"/instances/\")[0]\r\n      }\r\n    }\r\n  }\r\n\r\n  async initialize(): Promise<void> {\r\n    console.log(\"[v0] Initializing Z-Api Provider for client:\", this.clientId)\r\n\r\n    // If no instance exists, create one\r\n    if (!this.instanceId || !this.instanceToken) {\r\n      await this.createOrGetInstance()\r\n    } else {\r\n      // Check existing instance status\r\n      await this.checkInstanceStatus()\r\n    }\r\n  }\r\n\r\n  private async createOrGetInstance(): Promise<void> {\r\n    try {\r\n      // Try to load instance from backend config first (multi-tenant safe)\r\n      try {\r\n        // eslint-disable-next-line @typescript-eslint/no-var-requires\r\n        const { API_BASE_URL } = require(\"@/lib/api-client\")\r\n        if (API_BASE_URL) {\r\n          const res = await fetch(`${API_BASE_URL}/whatsapp/config`)\r\n          if (res.ok) {\r\n            const safe = await res.json()\r\n            const fromBackendId = safe?.instanceId\r\n            const fromBackendToken = safe?.instanceToken\r\n            if (fromBackendId && fromBackendToken) {\r\n              this.instanceId = fromBackendId\r\n              this.instanceToken = fromBackendToken\r\n              localStorage.setItem(\r\n                `zapi_instance_${this.clientId}`,\r\n                JSON.stringify({ instanceId: this.instanceId, instanceToken: this.instanceToken, status: \"disconnected\", clientId: this.clientId }),\r\n              )\r\n              console.log(\"[v0] Using instance from backend config:\", this.instanceId)\r\n              await this.checkInstanceStatus()\r\n              return\r\n            }\r\n          }\r\n        }\r\n      } catch {}\r\n      // Check if instance already exists for this client\r\n      const savedInstance = localStorage.getItem(`zapi_instance_${this.clientId}`)\r\n\r\n      if (savedInstance) {\r\n        const instance: ZApiInstance = JSON.parse(savedInstance)\r\n        this.instanceId = instance.instanceId\r\n        this.instanceToken = instance.instanceToken\r\n        console.log(\"[v0] Using existing Z-Api instance:\", this.instanceId)\r\n\r\n        await this.checkInstanceStatus()\r\n        return\r\n      }\r\n\r\n      // Do NOT auto-create instance: require manual ID/TOKEN\r\n      throw new Error(\r\n        \"Instância Z-API não encontrada. Informe manualmente 'instanceId' e 'instanceToken' na configuração do WhatsApp (cole a URL completa da instância para autoextrair).\",\r\n      )\r\n    } catch (error) {\r\n      console.error(\"[v0] Error creating Z-Api instance:\", error)\r\n      throw error\r\n    }\r\n  }\r\n\r\n  async generateQRCode(): Promise<string> {\r\n    if (!this.instanceId || !this.instanceToken) {\r\n      throw new Error(\"Instance not initialized\")\r\n    }\r\n\r\n    try {\r\n      console.log(\"[v0] Generating QR Code via backend for instance:\", this.instanceId)\r\n      // Prefer PNG bytes endpoint and return its URL (works in <img src>)\r\n      const qrUrl = `${API_BASE_URL}/whatsapp/qr/image?ts=${Date.now()}`\r\n\r\n      // Fire-and-forget status polling\r\n      this.startStatusPolling()\r\n\r\n      console.log(\"[v0] QR Code URL generated:\", qrUrl)\r\n      return qrUrl\r\n    } catch (error) {\r\n      console.error(\"[v0] Error generating QR Code via backend:\", error)\r\n      throw error\r\n    }\r\n  }\r\n\r\n  private startStatusPolling(): void {\r\n    const pollInterval = setInterval(async () => {\r\n      try {\r\n        const status = await this.checkInstanceStatus()\r\n\r\n        if (status === \"connected\") {\r\n          clearInterval(pollInterval)\r\n\r\n          if (this.statusCallback) {\r\n            this.statusCallback(\"connected\")\r\n          }\r\n\r\n          // Update saved instance\r\n          const savedInstance = localStorage.getItem(`zapi_instance_${this.clientId}`)\r\n          if (savedInstance) {\r\n            const instance: ZApiInstance = JSON.parse(savedInstance)\r\n            instance.status = \"connected\"\r\n            localStorage.setItem(`zapi_instance_${this.clientId}`, JSON.stringify(instance))\r\n          }\r\n\r\n          // Setup webhook listener\r\n          await this.setupWebhook()\r\n        }\r\n      } catch (error) {\r\n        console.error(\"[v0] Error polling status:\", error)\r\n      }\r\n    }, 3000) // Poll every 3 seconds\r\n\r\n    // Stop polling after 5 minutes\r\n    setTimeout(() => clearInterval(pollInterval), 300000)\r\n  }\r\n\r\n  private async checkInstanceStatus(): Promise<string> {\r\n    if (!this.instanceId || !this.instanceToken) {\r\n      return \"disconnected\"\r\n    }\r\n\r\n    try {\r\n      // Use backend endpoint instead of direct Z-API call\r\n      const data = await apiClient.get<any>(\"/whatsapp/status\")\r\n      const status = data.connected === true ? \"connected\" : \"disconnected\"\r\n\r\n      console.log(\"[v0] Instance status from backend:\", status)\r\n      return status\r\n    } catch (error) {\r\n      console.error(\"[v0] Error checking status via backend:\", error)\r\n      return \"disconnected\"\r\n    }\r\n  }\r\n\r\n  private async setupWebhook(): Promise<void> {\r\n    if (!this.config.webhookUrl || !this.instanceId || !this.instanceToken) {\r\n      return\r\n    }\r\n\r\n    try {\r\n      const isHttps = /^https:/i.test(this.config.webhookUrl)\r\n      if (!isHttps) {\r\n        console.warn(\"[v0] Webhook URL must be HTTPS for Z-API; skipping setup:\", this.config.webhookUrl)\r\n        return\r\n      }\r\n\r\n      // Use backend endpoint instead of direct Z-API call\r\n      const response = await fetch(\"/api/whatsapp/setup-webhook\", {\r\n        method: \"POST\",\r\n        headers: {\r\n          \"Content-Type\": \"application/json\",\r\n          \"Authorization\": `Bearer ${localStorage.getItem(\"unicrm_access_token\")}`\r\n        },\r\n        body: JSON.stringify({\r\n          webhookUrl: this.config.webhookUrl,\r\n          events: [\"message\", \"status\"]\r\n        })\r\n      })\r\n\r\n      if (!response.ok) {\r\n        const error = await response.text()\r\n        console.warn(\"[v0] Backend webhook setup failed:\", response.status, error)\r\n      } else {\r\n        console.log(\"[v0] Webhook configured successfully via backend\")\r\n      }\r\n    } catch (error) {\r\n      console.error(\"[v0] Error setting up webhook via backend:\", error)\r\n    }\r\n  }\r\n\r\n  async sendMessage(contactId: string, message: string): Promise<WhatsAppMessage> {\r\n    if (!this.instanceId || !this.instanceToken) {\r\n      throw new Error(\"Instance not initialized\")\r\n    }\r\n\r\n    try {\r\n      // Use backend endpoint instead of direct Z-API call\r\n      const response = await fetch(\"/api/whatsapp/send-message\", {\r\n        method: \"POST\",\r\n        headers: {\r\n          \"Content-Type\": \"application/json\",\r\n          \"Authorization\": `Bearer ${localStorage.getItem(\"unicrm_access_token\")}`\r\n        },\r\n        body: JSON.stringify({\r\n          contactId: contactId.replace(/\\D/g, \"\"),\r\n          message: message,\r\n          timestamp: new Date().toISOString()\r\n        })\r\n      })\r\n\r\n      if (!response.ok) {\r\n        const error = await response.text()\r\n        console.error(\"[v0] Backend send message failed:\", error)\r\n        throw new Error(`Send message failed: ${response.status}`)\r\n      }\r\n\r\n      const result = await response.json()\r\n      return {\r\n        id: result.messageId || `msg_${Date.now()}`,\r\n        contactId: contactId.replace(/\\D/g, \"\"),\r\n        content: message,\r\n        timestamp: new Date(),\r\n        isFromMe: true,\r\n        messageType: \"text\",\r\n        status: \"sent\",\r\n      }\r\n    } catch (error) {\r\n      console.error(\"[v0] Error sending message via backend:\", error)\r\n      throw error\r\n    }\r\n  }\r\n\r\n  async getContacts(): Promise<WhatsAppContact[]> {\r\n    if (!this.instanceId || !this.instanceToken) {\r\n      return []\r\n    }\r\n\r\n    try {\r\n      const status = await this.checkInstanceStatus()\r\n      if (status !== \"connected\") return []\r\n      \r\n      // Use backend endpoint instead of direct Z-API call\r\n      const response = await fetch(\"/api/whatsapp/contacts\", {\r\n        method: \"GET\",\r\n        headers: {\r\n          \"Authorization\": `Bearer ${localStorage.getItem(\"unicrm_access_token\")}`\r\n        }\r\n      })\r\n\r\n      if (!response.ok) {\r\n        const error = await response.text()\r\n        console.error(\"[v0] Backend contacts error:\", error)\r\n        return []\r\n      }\r\n\r\n      const data = await response.json()\r\n      return data.contacts || []\r\n    } catch (error) {\r\n      console.error(\"[v0] Error fetching contacts via backend:\", error)\r\n      return []\r\n    }\r\n  }\r\n\r\n  async getConversations(): Promise<WhatsAppConversation[]> {\r\n    if (!this.instanceId || !this.instanceToken) {\r\n      return []\r\n    }\r\n\r\n    try {\r\n      const status = await this.checkInstanceStatus()\r\n      if (status !== \"connected\") return []\r\n      \r\n      // Use backend endpoint instead of direct Z-API call\r\n      const response = await fetch(\"/api/whatsapp/conversations\", {\r\n        method: \"GET\",\r\n        headers: {\r\n          \"Authorization\": `Bearer ${localStorage.getItem(\"unicrm_access_token\")}`\r\n        }\r\n      })\r\n\r\n      if (!response.ok) {\r\n        const error = await response.text()\r\n        console.error(\"[v0] Backend conversations error:\", error)\r\n        return []\r\n      }\r\n\r\n      const data = await response.json()\r\n      return data.conversations || []\r\n    } catch (error) {\r\n      console.error(\"[v0] Error fetching conversations via backend:\", error)\r\n      return []\r\n    }\r\n  }\r\n\r\n  async getMessages(contactId: string): Promise<WhatsAppMessage[]> {\r\n    if (!this.instanceId || !this.instanceToken) {\r\n      return []\r\n    }\r\n\r\n    try {\r\n      // Use backend endpoint instead of direct Z-API call\r\n      const response = await fetch(`/api/whatsapp/messages/${encodeURIComponent(contactId)}`, {\r\n        method: \"GET\",\r\n        headers: {\r\n          \"Authorization\": `Bearer ${localStorage.getItem(\"unicrm_access_token\")}`\r\n        }\r\n      })\r\n\r\n      if (!response.ok) {\r\n        const error = await response.text()\r\n        console.error(\"[v0] Backend messages error:\", error)\r\n        return []\r\n      }\r\n\r\n      const data = await response.json()\r\n      return data.messages || []\r\n    } catch (error) {\r\n      console.error(\"[v0] Error fetching messages via backend:\", error)\r\n      return []\r\n    }\r\n  }\r\n\r\n  async markAsRead(contactId: string, messageId: string): Promise<void> {\r\n    if (!this.instanceId || !this.instanceToken) {\r\n      return\r\n    }\r\n\r\n    try {\r\n      // Use backend endpoint instead of direct Z-API call\r\n      const response = await fetch(\"/api/whatsapp/mark-read\", {\r\n        method: \"POST\",\r\n        headers: {\r\n          \"Content-Type\": \"application/json\",\r\n          \"Authorization\": `Bearer ${localStorage.getItem(\"unicrm_access_token\")}`\r\n        },\r\n        body: JSON.stringify({\r\n          contactId: contactId.replace(/\\D/g, \"\"),\r\n          messageId: messageId\r\n        })\r\n      })\r\n\r\n      if (!response.ok) {\r\n        const error = await response.text()\r\n        console.error(\"[v0] Backend mark as read failed:\", error)\r\n      } else {\r\n        console.log(\"[v0] Message marked as read via backend\")\r\n      }\r\n    } catch (error) {\r\n      console.error(\"[v0] Error marking message as read via backend:\", error)\r\n    }\r\n  }\r\n\r\n  onMessageReceived(callback: (message: WhatsAppMessage) => void): void {\r\n    this.messageCallback = callback\r\n  }\r\n\r\n  onContactStatusChanged(callback: (contact: WhatsAppContact) => void): void {\r\n    this.contactCallback = callback\r\n  }\r\n\r\n  onQRCodeGenerated(callback: (qrCode: string) => void): void {\r\n    this.qrCodeCallback = callback\r\n  }\r\n\r\n  onStatusChanged(callback: (status: string) => void): void {\r\n    this.statusCallback = callback\r\n  }\r\n\r\n  async disconnect(): Promise<void> {\r\n    if (this.instanceId && this.instanceToken) {\r\n      try {\r\n        // Use backend endpoint instead of direct Z-API call\r\n        const response = await fetch(\"/api/whatsapp/disconnect\", {\r\n          method: \"POST\",\r\n          headers: {\r\n            \"Content-Type\": \"application/json\",\r\n            \"Authorization\": `Bearer ${localStorage.getItem(\"unicrm_access_token\")}`\r\n          },\r\n          body: JSON.stringify({})\r\n        })\r\n\r\n        if (!response.ok) {\r\n          const error = await response.text()\r\n          console.error(\"[v0] Backend disconnect failed:\", error)\r\n          throw new Error(`Disconnect failed: ${response.status}`)\r\n        }\r\n\r\n        const result = await response.json()\r\n        console.log(\"[v0] WhatsApp disconnected via backend:\", result)\r\n\r\n        // Clear saved instance\r\n        localStorage.removeItem(`zapi_instance_${this.clientId}`)\r\n\r\n      } catch (error) {\r\n        console.error(\"[v0] Error disconnecting via backend:\", error)\r\n        throw error\r\n      }\r\n    }\r\n  }\r\n\r\n  async getInstanceStatus(): Promise<string> {\r\n    return await this.checkInstanceStatus()\r\n  }\r\n\r\n  async generatePhoneCode(phone: string): Promise<string> {\r\n    if (!this.instanceId || !this.instanceToken) {\r\n      throw new Error(\"Instance not initialized\")\r\n    }\r\n    \r\n    try {\r\n      // Use backend endpoint instead of direct Z-API call\r\n      const response = await fetch(\"/api/whatsapp/generate-phone-code\", {\r\n        method: \"POST\",\r\n        headers: {\r\n          \"Content-Type\": \"application/json\",\r\n          \"Authorization\": `Bearer ${localStorage.getItem(\"unicrm_access_token\")}`\r\n        },\r\n        body: JSON.stringify({\r\n          phone: phone.replace(/\\D/g, \"\")\r\n        })\r\n      })\r\n\r\n      if (!response.ok) {\r\n        const error = await response.text()\r\n        console.error(\"[v0] Backend phone code generation failed:\", error)\r\n        throw new Error(`Phone code generation failed: ${response.status}`)\r\n      }\r\n\r\n      const text = await response.text()\r\n      try {\r\n        const data = JSON.parse(text)\r\n        return data.code || data.qrcode || data.base64 || \"\"\r\n      } catch {\r\n        return text\r\n      }\r\n    } catch (error) {\r\n      console.error(\"[v0] Error generating phone code via backend:\", error)\r\n      throw error\r\n    }\r\n  }\r\n\r\n  async disconnectInstance(): Promise<boolean> {\r\n    if (!this.instanceId || !this.instanceToken) return false\r\n    \r\n    try {\r\n      // Use backend endpoint instead of direct Z-API call\r\n      const response = await fetch(\"/api/whatsapp/disconnect-instance\", {\r\n        method: \"POST\",\r\n        headers: {\r\n          \"Content-Type\": \"application/json\",\r\n          \"Authorization\": `Bearer ${localStorage.getItem(\"unicrm_access_token\")}`\r\n        },\r\n        body: JSON.stringify({})\r\n      })\r\n\r\n      if (!response.ok) {\r\n        const error = await response.text()\r\n        console.error(\"[v0] Backend disconnect instance failed:\", error)\r\n        return false\r\n      }\r\n\r\n      console.log(\"[v0] Instance disconnected via backend\")\r\n      return true\r\n    } catch (error) {\r\n      console.error(\"[v0] Error disconnecting instance via backend:\", error)\r\n      return false\r\n    }\r\n  }\r\n\r\n  async restartInstance(): Promise<boolean> {\r\n    if (!this.instanceId || !this.instanceToken) return false\r\n    \r\n    try {\r\n      // Use backend endpoint instead of direct Z-API call\r\n      const response = await fetch(\"/api/whatsapp/restart-instance\", {\r\n        method: \"POST\",\r\n        headers: {\r\n          \"Content-Type\": \"application/json\",\r\n          \"Authorization\": `Bearer ${localStorage.getItem(\"unicrm_access_token\")}`\r\n        },\r\n        body: JSON.stringify({})\r\n      })\r\n\r\n      if (!response.ok) {\r\n        const error = await response.text()\r\n        console.error(\"[v0] Backend restart instance failed:\", error)\r\n        return false\r\n      }\r\n\r\n      console.log(\"[v0] Instance restarted via backend\")\r\n      return true\r\n    } catch (error) {\r\n      console.error(\"[v0] Error restarting instance via backend:\", error)\r\n      return false\r\n    }\r\n  }\r\n}\r\n\r\n// WhatsApp Service Manager\r\nexport class WhatsAppService {\r\n  private provider: WhatsAppAPIProvider | null = null\r\n  private contacts: WhatsAppContact[] = []\r\n  private conversations: Map<string, WhatsAppConversation> = new Map()\r\n  private messageListeners: ((message: WhatsAppMessage) => void)[] = []\r\n  private contactListeners: ((contact: WhatsAppContact) => void)[] = []\r\n\r\n  private async ensureProviderInitialized(): Promise<boolean> {\r\n    if (this.provider) return true\r\n    try {\r\n      if (typeof window !== \"undefined\") {\r\n        const keys = [\"unicrm_whatsapp_config\", \"whatsapp_config\"]\r\n        for (const k of keys) {\r\n          const raw = localStorage.getItem(k)\r\n          if (raw) {\r\n            const cfg = JSON.parse(raw)\r\n            if (cfg && cfg.provider) {\r\n              await this.initialize(cfg as WhatsAppAPIConfig)\r\n              return true\r\n            }\r\n          }\r\n        }\r\n      }\r\n    } catch {}\r\n    return false\r\n  }\r\n\r\n  async initialize(config: WhatsAppAPIConfig): Promise<void> {\r\n    console.log(\"[v0] Initializing WhatsApp service with provider:\", config.provider)\r\n\r\n    // Create provider based on configuration\r\n    switch (config.provider) {\r\n      case \"z-api\":\r\n        this.provider = new ZApiProvider(config as ZApiConfig)\r\n        break\r\n      case \"custom\":\r\n      case \"whatsapp-web-js\":\r\n      case \"baileys\":\r\n      case \"twilio\":\r\n      case \"meta-business\":\r\n        this.provider = new GenericWhatsAppProvider(config)\r\n        break\r\n      default:\r\n        throw new Error(`Unsupported WhatsApp provider: ${config.provider}`)\r\n    }\r\n\r\n    const provider = this.provider\r\n    await provider.initialize()\r\n\r\n    if (!provider || this.provider !== provider) {\r\n      return\r\n    }\r\n\r\n    provider.onMessageReceived((message) => {\r\n      this.handleNewMessage(message)\r\n    })\r\n\r\n    provider.onContactStatusChanged((contact) => {\r\n      this.handleContactStatusChange(contact)\r\n    })\r\n\r\n    // Load initial data\r\n    await this.loadContacts()\r\n    await this.loadConversations()\r\n  }\r\n\r\n  private async loadContacts(): Promise<void> {\r\n    if (!this.provider) return\r\n\r\n    try {\r\n      const fetched = await this.provider.getContacts()\r\n      let contacts = Array.isArray(fetched) ? fetched : []\r\n      if (contacts.length === 0) {\r\n        try {\r\n          const convs = await this.provider.getConversations()\r\n          const byId = new Map<string, WhatsAppContact>()\r\n          convs.forEach((c) => {\r\n            const id = (c.contactId || \"\").replace(/\\D/g, \"\")\r\n            if (!id) return\r\n            if (!byId.has(id)) {\r\n              byId.set(id, {\r\n                id,\r\n                name: id,\r\n                phone: id,\r\n                isOnline: true,\r\n                lastSeen: new Date(),\r\n              } as WhatsAppContact)\r\n            }\r\n          })\r\n          contacts = Array.from(byId.values())\r\n        } catch {}\r\n      }\r\n      if (contacts.length > 0) {\r\n        const merged = new Map<string, WhatsAppContact>()\r\n        ;[...this.contacts, ...contacts].forEach((c) => merged.set(c.id, c))\r\n        this.contacts = Array.from(merged.values())\r\n      }\r\n      console.log(\"[v0] Loaded contacts:\", this.contacts.length)\r\n    } catch (error) {\r\n      console.error(\"[v0] Error loading contacts:\", error)\r\n    }\r\n  }\r\n\r\n  private async loadConversations(): Promise<void> {\r\n    if (!this.provider) return\r\n\r\n    try {\r\n      const fromProvider = await this.provider.getConversations()\r\n      const providerConvs = Array.isArray(fromProvider) ? fromProvider : []\r\n      let backendConvs: WhatsAppConversation[] = []\r\n      try {\r\n        const api = API_BASE_URL\r\n        if (api) {\r\n          const res = await fetch(`${api}/whatsapp/conversations`)\r\n          if (res.ok) {\r\n            const data = await res.json()\r\n            const convs = Array.isArray(data?.conversations) ? data.conversations : []\r\n            backendConvs = convs.map((c: any) => ({\r\n              contactId: String(c.contactId || \"\").replace(/\\D/g, \"\"),\r\n              messages: Array.isArray(c.messages)\r\n                ? c.messages.map((m: any) => ({\r\n                    id: String(m.id || `msg_${Date.now()}`),\r\n                    contactId: String(m.contactId || \"\").replace(/\\D/g, \"\"),\r\n                    content: String(m.content || \"\"),\r\n                    timestamp: new Date(String(m.timestamp || new Date().toISOString())),\r\n                    isFromMe: Boolean(m.isFromMe),\r\n                    messageType: (m.messageType as any) || \"text\",\r\n                    status: (m.status as any) || \"received\",\r\n                  }))\r\n                : [],\r\n              unreadCount: Number(c.unreadCount || 0),\r\n              lastMessage: c.lastMessage\r\n                ? {\r\n                    id: String(c.lastMessage.id || `msg_${Date.now()}`),\r\n                    contactId: String(c.lastMessage.contactId || \"\").replace(/\\D/g, \"\"),\r\n                    content: String(c.lastMessage.content || \"\"),\r\n                    timestamp: new Date(String(c.lastMessage.timestamp || new Date().toISOString())),\r\n                    isFromMe: Boolean(c.lastMessage.isFromMe),\r\n                    messageType: (c.lastMessage.messageType as any) || \"text\",\r\n                    status: (c.lastMessage.status as any) || \"received\",\r\n                  }\r\n                : undefined,\r\n            }))\r\n          }\r\n        }\r\n      } catch {}\r\n      const merged = new Map<string, WhatsAppConversation>()\r\n      ;[...providerConvs, ...backendConvs].forEach((conv) => {\r\n        const existing = merged.get(conv.contactId)\r\n        if (!existing) {\r\n          merged.set(conv.contactId, conv)\r\n        } else {\r\n          const byId = new Map<string, WhatsAppMessage>()\r\n          ;(existing.messages || []).forEach((m) => byId.set(m.id, m))\r\n          ;(conv.messages || []).forEach((m) => byId.set(m.id, m))\r\n          existing.messages = Array.from(byId.values()).sort((a, b) => a.timestamp.getTime() - b.timestamp.getTime())\r\n          existing.lastMessage = existing.messages[existing.messages.length - 1] || existing.lastMessage\r\n          existing.unreadCount = existing.messages.filter((m) => !m.isFromMe).length\r\n          merged.set(conv.contactId, existing)\r\n        }\r\n      })\r\n      merged.forEach((v, k) => this.conversations.set(k, v))\r\n      console.log(\"[v0] Loaded conversations:\", merged.size)\r\n    } catch (error) {\r\n      console.error(\"[v0] Error loading conversations:\", error)\r\n    }\r\n  }\r\n\r\n  private handleNewMessage(message: WhatsAppMessage): void {\r\n    console.log(\"[v0] New message received:\", message)\r\n\r\n    // Update conversation\r\n    const conversation = this.conversations.get(message.contactId) || {\r\n      contactId: message.contactId,\r\n      messages: [],\r\n      unreadCount: 0,\r\n    }\r\n\r\n    conversation.messages.push(message)\r\n    conversation.lastMessage = message\r\n\r\n    if (!message.isFromMe) {\r\n      conversation.unreadCount++\r\n    }\r\n\r\n    this.conversations.set(message.contactId, conversation)\r\n\r\n    // Notify listeners\r\n    this.messageListeners.forEach((listener) => listener(message))\r\n  }\r\n\r\n  private handleContactStatusChange(contact: WhatsAppContact): void {\r\n    console.log(\"[v0] Contact status changed:\", contact)\r\n\r\n    // Update contact in list\r\n    const index = this.contacts.findIndex((c) => c.id === contact.id)\r\n    if (index >= 0) {\r\n      this.contacts[index] = contact\r\n    } else {\r\n      this.contacts.push(contact)\r\n    }\r\n\r\n    // Notify listeners\r\n    this.contactListeners.forEach((listener) => listener(contact))\r\n  }\r\n\r\n  async sendMessage(contactId: string, message: string): Promise<WhatsAppMessage | null> {\r\n    if (!this.provider) {\r\n      try {\r\n        const raw = typeof window !== \"undefined\" ? (localStorage.getItem(\"unicrm_whatsapp_config\") || localStorage.getItem(\"whatsapp_config\")) : null\r\n        if (raw) {\r\n          const cfg = JSON.parse(raw)\r\n          await this.initialize(cfg)\r\n        } else {\r\n          console.error(\"[v0] WhatsApp provider not initialized\")\r\n          return null\r\n        }\r\n      } catch (e) {\r\n        console.error(\"[v0] Failed to auto-initialize WhatsApp provider:\", e)\r\n        return null\r\n      }\r\n    }\r\n\r\n    try {\r\n      if (!this.provider) {\r\n        console.error(\"[v0] WhatsApp provider not initialized\")\r\n        return null\r\n      }\r\n      const sentMessage = await this.provider.sendMessage(contactId, message)\r\n      try {\r\n        const api = API_BASE_URL\r\n        if (api) {\r\n          await fetch(`${api}/whatsapp/send-message`, {\r\n            method: \"POST\",\r\n            headers: { \"Content-Type\": \"application/json\" },\r\n            body: JSON.stringify({ contactId: contactId, message, timestamp: new Date().toISOString() }),\r\n          })\r\n        }\r\n      } catch {}\r\n      this.handleNewMessage(sentMessage)\r\n      return sentMessage\r\n    } catch (error) {\r\n      console.error(\"[v0] Error sending message:\", error)\r\n      return null\r\n    }\r\n  }\r\n\r\n  getContacts(): WhatsAppContact[] {\r\n    return this.contacts ? [...this.contacts] : []\r\n  }\r\n\r\n  getConversation(contactId: string): WhatsAppConversation | null {\r\n    return this.conversations.get(contactId) || null\r\n  }\r\n\r\n  getAllConversations(): WhatsAppConversation[] {\r\n    return Array.from(this.conversations.values())\r\n  }\r\n\r\n  createContact(phone: string, name?: string): WhatsAppContact {\r\n    const digits = (phone || \"\").replace(/\\D/g, \"\")\r\n    const contact: WhatsAppContact = {\r\n      id: digits,\r\n      name: name?.trim() || digits,\r\n      phone: digits,\r\n      avatar: undefined,\r\n      isOnline: true,\r\n      lastSeen: new Date(),\r\n    }\r\n    // Add or update contact list\r\n    const index = this.contacts.findIndex((c) => c.id === contact.id)\r\n    if (index >= 0) {\r\n      this.contacts[index] = contact\r\n    } else {\r\n      this.contacts.push(contact)\r\n    }\r\n    // Ensure conversation exists\r\n    if (!this.conversations.has(digits)) {\r\n      this.conversations.set(digits, { contactId: digits, messages: [], unreadCount: 0 })\r\n    }\r\n    // Notify listeners\r\n    this.contactListeners.forEach((listener) => listener(contact))\r\n    return contact\r\n  }\r\n\r\n  async markAsRead(contactId: string, messageId: string): Promise<void> {\r\n    if (!this.provider) return\r\n\r\n    try {\r\n      await this.provider.markAsRead(contactId, messageId)\r\n\r\n      // Update local conversation\r\n      const conversation = this.conversations.get(contactId)\r\n      if (conversation) {\r\n        conversation.unreadCount = 0\r\n        this.conversations.set(contactId, conversation)\r\n      }\r\n    } catch (error) {\r\n      console.error(\"[v0] Error marking message as read:\", error)\r\n    }\r\n  }\r\n\r\n  async disconnectInstance(): Promise<boolean> {\r\n    if (!this.provider) {\r\n      const okInit = await this.ensureProviderInitialized()\r\n      if (!okInit) return false\r\n    }\r\n    if (this.provider instanceof ZApiProvider) {\r\n      const ok = await this.provider.disconnectInstance()\r\n      try { await (this.provider as ZApiProvider).getInstanceStatus() } catch {}\r\n      return ok\r\n    }\r\n    return false\r\n  }\r\n\r\n  async restartInstance(): Promise<boolean> {\r\n    if (!this.provider) {\r\n      const okInit = await this.ensureProviderInitialized()\r\n      if (!okInit) return false\r\n    }\r\n    if (this.provider instanceof ZApiProvider) {\r\n      const ok = await this.provider.restartInstance()\r\n      try { await (this.provider as ZApiProvider).getInstanceStatus() } catch {}\r\n      return ok\r\n    }\r\n    return false\r\n  }\r\n\r\n  async generatePhoneCode(phone: string): Promise<string> {\r\n    if (!this.provider) return \"\"\r\n    if (this.provider instanceof ZApiProvider) {\r\n      return await this.provider.generatePhoneCode(phone)\r\n    }\r\n    return \"\"\r\n  }\r\n\r\n  async refreshMessages(contactId: string): Promise<WhatsAppMessage[]> {\r\n    if (!this.provider) return []\r\n    try {\r\n      const candidates: string[] = (() => {\r\n        const digits = (contactId || \"\").replace(/\\D/g, \"\")\r\n        const set = new Set<string>()\r\n        set.add(digits)\r\n        if (digits.length === 11 && !digits.startsWith(\"55\")) set.add(`55${digits}`)\r\n        if (digits.startsWith(\"55\") && digits.length > 11) set.add(digits.slice(2))\r\n        return Array.from(set)\r\n      })()\r\n\r\n      const providerMsgsArr: WhatsAppMessage[][] = []\r\n      for (const cand of candidates) {\r\n        try {\r\n          const msgs = await this.provider.getMessages(cand)\r\n          if (Array.isArray(msgs) && msgs.length > 0) providerMsgsArr.push(msgs)\r\n        } catch {}\r\n      }\r\n      const providerMsgs: WhatsAppMessage[] = ([] as WhatsAppMessage[]).concat(...providerMsgsArr)\r\n\r\n      let backendMsgs: WhatsAppMessage[] = []\r\n      try {\r\n        const api = API_BASE_URL\r\n        if (api) {\r\n          for (const cand of candidates) {\r\n            const res = await fetch(`${api}/whatsapp/messages/${cand}`)\r\n            if (res.ok) {\r\n              const data = await res.json()\r\n              const backend = Array.isArray(data?.messages) ? data.messages : []\r\n              const mapped = backend.map((m: any) => ({\r\n                id: String(m.id || `msg_${Date.now()}`),\r\n                contactId: String(m.contactId || \"\").replace(/\\D/g, \"\"),\r\n                content: String(m.content || \"\"),\r\n                timestamp: new Date(String(m.timestamp || new Date().toISOString())),\r\n                isFromMe: Boolean(m.isFromMe),\r\n                messageType: (m.messageType as any) || \"text\",\r\n                status: (m.status as any) || \"received\",\r\n              }))\r\n              backendMsgs = backendMsgs.concat(mapped)\r\n            }\r\n          }\r\n        }\r\n      } catch {}\r\n      const existing = this.conversations.get(contactId) || { contactId, messages: [], unreadCount: 0 }\r\n      const byId = new Map<string, WhatsAppMessage>()\r\n      const push = (m: WhatsAppMessage) => {\r\n        const k = `${m.id}|${m.timestamp instanceof Date ? m.timestamp.getTime() : new Date(m.timestamp).getTime()}`\r\n        byId.set(k, m)\r\n      }\r\n      ;(existing.messages || []).forEach(push)\r\n      ;(providerMsgs || []).forEach(push)\r\n      ;(backendMsgs || []).forEach(push)\r\n      const combined = Array.from(byId.values()).sort((a, b) => a.timestamp.getTime() - b.timestamp.getTime())\r\n      if (combined.length > 0) {\r\n        const byId = new Map<string, WhatsAppMessage>()\r\n        combined.forEach((m) => byId.set(m.id, m))\r\n        existing.messages = Array.from(byId.values())\r\n        existing.lastMessage = existing.messages[existing.messages.length - 1] || existing.lastMessage\r\n        existing.unreadCount = existing.messages.filter((m) => !m.isFromMe).length\r\n      }\r\n      this.conversations.set(contactId, existing as WhatsAppConversation)\r\n      return existing.messages\r\n    } catch (error) {\r\n      console.error(\"[v0] Error refreshing messages:\", error)\r\n      return []\r\n    }\r\n  }\r\n\r\n  onMessageReceived(callback: (message: WhatsAppMessage) => void): void {\r\n    this.messageListeners.push(callback)\r\n  }\r\n\r\n  offMessageReceived(callback: (message: WhatsAppMessage) => void): void {\r\n    this.messageListeners = this.messageListeners.filter((cb) => cb !== callback)\r\n  }\r\n\r\n  onContactStatusChanged(callback: (contact: WhatsAppContact) => void): void {\r\n    this.contactListeners.push(callback)\r\n  }\r\n\r\n  offContactStatusChanged(callback: (contact: WhatsAppContact) => void): void {\r\n    this.contactListeners = this.contactListeners.filter((cb) => cb !== callback)\r\n  }\r\n\r\n  async disconnect(): Promise<void> {\r\n    if (this.provider) {\r\n      await this.provider.disconnect()\r\n      this.provider = null\r\n    }\r\n\r\n    this.contacts = []\r\n    this.conversations.clear()\r\n    this.messageListeners = []\r\n    this.contactListeners = []\r\n  }\r\n}\r\n\r\n// Global WhatsApp service instance\r\nexport const whatsappService = new WhatsAppService()\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Projetos\\Back_endCrm\\kanbanproject1\\next-env.d.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projetos\\Back_endCrm\\kanbanproject1\\next.config.mjs","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projetos\\Back_endCrm\\kanbanproject1\\postcss.config.mjs","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projetos\\Back_endCrm\\kanbanproject1\\tailwind.config.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]}]